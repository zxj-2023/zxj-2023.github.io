<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="å‰è¨€ æœ¬æ•™ç¨‹ä¸ºlangchainå®˜æ–¹æ•™ç¨‹çš„å­¦ä¹ è®°å½• academy.langchain.com&#x2F;enrollments ä»£ç è§[learn-rag-langchain&#x2F;academy-langgraph at main Â· zxj-2023&#x2F;learn-rag-langchain](https:&#x2F;&#x2F;github.com&#x2F;zxj-2023&#x2F;learn-rag-langchain&#x2F;tree&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="LangGraphå­¦ä¹ â€”â€”agentâ€”â€”ä¸Š">
<meta property="og:url" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/index.html">
<meta property="og:site_name" content="Zhang XiJun">
<meta property="og:description" content="å‰è¨€ æœ¬æ•™ç¨‹ä¸ºlangchainå®˜æ–¹æ•™ç¨‹çš„å­¦ä¹ è®°å½• academy.langchain.com&#x2F;enrollments ä»£ç è§[learn-rag-langchain&#x2F;academy-langgraph at main Â· zxj-2023&#x2F;learn-rag-langchain](https:&#x2F;&#x2F;github.com&#x2F;zxj-2023&#x2F;learn-rag-langchain&#x2F;tree&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719142543838.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719145948088.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66e0e9f526b41a4ed9e2d28b_agent-memory2.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719154439415.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719171509917.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719203204234.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66dbaf892d24625a201744e5_streaming1.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250720225640772.png">
<meta property="og:image" content="https://cdn.prod.website-files.com/65b8cd72835ceeacd4449a53/66dbae7985b747dfed67775d_breakpoints1.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250720230924672.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250721222709712.png">
<meta property="og:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66dbb038f89f2d847ee5c336_time-travel3.png">
<meta property="article:published_time" content="2025-07-17T16:00:00.000Z">
<meta property="article:modified_time" content="2025-08-13T01:25:22.000Z">
<meta property="article:author" content="å¼ ç†™æµš">
<meta property="article:tag" content="langgraph">
<meta property="article:tag" content="fastapi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719142543838.png">


<link rel="canonical" href="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/","path":"2025/07/18/å­¦ä¹ /aiæ¡†æ¶/langgraph-agent/","title":"LangGraphå­¦ä¹ â€”â€”agentâ€”â€”ä¸Š"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LangGraphå­¦ä¹ â€”â€”agentâ€”â€”ä¸Š | Zhang XiJun</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Zhang XiJun</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">BLOGS</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-1"><span class="nav-number">2.</span> <span class="nav-text">module-1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#route%E8%B7%AF%E7%94%B1"><span class="nav-number">2.1.</span> <span class="nav-text">routeè·¯ç”±</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7"><span class="nav-number">2.1.1.</span> <span class="nav-text">å®šä¹‰å·¥å…·</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E6%9D%A1%E4%BB%B6%E8%BE%B9"><span class="nav-number">2.1.2.</span> <span class="nav-text">æ„å»ºæ¡ä»¶è¾¹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B0%83%E7%94%A8"><span class="nav-number">2.1.3.</span> <span class="nav-text">è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#agent%E4%BB%A3%E7%90%86"><span class="nav-number">2.2.</span> <span class="nav-text">agentä»£ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E5%B7%A5%E5%85%B7-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">å®šä¹‰å·¥å…·</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86"><span class="nav-number">2.2.2.</span> <span class="nav-text">åˆ›å»ºä»£ç†</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B0%83%E7%94%A8-1"><span class="nav-number">2.2.3.</span> <span class="nav-text">è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#agent-memory%E4%BB%A3%E7%90%86%E8%AE%B0%E5%BF%86"><span class="nav-number">2.3.</span> <span class="nav-text">Agent memoryä»£ç†è®°å¿†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-2"><span class="nav-number">3.</span> <span class="nav-text">module-2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#state-scheme%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.</span> <span class="nav-text">state-schemeçŠ¶æ€æ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#typeddict"><span class="nav-number">3.1.1.</span> <span class="nav-text">TypedDict</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dataclass%E6%95%B0%E6%8D%AE%E7%B1%BB"><span class="nav-number">3.1.2.</span> <span class="nav-text">Dataclassæ•°æ®ç±»</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#state-reducers%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0%E5%87%BD%E6%95%B0"><span class="nav-number">3.2.</span> <span class="nav-text">State
ReducersçŠ¶æ€æ›´æ–°å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#custom-reducers-%E8%87%AA%E5%AE%9A%E4%B9%89-reducers"><span class="nav-number">3.2.1.</span> <span class="nav-text">Custom Reducers è‡ªå®šä¹‰
Reducers</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#messagesstate"><span class="nav-number">3.2.2.</span> <span class="nav-text">MessagesState</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#multiple-schemas-%E5%A4%9A%E7%A7%8D%E7%8A%B6%E6%80%81"><span class="nav-number">3.3.</span> <span class="nav-text">Multiple Schemas
å¤šç§çŠ¶æ€</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#private-state-%E7%A7%81%E6%9C%89%E7%8A%B6%E6%80%81"><span class="nav-number">3.3.1.</span> <span class="nav-text">Private State
ç§æœ‰çŠ¶æ€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#input-output-schema-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.3.2.</span> <span class="nav-text">Input &#x2F; Output Schema
è¾“å…¥&#x2F;è¾“å‡ºæ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#filtering-and-trimming-messages%E7%AD%9B%E9%80%89%E5%92%8C%E7%B2%BE%E7%AE%80%E6%B6%88%E6%81%AF"><span class="nav-number">3.4.</span> <span class="nav-text">Filtering
and trimming messagesç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8C%96%E5%99%A8reducer"><span class="nav-number">3.4.1.</span> <span class="nav-text">ç®€åŒ–å™¨ï¼ˆReducerï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AD%9B%E9%80%89%E6%B6%88%E6%81%AFfiltering-messages"><span class="nav-number">3.4.2.</span> <span class="nav-text">ç­›é€‰æ¶ˆæ¯ï¼ˆFiltering
messagesï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A3%81%E5%89%AA%E6%B6%88%E6%81%AFtrim-messages"><span class="nav-number">3.4.3.</span> <span class="nav-text">è£å‰ªæ¶ˆæ¯ï¼ˆTrim
messagesï¼‰</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#chatbot-with-message-summarization%E5%B8%A6%E6%9C%89%E6%B6%88%E6%81%AF%E6%80%BB%E7%BB%93%E5%8A%9F%E8%83%BD%E7%9A%84%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="nav-number">3.5.</span> <span class="nav-text">Chatbot
with message summarizationå¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%80%BB%E7%BB%93%E7%8A%B6%E6%80%81"><span class="nav-number">3.5.1.</span> <span class="nav-text">å®šä¹‰æ€»ç»“çŠ¶æ€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89llm%E8%8A%82%E7%82%B9"><span class="nav-number">3.5.2.</span> <span class="nav-text">å®šä¹‰LLMèŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%91%98%E8%A6%81%E8%8A%82%E7%82%B9"><span class="nav-number">3.5.3.</span> <span class="nav-text">å®šä¹‰æ‘˜è¦èŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E5%87%BD%E6%95%B0"><span class="nav-number">3.5.4.</span> <span class="nav-text">å®šä¹‰è·¯ç”±å‡½æ•°</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%86%85%E5%AD%98%E5%B9%B6%E7%BC%96%E8%AF%91%E5%9B%BE"><span class="nav-number">3.5.5.</span> <span class="nav-text">æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="nav-number">3.5.6.</span> <span class="nav-text">ä½¿ç”¨çº¿ç¨‹è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#chatbot-with-message-summarization-external-db-memory%E5%85%B7%E6%9C%89%E6%B6%88%E6%81%AF%E6%80%BB%E7%BB%93%E5%92%8C%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%B0%E5%BF%86%E7%9A%84%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="nav-number">3.6.</span> <span class="nav-text">Chatbot
with message summarization &amp; external DB
memoryå…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.6.1.</span> <span class="nav-text">ä½¿ç”¨æ•°æ®åº“</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-3"><span class="nav-number">4.</span> <span class="nav-text">module-3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#streaming-%E6%B5%81%E5%BC%8F%E4%BC%A0%E8%BE%93"><span class="nav-number">4.1.</span> <span class="nav-text">Streaming æµå¼ä¼ è¾“</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#stream_modeupdates"><span class="nav-number">4.1.1.</span> <span class="nav-text">stream_mode&#x3D;â€œupdatesâ€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#stream_modevalues"><span class="nav-number">4.1.2.</span> <span class="nav-text">stream_mode&#x3D;â€œvaluesâ€</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#streaming-tokens-%E6%B5%81%E5%BC%8F%E4%BC%A0%E8%BE%93%E4%BB%A4%E7%89%8C"><span class="nav-number">4.1.3.</span> <span class="nav-text">Streaming tokens
æµå¼ä¼ è¾“ä»¤ç‰Œ</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#breakpoints-%E6%96%AD%E7%82%B9"><span class="nav-number">4.2.</span> <span class="nav-text">Breakpoints æ–­ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#breakpoints-for-human-approval%E7%94%A8%E4%BA%8E%E4%BA%BA%E7%B1%BB%E5%AE%A1%E6%89%B9%E7%9A%84%E6%96%AD%E7%82%B9"><span class="nav-number">4.2.1.</span> <span class="nav-text">Breakpoints
for human approvalç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#editing-graph-state-%E7%BC%96%E8%BE%91%E5%9B%BE%E7%8A%B6%E6%80%81"><span class="nav-number">4.3.</span> <span class="nav-text">Editing graph state
ç¼–è¾‘å›¾çŠ¶æ€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dynamic-breakpoints-%E5%8A%A8%E6%80%81%E6%96%AD%E7%82%B9"><span class="nav-number">4.4.</span> <span class="nav-text">Dynamic breakpoints
åŠ¨æ€æ–­ç‚¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#time-travel-%E6%97%B6%E9%97%B4%E6%97%85%E8%A1%8C"><span class="nav-number">4.5.</span> <span class="nav-text">Time travel æ—¶é—´æ—…è¡Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#browsing-history-%E6%B5%8F%E8%A7%88%E5%8E%86%E5%8F%B2"><span class="nav-number">4.5.1.</span> <span class="nav-text">Browsing History
æµè§ˆå†å²</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#replaying-%E5%9B%9E%E6%94%BE"><span class="nav-number">4.5.2.</span> <span class="nav-text">Replaying
å›æ”¾</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#forking-%E5%88%86%E5%8F%89"><span class="nav-number">4.5.3.</span> <span class="nav-text">Forking åˆ†å‰</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">5.</span> <span class="nav-text">åŸºç¡€çŸ¥è¯†</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#message"><span class="nav-number">5.1.</span> <span class="nav-text">message</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å¼ ç†™æµš"
      src="/images/zxjavatar.gif">
  <p class="site-author-name" itemprop="name">å¼ ç†™æµš</p>
  <div class="site-description" itemprop="description">zxj Blogs</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">164</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zxj-2023" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zxj-2023" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=2902065320&site=qq&menu=yes" title="QQ â†’ http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;2902065320&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener me" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          é“¾æ¥
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://zxj-2023.github.io/" title="https:&#x2F;&#x2F;zxj-2023.github.io" rel="noopener" target="_blank">Zhang XiJun</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://theme-next.js.org/" title="https:&#x2F;&#x2F;theme-next.js.org" rel="noopener" target="_blank">NexT</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="LangGraphå­¦ä¹ â€”â€”agentâ€”â€”ä¸Š | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          LangGraphå­¦ä¹ â€”â€”agentâ€”â€”ä¸Š
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-18T00:00:00+08:00">2025-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-13 09:25:22" itemprop="dateModified" datetime="2025-08-13T09:25:22+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="æœ¬æ–‡æ€»é˜…è¯»é‡ far fa-eye æ¬¡"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h3 id="å‰è¨€">å‰è¨€</h3>
<p>æœ¬æ•™ç¨‹ä¸ºlangchainå®˜æ–¹æ•™ç¨‹çš„å­¦ä¹ è®°å½•</p>
<p><a target="_blank" rel="noopener" href="https://academy.langchain.com/enrollments">academy.langchain.com/enrollments</a></p>
<p>ä»£ç è§<a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain">[learn-rag-langchain/academy-langgraph
at main Â·
zxj-2023/learn-rag-langchain](https://github.com/zxj-2023/learn-rag-langchain/tree/main/academy-langgraph)</a></p>
<h3 id="module-1">module-1</h3>
<h4 id="routeè·¯ç”±">routeè·¯ç”±</h4>
<p>åœ¨ LangGraph
ä¸­ï¼Œ<strong>routeï¼ˆè·¯ç”±ï¼‰*<em>çš„æ ¸å¿ƒä½œç”¨æ˜¯*</em>æ ¹æ®å½“å‰çŠ¶æ€åŠ¨æ€å†³å®šâ€œä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œå“ªä¸ªèŠ‚ç‚¹â€</strong></p>
<h5 id="å®šä¹‰å·¥å…·">å®šä¹‰å·¥å…·</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def multiply(a: int, b: int) -&gt; int:</span><br><span class="line">    &quot;&quot;&quot;Multiply a and b.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        a: first int</span><br><span class="line">        b: second int</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return a * b</span><br><span class="line">    </span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line">llm_with_tools = llm.bind_tools([multiply])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸‰å¼•å·å­—ç¬¦ä¸²å« <strong>docstring</strong>ï¼Œå®ƒä¼šè¢« LangChain
æ‹¿æ¥åšä¸¤ä»¶äº‹ï¼š</p>
<ol type="1">
<li><strong>ç”Ÿæˆå·¥å…·çš„ descriptionï¼ˆç»™å¤§æ¨¡å‹çœ‹çš„â€œè¯´æ˜ä¹¦â€ï¼‰</strong>
æ²¡æœ‰å®ƒæ—¶ï¼ŒLangChain åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼ŒæŠŠå‡½æ•°å <code>multiply</code>
æ‹¼æˆä¸€å¥ â€œmultiply toolâ€
ä¹‹ç±»çš„é»˜è®¤æè¿°ã€‚å¤§æ¨¡å‹æ‹¿åˆ°çš„å·¥å…·åˆ—è¡¨é‡Œï¼Œè¿™ä¸ªå·¥å…·å°±åªæœ‰ä¸€ä¸ªå¹²å·´å·´çš„åå­—å’Œå‚æ•°åˆ—è¡¨ï¼Œå®ƒå¯èƒ½çŒœä¸åˆ°è¿™ä¸ªå·¥å…·åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„</li>
<li><strong>ç»™äººç±»å¼€å‘è€…è‡ªå·±çœ‹</strong>
IDEã€æ–‡æ¡£ç”Ÿæˆå™¨ã€é™æ€æ£€æŸ¥å·¥å…·éƒ½ä¼šè¯»å–è¿™æ®µæ–‡å­—ï¼Œæ–¹ä¾¿åæœŸç»´æŠ¤ã€‚</li>
</ol>
</blockquote>
<h5 id="æ„å»ºæ¡ä»¶è¾¹">æ„å»ºæ¡ä»¶è¾¹</h5>
<p><code>tool_calling_llm</code>
æ˜¯ä¸€ä¸ª<strong>æ™®é€šçš„è®¡ç®—èŠ‚ç‚¹</strong>ï¼ˆnodeï¼‰ï¼Œè´Ÿè´£æŠŠå½“å‰å¯¹è¯çŠ¶æ€äº¤ç»™å¤§æ¨¡å‹ï¼Œè®©å¤§æ¨¡å‹å†³å®šè¦ä¸è¦è°ƒç”¨å·¥å…·ï¼›</p>
<p>çœŸæ­£å®Œæˆâ€œè·¯ç”±â€åŠ¨ä½œçš„æ˜¯ <strong><code>tools_condition</code></strong>
è¿™ä¸ªå‡½æ•°â€”â€”å®ƒæ‰æ˜¯ LangGraph é‡Œçš„ <strong>routeï¼ˆæ¡ä»¶è¾¹ï¼‰</strong>ã€‚</p>
<p><code>tools_condition</code> æ˜¯ ä½œä¸º<strong>LangGraph
é¢„ç½®çš„â€œé»˜è®¤è·¯ç”±å‡½æ•°â€</strong>ï¼ŒåŠŸèƒ½å°±æ˜¯ï¼Œå¦‚æœå¤§æ¨¡å‹çš„æœ€æ–°å›å¤ä¸­åŒ…å«å·¥å…·è°ƒç”¨ï¼Œå°±è°ƒç”¨å·¥å…·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Node</span><br><span class="line">def tool_calling_llm(state: MessagesState):</span><br><span class="line">	#è°ƒç”¨å¤§æ¨¡å‹åå°†æœ€æ–°çš„æ¶ˆæ¯è¿”å›</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm_with_tools.invoke(state[&quot;messages&quot;])]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">#MessagesState æ˜¯ LangGraph å®˜æ–¹é¢„ç½® çš„ä¸€ç§ çŠ¶æ€ï¼ˆStateï¼‰å®šä¹‰</span><br><span class="line">#è¿™ä¸ªçŠ¶æ€ç»´æŠ¤äº†ä¸€ä¸ªæ¶ˆæ¯listï¼Œæœ‰æ–°çš„æ¶ˆæ¯å°±åŠ è¿›è¿™ä¸ªæ¶ˆæ¯list</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;tool_calling_llm&quot;, tool_calling_llm)</span><br><span class="line">builder.add_node(&quot;tools&quot;, ToolNode([multiply]))</span><br><span class="line">builder.add_edge(START, &quot;tool_calling_llm&quot;)</span><br><span class="line">builder.add_conditional_edges(</span><br><span class="line">    &quot;tool_calling_llm&quot;,</span><br><span class="line">    # å¦‚æœåŠ©æ‰‹ï¼ˆç»“æœï¼‰çš„æœ€æ–°æ¶ˆæ¯æ˜¯å·¥å…·è°ƒç”¨ -&gt; tools_condition è·¯ç”±åˆ°å·¥å…·</span><br><span class="line">    # å¦‚æœåŠ©æ‰‹ï¼ˆç»“æœï¼‰çš„æœ€æ–°æ¶ˆæ¯ä¸æ˜¯å·¥å…·è°ƒç”¨ -&gt; tools_condition è·¯ç”±åˆ° END</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line">builder.add_edge(&quot;tools&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719142543838.png" alt="image-20250719142543838">
<figcaption aria-hidden="true">image-20250719142543838</figcaption>
</figure>
<h5 id="è°ƒç”¨">è°ƒç”¨</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import HumanMessage</span><br><span class="line">messages = [HumanMessage(content=&quot;ä½ å¥½ï¼Œ2ä¹˜2æ˜¯å¤šå°‘&quot;)]</span><br><span class="line">messages = graph.invoke(&#123;&quot;messages&quot;: messages&#125;)</span><br><span class="line">for m in messages[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼Œ2ä¹˜2æ˜¯å¤šå°‘</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_e026ceb409e247748786ad)</span><br><span class="line"> Call ID: call_e026ceb409e247748786ad</span><br><span class="line">  Args:</span><br><span class="line">    a: 2</span><br><span class="line">    b: 2</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h4 id="agentä»£ç†">agentä»£ç†</h4>
<p>åœ¨ LangGraph ä¸­ï¼Œ<strong>ä»£ç†ï¼ˆAgentï¼‰</strong>
è¢«æ˜ç¡®å®šä¹‰ä¸º<strong>â€œä¸€ä¸ªç”±å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é©±åŠ¨çš„ã€èƒ½å¤Ÿå¾ªç¯å†³ç­–å¹¶è°ƒç”¨å¤–éƒ¨å·¥å…·æ¥å®Œæˆä»»åŠ¡çš„èŠ‚ç‚¹æˆ–å­å›¾â€</strong>ã€‚</p>
<p><strong>Agent = LLM + å·¥å…·é›†åˆ + æç¤ºæ¨¡æ¿</strong>ï¼Œä¸‰è€…åœ¨ LangGraph
çš„çŠ¶æ€åŒ–å›¾ç»“æ„é‡Œå¾ªç¯è¿è¡Œï¼Œç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶ã€‚</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2210.03629">ReAct</a>
æ˜¯ä¸€ç§æµè¡Œçš„é€šç”¨æ™ºèƒ½ä½“æ¶æ„ï¼Œå®ƒç»“åˆäº†è¿™äº›æ‰©å±•ï¼Œå¹¶æ•´åˆäº†ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/agentic_concepts/#tool-calling">å·¥å…·è°ƒç”¨</a>ï¼šå…è®¸LLMæ ¹æ®éœ€è¦é€‰æ‹©å’Œä½¿ç”¨å„ç§å·¥å…·ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/agentic_concepts/#memory">è®°å¿†</a>ï¼šä½¿æ™ºèƒ½ä½“èƒ½å¤Ÿä¿ç•™å’Œä½¿ç”¨ä¹‹å‰æ­¥éª¤çš„ä¿¡æ¯ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/agentic_concepts/#planning">è§„åˆ’</a>ï¼šä½¿LLMèƒ½å¤Ÿåˆ›å»ºå¹¶éµå¾ªå¤šæ­¥è®¡åˆ’ä»¥å®ç°ç›®æ ‡ã€‚</li>
</ol>
<p>å³</p>
<p><code>act</code>- è®©æ¨¡å‹è°ƒç”¨ç‰¹å®šå·¥å…·</p>
<p><code>observe</code> - å°†å·¥å…·è¾“å‡ºä¼ é€’å›æ¨¡å‹</p>
<p><code>reason</code> -
è®©æ¨¡å‹å¯¹å·¥å…·è¾“å‡ºè¿›è¡Œæ¨ç†ï¼Œä»¥å†³å®šä¸‹ä¸€æ­¥æ“ä½œï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå·¥å…·æˆ–ç›´æ¥å“åº”ï¼‰</p>
</blockquote>
<h5 id="å®šä¹‰å·¥å…·-1">å®šä¹‰å·¥å…·</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tools = [add, multiply, divide]#å·¥å…·å‡½æ•°å…·ä½“å†…å®¹çœç•¥</span><br><span class="line">llm = ChatOpenAI()</span><br><span class="line"></span><br><span class="line"># åœ¨è¿™ä¸ª ipynb æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å¹¶è¡Œå·¥å…·è°ƒç”¨ï¼ˆparallel tool callingï¼‰è®¾ç½®ä¸º falseï¼Œå› ä¸ºæ•°å­¦è®¡ç®—é€šå¸¸æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œå¹¶ä¸”è¿™æ¬¡æˆ‘ä»¬æœ‰3ä¸ªå¯ä»¥è¿›è¡Œæ•°å­¦è®¡ç®—çš„å·¥å…·ã€‚</span><br><span class="line"># OpenAI æ¨¡å‹ä¸ºäº†æ•ˆç‡ï¼Œé»˜è®¤è¿›è¡Œå¹¶è¡Œå·¥å…·è°ƒç”¨ï¼Œè¯¦æƒ…è¯·å‚é˜… `https://python.langchain.com/docs/how_to/tool_calling_parallel/`</span><br><span class="line"># ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ¨¡å‹åœ¨å¤„ç†æ•°å­¦æ–¹ç¨‹å¼æ—¶çš„è¡¨ç°ï¼</span><br><span class="line">llm_with_tools = llm.bind_tools(tools, parallel_tool_calls=False)</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºä»£ç†">åˆ›å»ºä»£ç†</h5>
<p>å®šä¹‰èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import MessagesState</span><br><span class="line">from langchain_core.messages import HumanMessage, SystemMessage</span><br><span class="line"></span><br><span class="line"># System message</span><br><span class="line">sys_msg = SystemMessage(content=&quot;ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼Œè´Ÿè´£å¯¹ä¸€ç»„è¾“å…¥æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚&quot;)</span><br><span class="line"></span><br><span class="line"># Node</span><br><span class="line">def assistant(state: MessagesState):</span><br><span class="line">   return &#123;&quot;messages&quot;: [llm_with_tools.invoke([sys_msg] + state[&quot;messages&quot;])]&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥ç›¸å½“äºå®šä¹‰äº†ç³»ç»Ÿæç¤ºè¯ï¼Œç„¶ååœ¨ assistant è¿™ä¸ªèŠ‚ç‚¹é‡Œï¼Œé€šè¿‡
[sys_msg] + state[â€œmessagesâ€]
è¿™éƒ¨åˆ†ä»£ç ï¼Œè¿™ä¸ªç³»ç»Ÿæç¤ºè¯è¢«æ·»åŠ åˆ°äº†æ•´ä¸ªå¯¹è¯å†å²çš„æœ€å‰é¢ï¼Œç„¶åä¸€èµ·å‘é€ç»™æ¨¡å‹ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆå›å¤æ—¶å°±ä¼šéµå¾ªè¿™ä¸ªç³»ç»Ÿæç¤ºè¯çš„æŒ‡ç¤ºã€‚</p>
<p>ä¸ä¸Šä¸€ä¸ªä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å°† <code>Tools</code> èŠ‚ç‚¹
<strong>å›ç¯</strong> è¿æ¥åˆ°
<code>Assistant</code>ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå›è·¯ã€‚</p>
<p>åœ¨
assistantèŠ‚ç‚¹æ‰§è¡Œåï¼Œ<code>tools_condition</code>æ£€æŸ¥æ¨¡å‹çš„è¾“å‡ºæ˜¯å¦ä¸ºå·¥å…·è°ƒç”¨ã€‚</p>
<p>å¦‚æœæ˜¯å·¥å…·è°ƒç”¨ï¼Œåˆ™æµç¨‹è¢«å¯¼å‘è‡³ <code>tools</code> èŠ‚ç‚¹ã€‚</p>
<p><code>tools</code>èŠ‚ç‚¹é‡æ–°è¿æ¥åˆ°<code>assistant</code><strong>ã€‚</strong>
åªè¦æ¨¡å‹å†³å®šè°ƒç”¨å·¥å…·ï¼Œæ­¤å¾ªç¯å°±ä¼šç»§ç»­ã€‚</p>
<p>å¦‚æœæ¨¡å‹çš„å“åº”ä¸æ˜¯å·¥å…·è°ƒç”¨ï¼Œåˆ™æµç¨‹è¢«å¯¼å‘è‡³ç»“æŸï¼Œç»ˆæ­¢è¯¥è¿‡ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"># Define nodes: these do the work</span><br><span class="line">builder.add_node(&quot;assistant&quot;, assistant)</span><br><span class="line">builder.add_node(&quot;tools&quot;, ToolNode(tools))</span><br><span class="line"></span><br><span class="line"># Define edges: these determine how the control flow moves</span><br><span class="line">builder.add_edge(START, &quot;assistant&quot;)</span><br><span class="line">builder.add_conditional_edges(</span><br><span class="line">    &quot;assistant&quot;,</span><br><span class="line">    # If the latest message (result) from assistant is a tool call -&gt; tools_condition routes to tools</span><br><span class="line">    # If the latest message (result) from assistant is a not a tool call -&gt; tools_condition routes to END</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line">builder.add_edge(&quot;tools&quot;, &quot;assistant&quot;)</span><br><span class="line">react_graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># Show</span><br><span class="line">display(Image(react_graph.get_graph(xray=True).draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719145948088.png" alt="image-20250719145948088">
<figcaption aria-hidden="true">image-20250719145948088</figcaption>
</figure>
<h5 id="è°ƒç”¨-1">è°ƒç”¨</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">messages = [HumanMessage(content=&quot;å°†3å’Œ4ç›¸åŠ ã€‚å°†ç»“æœä¹˜ä»¥2ã€‚å†å°†ç»“æœé™¤ä»¥5ã€‚&quot;)]</span><br><span class="line">messages = react_graph.invoke(&#123;&quot;messages&quot;: messages&#125;)</span><br><span class="line"></span><br><span class="line">for m in messages[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>parallel_tool_calls=Falseçš„è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">å°†3å’Œ4ç›¸åŠ ã€‚å°†ç»“æœä¹˜ä»¥2ã€‚å†å°†ç»“æœé™¤ä»¥5ã€‚</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  add (call_6c69898dba0342bfbb889e)</span><br><span class="line"> Call ID: call_6c69898dba0342bfbb889e</span><br><span class="line">  Args:</span><br><span class="line">    a: 3</span><br><span class="line">    b: 4</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: add</span><br><span class="line"></span><br><span class="line">7</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_9940e7603ecf4a13a5f2fb)</span><br><span class="line"> Call ID: call_9940e7603ecf4a13a5f2fb</span><br><span class="line">  Args:</span><br><span class="line">    a: 7</span><br><span class="line">    b: 2</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">14</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  divide (call_d48fbbe205a14dfbaa3500)</span><br><span class="line"> Call ID: call_d48fbbe205a14dfbaa3500</span><br><span class="line">  Args:</span><br><span class="line">    a: 14</span><br><span class="line">    b: 5</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: divide</span><br><span class="line"></span><br><span class="line">2.8</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœæ˜¯2.8ã€‚</span><br></pre></td></tr></table></figure>
<p>parallel_tool_calls=Trueçš„è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">å°†3å’Œ4ç›¸åŠ ã€‚å°†ç»“æœä¹˜ä»¥2ã€‚å†å°†ç»“æœé™¤ä»¥5ã€‚</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  add (call_e0c7d8e65f2c49e8aecd3e)</span><br><span class="line"> Call ID: call_e0c7d8e65f2c49e8aecd3e</span><br><span class="line">  Args:</span><br><span class="line">    a: 3</span><br><span class="line">    b: 4</span><br><span class="line">  multiply (call_5bf824058e64489aaace91)</span><br><span class="line"> Call ID: call_5bf824058e64489aaace91</span><br><span class="line">  Args:</span><br><span class="line">    a: 7</span><br><span class="line">    b: 2</span><br><span class="line">  divide (call_36c34f69f6574028b28847)</span><br><span class="line"> Call ID: call_36c34f69f6574028b28847</span><br><span class="line">  Args:</span><br><span class="line">    a: 14</span><br><span class="line">    b: 5</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: add</span><br><span class="line"></span><br><span class="line">7</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">14</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: divide</span><br><span class="line"></span><br><span class="line">2.8</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœæ˜¯ **2.8**ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="agent-memoryä»£ç†è®°å¿†">Agent memoryä»£ç†è®°å¿†</h4>
<p>ä½¿ç”¨chekpointeræ£€æŸ¥ç‚¹çš„åŠŸèƒ½ï¼Œæœ€ç®€å•çš„æ£€æŸ¥ç‚¹ä¹‹ä¸€æ˜¯
<code>MemorySaver</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå›¾å½¢çŠ¶æ€çš„å†…å­˜é”®å€¼å­˜å‚¨ã€‚</p>
<p>è¿™ä¸ªæ£€æŸ¥ç‚¹å°±ç›¸å½“äºæŠŠ<strong>å›¾çš„æ¯ä¸€æ¬¡â€œçŠ¶æ€å¿«ç…§â€æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨</strong>çš„æœºåˆ¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">memory = MemorySaver()</span><br><span class="line">react_graph_memory = builder.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/persistence/">è®°å¿†åŠŸèƒ½</a>
æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼LangGraph
å¯ä»¥ä½¿ç”¨æ£€æŸ¥ç‚¹å·¥å…·åœ¨æ¯ä¸€æ­¥ä¹‹åè‡ªåŠ¨ä¿å­˜å›¾çš„çŠ¶æ€ã€‚è¿™ä¸€å†…ç½®çš„æŒä¹…åŒ–å±‚ä¸ºæˆ‘ä»¬æä¾›äº†å†…å­˜åŠŸèƒ½ï¼Œä½¿
LangGraph èƒ½å¤Ÿä»æœ€åä¸€æ¬¡çŠ¶æ€æ›´æ–°å¤„ç»§ç»­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Specify a thread</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Specify an input</span><br><span class="line">messages = [HumanMessage(content=&quot;Add 3 and 4.&quot;)]</span><br><span class="line"></span><br><span class="line"># Run</span><br><span class="line">messages = react_graph_memory.invoke(&#123;&quot;messages&quot;: messages&#125;,config)</span><br><span class="line">for m in messages[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ä½¿ç”¨å†…å­˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸€ä¸ª <code>thread_id</code>ã€‚è¿™
<code>thread_id</code> å°†å­˜å‚¨æˆ‘ä»¬çš„å›¾å½¢çŠ¶æ€é›†åˆã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œæ£€æŸ¥ç‚¹åœ¨å›¾çš„æ¯ä¸€æ­¥å†™å…¥çŠ¶æ€ï¼Œè¿™äº›æ£€æŸ¥ç‚¹ä¿å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­
ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>thread_id</code> åœ¨æœªæ¥è®¿é—®è¯¥çº¿ç¨‹</p>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66e0e9f526b41a4ed9e2d28b_agent-memory2.png" alt="state.jpg">
<figcaption aria-hidden="true">state.jpg</figcaption>
</figure>
<h3 id="module-2">module-2</h3>
<h4 id="state-schemeçŠ¶æ€æ¨¡å¼">state-schemeçŠ¶æ€æ¨¡å¼</h4>
<p>LangGraph çš„ <strong>state-schemeï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰</strong>
å°±æ˜¯â€œä¸€å¼ <strong>è“å›¾</strong>â€ï¼Œå®ƒå‘Šè¯‰æ¡†æ¶ï¼šâ€œåœ¨æ•´ä¸ªå›¾çš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼ŒçŠ¶æ€å¯¹è±¡åº”è¯¥é•¿ä»€ä¹ˆæ ·ã€æ¯ä¸ªå­—æ®µæ€æ ·è¢«æ›´æ–°ã€ä»¥åŠèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•å…±äº«æˆ–éš”ç¦»æ•°æ®ã€‚â€</p>
<p>state-scheme ç”¨ <strong>TypedDict</strong> æˆ– <strong>Pydantic
BaseModel</strong> æ¥å£°æ˜ï¼Œå®šä¹‰äº†ï¼š</p>
<ul>
<li>çŠ¶æ€é‡Œæœ‰å“ªäº›å­—æ®µï¼ˆkeyï¼‰</li>
<li>æ¯ä¸ªå­—æ®µçš„ Python ç±»å‹</li>
<li><strong>å¯é€‰</strong> è¯¥å­—æ®µçš„
<strong>reducer</strong>ï¼ˆæ›´æ–°è§„åˆ™ï¼‰</li>
</ul>
<h5 id="typeddict"><strong>TypedDict</strong></h5>
<p><strong>åŸºæœ¬å®šä¹‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from typing_extensions import TypedDict</span><br><span class="line"></span><br><span class="line">class TypedDictState(TypedDict):</span><br><span class="line">    foo: str</span><br><span class="line">    bar: str</span><br></pre></td></tr></table></figure>
<p><strong>å¯å¢åŠ åƒ <code>Literal</code>
è¿™æ ·çš„ç±»å‹æç¤ºï¼Œä½¿å…¶æ›´æœ‰ä»·å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from typing import Literal</span><br><span class="line"></span><br><span class="line">class TypedDictState(TypedDict):</span><br><span class="line">    name: str</span><br><span class="line">    mood: Literal[&quot;happy&quot;,&quot;sad&quot;]</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ<code>mood</code> åªèƒ½æ˜¯ â€œhappyâ€ æˆ– â€œsadâ€ã€‚</p>
<p><strong>åŠ  reducerï¼šè®©æ›´æ–°â€œå¯è¿½åŠ â€è€Œä¸è¦†ç›–</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class MathState(TypedDict):</span><br><span class="line">    question: str</span><br><span class="line">    scratchpad: Annotated[list[str], add_message]  # æ–°å…ƒç´ è‡ªåŠ¨è¿½åŠ </span><br><span class="line">    answer: int</span><br></pre></td></tr></table></figure>
<p><code>Annotated[list[str], add]</code> å‘Šè¯‰ LangGraphï¼šå½“èŠ‚ç‚¹è¿”å›
<code>&#123;"scratchpad": ["æ–°æ­¥éª¤"]&#125;</code>
æ—¶ï¼Œ<strong>è¿½åŠ </strong>åˆ°ç°æœ‰åˆ—è¡¨ï¼Œè€Œä¸æ˜¯æ›¿æ¢</p>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from IPython.display import Image, display</span><br><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line">#å®šä¹‰èŠ‚ç‚¹</span><br><span class="line">def node_1(state):</span><br><span class="line">    print(&quot;---Node 1---&quot;)</span><br><span class="line">    return &#123;&quot;name&quot;: state[&#x27;name&#x27;] + &quot; is ... &quot;&#125;</span><br><span class="line"></span><br><span class="line">def node_2(state):</span><br><span class="line">    print(&quot;---Node 2---&quot;)</span><br><span class="line">    return &#123;&quot;mood&quot;: &quot;happy&quot;&#125;</span><br><span class="line"></span><br><span class="line">def node_3(state):</span><br><span class="line">    print(&quot;---Node 3---&quot;)</span><br><span class="line">    return &#123;&quot;mood&quot;: &quot;sad&quot;&#125;</span><br><span class="line">#è·¯ç”±å‡½æ•°</span><br><span class="line">def decide_mood(state) -&gt; Literal[&quot;node_2&quot;, &quot;node_3&quot;]:</span><br><span class="line">        </span><br><span class="line">    # Here, let&#x27;s just do a 50 / 50 split between nodes 2, 3</span><br><span class="line">    if random.random() &lt; 0.5:</span><br><span class="line"></span><br><span class="line">        # 50% of the time, we return Node 2</span><br><span class="line">        return &quot;node_2&quot;</span><br><span class="line">    </span><br><span class="line">    # 50% of the time, we return Node 3</span><br><span class="line">    return &quot;node_3&quot;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(TypedDictState)</span><br><span class="line">builder.add_node(&quot;node_1&quot;, node_1)</span><br><span class="line">builder.add_node(&quot;node_2&quot;, node_2)</span><br><span class="line">builder.add_node(&quot;node_3&quot;, node_3)</span><br><span class="line"></span><br><span class="line"># Logic</span><br><span class="line">builder.add_edge(START, &quot;node_1&quot;)</span><br><span class="line">builder.add_conditional_edges(&quot;node_1&quot;, decide_mood)</span><br><span class="line">builder.add_edge(&quot;node_2&quot;, END)</span><br><span class="line">builder.add_edge(&quot;node_3&quot;, END)</span><br><span class="line"></span><br><span class="line"># Add</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719154439415.png" alt="image-20250719154439415">
<figcaption aria-hidden="true">image-20250719154439415</figcaption>
</figure>
<p>å› ä¸ºæˆ‘ä»¬çš„çŠ¶æ€æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæˆ‘ä»¬åªéœ€ç”¨ä¸€ä¸ªå­—å…¸è°ƒç”¨å›¾ï¼Œä»¥è®¾ç½®çŠ¶æ€ä¸­
<code>name</code> é”®çš„åˆå§‹å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.invoke(&#123;&quot;name&quot;:&quot;Lance&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="dataclassæ•°æ®ç±»"><strong>Dataclassæ•°æ®ç±»</strong></h5>
<p>pythonçš„dataclassesåº“æä¾›äº†ä¸€ç§ç®€æ´çš„è¯­æ³•ï¼Œç”¨äºåˆ›å»ºä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®çš„ç±»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from dataclasses import dataclass</span><br><span class="line"></span><br><span class="line">@dataclass</span><br><span class="line">class DataclassState:</span><br><span class="line">    name: str</span><br><span class="line">    mood: Literal[&quot;happy&quot;,&quot;sad&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def node_1(state):</span><br><span class="line">    print(&quot;---Node 1---&quot;)</span><br><span class="line">    return &#123;&quot;name&quot;: state.name + &quot; is ... &quot;&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(DataclassState)</span><br><span class="line">builder.add_node(&quot;node_1&quot;, node_1)</span><br><span class="line">builder.add_node(&quot;node_2&quot;, node_2)</span><br><span class="line">builder.add_node(&quot;node_3&quot;, node_3)</span><br><span class="line"></span><br><span class="line"># Logic</span><br><span class="line">builder.add_edge(START, &quot;node_1&quot;)</span><br><span class="line">builder.add_conditional_edges(&quot;node_1&quot;, decide_mood)</span><br><span class="line">builder.add_edge(&quot;node_2&quot;, END)</span><br><span class="line">builder.add_edge(&quot;node_3&quot;, END)</span><br><span class="line"></span><br><span class="line"># Add</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p>è¦è®¿é—® <code>dataclass</code> çš„é”®ï¼Œæˆ‘ä»¬åªéœ€ä¿®æ”¹åœ¨
<code>node_1</code> ä¸­ä½¿ç”¨çš„ä¸‹æ ‡å³å¯ï¼š</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>state.name</code> æ¥è¡¨ç¤º <code>dataclass</code>
çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>state["name"]</code> æ¥è¡¨ç¤ºä¸Šé¢çš„
<code>TypedDict</code>ã€‚</p>
<p>ä½ ä¼šæ³¨æ„åˆ°ä¸€ä¸ªæœ‰ç‚¹å¥‡æ€ªçš„åœ°æ–¹ï¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶è¿”å›ä¸€ä¸ªå­—å…¸æ¥æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚</p>
<p><strong>Dataclass åªæ˜¯â€œæè¿°â€çŠ¶æ€çš„å½¢çŠ¶ï¼Œè€ŒçœŸæ­£åœ¨ LangGraph
çš„èŠ‚ç‚¹ä¹‹é—´æµåŠ¨çš„ä¾æ—§æ˜¯ã€Œå­—å…¸ã€</strong>ï¼Œè¿™æ˜¯æ¡†æ¶è®¾è®¡å±‚é¢çš„çº¦å®š</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>dataclass</code> æ‹¥æœ‰é”®
<code>name</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»èŠ‚ç‚¹ä¼ é€’ä¸€ä¸ªå­—å…¸æ¥æ›´æ–°å®ƒï¼Œå°±åƒåœ¨çŠ¶æ€ä¸º
<code>TypedDict</code> æ—¶æ‰€åšçš„é‚£æ ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.invoke(DataclassState(name=&quot;Lance&quot;,mood=&quot;sad&quot;))</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡ <code>dataclass</code> æ¥è®¾ç½®çŠ¶æ€ä¸­æ¯ä¸ªé”®/é€šé“çš„åˆå§‹å€¼ï¼</p>
<h4 id="state-reducersçŠ¶æ€æ›´æ–°å‡½æ•°"><strong>State
Reducers</strong>çŠ¶æ€æ›´æ–°å‡½æ•°</h4>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/concepts/low_level/#reducers">Reducers</a>
ä¸ºæˆ‘ä»¬æŒ‡å®šäº†å¦‚ä½•æ‰§è¡Œæ›´æ–°ã€‚å®ƒæ¥æ”¶ <strong>æ—§çŠ¶æ€</strong> ä¸
<strong>ä¸€æ¬¡å˜æ›´æŒ‡ä»¤ï¼ˆaction /
å¢é‡å­—æ®µï¼‰</strong>ï¼Œ<strong>è¿”å›å…¨æ–°çš„çŠ¶æ€å¯¹è±¡</strong>ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­<strong>ä¸èƒ½ä¿®æ”¹åŸæœ‰æ•°æ®</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Annotated</code> ç±»å‹æ¥æŒ‡å®šä¸€ä¸ª reducer
å‡½æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬å°†æ¯ä¸ªèŠ‚ç‚¹è¿”å›çš„å€¼é™„åŠ åˆ°ç»“æœä¸­ï¼Œè€Œä¸æ˜¯è¦†ç›–å®ƒä»¬ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from operator import add</span><br><span class="line">from typing import Annotated</span><br><span class="line"></span><br><span class="line">class State(TypedDict):</span><br><span class="line">    foo: Annotated[list[int], add]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå¯ä»¥æ‰§è¡Œæ­¤æ“ä½œçš„ç¼©å‡å™¨ï¼š<code>operator.add</code> æ˜¯
Python å†…ç½® operator æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚å½“ <code>operator.add</code>
åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œå®ƒæ‰§è¡Œåˆ—è¡¨è¿æ¥ã€‚</p>
<h5 id="custom-reducers-è‡ªå®šä¹‰-reducers"><strong>Custom Reducers è‡ªå®šä¹‰
Reducers</strong></h5>
<p>æˆ‘ä»¬åŒæ ·å¯ä»¥è‡ªå®šä¹‰reducerså‡½æ•°ï¼Œè§£å†³ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ï¼Œå¦‚ä¸‹å¯ä»¥è§£å†³ä¼ å…¥å‚æ•°ä¸ºnoneçš„æƒ…å†µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def reduce_list(left: list | None, right: list | None) -&gt; list:</span><br><span class="line">    &quot;&quot;&quot;å®‰å…¨åœ°åˆå¹¶ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¤„ç†å…¶ä¸­ä¸€ä¸ªæˆ–ä¸¤ä¸ªè¾“å…¥å¯èƒ½ä¸º None çš„æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">    å‚æ•°ï¼š</span><br><span class="line">        left (list | None): è¦åˆå¹¶çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ– Noneã€‚</span><br><span class="line">        right (list | None): è¦åˆå¹¶çš„ç¬¬äºŒä¸ªåˆ—è¡¨ï¼Œæˆ– Noneã€‚</span><br><span class="line"></span><br><span class="line">    è¿”å›ï¼š</span><br><span class="line">        list: ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªè¾“å…¥åˆ—è¡¨æ‰€æœ‰å…ƒç´ çš„æ–°åˆ—è¡¨ã€‚</span><br><span class="line">               å¦‚æœè¾“å…¥ä¸º Noneï¼Œåˆ™å°†å…¶è§†ä¸ºç©ºåˆ—è¡¨ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if not left:</span><br><span class="line">        left = []</span><br><span class="line">    if not right:</span><br><span class="line">        right = []</span><br><span class="line">    return left + right</span><br><span class="line"></span><br><span class="line">class DefaultState(TypedDict):</span><br><span class="line">    foo: Annotated[list[int], add]</span><br><span class="line"></span><br><span class="line">class CustomReducerState(TypedDict):</span><br><span class="line">    foo: Annotated[list[int], reduce_list]</span><br></pre></td></tr></table></figure>
<h5 id="messagesstate">MessagesState</h5>
<p>æˆ‘å¯ä»¥ä½¿ç”¨å†…ç½®çš„ reducer <code>add_messages</code>
æ¥å¤„ç†çŠ¶æ€ä¸­çš„æ¶ˆæ¯</p>
<p>è€Œ<em><code>MessagesState</code></em> <em>å†…ç½®äº†ä¸€ä¸ª</em>
<em><code>messages</code></em> é”® å®ƒè¿˜ä¸ºè¯¥é”®å†…ç½®äº†ä¸€ä¸ª
<code>add_messages</code> åˆå¹¶å™¨ï¼Œè¿™ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from typing import Annotated</span><br><span class="line">from langgraph.graph import MessagesState</span><br><span class="line">from langchain_core.messages import AnyMessage</span><br><span class="line">from langgraph.graph.message import add_messages</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ TypedDictï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¸¦æœ‰ add_messages reducer çš„æ¶ˆæ¯åˆ—è¡¨ã€‚</span><br><span class="line">class CustomMessagesState(TypedDict):</span><br><span class="line">    messages: Annotated[list[AnyMessage], add_messages]</span><br><span class="line">    added_key_1: str</span><br><span class="line">    added_key_2: str</span><br><span class="line">    # etc</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ MessagesState ï¼Œå®ƒåŒ…å«å¸¦æœ‰ add_messages reducer çš„ messages é”®ã€‚</span><br><span class="line">class ExtendedMessagesState(MessagesState):</span><br><span class="line">    # æ·»åŠ é™¤ messages ä¹‹å¤–æ‰€éœ€çš„ä»»ä½•é”®ï¼Œ messages æ˜¯é¢„æ„å»ºçš„ã€‚</span><br><span class="line">    added_key_1: str</span><br><span class="line">    added_key_2: str</span><br><span class="line">    # etc</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨ <code>add_messages</code> reducer
æ—¶ï¼Œè®©æˆ‘ä»¬å±•ç¤ºä¸€äº›æœ‰ç”¨çš„æŠ€å·§ã€‚</p>
<p><strong>é‡å†™ï¼ˆRe-writingï¼‰</strong></p>
<p>å¦‚æœæˆ‘ä»¬ä¼ é€’çš„æ¶ˆæ¯ä¸ <code>messages</code> åˆ—è¡¨ä¸­å·²æœ‰çš„æ¶ˆæ¯å…·æœ‰ç›¸åŒçš„
IDï¼Œåˆ™è¯¥æ¶ˆæ¯å°†è¢«è¦†ç›–ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Initial state</span><br><span class="line">initial_messages = [AIMessage(content=&quot;Hello! How can I assist you?&quot;, name=&quot;Model&quot;, id=&quot;1&quot;),</span><br><span class="line">                    HumanMessage(content=&quot;I&#x27;m looking for information on marine biology.&quot;, name=&quot;Lance&quot;, id=&quot;2&quot;)</span><br><span class="line">                   ]</span><br><span class="line"></span><br><span class="line"># New message to add</span><br><span class="line">new_message = HumanMessage(content=&quot;I&#x27;m looking for information on whales, specifically&quot;, name=&quot;Lance&quot;, id=&quot;2&quot;)</span><br><span class="line"></span><br><span class="line"># Test</span><br><span class="line">add_messages(initial_messages , new_message)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AIMessage(content=&#x27;Hello! How can I assist you?&#x27;, name=&#x27;Model&#x27;, id=&#x27;1&#x27;),</span><br><span class="line"> HumanMessage(content=&quot;I&#x27;m looking for information on whales, specifically&quot;, name=&#x27;Lance&#x27;, id=&#x27;2&#x27;)]</span><br></pre></td></tr></table></figure>
<p><strong>åˆ é™¤ï¼ˆRemovalï¼‰</strong></p>
<p><code>add_messages</code> ä¹Ÿ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/memory/delete-messages/">åŒæ ·æ”¯æŒåˆ é™¤</a>ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨
<a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/messages/langchain_core.messages.modifier.RemoveMessage.html">RemoveMessage</a>
æ¥è‡ª <code>langchain_core</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import RemoveMessage</span><br><span class="line"></span><br><span class="line"># Message list</span><br><span class="line">messages = [AIMessage(&quot;Hi.&quot;, name=&quot;Bot&quot;, id=&quot;1&quot;)]</span><br><span class="line">messages.append(HumanMessage(&quot;Hi.&quot;, name=&quot;Lance&quot;, id=&quot;2&quot;))</span><br><span class="line">messages.append(AIMessage(&quot;So you said you were researching ocean mammals?&quot;, name=&quot;Bot&quot;, id=&quot;3&quot;))</span><br><span class="line">messages.append(HumanMessage(&quot;Yes, I know about whales. But what others should I learn about?&quot;, name=&quot;Lance&quot;, id=&quot;4&quot;))</span><br><span class="line"></span><br><span class="line"># Isolate messages to delete</span><br><span class="line">delete_messages = [RemoveMessage(id=m.id) for m in messages[:-2]]</span><br><span class="line">print(delete_messages)</span><br></pre></td></tr></table></figure>
<h4 id="multiple-schemas-å¤šç§çŠ¶æ€"><strong>Multiple Schemas</strong>
å¤šç§çŠ¶æ€</h4>
<h5 id="private-state-ç§æœ‰çŠ¶æ€"><strong>Private State</strong>
ç§æœ‰çŠ¶æ€</h5>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºåœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ é€’ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/pass_private_state/">private
state</a>
çš„æƒ…å†µã€‚è¿™å¯¹äºå›¾çš„ä¸­é—´è®¡ç®—é€»è¾‘ä¸­éœ€è¦çš„ä»»ä½•å†…å®¹éƒ½å¾ˆæœ‰ç”¨ï¼Œä½†ä¸å›¾çš„æ•´ä½“è¾“å…¥æˆ–è¾“å‡ºæ— å…³ã€‚</p>
<p>ç¤ºä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">from typing_extensions import TypedDict</span><br><span class="line">from IPython.display import Image, display</span><br><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line"></span><br><span class="line">class OverallState(TypedDict):</span><br><span class="line">    foo: int</span><br><span class="line"></span><br><span class="line">class PrivateState(TypedDict):</span><br><span class="line">    baz: int</span><br><span class="line"></span><br><span class="line">def node_1(state: OverallState) -&gt; PrivateState:</span><br><span class="line">    print(&quot;---Node 1---&quot;)</span><br><span class="line">    return &#123;&quot;baz&quot;: state[&#x27;foo&#x27;] + 1&#125;</span><br><span class="line"></span><br><span class="line">def node_2(state: PrivateState) -&gt; OverallState:</span><br><span class="line">    print(&quot;---Node 2---&quot;)</span><br><span class="line">    return &#123;&quot;foo&quot;: state[&#x27;baz&#x27;] + 1&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(OverallState)</span><br><span class="line">builder.add_node(&quot;node_1&quot;, node_1)</span><br><span class="line">builder.add_node(&quot;node_2&quot;, node_2)</span><br><span class="line"></span><br><span class="line"># Logic</span><br><span class="line">builder.add_edge(START, &quot;node_1&quot;)</span><br><span class="line">builder.add_edge(&quot;node_1&quot;, &quot;node_2&quot;)</span><br><span class="line">builder.add_edge(&quot;node_2&quot;, END)</span><br><span class="line"></span><br><span class="line"># Add</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719171509917.png" alt="image-20250719171509917">
<figcaption aria-hidden="true">image-20250719171509917</figcaption>
</figure>
<p>æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª <code>OverallState</code> å’Œä¸€ä¸ª
<code>PrivateState</code>ã€‚<code>node_2</code> ä½¿ç”¨
<code>PrivateState</code> ä½œä¸ºè¾“å…¥ï¼Œä½†è¾“å‡ºå†™å…¥åˆ°
<code>OverallState</code>ã€‚</p>
<p><code>baz</code> ä»…åŒ…å«åœ¨ <code>PrivateState</code>
ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>baz</code> è¢«æ’é™¤åœ¨å›¾å½¢è¾“å‡ºä¹‹å¤–ï¼Œå› ä¸ºå®ƒä¸åœ¨
<code>OverallState</code> ä¸­ã€‚</p>
<h5 id="input-output-schema-è¾“å…¥è¾“å‡ºæ¨¡å¼"><strong>Input / Output Schema
</strong>è¾“å…¥/è¾“å‡ºæ¨¡å¼</h5>
<p>åœ¨ LangGraph ä¸­ï¼Œ<strong>Input / Output Schema</strong>
å°±æ˜¯â€œ<strong>å›¾çš„å¯¹å¤–æ¥å£åè®®</strong>â€ï¼š<strong>è°ƒç”¨è€…åªèƒ½æŒ‰ Input
Schema ä¼ å‚ï¼›å›¾è¿è¡Œå®Œåï¼Œåªåå‡º Output Schema è§„å®šçš„å­—æ®µã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line">from typing_extensions import TypedDict</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è¾“å…¥çš„æ¨¡å¼</span><br><span class="line">class InputState(TypedDict):</span><br><span class="line">    question: str</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è¾“å‡ºçš„æ¨¡å¼</span><br><span class="line">class OutputState(TypedDict):</span><br><span class="line">    answer: str</span><br><span class="line"></span><br><span class="line"># å®šä¹‰æ•´ä½“æ¨¡å¼ï¼Œç»“åˆè¾“å…¥å’Œè¾“å‡º</span><br><span class="line">class OverallState(InputState, OutputState):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¤„ç†è¾“å…¥å¹¶ç”Ÿæˆç­”æ¡ˆçš„èŠ‚ç‚¹</span><br><span class="line">def answer_node(state: InputState):</span><br><span class="line">    # ç¤ºä¾‹ç­”æ¡ˆå’Œé¢å¤–é”®</span><br><span class="line">    return &#123;&quot;answer&quot;: &quot;bye&quot;, &quot;question&quot;: state[&quot;question&quot;]&#125;</span><br><span class="line"></span><br><span class="line"># æ„å»ºå›¾ï¼Œå¹¶æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºæ¨¡å¼</span><br><span class="line">builder = StateGraph(OverallState, input_schema=InputState, output_schema=OutputState)</span><br><span class="line">builder.add_node(answer_node)  # æ·»åŠ ç­”æ¡ˆèŠ‚ç‚¹</span><br><span class="line">builder.add_edge(START, &quot;answer_node&quot;)  # å®šä¹‰èµ·å§‹è¾¹</span><br><span class="line">builder.add_edge(&quot;answer_node&quot;, END)  # å®šä¹‰ç»“æŸè¾¹</span><br><span class="line">graph = builder.compile()  # ç¼–è¯‘å›¾</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨è¾“å…¥è°ƒç”¨å›¾å¹¶æ‰“å°ç»“æœ</span><br><span class="line">print(graph.invoke(&#123;&quot;question&quot;: &quot;hi&quot;&#125;))</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;answer&#x27;: &#x27;bye Lance&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ<code>input</code> / <code>output</code>
æ¨¡å¼å¯¹å›¾çš„è¾“å…¥å’Œè¾“å‡ºä¸Šå…è®¸çš„é”®è¿›è¡Œ <strong>è¿‡æ»¤</strong>ã€‚å¯ä»¥çœ‹åˆ°
<code>output</code> æ¨¡å¼å°†è¾“å‡ºé™åˆ¶ä¸ºä»…åŒ…å« <code>answer</code> é”®ã€‚</p>
<h4 id="filtering-and-trimming-messagesç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯"><strong>Filtering
and trimming messages</strong>ç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯</h4>
<p>å¦‚æœæˆ‘ä»¬åœ¨å¤„ç†é•¿æ—¶é—´å¯¹è¯æ—¶ä¸å¤Ÿå°å¿ƒï¼Œä¼šå¯¼è‡´é«˜ä»¤ç‰Œä½¿ç”¨é‡å’Œå»¶è¿Ÿï¼Œå› ä¸ºæˆ‘ä»¬ä¼ é€’ç»™æ¨¡å‹çš„æ˜¯ä¸€ç³»åˆ—ä¸æ–­å¢åŠ çš„æ¶ˆæ¯ã€‚æ‰€ä»¥è¦è¿›è¡Œç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯ã€‚</p>
<h5 id="ç®€åŒ–å™¨reducer"><strong>ç®€åŒ–å™¨ï¼ˆReducerï¼‰</strong></h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import RemoveMessage</span><br><span class="line"></span><br><span class="line"># Nodes</span><br><span class="line">def filter_messages(state: MessagesState):</span><br><span class="line">    # åˆ é™¤é™¤æœ€è¿‘ä¸¤æ¡æ¶ˆæ¯å¤–çš„æ‰€æœ‰æ¶ˆæ¯</span><br><span class="line">    delete_messages = [RemoveMessage(id=m.id) for m in state[&quot;messages&quot;][:-2]]</span><br><span class="line">    return &#123;&quot;messages&quot;: delete_messages&#125;</span><br><span class="line"></span><br><span class="line">def chat_model_node(state: MessagesState):    </span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(state[&quot;messages&quot;])]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;filter&quot;, filter_messages)</span><br><span class="line">builder.add_node(&quot;chat_model&quot;, chat_model_node)</span><br><span class="line">builder.add_edge(START, &quot;filter&quot;)</span><br><span class="line">builder.add_edge(&quot;filter&quot;, &quot;chat_model&quot;)</span><br><span class="line">builder.add_edge(&quot;chat_model&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719203204234.png" alt="image-20250719203204234">
<figcaption aria-hidden="true">image-20250719203204234</figcaption>
</figure>
<h5 id="ç­›é€‰æ¶ˆæ¯filtering-messages"><strong>ç­›é€‰æ¶ˆæ¯ï¼ˆFiltering
messagesï¼‰</strong></h5>
<p>å¦‚æœä½ ä¸éœ€è¦æˆ–ä¸å¸Œæœ›ä¿®æ”¹å›¾çŠ¶æ€ï¼Œå¯ä»¥ç›´æ¥è¿‡æ»¤ä¼ é€’ç»™èŠå¤©æ¨¡å‹çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Node</span><br><span class="line">def chat_model_node(state: MessagesState):</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(state[&quot;messages&quot;][-1:])]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;chat_model&quot;, chat_model_node)</span><br><span class="line">builder.add_edge(START, &quot;chat_model&quot;)</span><br><span class="line">builder.add_edge(&quot;chat_model&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œåªéœ€ä¼ é€’ä¸€ä¸ªè¿‡æ»¤åçš„åˆ—è¡¨ï¼š<code>llm.invoke(messages[-1:])</code>
ç»™æ¨¡å‹ã€‚</p>
<p>çŠ¶æ€åŒ…å«äº†æ‰€æœ‰æ¶ˆæ¯ã€‚ä½†è¿™é‡Œæ¨¡å‹è°ƒç”¨ä»…ä½¿ç”¨æœ€åä¸€æ¡æ¶ˆæ¯</p>
<h5 id="è£å‰ªæ¶ˆæ¯trim-messages"><strong>è£å‰ªæ¶ˆæ¯ï¼ˆTrim
messagesï¼‰</strong></h5>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯æ ¹æ®è®¾å®šä¸€å®šæ•°é‡çš„tokensè¿›è¡Œ <a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/how_to/trim_messages/#getting-the-last-max_tokens-tokens">trim
messages</a>ã€‚åœ¨æŠŠå¯¹è¯å†å²å‘ç»™å¤§æ¨¡å‹ä¹‹å‰ï¼ŒæŒ‰ <strong>token é¢„ç®—</strong>
æŠŠè¶…é•¿æ¶ˆæ¯åˆ—è¡¨â€œå‰ªâ€åˆ°åˆé€‚é•¿åº¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import trim_messages</span><br><span class="line"></span><br><span class="line"># Node</span><br><span class="line">def chat_model_node(state: MessagesState):</span><br><span class="line">    # ä½¿ç”¨ trim_messages å‡½æ•°ä¿®å‰ªæ¶ˆæ¯åˆ—è¡¨</span><br><span class="line">    # max_tokens: é™åˆ¶æ¶ˆæ¯çš„æœ€å¤§ä»¤ç‰Œæ•°</span><br><span class="line">    # strategy: ä¿®å‰ªç­–ç•¥ï¼Œè¿™é‡Œæ˜¯â€œlastâ€ï¼Œè¡¨ç¤ºä¿ç•™æœ€æ–°çš„æ¶ˆæ¯</span><br><span class="line">    # token_counter: ç”¨äºè®¡ç®—ä»¤ç‰Œæ•°çš„æ¨¡å‹å®ä¾‹</span><br><span class="line">    # allow_partial: æ˜¯å¦å…è®¸éƒ¨åˆ†ä¿®å‰ª</span><br><span class="line">    messages = trim_messages(</span><br><span class="line">            state[&quot;messages&quot;],</span><br><span class="line">            max_tokens=100,</span><br><span class="line">            strategy=&quot;last&quot;,</span><br><span class="line">            token_counter= ChatOpenAI(</span><br><span class="line">                model=&quot;qwen-plus-2025-04-28&quot;,</span><br><span class="line">                api_key=&quot;sk-&quot;,</span><br><span class="line">                base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;),</span><br><span class="line">            allow_partial=False,</span><br><span class="line">        )</span><br><span class="line">    # è°ƒç”¨è¯­è¨€æ¨¡å‹ï¼ˆllmï¼‰å¤„ç†ä¿®å‰ªåçš„æ¶ˆæ¯ï¼Œå¹¶è¿”å›ç»“æœ</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(messages)]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;chat_model&quot;, chat_model_node)</span><br><span class="line">builder.add_edge(START, &quot;chat_model&quot;)</span><br><span class="line">builder.add_edge(&quot;chat_model&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<h4 id="chatbot-with-message-summarizationå¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº"><strong>Chatbot
with message summarization</strong>å¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº</h4>
<p>ä¸å…¶ä»…ä»…ä¿®å‰ªæˆ–è¿‡æ»¤æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰æ¥ç”Ÿæˆå¯¹è¯çš„å®æ—¶æ‘˜è¦ã€‚</p>
<p>è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¿ç•™æ•´ä¸ªå¯¹è¯çš„å‹ç¼©è¡¨ç¤ºï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡ä¿®å‰ªæˆ–è¿‡æ»¤å°†å…¶ç§»é™¤ã€‚</p>
<p>æˆ‘ä»¬å°†ä¸ºè¯¥èŠå¤©æœºå™¨äººé…å¤‡è®°å¿†åŠŸèƒ½ï¼Œæ”¯æŒé•¿æ—¶é—´å¯¹è¯ï¼ŒåŒæ—¶ä¸ä¼šäº§ç”Ÿé«˜æ˜‚çš„
token æˆæœ¬æˆ–å»¶è¿Ÿã€‚</p>
<h5 id="å®šä¹‰æ€»ç»“çŠ¶æ€">å®šä¹‰æ€»ç»“çŠ¶æ€</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import MessagesState</span><br><span class="line">class State(MessagesState):</span><br><span class="line">    summary: str</span><br></pre></td></tr></table></figure>
<p>é™¤äº†å†…ç½®çš„ <code>messages</code>
é”®ä¹‹å¤–ï¼Œæˆ‘ä»¬ç°åœ¨è¿˜å°†åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰é”®ï¼ˆ<code>summary</code>ï¼‰ã€‚</p>
<h5 id="å®šä¹‰llmèŠ‚ç‚¹">å®šä¹‰LLMèŠ‚ç‚¹</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import SystemMessage, HumanMessage, RemoveMessage </span><br><span class="line"> </span><br><span class="line"> # å®šä¹‰è°ƒç”¨æ¨¡å‹çš„é€»è¾‘</span><br><span class="line">def call_model(state: State): </span><br><span class="line">     </span><br><span class="line">     # è·å–æ‘˜è¦ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ </span><br><span class="line">     summary = state.get(&quot;summary&quot;, &quot;&quot;) </span><br><span class="line"> </span><br><span class="line">     # å¦‚æœæœ‰æ‘˜è¦ï¼Œåˆ™æ·»åŠ å®ƒ</span><br><span class="line">     if summary: </span><br><span class="line">         </span><br><span class="line">         # å°†æ‘˜è¦æ·»åŠ åˆ°ç³»ç»Ÿæ¶ˆæ¯ä¸­</span><br><span class="line">         system_message = f&quot;å…ˆå‰å¯¹è¯çš„æ‘˜è¦ï¼š&#123;summary&#125;&quot; </span><br><span class="line"> </span><br><span class="line">         # å°†æ‘˜è¦é™„åŠ åˆ°ä»»ä½•è¾ƒæ–°çš„æ¶ˆæ¯ä¸­</span><br><span class="line">         messages = [SystemMessage(content=system_message)] + state[&quot;messages&quot;] </span><br><span class="line">     </span><br><span class="line">     else: </span><br><span class="line">         messages = state[&quot;messages&quot;] </span><br><span class="line">     </span><br><span class="line">     response = model.invoke(messages) </span><br><span class="line">     return &#123;&quot;messages&quot;: response&#125; </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹æ¥<strong>è°ƒç”¨æˆ‘ä»¬çš„LLM</strong>ï¼Œå¦‚æœå­˜åœ¨æ‘˜è¦ï¼Œåˆ™å°†å…¶çº³å…¥æç¤ºä¸­ã€‚</p>
<blockquote>
<p>å½“ call_model å‡½æ•°è¿”å› {â€œmessagesâ€: response} æ—¶ï¼Œå®ƒæ˜¯åœ¨å‘Šè¯‰
langgraph ï¼šâ€œè¯·ç”¨ response ï¼ˆå³æ¨¡å‹çš„æ–°è¾“å‡ºï¼‰æ¥æ›´æ–° State å¯¹è±¡ä¸­
messages é”®å¯¹åº”çš„å€¼ã€‚â€ langgraph ä¼šå°†è¿™ä¸ªæ–°æ¶ˆæ¯è¿½åŠ åˆ° messages
åˆ—è¡¨ä¸­ï¼Œä»è€Œä¿æŒäº†å¯¹è¯å†å²çš„è¿ç»­æ€§</p>
</blockquote>
<h5 id="å®šä¹‰æ‘˜è¦èŠ‚ç‚¹">å®šä¹‰æ‘˜è¦èŠ‚ç‚¹</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def summarize_conversation(state: State): </span><br><span class="line">     </span><br><span class="line">     # é¦–å…ˆï¼Œæˆ‘ä»¬è·å–ä»»ä½•ç°æœ‰çš„æ‘˜è¦</span><br><span class="line">     summary = state.get(&quot;summary&quot;, &quot;&quot;) </span><br><span class="line"> </span><br><span class="line">     # åˆ›å»ºæˆ‘ä»¬çš„æ‘˜è¦æç¤º</span><br><span class="line">     if summary: </span><br><span class="line">         </span><br><span class="line">         # æ‘˜è¦å·²å­˜åœ¨</span><br><span class="line">         summary_message = ( </span><br><span class="line">             f&quot;è¿™æ˜¯è¿„ä»Šä¸ºæ­¢å¯¹è¯çš„æ‘˜è¦ï¼š&#123;summary&#125;\n\n&quot; </span><br><span class="line">             &quot;è¯·ç»“åˆä»¥ä¸Šæ–°æ¶ˆæ¯æ‰©å±•æ‘˜è¦ï¼š&quot; </span><br><span class="line">         ) </span><br><span class="line">         </span><br><span class="line">     else: </span><br><span class="line">         summary_message = &quot;åˆ›å»ºä»¥ä¸Šå¯¹è¯çš„æ‘˜è¦ï¼š&quot; </span><br><span class="line"> </span><br><span class="line">     # å°†æç¤ºæ·»åŠ åˆ°æˆ‘ä»¬çš„å†å²è®°å½•ä¸­</span><br><span class="line">     messages = state[&quot;messages&quot;] + [HumanMessage(content=summary_message)] </span><br><span class="line">     response = model.invoke(messages) </span><br><span class="line">     </span><br><span class="line">     # åˆ é™¤é™¤æœ€è¿‘2æ¡æ¶ˆæ¯å¤–çš„æ‰€æœ‰æ¶ˆæ¯</span><br><span class="line">     delete_messages = [RemoveMessage(id=m.id) for m in state[&quot;messages&quot;][:-2]] </span><br><span class="line">     return &#123;&quot;summary&quot;: response.content, &quot;messages&quot;: delete_messages&#125; </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹æ¥<strong>ç”Ÿæˆæ‘˜è¦</strong>ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨
<code>RemoveMessage</code> åœ¨ç”Ÿæˆæ‘˜è¦åè¿‡æ»¤æˆ‘ä»¬çš„çŠ¶æ€ã€‚</p>
<h5 id="å®šä¹‰è·¯ç”±å‡½æ•°">å®šä¹‰è·¯ç”±å‡½æ•°</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import END </span><br><span class="line"> # å†³å®šæ˜¯ç»“æŸå¯¹è¯è¿˜æ˜¯æ€»ç»“å¯¹è¯</span><br><span class="line">def should_continue(state: State): </span><br><span class="line">     </span><br><span class="line">     &quot;&quot;&quot;è¿”å›è¦æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚&quot;&quot;&quot; </span><br><span class="line">     </span><br><span class="line">     messages = state[&quot;messages&quot;] </span><br><span class="line">     </span><br><span class="line">     # å¦‚æœæ¶ˆæ¯è¶…è¿‡å…­æ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€»ç»“å¯¹è¯</span><br><span class="line">     if len(messages) &gt; 6: </span><br><span class="line">         return &quot;summarize_conversation&quot; </span><br><span class="line">     </span><br><span class="line">     # å¦åˆ™æˆ‘ä»¬å°±å¯ä»¥ç»“æŸäº†</span><br><span class="line">     return END </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹ï¼Œä»¥æ ¹æ®å¯¹è¯é•¿åº¦ç¡®å®šæ˜¯å¦ç”Ÿæˆæ‘˜è¦ã€‚</p>
<blockquote>
<p>åœ¨ langgraph ä¸­ï¼Œ Command
æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼Œç”¨äºæŒ‡å¯¼å›¾å½¢ï¼ˆgraphï¼‰å†³å®šæ¥ä¸‹æ¥åº”è¯¥æ‰§è¡Œå“ªä¸ªèŠ‚ç‚¹ã€‚
æ‚¨å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ç»™å›¾å½¢ä¸‹è¾¾çš„ä¸€ä¸ªâ€œå‘½ä»¤â€ã€‚</p>
</blockquote>
<h5 id="æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾">æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Image, display</span><br><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">from langgraph.graph import StateGraph, START</span><br><span class="line"></span><br><span class="line"># Define a new graph</span><br><span class="line">workflow = StateGraph(State)</span><br><span class="line">workflow.add_node(&quot;conversation&quot;, call_model)</span><br><span class="line">workflow.add_node(&quot;summarize_conversation&quot;,summarize_conversation)</span><br><span class="line"></span><br><span class="line"># Set the entrypoint as conversation</span><br><span class="line">workflow.add_edge(START, &quot;conversation&quot;)</span><br><span class="line">workflow.add_conditional_edges(&quot;conversation&quot;, should_continue)</span><br><span class="line">workflow.add_edge(&quot;summarize_conversation&quot;, END)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Compile</span><br><span class="line">memory = MemorySaver()</span><br><span class="line">graph = workflow.compile(checkpointer=memory)</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨çº¿ç¨‹è°ƒç”¨">ä½¿ç”¨çº¿ç¨‹è°ƒç”¨</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;2&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">input_message = HumanMessage(content=&quot;æˆ‘å–œæ¬¢ç©lolï¼Œä½ çŸ¥é“è¿™ä¸ªæ¸¸æˆå—&quot;)</span><br><span class="line">output = graph.invoke(&#123;&quot;messages&quot;: [input_message]&#125;, config) </span><br><span class="line">for m in output[&#x27;messages&#x27;][-1:]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>å½“å¯¹è¯å¤§äº6ï¼Œå¯ç”Ÿæˆæ¦‚è¦</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.get_state(config).values.get(&quot;summary&quot;,&quot;&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="chatbot-with-message-summarization-external-db-memoryå…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº"><strong>Chatbot
with message summarization &amp; external DB
memory</strong>å…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº</h4>
<h5 id="ä½¿ç”¨æ•°æ®åº“">ä½¿ç”¨æ•°æ®åº“</h5>
<p><code>SqliteSaver</code> æ˜¯ LangGraph æä¾›çš„ä¸€ä¸ª
<strong>è½»é‡çº§çŠ¶æ€æŒä¹…åŒ–å·¥å…·</strong>ï¼Œå®ƒå°†å›¾çš„è¿è¡ŒçŠ¶æ€ï¼ˆå³
checkpointï¼‰ä¿å­˜åˆ°æœ¬åœ°çš„ SQLite
æ•°æ®åº“ä¸­ï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨ç¨‹åºä¸­æ–­æˆ–é‡å¯å<strong>æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼Œç‰¹åˆ«é€‚åˆæœ¬åœ°å¼€å‘ã€å®éªŒæ€§é¡¹ç›®æˆ–ä¸­å°è§„æ¨¡åº”ç”¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æä¾› â€œ:memory:â€ ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªå†…å­˜ä¸­çš„ SQLite æ•°æ®åº“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import sqlite3</span><br><span class="line"># In memory</span><br><span class="line">conn = sqlite3.connect(&quot;:memory:&quot;, check_same_thread = False)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æä¾›ä¸€ä¸ª db è·¯å¾„ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªç›®å½• state_dbï¼Œå¹¶å°è¯•ä» GitHub ä¸‹è½½ä¸€ä¸ªåä¸º example.db çš„ SQLite æ•°æ®åº“æ–‡ä»¶</span><br><span class="line">!mkdir -p state_db &amp;&amp; [ ! -f state_db/example.db ] &amp;&amp; wget -P state_db https://github.com/langchain-ai/langchain-academy/raw/main/module-2/state_db/example.db</span><br><span class="line"></span><br><span class="line">db_path = &quot;state_db/example.db&quot;</span><br><span class="line">conn = sqlite3.connect(db_path, check_same_thread=False)</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰checkpoint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.checkpoint.sqlite import SqliteSaver</span><br><span class="line">memory = SqliteSaver(conn)</span><br></pre></td></tr></table></figure>
<p>åƒä¸Šä¸€ä¸ªå½¢å¼ç¼–è¯‘å›¾</p>
<p>è®©æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹æˆ‘ä»¬çš„çŠ¶æ€æ˜¯å¦å·²ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line">graph_state = graph.get_state(config)</span><br><span class="line">graph_state</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨åƒ Sqlite è¿™æ ·çš„æ•°æ®åº“æ„å‘³ç€çŠ¶æ€ä¼šè¢«æŒä¹…åŒ–ï¼</p>
<h3 id="module-3">module-3</h3>
<h4 id="streaming-æµå¼ä¼ è¾“"><strong>Streaming</strong> æµå¼ä¼ è¾“</h4>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/concepts/low_level/#streaming">æµå¼ä¼ è¾“æˆ‘ä»¬çš„å›¾çŠ¶æ€</a>
çš„æ–¹æ³•ã€‚<code>.stream</code> å’Œ <code>.astream</code>
æ˜¯ç”¨äºæµå¼è¿”å›ç»“æœçš„åŒæ­¥å’Œå¼‚æ­¥æ–¹æ³•ã€‚</p>
<p><code>values</code>ï¼šè¿™å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹è¢«è°ƒç”¨åæµå¼ä¼ è¾“å›¾çš„å®Œæ•´çŠ¶æ€ã€‚
<code>updates</code>ï¼šè¿™å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹è¢«è°ƒç”¨åæµå¼ä¼ è¾“å›¾çš„çŠ¶æ€æ›´æ–°ã€‚</p>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66dbaf892d24625a201744e5_streaming1.png" alt="values_vs_updates.png">
<figcaption aria-hidden="true">values_vs_updates.png</figcaption>
</figure>
<h5 id="stream_modeupdates">stream_mode=â€œupdatesâ€</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Create a thread</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Start conversation</span><br><span class="line">for chunk in graph.stream(&#123;&quot;messages&quot;: [HumanMessage(content=&quot;ä½ å¥½æˆ‘æ˜¯zxj&quot;)]&#125;, config, stream_mode=&quot;updates&quot;):</span><br><span class="line">    print(chunk)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;conversation&#x27;: &#123;&#x27;messages&#x27;: AIMessage(content=&#x27;ä½ å¥½ï¼Œzxjï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼ŸğŸ˜Š&#x27;, additional_kwargs=&#123;&#x27;refusal&#x27;: None&#125;, response_metadata=&#123;&#x27;token_usage&#x27;: &#123;&#x27;completion_tokens&#x27;: 16, &#x27;prompt_tokens&#x27;: 576, &#x27;total_tokens&#x27;: 592, &#x27;completion_tokens_details&#x27;: None, &#x27;prompt_tokens_details&#x27;: None&#125;, &#x27;model_name&#x27;: &#x27;qwen-plus-2025-04-28&#x27;, &#x27;system_fingerprint&#x27;: None, &#x27;id&#x27;: &#x27;chatcmpl-891471ae-2fe8-9b3d-b5f7-f4fcd55a4e16&#x27;, &#x27;service_tier&#x27;: None, &#x27;finish_reason&#x27;: &#x27;stop&#x27;, &#x27;logprobs&#x27;: None&#125;, id=&#x27;run--f36409f3-af43-4e9b-8a46-39646ad7c106-0&#x27;, usage_metadata=&#123;&#x27;input_tokens&#x27;: 576, &#x27;output_tokens&#x27;: 16, &#x27;total_tokens&#x27;: 592, &#x27;input_token_details&#x27;: &#123;&#125;, &#x27;output_token_details&#x27;: &#123;&#125;&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>stream_mode="updates"</code>ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ <code>updates</code>
è¿›è¡Œæµå¼ä¼ è¾“ï¼Œæ‰€ä»¥åªæœ‰åœ¨å›¾ä¸­çš„èŠ‚ç‚¹è¿è¡Œåï¼Œæˆ‘ä»¬æ‰èƒ½çœ‹åˆ°çŠ¶æ€çš„æ›´æ–°ã€‚æ¯ä¸ª
<code>chunk</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä»¥ <code>node_name</code>
ä¸ºé”®ï¼Œæ›´æ–°åçš„çŠ¶æ€ä¸ºå€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Start conversation</span><br><span class="line">for chunk in graph.stream(&#123;&quot;messages&quot;: [HumanMessage(content=&quot;ä½ å¥½æˆ‘æ˜¯zxj&quot;)]&#125;, config, stream_mode=&quot;updates&quot;):</span><br><span class="line">    chunk[&#x27;conversation&#x27;][&quot;messages&quot;].pretty_print()</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬ç›´æ¥æ‰“å°çŠ¶æ€æ›´æ–°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å‘€ï¼Œzxjï¼å†æ¬¡è§åˆ°ä½ çœŸé«˜å…´ï½ğŸ˜Š æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®å¿™çš„å—ï¼Ÿ</span><br></pre></td></tr></table></figure>
<h5 id="stream_modevalues">stream_mode=â€œvaluesâ€</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Start conversation, again</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;2&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Start conversation</span><br><span class="line">input_message = HumanMessage(content=&quot;ä½ å¥½æˆ‘æ˜¯zxj&quot;)</span><br><span class="line">for event in graph.stream(&#123;&quot;messages&quot;: [input_message]&#125;, config, stream_mode=&quot;values&quot;):</span><br><span class="line">    for m in event[&#x27;messages&#x27;]:</span><br><span class="line">        m.pretty_print()</span><br><span class="line">    print(&quot;---&quot;*25)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>stream_mode="values"</code>.è¿™æ˜¯åœ¨
<code>conversation</code> èŠ‚ç‚¹è¢«è°ƒç”¨åï¼Œå›¾çš„æ•´ä¸ªçŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½æˆ‘æ˜¯zxj</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½æˆ‘æ˜¯zxj</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼Œzxjï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼ŸğŸ˜Š</span><br><span class="line">---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="streaming-tokens-æµå¼ä¼ è¾“ä»¤ç‰Œ"><strong>Streaming tokens</strong>
<strong>æµå¼ä¼ è¾“ä»¤ç‰Œ</strong></h5>
<p>åœ¨ LangGraph ä¸­ï¼Œâ€œæµå¼ä¼ è¾“ä»¤ç‰Œï¼ˆStreaming
tokensï¼‰â€æŒ‡çš„æ˜¯<strong>åœ¨èŠ‚ç‚¹å†…éƒ¨çš„å¤§æ¨¡å‹ï¼ˆLLMï¼‰ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œé€ token
åœ°å°†ä¸­é—´ç»“æœå®æ—¶æ¨é€åˆ°å®¢æˆ·ç«¯</strong>çš„èƒ½åŠ›ã€‚å®ç°è¿™ä¸€èƒ½åŠ›çš„æ ¸å¿ƒæ–¹æ³•æ˜¯
<code>astream_events</code>ï¼Œå®ƒä¼šä»¥äº‹ä»¶æµçš„å½¢å¼æš´éœ²æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ç»†èŠ‚ï¼ŒåŒ…æ‹¬æ¯ä¸€æ¬¡
LLM è°ƒç”¨äº§ç”Ÿçš„ tokenã€‚</p>
<p>æ¯ä¸ªäº‹ä»¶æ˜¯ä¸€ä¸ªåŒ…å«å‡ ä¸ªé”®çš„å­—å…¸ï¼š</p>
<p><code>event</code>ï¼šè¿™æ˜¯æ­£åœ¨å‘å‡ºçš„äº‹ä»¶çš„ç±»å‹ã€‚</p>
<p><code>name</code>ï¼šè¿™æ˜¯äº‹ä»¶çš„åç§°ã€‚</p>
<p><code>data</code>ï¼šè¿™æ˜¯ä¸äº‹ä»¶ç›¸å…³è”çš„æ•°æ®ã€‚</p>
<p><code>metadata</code>ï¼šåŒ…å«
<code>langgraph_node</code>ï¼Œå³å‘å‡ºäº‹ä»¶çš„èŠ‚ç‚¹ã€‚</p>
<p>è¦ç‚¹æ˜¯ï¼Œå›¾è¡¨ä¸­èŠå¤©æ¨¡å‹çš„ä»¤ç‰Œå…·æœ‰ <code>on_chat_model_stream</code>
ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>event['metadata']['langgraph_node']</code>
æ¥é€‰æ‹©è¦æµå¼çš„èŠ‚ç‚¹ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>event['data']</code>
æ¥è·å–æ¯ä¸ªäº‹ä»¶çš„å®é™…æ•°æ®ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®æ˜¯ä¸€ä¸ª
<code>AIMessageChunk</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node_to_stream = &#x27;conversation&#x27;#å®šä¹‰æµå¼ä¼ è¾“çš„èŠ‚ç‚¹</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;5&quot;&#125;&#125;</span><br><span class="line">input_message = HumanMessage(content=&quot;ä¸ºæˆ‘ä»‹ç»lol&quot;)</span><br><span class="line">async for event in graph.astream_events(&#123;&quot;messages&quot;: [input_message]&#125;, config, version=&quot;v2&quot;):</span><br><span class="line">    # ä»ç‰¹å®šèŠ‚ç‚¹è·å–èŠå¤©æ¨¡å‹ç”Ÿæˆçš„ Token</span><br><span class="line">    #äº‹ä»¶ç±»å‹å¿…é¡»æ˜¯ é€ token æµå¼è¾“å‡ºï¼ˆon_chat_model_streamï¼‰ã€‚</span><br><span class="line">    if event[&quot;event&quot;] == &quot;on_chat_model_stream&quot; and event[&#x27;metadata&#x27;].get(&#x27;langgraph_node&#x27;,&#x27;&#x27;) == node_to_stream:</span><br><span class="line">        data = event[&quot;data&quot;]</span><br><span class="line">        print(data[&quot;chunk&quot;].content, end=&quot;|&quot;)</span><br></pre></td></tr></table></figure>
<p>eventçš„å¸¸è§ç±»å‹</p>
<table>
<colgroup>
<col style="width: 32%">
<col style="width: 67%">
</colgroup>
<thead>
<tr>
<th>äº‹ä»¶ç±»å‹ (<code>event</code>)</th>
<th>è§¦å‘æ—¶æœºä¸è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>on_chain_start</code></td>
<td>ä»»æ„ Runnableï¼ˆèŠ‚ç‚¹ã€å­å›¾æˆ–æ•´ä¸ªå›¾ï¼‰å¼€å§‹æ‰§è¡Œ</td>
</tr>
<tr>
<td><code>on_chain_stream</code></td>
<td>èŠ‚ç‚¹/å›¾åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ <strong>å¢é‡è¾“å‡º</strong> chunk</td>
</tr>
<tr>
<td><code>on_chain_end</code></td>
<td>ä»»æ„ Runnable æ‰§è¡Œå®Œæˆ</td>
</tr>
<tr>
<td><code>on_chat_model_start</code></td>
<td><strong>ChatModel</strong> å¼€å§‹è°ƒç”¨</td>
</tr>
<tr>
<td><code>on_chat_model_stream</code></td>
<td><strong>ChatModel</strong> é€ token è¿”å›å†…å®¹ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰</td>
</tr>
<tr>
<td><code>on_chat_model_end</code></td>
<td><strong>ChatModel</strong> è°ƒç”¨ç»“æŸ</td>
</tr>
<tr>
<td><code>on_tool_start</code></td>
<td><strong>Tool</strong> å¼€å§‹è°ƒç”¨</td>
</tr>
<tr>
<td><code>on_tool_end</code></td>
<td><strong>Tool</strong> è°ƒç”¨ç»“æŸ</td>
</tr>
<tr>
<td><code>on_retriever_start</code></td>
<td><strong>Retriever</strong> å¼€å§‹æ£€ç´¢</td>
</tr>
<tr>
<td><code>on_retriever_end</code></td>
<td><strong>Retriever</strong> æ£€ç´¢ç»“æŸ</td>
</tr>
</tbody>
</table>
<h4 id="breakpoints-æ–­ç‚¹"><strong>Breakpoints æ–­ç‚¹</strong></h4>
<p><code>human-in-the-loop</code>ï¼ˆäººå·¥ä»‹å…¥/äººåœ¨å›è·¯ï¼‰çš„ä¸‰å¤§åŠ¨æœºï¼š</p>
<p>1ï¸âƒ£
Approvalï¼ˆå®¡æ‰¹ï¼‰æˆ‘ä»¬å¯ä»¥ä¸­æ–­æ™ºèƒ½ä½“ï¼Œå°†å½“å‰çŠ¶æ€å‘ˆç°ç»™ç”¨æˆ·ï¼Œå¹¶è®©ç”¨æˆ·å†³å®šæ˜¯å¦æ‰§è¡Œè¯¥æ“ä½œã€‚</p>
<p>2ï¸âƒ£ Debuggingï¼ˆè°ƒè¯•/å›æ”¾ï¼‰æˆ‘ä»¬å¯ä»¥å›é€€å›¾å½¢ä»¥é‡ç°æˆ–é¿å…é—®é¢˜</p>
<p>3ï¸âƒ£ Editingï¼ˆç¼–è¾‘ï¼‰AI
äº§å‡ºçš„ä¸­é—´ç»“æœä¸ç¬¦åˆé¢„æœŸï¼Œä½†ä¸æƒ³é‡è·‘æ•´å›¾ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹çŠ¶æ€</p>
<p>æˆ‘ä»¬å°†ä»‹ç» <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/breakpoints/#simple-usage">breakpoints</a>ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨ç‰¹å®šæ­¥éª¤åœæ­¢å›¾çš„ç®€å•æ–¹æ³•ã€‚</p>
<h5 id="breakpoints-for-human-approvalç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹"><strong>Breakpoints
for human approval</strong>ç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹</h5>
<p>å‡è®¾æˆ‘ä»¬å…³æ³¨å·¥å…·çš„ä½¿ç”¨ï¼šæˆ‘ä»¬å¸Œæœ›æ‰¹å‡†ä»£ç†ä½¿ç”¨å…¶ä»»ä½•å·¥å…·ã€‚</p>
<p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç®€å•åœ°ç”¨ <code>interrupt_before=["tools"]</code>
ç¼–è¯‘å›¾å½¢ï¼Œå…¶ä¸­ <code>tools</code> æ˜¯æˆ‘ä»¬çš„å·¥å…·èŠ‚ç‚¹ã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨çš„èŠ‚ç‚¹ <code>tools</code>
ä¹‹å‰ï¼Œæ‰§è¡Œå°†è¢«ä¸­æ–­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = builder.compile(interrupt_before=[&quot;tools&quot;], checkpointer=memory)</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250720225640772.png" alt="image-20250720225640772">
<figcaption aria-hidden="true">image-20250720225640772</figcaption>
</figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Input</span><br><span class="line">initial_input = &#123;&quot;messages&quot;: HumanMessage(content=&quot;2ä¹˜3&quot;)&#125;</span><br><span class="line"></span><br><span class="line"># Thread</span><br><span class="line">thread = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Run the graph until the first interruption</span><br><span class="line">for event in graph.stream(initial_input, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_92a4bcf88d25476d925775)</span><br><span class="line"> Call ID: call_92a4bcf88d25476d925775</span><br><span class="line">  Args:</span><br><span class="line">    a: 2</span><br><span class="line">    b: 3</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥è·å–çŠ¶æ€å¹¶æŸ¥çœ‹è¦è°ƒç”¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ï¼Œå¯ä»¥å‘ç°å›¾å·²è¢«ä¸­æ–­ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªå¾ˆå¥½çš„æŠ€å·§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>None</code>
è°ƒç”¨å›¾æ—¶ï¼Œå®ƒå°†ç›´æ¥ä»æœ€åä¸€ä¸ªçŠ¶æ€æ£€æŸ¥ç‚¹ç»§ç»­ï¼</p>
<figure>
<img src="https://cdn.prod.website-files.com/65b8cd72835ceeacd4449a53/66dbae7985b747dfed67775d_breakpoints1.png" alt="breakpoints.jpg">
<figcaption aria-hidden="true">breakpoints.jpg</figcaption>
</figure>
<p>çŠ¶æ€å¿«ç…§ï¼ˆStateSnapshotï¼‰</p>
<ul>
<li>ç±»å‹ï¼šä¸“é—¨ç”¨æ¥å­˜ <strong>ä¸€ä¸ªæ—¶åˆ»</strong> çš„å®Œæ•´çŠ¶æ€</li>
<li>è·å–æ–¹å¼ï¼š
<ul>
<li><code>Graph.get_state()</code> â†’ <strong>æœ€æ–°çš„</strong> å¿«ç…§</li>
<li><code>Graph.get_state_history()</code> â†’ <strong>æ‰€æœ‰</strong>
å¿«ç…§åˆ—è¡¨</li>
</ul></li>
</ul>
<p>ç»§ç»­/é‡è·‘å›¾</p>
<ul>
<li><code>Graph.stream(None, &#123;"thread_id": "xxx"&#125;)</code>
<ul>
<li>ä¸ä¼ æ–°è¾“å…¥ <code>None</code> è¡¨ç¤º
<strong>ä»å½“å‰æœ€æ–°çŠ¶æ€ç»§ç»­è·‘</strong></li>
<li>ä¹Ÿå¯å›é€€åˆ°å†å²å¿«ç…§ï¼Œå†é‡è·‘ï¼ˆè°ƒè¯•/å›æ”¾ï¼‰</li>
</ul></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_92a4bcf88d25476d925775)</span><br><span class="line"> Call ID: call_92a4bcf88d25476d925775</span><br><span class="line">  Args:</span><br><span class="line">    a: 2</span><br><span class="line">    b: 3</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">6</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3çš„ç»“æœæ˜¯6ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="editing-graph-state-ç¼–è¾‘å›¾çŠ¶æ€"><strong>Editing graph state
</strong>ç¼–è¾‘å›¾çŠ¶æ€</h4>
<p>æ–­ç‚¹ä¹Ÿæ˜¯<a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/edit-graph-state/">ä¿®æ”¹å›¾çŠ¶æ€çš„æœºä¼š</a>è®©æˆ‘ä»¬åœ¨
<code>assistant</code> èŠ‚ç‚¹ä¹‹å‰ä¸ºä»£ç†è®¾ç½®æ–­ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = builder.compile(interrupt_before=[&quot;assistant&quot;], checkpointer=memory)</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250720230924672.png" alt="image-20250720230924672">
<figcaption aria-hidden="true">image-20250720230924672</figcaption>
</figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Input</span><br><span class="line">initial_input = &#123;&quot;messages&quot;: &quot;2ä¹˜3&quot;&#125;</span><br><span class="line"></span><br><span class="line"># Thread</span><br><span class="line">thread = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Run the graph until the first interruption</span><br><span class="line">for event in graph.stream(initial_input, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3</span><br></pre></td></tr></table></figure>
<p>å½“çŠ¶æ€ä¸­æ–­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åº”ç”¨çŠ¶æ€æ›´æ–°</p>
<p>è®°ä½ï¼Œå¯¹ <code>messages</code> é”®çš„æ›´æ–°å°†ä½¿ç”¨
<code>add_messages</code> reducerï¼š</p>
<p>**å¦‚æœæˆ‘ä»¬æƒ³è¦†ç›–ç°æœ‰çš„æ¶ˆæ¯ï¼Œå¯ä»¥æä¾›å¸¦æœ‰* <em><code>id</code></em>
*çš„æ¶ˆæ¯ã€‚** å¦‚æœæˆ‘ä»¬åªæƒ³å°†æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ä¸­ï¼Œåˆ™å¯ä»¥ä¼ é€’æœªæŒ‡å®š
<code>id</code> çš„æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.update_state(</span><br><span class="line">    thread,</span><br><span class="line">    &#123;&quot;messages&quot;: [HumanMessage(content=&quot;ä¸è¦ï¼Œå®é™…ä¸Šè¦3ä¹˜3!&quot;)]&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">new_state = graph.get_state(thread).values</span><br><span class="line">for m in new_state[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3</span><br><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä¸è¦ï¼Œå®é™…ä¸Šè¦3ä¹˜3!</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œæˆ‘ä»¬çš„ä»£ç†æ“ä½œï¼Œåªéœ€ä¼ é€’ <code>None</code>
å¹¶å…è®¸å…¶ä»å½“å‰çŠ¶æ€ç»§ç»­æ‰§è¡Œã€‚æˆ‘ä»¬è¾“å‡ºå½“å‰å†…å®¹ï¼Œç„¶åç»§ç»­æ‰§è¡Œå‰©ä½™çš„èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h4 id="dynamic-breakpoints-åŠ¨æ€æ–­ç‚¹"><strong>Dynamic breakpoints
</strong>åŠ¨æ€æ–­ç‚¹</h4>
<p>ä½ å¯ä»¥æ ¹æ®æ¡ä»¶æ¥å®ç°å®ƒï¼ˆä»èŠ‚ç‚¹å†…éƒ¨åŸºäºå¼€å‘äººå‘˜å®šä¹‰çš„é€»è¾‘ï¼‰ã€‚æ‚¨å¯ä»¥å‘ç”¨æˆ·è¯´æ˜å…¶ä¸­æ–­åŸå› ï¼ˆé€šè¿‡å°†æ‚¨æƒ³ä¼ é€’çš„å†…å®¹å‘é€åˆ°
<code>NodeInterrupt</code>ï¼‰ã€‚</p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå›¾è¡¨ï¼Œå…¶ä¸­æ ¹æ®è¾“å…¥çš„é•¿åº¦ä¼šæŠ›å‡ºä¸€ä¸ª
<code>NodeInterrupt</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Image, display</span><br><span class="line"></span><br><span class="line">from typing_extensions import TypedDict</span><br><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">from langgraph.errors import NodeInterrupt</span><br><span class="line">from langgraph.graph import START, END, StateGraph</span><br><span class="line"></span><br><span class="line">class State(TypedDict):</span><br><span class="line">    input: str</span><br><span class="line"></span><br><span class="line">def step_1(state: State) -&gt; State:</span><br><span class="line">    print(&quot;---Step 1---&quot;)</span><br><span class="line">    return state</span><br><span class="line"></span><br><span class="line">def step_2(state: State) -&gt; State:</span><br><span class="line">    # å¦‚æœè¾“å…¥å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡5ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æŠ›å‡ºNodeInterruptå¼‚å¸¸</span><br><span class="line">    if len(state[&#x27;input&#x27;]) &gt; 5:</span><br><span class="line">        raise NodeInterrupt(f&quot;æ”¶åˆ°é•¿åº¦è¶…è¿‡5ä¸ªå­—ç¬¦çš„è¾“å…¥: &#123;state[&#x27;input&#x27;]&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    print(&quot;---Step 2---&quot;)</span><br><span class="line">    return state</span><br><span class="line"></span><br><span class="line">def step_3(state: State) -&gt; State:</span><br><span class="line">    print(&quot;---Step 3---&quot;)</span><br><span class="line">    return state</span><br><span class="line"></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line">builder.add_node(&quot;step_1&quot;, step_1)</span><br><span class="line">builder.add_node(&quot;step_2&quot;, step_2)</span><br><span class="line">builder.add_node(&quot;step_3&quot;, step_3)</span><br><span class="line">builder.add_edge(START, &quot;step_1&quot;)</span><br><span class="line">builder.add_edge(&quot;step_1&quot;, &quot;step_2&quot;)</span><br><span class="line">builder.add_edge(&quot;step_2&quot;, &quot;step_3&quot;)</span><br><span class="line">builder.add_edge(&quot;step_3&quot;, END)</span><br><span class="line"></span><br><span class="line"># Set up memory</span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"># Compile the graph with memory</span><br><span class="line">graph = builder.compile(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250721222709712.png" alt="image-20250721222709712">
<figcaption aria-hidden="true">image-20250721222709712</figcaption>
</figure>
<p>è®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªè¾“å…¥è¶…è¿‡5ä¸ªå­—ç¬¦çš„å›¾ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">initial_input = &#123;&quot;input&quot;: &quot;hello world&quot;&#125;</span><br><span class="line">thread_config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Run the graph until the first interruption</span><br><span class="line">for event in graph.stream(initial_input, thread_config, stream_mode=&quot;values&quot;):</span><br><span class="line">    print(event)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;input&#x27;: &#x27;hello world&#x27;&#125;</span><br><span class="line">---Step 1---</span><br><span class="line">&#123;&#x27;input&#x27;: &#x27;hello world&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å°è¯•ä»æ–­ç‚¹æ¢å¤å›¾ã€‚ä½†æ˜¯ï¼Œè¿™åªä¼šé‡æ–°è¿è¡Œç›¸åŒçš„èŠ‚ç‚¹ï¼é™¤éçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™æˆ‘ä»¬å°†ä¸€ç›´å¡åœ¨è¿™é‡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.update_state(</span><br><span class="line">    thread_config,</span><br><span class="line">    &#123;&quot;input&quot;: &quot;hi&quot;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨update_stateæ›´æ–°çŠ¶æ€</p>
<h4 id="time-travel-æ—¶é—´æ—…è¡Œ"><strong>Time travel</strong> æ—¶é—´æ—…è¡Œ</h4>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ã€é‡æ’­ï¼Œç”šè‡³ä»è¿‡å»çš„çŠ¶æ€å‰å‡ºï¼Œæ¥å±•ç¤º LangGraph <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/time-travel/">æ”¯æŒdebug</a>
çš„åŠŸèƒ½ã€‚</p>
<h5 id="browsing-history-æµè§ˆå†å²"><strong>Browsing History</strong>
<strong>æµè§ˆå†å²</strong></h5>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>get_state</code> æ¥æŸ¥çœ‹ç»™å®š <code>thread_id</code>
çš„å›¾çš„ å½“å‰ çŠ¶æ€ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.get_state(&#123;&#x27;configurable&#x27;: &#123;&#x27;thread_id&#x27;: &#x27;1&#x27;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥æµè§ˆä»£ç†çš„çŠ¶æ€å†å²ã€‚<code>get_state_history</code>
è®©æˆ‘ä»¬èƒ½å¤Ÿè·å–æ‰€æœ‰å…ˆå‰æ­¥éª¤çš„çŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">all_states = [s for s in graph.get_state_history(thread)]</span><br><span class="line">len(all_states)</span><br><span class="line">print(all_states)</span><br></pre></td></tr></table></figure>
<h5 id="replaying-å›æ”¾"><strong>Replaying</strong>
<strong>å›æ”¾</strong></h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">to_replay = all_states[-2]</span><br><span class="line">to_replay.values</span><br><span class="line">&#123;&#x27;messages&#x27;: [HumanMessage(content=&#x27;2ä¹˜3&#x27;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, id=&#x27;0676d9b5-cd59-4630-924d-b5c8d950e8d8&#x27;)]&#125;</span><br><span class="line">to_replay.next</span><br><span class="line">(&#x27;assistant&#x27;,)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜è·å–äº†é…ç½®ï¼Œå®ƒå‘Šè¯‰äº†æˆ‘ä»¬ <code>checkpoint_id</code> ä»¥åŠ
<code>thread_id</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">to_replay.config</span><br><span class="line">&#123;&#x27;configurable&#x27;: &#123;&#x27;thread_id&#x27;: &#x27;1&#x27;,</span><br><span class="line">  &#x27;checkpoint_ns&#x27;: &#x27;&#x27;,</span><br><span class="line">  &#x27;checkpoint_id&#x27;: &#x27;1f066c0e-2ee2-66d5-8000-5dde78194aae&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ä»è¿™é‡Œé‡æ’­ï¼Œæˆ‘ä»¬åªéœ€å°†é…ç½®ä¼ å›ç»™ä»£ç†ï¼å›¾çŸ¥é“è¿™ä¸ªæ£€æŸ¥ç‚¹å·²ç»æ‰§è¡Œè¿‡äº†ã€‚å®ƒåªæ˜¯ä»è¿™ä¸ªæ£€æŸ¥ç‚¹é‡æ–°æ’­æ”¾ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, to_replay.config, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h5 id="forking-åˆ†å‰"><strong>Forking</strong> åˆ†å‰</h5>
<p>å¦‚æœæˆ‘ä»¬æƒ³ä»ç›¸åŒçš„æ­¥éª¤è¿è¡Œï¼Œä½†ä½¿ç”¨ä¸åŒçš„è¾“å…¥ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ˜¯åˆ†å‰ã€‚</p>
<figure>
<img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66dbb038f89f2d847ee5c336_time-travel3.png" alt="fig3.jpg">
<figcaption aria-hidden="true">fig3.jpg</figcaption>
</figure>
<p>è®©æˆ‘ä»¬ä¿®æ”¹æ­¤æ£€æŸ¥ç‚¹çš„çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æä¾›çš„
<code>checkpoint_id</code> æ¥è¿è¡Œ <code>update_state</code>ã€‚</p>
<p>è¯·è®°ä½æˆ‘ä»¬å¯¹ <code>messages</code> çš„ reducer æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<ul>
<li>å®ƒä¼šè¿½åŠ æ¶ˆæ¯ï¼Œé™¤éæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¶ˆæ¯ IDã€‚</li>
<li>æˆ‘ä»¬æä¾›æ¶ˆæ¯ ID æ˜¯ä¸ºäº†è¦†ç›–æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯å°†æ¶ˆæ¯è¿½åŠ åˆ°çŠ¶æ€ä¸­ï¼</li>
</ul>
<p>å› æ­¤ï¼Œè¦è¦†ç›–æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªéœ€æä¾›æ¶ˆæ¯ IDï¼Œè€Œæˆ‘ä»¬å·²æœ‰
<code>to_fork.values["messages"].id</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fork_config = graph.update_state(</span><br><span class="line">    to_fork.config,</span><br><span class="line">    &#123;&quot;messages&quot;: [HumanMessage(content=&#x27;5ä¹˜3&#x27;, </span><br><span class="line">                               id=to_fork.values[&quot;messages&quot;][0].id)]&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†</h3>
<h4 id="message">message</h4>
<p>LangChain ä¸­çš„ HumanMessage ã€ AIMessage ã€ SystemMessage å’Œ
ToolMessage
ã€‚è¿™äº›æ¶ˆæ¯ç±»å‹æ˜¯æ„å»ºä¸è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„å¯¹è¯å†å²ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£ä¸Šä¸‹æ–‡å¹¶åšå‡ºæ°å½“çš„å›åº”ã€‚</p>
<ol type="1">
<li>SystemMessage</li>
</ol>
<p>SystemMessage çš„ç»“æ„æœ€ç®€å•ï¼Œå®ƒåªåŒ…å«å†…å®¹å’Œç±»å‹ã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): æ¶ˆæ¯çš„å…·ä½“å†…å®¹ï¼Œå³ç»™ AI çš„æŒ‡ä»¤ã€‚</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜systemâ€™ ã€‚</li>
</ul>
<ol start="2" type="1">
<li>HumanMessage</li>
</ol>
<p>HumanMessage çš„ç»“æ„ä¹ŸåŒæ ·ç®€å•ï¼Œä»£è¡¨ç”¨æˆ·çš„è¾“å…¥ã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ã€‚</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜humanâ€™ ã€‚</li>
</ul>
<ol start="3" type="1">
<li>AIMessage</li>
</ol>
<p>AIMessage
çš„ç»“æ„ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒä¸ä»…å¯ä»¥åŒ…å«æ–‡æœ¬å“åº”ï¼Œè¿˜å¯ä»¥åŒ…å«å¯¹å·¥å…·çš„è°ƒç”¨è¯·æ±‚ã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): AI ç”Ÿæˆçš„æ–‡æœ¬å“åº”ã€‚å¦‚æœ AI
çš„å›å¤æ˜¯å‘èµ·å·¥å…·è°ƒç”¨ï¼Œæ­¤å­—æ®µå¯ä»¥ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li>
<li>tool_calls (list[dict], å¯é€‰):
ä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼Œæ¯ä¸ªå­—å…¸ä»£è¡¨ä¸€ä¸ªå·¥å…·è°ƒç”¨è¯·æ±‚ã€‚è¿™æ˜¯æ”¯æŒâ€œFunction
Callingâ€æˆ–â€œTool Callingâ€åŠŸèƒ½çš„æ ¸å¿ƒã€‚å…¶ç»“æ„é€šå¸¸åŒ…å«ï¼š
<ul>
<li>name (str): è¦è°ƒç”¨çš„å·¥å…·åç§°ã€‚</li>
<li>args (dict): è°ƒç”¨å·¥å…·æ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°ã€‚</li>
<li>id (str): æ­¤æ¬¡å·¥å…·è°ƒç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåç»­ ToolMessage
çš„å…³è”ã€‚</li>
</ul></li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜aiâ€™ ã€‚</li>
</ul>
<ol start="4" type="1">
<li>ToolMessage</li>
</ol>
<p>ToolMessage ç”¨äºæ‰¿è½½å·¥å…·æ‰§è¡Œåçš„è¿”å›ç»“æœã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): å·¥å…·æ‰§è¡Œè¿”å›çš„ç»“æœã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ JSON
æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</li>
<li>tool_call_id (str): æ­¤æ¬¡å·¥å…·è°ƒç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œ å¿…é¡» ä¸ä¹‹å‰ AIMessage
ä¸­ tool_calls é‡Œçš„ id
ç›¸å¯¹åº”ã€‚è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®åœ°å°†ç»“æœä¸è¯·æ±‚åŒ¹é…èµ·æ¥ã€‚</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜toolâ€™ ã€‚</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>è¯·æˆ‘ä¸€æ¯å’–å•¡å§ï¼</div>
  <button>
    èµèµ
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="å¼ ç†™æµš å¾®ä¿¡">
        <span>å¾®ä¿¡</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="å¼ ç†™æµš æ”¯ä»˜å®">
        <span>æ”¯ä»˜å®</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/langgraph/" rel="tag"># langgraph</a>
              <a href="/tags/fastapi/" rel="tag"># fastapi</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/18/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/libreoffice/" rel="prev" title="Libreoffice">
                  <i class="fa fa-angle-left"></i> Libreoffice
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/21/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/Retrieval/" rel="next" title="Retrieval">
                  Retrieval <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å¼ ç†™æµš</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™è®¿é—®æ•° fa fa-user æ¬¡"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™æ€»è®¿é—®é‡ fa fa-eye æ¬¡"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="400" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
