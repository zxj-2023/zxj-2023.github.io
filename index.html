<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="zxj Blogs">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhang XiJun">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Zhang XiJun">
<meta property="og:description" content="zxj Blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="å¼ ç†™æµš">
<meta property="article:tag" content="zxj">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhang XiJun</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhang XiJun</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">BLOGS</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å¼ ç†™æµš"
      src="/images/zxjavatar.gif">
  <p class="site-author-name" itemprop="name">å¼ ç†™æµš</p>
  <div class="site-description" itemprop="description">zxj Blogs</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">132</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zxj-2023" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zxj-2023" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=2902065320&site=qq&menu=yes" title="QQ â†’ http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;2902065320&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener me" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          é“¾æ¥
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://zxj-2023.github.io/" title="https:&#x2F;&#x2F;zxj-2023.github.io" rel="noopener" target="_blank">Zhang XiJun</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://theme-next.js.org/" title="https:&#x2F;&#x2F;theme-next.js.org" rel="noopener" target="_blank">NexT</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/28/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/deepresearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/28/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/deepresearch/" class="post-title-link" itemprop="url">deepresearchå®æˆ˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-28 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š15:24:10" itemprop="dateCreated datePublished" datetime="2025-08-28T00:00:00+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent%E5%AE%9E%E6%88%98/" itemprop="url" rel="index"><span itemprop="name">agentå®æˆ˜</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ç†è§£deepresearch">ç†è§£deepresearch</h3>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1aXg5zzExm?buvid=XX7932A7E9DD8A1DA92D4974AB535749A9B44&amp;from_spmid=tm.recommend.0.0&amp;is_story_h5=false&amp;mid=25yhOI1fPeVYa5V16BFcAw%3D%3D&amp;plat_id=116&amp;share_from=ugc&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=aec53502-2411-4bc1-8ccf-ce85bd6efc1e&amp;share_source=QQ&amp;share_tag=s_i&amp;spmid=united.player-video-detail.0.0&amp;timestamp=1753142992&amp;unique_k=tZcFKrS&amp;up_id=28357052&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">ğŸ¦œğŸ•¸ï¸
Open Deep Research V2ï¼šæ–°æ¶æ„ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æœ€æ–°å®è·µ
ğŸ“‹_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://academy.langchain.com/courses/take/deep-research-with-langgraph/lessons/67513388-course-overview">Project:
Deep Research with LangGraph - LangChain Academy</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/langchain-ai/open_deep_research">langchain-ai/open_deep_research
â€” langchain-ai/open_deep_research</a></p>
<p>å®˜æ–¹åšæ–‡<a target="_blank" rel="noopener" href="https://blog.langchain.com/open-deep-research/">å¼€å¯æ·±åº¦ç ”ç©¶ â€”
Open Deep Research</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/25/%E5%AE%9E%E4%B9%A0/Tosea.ai/aippt%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/25/%E5%AE%9E%E4%B9%A0/Tosea.ai/aippt%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94/" class="post-title-link" itemprop="url">aipptæŠ€æœ¯è°ƒç ”</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-25 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-25T00:00:00+08:00">2025-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-28 17:16:27" itemprop="dateModified" datetime="2025-08-28T17:16:27+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/Tosea-ai/" itemprop="url" rel="index"><span itemprop="name">Tosea.ai</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æŠ€æœ¯è·¯çº¿">æŠ€æœ¯è·¯çº¿</h3>
<p><strong>æ–¹æ¡ˆ Aï¼šhtml â†’ PDF â†’
pptx</strong>ï¼ˆæˆ‘å°è¯•ä¸‹æ¥ä¸å¤§å¯è¡Œï¼Œæ— æ³•å†è¿›è¡Œç¼–è¾‘äº†ï¼‰</p>
<p><strong>æ–¹æ¡ˆ Bï¼šhtml â†’ PPTXGenJS</strong></p>
<p><strong>æ–¹æ¡ˆ Cï¼šhtml â†’ python-pptx</strong> (ä¸»æµ)</p>
<p><strong>æ–¹æ¡ˆ Dï¼šmarkdown â†’ Slidev</strong></p>
<p>æˆ‘å°è¯•äº†å½“å‰å¸‚é¢çš„pptç”Ÿæˆäº§å“ï¼Œåœ¨ç½‘é¡µé‡Œé¢å±•ç¤ºè¿˜ä¼šæœ‰è‰¯å¥½çš„åŠ¨ç”»æ•ˆæœï¼Œä½†æ˜¯ä¸€æ—¦å¯¼å‡ºæˆpptxï¼Œéƒ½æ˜¯ä¼šå˜æˆé™æ€é¡µé¢ï¼Œæ²¡æœ‰åŠ¨ç”»</p>
<p>reveal.jså¯ä»¥åˆ©ç”¨é¡µé¢ç”Ÿæˆä¸°å¯Œçš„pptåŠ¨ç”»æ•ˆæœï¼›Slidevå¯ä»¥å°†markdownè¯­æ³•è½¬åŒ–æˆpptï¼Œå¯ä»¥å¯¼å‡ºä¸ºpdfæˆ–pptxï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPPTX
æ–‡ä»¶ä¸­çš„æ‰€æœ‰å¹»ç¯ç‰‡éƒ½ä¼šè¢«å¯¼å‡ºä¸ºå›¾ç‰‡ã€‚</p>
<p>PPTXGenJSå’Œpython-pptxçš„åŸç†åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«ä¸€ä¸ªæ˜¯ä½¿ç”¨jsä¸€ä¸ªæ˜¯pythonï¼Œä½¿ç”¨æ–¹æ³•éƒ½æ˜¯é€šè¿‡è§£æHTMLæ ‡ç­¾å†…å®¹ï¼Œå®šä¹‰ä¸€ä¸ªpptå®ä¾‹ï¼Œå°†htmlçš„å†…å®¹ä¸€ç‚¹ç‚¹åŠ å…¥è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæœ€åå¯¼å‡ºpptxã€‚è¿™æ ·éƒ½ä»…èƒ½å®ç°æœ€åŸºæœ¬çš„pptæ¼”ç¤ºï¼Œä¸ä¼šæœ‰å¤æ‚çš„ç»“æ„ï¼Œè€Œä¸”ç»å¸¸ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜â€”â€”æŸä¸ªæ ‡ç­¾å†…æ–‡å­—å¤ªå¤šå¾€å¾€ä¼šè¶…å‡ºpptæ¼”ç¤ºèŒƒå›´</p>
<p>ç›´æ¥è®©AIæ¥ç”Ÿæˆéå¸¸è‡ªç”±çš„PPTï¼Œæœ€ç»ˆçš„æ•ˆæœä¸€èˆ¬æ¥è¯´éƒ½æ¯”è¾ƒçƒ‚ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é¢„å®šä¹‰ä¸€ä¸ªhtmlæ¨¡æ¿ï¼Œç„¶åè®©AIæ¥è‡ªåŠ¨çš„é€‰æ‹©æ¨¡æ¿å¾€é‡Œé¢å¡«å……å†…å®¹</p>
<h3 id="ç›¸å…³å·¥å…·">ç›¸å…³å·¥å…·</h3>
<p><a target="_blank" rel="noopener" href="https://cn.sli.dev/guide/">Slidev</a>
æ˜¯ä¸€ä¸ªä¸ºå¼€å‘è€…è®¾è®¡çš„åŸºäº Web çš„å¹»ç¯ç‰‡åˆ¶ä½œå·¥å…·ã€‚å®ƒå¸®åŠ©æ‚¨ä»¥ Markdown
çš„å½¢å¼ä¸“æ³¨äºç¼–å†™å¹»ç¯ç‰‡çš„å†…å®¹ï¼Œå¹¶åˆ¶ä½œå‡ºå…·æœ‰äº¤äº’å¼æ¼”ç¤ºåŠŸèƒ½çš„ã€é«˜åº¦å¯è‡ªå®šä¹‰çš„å¹»ç¯ç‰‡ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/hakimel/reveal.js">reveal.js</a>
æ˜¯ä¸€ä¸ªå¼€æºçš„ <strong>HTML æ¼”ç¤ºæ¡†æ¶</strong>ï¼Œç”¨ JavaScript
å†™æˆã€‚åªè¦ä½ ä¼šå†™ HTML/CSS/JSï¼Œå°±å¯ä»¥åƒåšç½‘é¡µä¸€æ ·åšå‡º
<strong>é…·ç‚«ã€å“åº”å¼ã€æ”¯æŒé”®ç›˜/é¼ æ ‡/è§¦æ§äº¤äº’</strong> çš„å¹»ç¯ç‰‡ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gitbrent/PptxGenJS">PptxGenJS</a>
å…è®¸æ‚¨ä½¿ç”¨ JavaScript ç”Ÿæˆä¸“ä¸šçš„ PowerPoint æ¼”ç¤ºæ–‡ç¨¿â€”â€”ç›´æ¥ä»
Nodeã€Reactã€Viteã€Electronï¼Œç”šè‡³æµè§ˆå™¨ä¸­ç”Ÿæˆã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/scanny/python-pptx">python-pptx</a>
æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºã€è¯»å–å’Œæ›´æ–° PowerPoint (.pptx)æ–‡ä»¶çš„ Python
åº“ã€‚å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»åŠ¨æ€å†…å®¹ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€åˆ†æè¾“å‡ºæˆ– JSON è´Ÿè½½ï¼‰ç”Ÿæˆ
PowerPoint æ¼”ç¤ºæ–‡ç¨¿ï¼Œå¯èƒ½æ˜¯åœ¨å“åº” HTTP è¯·æ±‚æ—¶ç”Ÿæˆ PPTX æ–‡ä»¶å¹¶ä¸‹è½½ã€‚</p>
<blockquote>
<p>python-pptxä½¿ç”¨æ–¹å¼ï¼šæ ¹æ®æ ‡ç­¾è§£æhtmlæ–‡ä»¶ï¼Œå¦‚h1ï¼Œdivç­‰ï¼Œç„¶åä¸€ç‚¹ç‚¹æ·»åŠ åˆ°å®šä¹‰çš„é¡µä¸­</p>
</blockquote>
<h3 id="å¸‚é¢åŒç±»äº§å“">å¸‚é¢åŒç±»äº§å“</h3>
<ol type="1">
<li><a target="_blank" rel="noopener" href="https://www.genspark.ai/agents?type=slides_agent">Genspark</a>
<ul>
<li>Genspark æ˜¯ <strong>MainFunc</strong> å…¬å¸ï¼ˆç”±å‰å°åº¦ CEO
æ™¯é²²å’Œå‰å°åº¦ CTO æœ±å‡¯åè”åˆåˆ›ç«‹ï¼‰æ¨å‡ºçš„ <strong>AI Agent
æœç´¢å¼•æ“</strong>ï¼ˆæˆ–ç§°â€œAI åŸç”Ÿæœç´¢å¼•æ“â€ï¼‰ã€‚</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://www.tiangong.cn/?from=ai-tab.cn">skywork</a>
<ul>
<li>Skywork æ˜¯æ˜†ä»‘ä¸‡ç»´ï¼ˆKunlun Inc.ï¼‰æ——ä¸‹ <strong>SkyWork AI</strong>
æ¨å‡ºçš„ä¸€ç³»åˆ— <strong>å¼€æºå¤§æ¨¡å‹</strong> ä¸ <strong>AI
æŠ€æœ¯å“ç‰Œ</strong>ã€‚</li>
</ul></li>
<li><a target="_blank" rel="noopener" href="https://manus.im/app">manus</a></li>
<li><a target="_blank" rel="noopener" href="https://gamma.app/">Gamma</a> æ˜¯ä¸€ä¸ª <strong>â€œAI
é©±åŠ¨çš„åœ¨çº¿å†…å®¹å·¥ä½œç«™â€</strong>ï¼šè¾“å…¥ä¸€å¥è¯ã€ä¸€æ®µå¤§çº²æˆ–ä»»ä½•èµ„æ–™ï¼Œå®ƒå°±èƒ½åœ¨
<strong>1-3 åˆ†é’Ÿå†…</strong> å¸®ä½ ç”Ÿæˆ
<strong>é«˜é¢œå€¼ã€å“ç‰ŒåŒ–ã€å¯äº’åŠ¨</strong> çš„æ¼”ç¤ºæ–‡ç¨¿ã€ç½‘ç«™ã€ç¤¾åª’å›¾æ–‡æˆ–
PDFï¼Œå¹¶å¯ä¸€é”®å¯¼å‡ºä¸º <strong>PPT / Google Slides / PDF /
ç½‘ç«™é“¾æ¥</strong>ã€‚</li>
</ol>
<p>manusæ˜¯æ¯é¡µpptéƒ½æ˜¯ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œæˆ‘çŒœæµ‹åº”è¯¥æ˜¯ä½¿ç”¨åƒpython-pptxçš„åº“ç”Ÿæˆ</p>
<h3 id="ppt-mcp">ppt-mcp</h3>
<p>å¯ä»¥å‚è€ƒå…¶ä¸­çš„å·¥å…·å®ç°ï¼Œè¿™ä¸¤ä¸ªæˆ‘çœ‹ä¸‹æ¥éƒ½æ˜¯ä½¿ç”¨python-pptxåŒ…</p>
<p><a target="_blank" rel="noopener" href="https://github.com/GongRzhe/Office-PowerPoint-MCP-Server">GongRzhe/Office-PowerPoint-MCP-Server:
A MCP (Model Context Protocol) server for PowerPoint manipulation using
python-pptx. This server provides tools for creating, editing, and
manipulating PowerPoint presentations through the MCP protocol.</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ltc6539/mcp-ppt">ltc6539/mcp-ppt: A mcp
server supporting you to generate powerpoint using LLM and natural
language automatically.</a></p>
<h3 id="æ¶æ„æ€è€ƒ">æ¶æ„æ€è€ƒ</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">    subgraph &quot;Plan-and-Executeé˜¶æ®µ&quot;</span><br><span class="line">        A[&quot;ç”¨æˆ·è¾“å…¥&quot;] --&gt; B[&quot;Planner Agent&quot;]</span><br><span class="line">        B --&gt; C[&quot;Agent Executor&quot;]</span><br><span class="line">        C --&gt; D[&quot;Replanner&quot;]</span><br><span class="line">        D --&gt;|&quot;éœ€è¦æ›´å¤šä¿¡æ¯&quot;| C</span><br><span class="line">        D --&gt;|&quot;ä¿¡æ¯å……è¶³&quot;| E[&quot;è¾“å‡ºç»“æ„åŒ–ä¿¡æ¯&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph &quot;å†…å®¹ç”Ÿæˆé˜¶æ®µ&quot;</span><br><span class="line">        E --&gt; F[&quot;å¤§çº²è®¾è®¡èŠ‚ç‚¹&quot;]</span><br><span class="line">        F --&gt; G[&quot;é¡µé¢å†…å®¹ç”ŸæˆèŠ‚ç‚¹&quot;]</span><br><span class="line">        G --&gt; H[&quot;HTMLä»£ç ç”ŸæˆèŠ‚ç‚¹&quot;]</span><br><span class="line">    end</span><br><span class="line">    </span><br><span class="line">    subgraph &quot;æ–‡ä»¶è½¬æ¢é˜¶æ®µ&quot;</span><br><span class="line">        H --&gt; I[&quot;htmlæ¼”ç¤ºç”Ÿæˆ&quot;]</span><br><span class="line">        I --&gt; J[&quot;è½¬æ¢pptxèŠ‚ç‚¹&quot;]</span><br><span class="line">        J --&gt; K[&quot;è¾“å‡ºPPTXæ–‡ä»¶&quot;]</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>
<h3 id="åˆ©ç”¨apryseå°†pdfè½¬æˆpptx">åˆ©ç”¨APRYSEå°†pdfè½¬æˆpptx</h3>
<p>Apryseï¼ˆæ›¾ç”¨å PDFTronï¼‰æ˜¯ä¸€å®¶åŠ æ‹¿å¤§å…¬å¸æ¨å‡ºçš„å•†ç”¨ SDK å®¶æ—ï¼Œä¸“æ³¨
â€œä»»ä½•æ ¼å¼è¿›ã€ä»»ä½•æ ¼å¼å‡ºâ€ çš„æ–‡æ¡£å¤„ç†ã€‚</p>
<p>è·å–apikey<a target="_blank" rel="noopener" href="https://docs.apryse.com/core/guides/get-started/trial-key">Free
trial key for Apryse SDK | Apryse documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.apryse.com/core/guides/get-started/python3">Python
3.X PDF Library for Windows, Linux and Mac | Apryse
documentation</a></p>
<p><strong>å®‰è£… Apryse SDK çš„â€œç»“æ„åŒ–è¾“å‡ºæ¨¡å—â€ï¼ˆStructured Output
Moduleï¼‰</strong>ã€‚è¯¥æ¨¡å—æ˜¯ä¸€ä¸ªå¯é€‰çš„æ‰©å±•åŒ…ï¼ŒPDF â†’ PPTXã€PDF â†’ Word
ç­‰é«˜çº§è½¬æ¢åŠŸèƒ½éƒ½ä¾èµ–å®ƒã€‚<a target="_blank" rel="noopener" href="https://docs.apryse.com/core/guides/info/modules">åº“æ’ä»¶ï¼šOCRã€CAD
è½¬ PDF - é€‚ç”¨äºæœåŠ¡å™¨/æ¡Œé¢ SDK | Apryse æ–‡æ¡£ â€” Library Add-ons: OCR, CAD
to PDF - for Server/Desktop SDK | Apryse documentation</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from apryse_sdk import PDFNet, PDFDoc, Convert, StructuredOutputModule</span><br><span class="line"></span><br><span class="line"># 1. åˆå§‹åŒ–ï¼ˆè®¸å¯è¯ï¼‰</span><br><span class="line">PDFNet.Initialize(&quot;demo:1756369085114:&quot;)</span><br><span class="line"></span><br><span class="line"># 2. å‘Šè¯‰ SDK æ¨¡å—æ”¾åœ¨å“ªé‡Œ</span><br><span class="line">PDFNet.AddResourceSearchPath(r&quot;F:\project python\test\StructuredOutputWindows\Lib\Windows&quot;)</span><br><span class="line"></span><br><span class="line"># 3. å¯é€‰ï¼šç¡®è®¤æ¨¡å—å·²å°±ä½</span><br><span class="line">if not StructuredOutputModule.IsModuleAvailable():</span><br><span class="line">    raise RuntimeError(&quot;StructuredOutput module not found!&quot;)</span><br><span class="line"></span><br><span class="line"># 4. æ­£å¸¸è°ƒç”¨</span><br><span class="line">doc = PDFDoc(&quot;input.pdf&quot;)</span><br><span class="line">Convert.ToPowerPoint(doc, &quot;output.pptx&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Zftnz6Ewx/?spm_id_from=333.788.recommend_more_video.0&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">åŠ¨æ‰‹å®ç°ä¸€ä¸ªåšPPTçš„MCPæœåŠ¡å™¨_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/19/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/agentic-rag/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/19/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/agentic-rag/" class="post-title-link" itemprop="url">agentic-ragå®æˆ˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-19 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-19T00:00:00+08:00">2025-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-28 15:06:56" itemprop="dateModified" datetime="2025-08-28T15:06:56+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent%E5%AE%9E%E6%88%98/" itemprop="url" rel="index"><span itemprop="name">agentå®æˆ˜</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€">å‰è¨€</h3>
<p><strong>è¿™ä¸ªagentic
ragä¸»è¦æ˜¯ä½œç”¨äºæ£€ç´¢éƒ¨åˆ†ï¼Œç”±æ˜¯å¦éœ€è¦è°ƒç”¨æ£€ç´¢å·¥å…·åˆ¤å®šæ˜¯å¦è¿›å…¥æ£€ç´¢é˜¶æ®µï¼Œå½“æ£€ç´¢åˆ°ç›¸å…³çš„æ–‡ç« ï¼Œåˆ™è¿›è¡Œå›ç­”ï¼Œå¦åˆ™å¯¹é—®é¢˜è¿›è¡Œæ”¹å†™ï¼Œå†æ¬¡æ£€ç´¢</strong></p>
<p>ä»£ç è§<a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain/tree/main/agentic-rag">learn-rag-langchain/agentic-rag
at main Â· zxj-2023/learn-rag-langchain</a></p>
<p>åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ£€ç´¢ä»£ç†ã€‚å½“æ‚¨å¸Œæœ› LLM
å†³å®šæ˜¯å¦ä»å‘é‡å­˜å‚¨ä¸­æ£€ç´¢ä¸Šä¸‹æ–‡æˆ–ç›´æ¥å“åº”ç”¨æˆ·æ—¶ï¼Œæ£€ç´¢ä»£ç†éå¸¸æœ‰ç”¨ã€‚</p>
<p>å®Œæˆæ•™ç¨‹åï¼Œæˆ‘ä»¬å°†å®Œæˆä»¥ä¸‹å·¥ä½œï¼š</p>
<ol type="1">
<li>è·å–å¹¶é¢„å¤„ç†ç”¨äºæ£€ç´¢çš„æ–‡æ¡£ã€‚</li>
<li>ä¸ºè¿™äº›æ–‡æ¡£å»ºç«‹è¯­ä¹‰ç´¢å¼•ï¼Œå¹¶ä¸ºä»£ç†åˆ›å»ºä¸€ä¸ªæ£€ç´¢å·¥å…·ã€‚</li>
<li>æ„å»ºä¸€ä¸ªèƒ½å¤Ÿå†³å®šä½•æ—¶ä½¿ç”¨æ£€ç´¢å·¥å…·çš„ä»£ç†å¼ RAG ç³»ç»Ÿã€‚</li>
</ol>
<figure>
<img src="/2025/08/19/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/agentic-rag/image-20250819165309335.png" alt="image-20250819165309335">
<figcaption aria-hidden="true">image-20250819165309335</figcaption>
</figure>
<h3 id="é¢„å¤„ç†æ–‡æ¡£">1. é¢„å¤„ç†æ–‡æ¡£</h3>
<p>è·å–ç”¨äºæˆ‘ä»¬ RAG ç³»ç»Ÿçš„æ–‡æ¡£ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Lilian Weng
ä¼˜ç§€åšå®¢ä¸­æœ€æ–°çš„ä¸‰é¡µã€‚æˆ‘ä»¬å°†ä»ä½¿ç”¨ <code>WebBaseLoader</code>
å·¥å…·è·å–é¡µé¢å†…å®¹å¼€å§‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from langchain_community.document_loaders import WebBaseLoader</span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    &quot;https://lilianweng.github.io/posts/2024-11-28-reward-hacking/&quot;,</span><br><span class="line">    &quot;https://lilianweng.github.io/posts/2024-07-07-hallucination/&quot;,</span><br><span class="line">    &quot;https://lilianweng.github.io/posts/2024-04-12-diffusion-video/&quot;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">docs = [WebBaseLoader(url).load() for url in urls]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docs[0][0].page_content.strip()[:1000]</span><br></pre></td></tr></table></figure>
<p>å°†è·å–çš„æ–‡æ¡£åˆ†å‰²æˆæ›´å°çš„å—ï¼Œä»¥ä¾¿ç´¢å¼•åˆ°æˆ‘ä»¬çš„å‘é‡å­˜å‚¨ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from langchain_text_splitters import RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line">docs_list = [item for sublist in docs for item in sublist]</span><br><span class="line"></span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter.from_tiktoken_encoder(</span><br><span class="line">    chunk_size=100, chunk_overlap=50</span><br><span class="line">)</span><br><span class="line">doc_splits = text_splitter.split_documents(docs_list)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doc_splits[0].page_content.strip()</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºæ£€ç´¢å·¥å…·">2. åˆ›å»ºæ£€ç´¢å·¥å…·</h3>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†åˆ†å‰²çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç´¢å¼•åˆ°ä¸€ä¸ªå‘é‡å­˜å‚¨ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªå‘é‡å­˜å‚¨è¿›è¡Œè¯­ä¹‰æœç´¢ã€‚</p>
<p>ä½¿ç”¨å†…å­˜å‘é‡å­˜å‚¨å’Œ OpenAI åµŒå…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from langchain_chroma import Chroma  # å¯¼å…¥ Chroma</span><br><span class="line">from langchain_openai import OpenAIEmbeddings</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># ç¡®ä¿å®‰è£…äº† langchain-chroma</span><br><span class="line"># pip install langchain-chroma</span><br><span class="line"></span><br><span class="line">embedding = OpenAIEmbeddings(</span><br><span class="line">    api_key=&quot;sk-&quot;, </span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">    model=&quot;text-embedding-v4&quot;,</span><br><span class="line">    check_embedding_ctx_length=False,</span><br><span class="line">    dimensions=1536,</span><br><span class="line">    chunk_size=5  # è®¾ç½®è¾ƒå°çš„æ‰¹æ¬¡å¤§å°</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ Chroma æ›¿ä»£ InMemoryVectorStore</span><br><span class="line">vectorstore = Chroma.from_documents(</span><br><span class="line">    documents=doc_splits, </span><br><span class="line">    embedding=embedding,</span><br><span class="line">    persist_directory=&quot;./chroma_db&quot;  # æŒ‡å®šæŒä¹…åŒ–ç›®å½•</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># é‡æ–°åŠ è½½å·²å­˜åœ¨çš„ Chroma æ•°æ®åº“</span><br><span class="line">vectorstore = Chroma(</span><br><span class="line">    persist_directory=&quot;./chroma_db&quot;,</span><br><span class="line">    embedding_function=embedding</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">retriever = vectorstore.as_retriever()</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ LangChain çš„é¢„æ„å»º <code>create_retriever_tool</code>
åˆ›å»ºæ£€ç´¢å·¥å…·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain.tools.retriever import create_retriever_tool</span><br><span class="line"></span><br><span class="line">retriever_tool = create_retriever_tool(</span><br><span class="line">    retriever,                    # ã€è¾“å…¥ã€‘ä¸€ä¸ªå·²ç»é…ç½®å¥½çš„æ£€ç´¢å™¨ï¼ˆä¾‹å¦‚ï¼šå‘é‡æ•°æ®åº“çš„æ£€ç´¢å™¨ï¼‰</span><br><span class="line">    &quot;retrieve_blog_posts&quot;,        # ã€å·¥å…·åç§°ã€‘è¿™ä¸ªå·¥å…·çš„å”¯ä¸€æ ‡è¯†åï¼ˆä¾›æ¨¡å‹å†…éƒ¨è°ƒç”¨ï¼‰</span><br><span class="line">    &quot;Search and return information about Lilian Weng blog posts.&quot;  # ã€å·¥å…·æè¿°ã€‘æ¨¡å‹çœ‹åˆ°çš„è¯´æ˜ï¼Œç”¨äºå†³å®šæ˜¯å¦è°ƒç”¨å®ƒ</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retriever_tool.invoke(&#123;&quot;query&quot;: &quot;types of reward hacking&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="ç”ŸæˆæŸ¥è¯¢">3. ç”ŸæˆæŸ¥è¯¢</h3>
<p>ç°åœ¨æˆ‘ä»¬å°†å¼€å§‹æ„å»ºæˆ‘ä»¬æ™ºèƒ½ä½“ RAG å›¾ä¸­çš„ç»„ä»¶ï¼ˆèŠ‚ç‚¹å’Œè¾¹ï¼‰ã€‚</p>
<p>æ„å»ºä¸€ä¸ª <code>generate_query_or_respond</code> èŠ‚ç‚¹ã€‚å®ƒå°†è°ƒç”¨ LLM
æ¥æ ¹æ®å½“å‰å›¾çŠ¶æ€ï¼ˆæ¶ˆæ¯åˆ—è¡¨ï¼‰ç”Ÿæˆå“åº”ã€‚æ ¹æ®è¾“å…¥æ¶ˆæ¯ï¼Œå®ƒå°†å†³å®šä½¿ç”¨æ£€ç´¢å·¥å…·è¿›è¡Œæ£€ç´¢ï¼Œæˆ–ç›´æ¥å“åº”ç”¨æˆ·ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬é€šè¿‡
<code>.bind_tools</code> å‘èŠå¤©æ¨¡å‹æä¾›äº†å…ˆå‰åˆ›å»ºçš„
<code>retriever_tool</code> è®¿é—®æƒé™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain_community.chat_models import ChatTongyi</span><br><span class="line">llm = ChatTongyi(</span><br><span class="line">    model=&quot;qwen3-235b-a22b&quot;,</span><br><span class="line">    api_key=&quot;sk-&quot;,</span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">    model_kwargs=&#123;&quot;enable_thinking&quot;: False&#125;   # å…³é”®åœ¨è¿™é‡Œ</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import MessagesState</span><br><span class="line"></span><br><span class="line">def generate_query_or_respond(state: MessagesState):</span><br><span class="line">    &quot;&quot;&quot;è°ƒç”¨æ¨¡å‹ï¼Œæ ¹æ®å½“å‰çŠ¶æ€ç”Ÿæˆå“åº”ã€‚æ ¹æ®é—®é¢˜ï¼Œæ¨¡å‹å°†å†³å®šæ˜¯ä½¿ç”¨æ£€ç´¢å·¥å…·è¿›è¡Œæ£€ç´¢ï¼Œè¿˜æ˜¯ç›´æ¥å›å¤ç”¨æˆ·ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    response = (</span><br><span class="line">        llm</span><br><span class="line">        .bind_tools([retriever_tool]).invoke(state[&quot;messages&quot;])</span><br><span class="line">    )</span><br><span class="line">    return &#123;&quot;messages&quot;: [response]&#125;</span><br></pre></td></tr></table></figure>
<p>æå‡ºä¸€ä¸ªéœ€è¦è¯­ä¹‰æœç´¢çš„é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">input = &#123;</span><br><span class="line">    &quot;messages&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">            &quot;content&quot;: &quot;What does Lilian Weng say about types of reward hacking?&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">generate_query_or_respond(input)[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h3 id="è¯„å®šæ–‡ä»¶">4.è¯„å®šæ–‡ä»¶</h3>
<p>æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹ â€” <code>grade_documents</code> â€”
æ¥åˆ¤æ–­æ£€ç´¢åˆ°çš„æ–‡æ¡£æ˜¯å¦ä¸é—®é¢˜ç›¸å…³ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå…·æœ‰ç»“æ„åŒ–è¾“å‡ºæ¨¡å¼ <code>GradeDocuments</code>
çš„æ¨¡å‹æ¥å¯¹æ–‡æ¡£è¿›è¡Œè¯„åˆ†ã€‚ <code>grade_documents</code>
å‡½æ•°å°†æ ¹æ®è¯„åˆ†å†³ç­–ï¼ˆ <code>generate_answer</code> æˆ–
<code>rewrite_question</code> ï¼‰è¿”å›è¦å‰å¾€çš„èŠ‚ç‚¹çš„åç§°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">from pydantic import BaseModel, Field</span><br><span class="line">from typing import Literal</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è¯„åˆ†æç¤ºæ¨¡æ¿</span><br><span class="line">GRADE_PROMPT = (</span><br><span class="line">    &quot;ä½ æ˜¯ä¸€ä¸ªè¯„åˆ†å‘˜ï¼Œè´Ÿè´£è¯„ä¼°æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸ç”¨æˆ·é—®é¢˜çš„ç›¸å…³æ€§ã€‚\n &quot;</span><br><span class="line">    &quot;ä»¥ä¸‹æ˜¯æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹ï¼š\n\n &#123;context&#125; \n\n&quot;</span><br><span class="line">    &quot;ä»¥ä¸‹æ˜¯ç”¨æˆ·çš„é—®é¢˜ï¼š&#123;question&#125; \n&quot;</span><br><span class="line">    &quot;å¦‚æœæ–‡æ¡£åŒ…å«ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³çš„å…³é”®è¯æˆ–è¯­ä¹‰å«ä¹‰ï¼Œåˆ™å°†å…¶è¯„ä¸ºç›¸å…³ã€‚\n&quot;</span><br><span class="line">    &quot;è¯·ç»™å‡ºä¸€ä¸ªäºŒå…ƒè¯„åˆ†ï¼š&#x27;yes&#x27;ï¼ˆæ˜¯ï¼‰è¡¨ç¤ºç›¸å…³ï¼Œ&#x27;no&#x27;ï¼ˆå¦ï¼‰è¡¨ç¤ºä¸ç›¸å…³ã€‚&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ç”¨äºè¯„ä¼°æ–‡æ¡£ç›¸å…³æ€§çš„ Pydantic æ¨¡å‹</span><br><span class="line">class GradeDocuments(BaseModel):</span><br><span class="line">    &quot;&quot;&quot;ä½¿ç”¨äºŒå…ƒè¯„åˆ†å¯¹æ–‡æ¡£è¿›è¡Œç›¸å…³æ€§è¯„ä¼°ã€‚&quot;&quot;&quot;</span><br><span class="line">    </span><br><span class="line">    binary_score: str = Field(</span><br><span class="line">        description=&quot;ç›¸å…³æ€§è¯„åˆ†ï¼š&#x27;yes&#x27; è¡¨ç¤ºç›¸å…³ï¼Œ&#x27;no&#x27; è¡¨ç¤ºä¸ç›¸å…³&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–ç”¨äºè¯„åˆ†çš„èŠå¤©æ¨¡å‹</span><br><span class="line">grader_model = llm</span><br><span class="line"></span><br><span class="line">def grade_documents(</span><br><span class="line">    state: MessagesState,</span><br><span class="line">) -&gt; Literal[&quot;generate_answer&quot;, &quot;rewrite_question&quot;]:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    åˆ¤æ–­æ£€ç´¢åˆ°çš„æ–‡æ¡£æ˜¯å¦ä¸ç”¨æˆ·é—®é¢˜ç›¸å…³ã€‚</span><br><span class="line">    </span><br><span class="line">    å‚æ•°:</span><br><span class="line">        state: åŒ…å«æ¶ˆæ¯å†å²çš„çŠ¶æ€å¯¹è±¡ï¼Œå…¶ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯ç”¨æˆ·é—®é¢˜ï¼Œ</span><br><span class="line">               æœ€åä¸€æ¡æ¶ˆæ¯æ˜¯æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹ã€‚</span><br><span class="line">    </span><br><span class="line">    è¿”å›:</span><br><span class="line">        å¦‚æœæ–‡æ¡£ç›¸å…³ï¼Œè¿”å› &quot;generate_answer&quot;ï¼›</span><br><span class="line">        å¦‚æœä¸ç›¸å…³ï¼Œè¿”å› &quot;rewrite_question&quot;ï¼Œè¡¨ç¤ºéœ€è¦é‡å†™é—®é¢˜å¹¶é‡æ–°æ£€ç´¢ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    question = state[&quot;messages&quot;][0].content  # è·å–ç”¨æˆ·é—®é¢˜</span><br><span class="line">    context = state[&quot;messages&quot;][-1].content  # è·å–æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹</span><br><span class="line"></span><br><span class="line">    # å°†é—®é¢˜å’Œæ–‡æ¡£å†…å®¹å¡«å…¥æç¤ºæ¨¡æ¿</span><br><span class="line">    prompt = GRADE_PROMPT.format(question=question, context=context)</span><br><span class="line">    </span><br><span class="line">    # è°ƒç”¨æ¨¡å‹ï¼Œå¹¶ä»¥ç»“æ„åŒ–è¾“å‡ºï¼ˆPydantic æ¨¡å‹ï¼‰çš„å½¢å¼è·å–è¯„åˆ†ç»“æœ</span><br><span class="line">    response = (</span><br><span class="line">        grader_model</span><br><span class="line">        .with_structured_output(GradeDocuments)</span><br><span class="line">        .invoke([&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;])</span><br><span class="line">    )</span><br><span class="line">    #print(response)</span><br><span class="line">    score = response.binary_score  # è·å–äºŒå…ƒè¯„åˆ†ç»“æœ</span><br><span class="line"> </span><br><span class="line">    # æ ¹æ®è¯„åˆ†å†³å®šä¸‹ä¸€æ­¥æ“ä½œ</span><br><span class="line">    if score == &quot;yes&quot;:</span><br><span class="line">        return &quot;generate_answer&quot;  # æ–‡æ¡£ç›¸å…³ï¼Œç”Ÿæˆç­”æ¡ˆ</span><br><span class="line">    else:</span><br><span class="line">        return &quot;rewrite_question&quot;  # æ–‡æ¡£ä¸ç›¸å…³ï¼Œé‡å†™é—®é¢˜åé‡æ–°æ£€ç´¢</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import convert_to_messages</span><br><span class="line"></span><br><span class="line">input = &#123;</span><br><span class="line">    &quot;messages&quot;: convert_to_messages(#å°†ä¸€ç³»åˆ—æ¶ˆæ¯è½¬æ¢ä¸º BaseMessage ç±»å‹çš„æ¶ˆæ¯åˆ—è¡¨ã€‚</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;What does Lilian Weng say about types of reward hacking?&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;assistant&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;&quot;,</span><br><span class="line">                &quot;tool_calls&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: &quot;1&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;retrieve_blog_posts&quot;,</span><br><span class="line">                        &quot;args&quot;: &#123;&quot;query&quot;: &quot;types of reward hacking&quot;&#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;&quot;role&quot;: &quot;tool&quot;, &quot;content&quot;: &quot;meow&quot;, &quot;tool_call_id&quot;: &quot;1&quot;&#125;,</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">grade_documents(input)</span><br></pre></td></tr></table></figure>
<h3 id="é‡å†™é—®é¢˜">5. é‡å†™é—®é¢˜</h3>
<p>æ„å»º <code>rewrite_question</code> èŠ‚ç‚¹ã€‚</p>
<p>æ£€ç´¢å·¥å…·å¯èƒ½ä¼šè¿”å›æ½œåœ¨çš„ä¸ç›¸å…³æ–‡æ¡£ï¼Œè¿™è¡¨æ˜éœ€è¦æ”¹è¿›åŸå§‹ç”¨æˆ·é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†è°ƒç”¨
<code>rewrite_question</code> èŠ‚ç‚¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">REWRITE_PROMPT = (</span><br><span class="line">    &quot;Look at the input and try to reason about the underlying semantic intent / meaning.\n&quot;</span><br><span class="line">    &quot;Here is the initial question:&quot;</span><br><span class="line">    &quot;\n ------- \n&quot;</span><br><span class="line">    &quot;&#123;question&#125;&quot;</span><br><span class="line">    &quot;\n ------- \n&quot;</span><br><span class="line">    &quot;Formulate an improved question:&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">def rewrite_question(state: MessagesState):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    é‡å†™ç”¨æˆ·æœ€åˆçš„æé—®ï¼Œä»¥æ›´å¥½åœ°è¡¨è¾¾å…¶è¯­ä¹‰æ„å›¾ã€‚</span><br><span class="line">    </span><br><span class="line">    å‚æ•°:</span><br><span class="line">        state: åŒ…å«æ¶ˆæ¯å†å²çš„çŠ¶æ€å¯¹è±¡ï¼Œå…¶ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯æ˜¯ç”¨æˆ·åŸå§‹é—®é¢˜ã€‚</span><br><span class="line">    </span><br><span class="line">    è¿”å›:</span><br><span class="line">        ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ä¸€æ¡æ–°çš„ç”¨æˆ·æ¶ˆæ¯ï¼Œå†…å®¹ä¸ºæ”¹å†™åçš„é—®é¢˜ã€‚</span><br><span class="line">        è¯¥æ¶ˆæ¯å°†ç”¨äºåç»­çš„æ£€ç´¢æ­¥éª¤ï¼Œä»¥æé«˜æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    messages = state[&quot;messages&quot;]</span><br><span class="line">    question = messages[0].content  # è·å–ç”¨æˆ·æœ€åˆçš„æé—®</span><br><span class="line">    prompt = REWRITE_PROMPT.format(question=question)  # å°†é—®é¢˜å¡«å…¥æç¤ºæ¨¡æ¿</span><br><span class="line">    response = llm.invoke([&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;])  # è°ƒç”¨æ¨¡å‹ç”Ÿæˆæ”¹å†™åçš„é—®é¢˜</span><br><span class="line">    </span><br><span class="line">    # è¿”å›æ–°çš„æ¶ˆæ¯ç»“æ„ï¼Œå†…å®¹ä¸ºæ”¹å†™åçš„é—®é¢˜</span><br><span class="line">    return &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: response.content&#125;]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">input = &#123;</span><br><span class="line">    &quot;messages&quot;: convert_to_messages(</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;What does Lilian Weng say about types of reward hacking?&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;assistant&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;&quot;,</span><br><span class="line">                &quot;tool_calls&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: &quot;1&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;retrieve_blog_posts&quot;,</span><br><span class="line">                        &quot;args&quot;: &#123;&quot;query&quot;: &quot;types of reward hacking&quot;&#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;&quot;role&quot;: &quot;tool&quot;, &quot;content&quot;: &quot;meow&quot;, &quot;tool_call_id&quot;: &quot;1&quot;&#125;,</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = rewrite_question(input)</span><br><span class="line">print(response[&quot;messages&quot;][-1][&quot;content&quot;])</span><br></pre></td></tr></table></figure>
<h3 id="ç”Ÿæˆç­”æ¡ˆ">6. ç”Ÿæˆç­”æ¡ˆ</h3>
<p>æ„å»º <code>generate_answer</code>
èŠ‚ç‚¹ï¼šå¦‚æœæˆ‘ä»¬é€šè¿‡äº†è¯„åˆ†å™¨çš„æ£€æŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®åŸå§‹é—®é¢˜å’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GENERATE_PROMPT = (</span><br><span class="line">    &quot;You are an assistant for question-answering tasks. &quot;</span><br><span class="line">    &quot;Use the following pieces of retrieved context to answer the question. &quot;</span><br><span class="line">    &quot;If you don&#x27;t know the answer, just say that you don&#x27;t know. &quot;</span><br><span class="line">    &quot;Use three sentences maximum and keep the answer concise.\n&quot;</span><br><span class="line">    &quot;Question: &#123;question&#125; \n&quot;</span><br><span class="line">    &quot;Context: &#123;context&#125;&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_answer(state: MessagesState):</span><br><span class="line">    &quot;&quot;&quot;Generate an answer.&quot;&quot;&quot;</span><br><span class="line">    question = state[&quot;messages&quot;][0].content</span><br><span class="line">    context = state[&quot;messages&quot;][-1].content</span><br><span class="line">    prompt = GENERATE_PROMPT.format(question=question, context=context)</span><br><span class="line">    response = llm.invoke([&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;])</span><br><span class="line">    return &#123;&quot;messages&quot;: [response]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">input = &#123;</span><br><span class="line">    &quot;messages&quot;: convert_to_messages(</span><br><span class="line">        [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;What does Lilian Weng say about types of reward hacking?&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;assistant&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;&quot;,</span><br><span class="line">                &quot;tool_calls&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: &quot;1&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;retrieve_blog_posts&quot;,</span><br><span class="line">                        &quot;args&quot;: &#123;&quot;query&quot;: &quot;types of reward hacking&quot;&#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;tool&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;reward hacking can be categorized into two types: environment or goal misspecification, and reward tampering&quot;,</span><br><span class="line">                &quot;tool_call_id&quot;: &quot;1&quot;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = generate_answer(input)</span><br><span class="line">response[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h3 id="ç»„è£…å›¾è¡¨">7. ç»„è£…å›¾è¡¨</h3>
<p>ä»¥ <code>generate_query_or_respond</code> å¼€å¤´ï¼Œå¹¶ç¡®å®šæ˜¯å¦éœ€è¦è°ƒç”¨
<code>retriever_tool</code></p>
<p>ä½¿ç”¨ <code>tools_condition</code> è·³è½¬åˆ°ä¸‹ä¸€æ­¥ï¼š</p>
<ul>
<li>å¦‚æœ <code>generate_query_or_respond</code> è¿”å›
<code>tool_calls</code> ï¼Œè°ƒç”¨ <code>retriever_tool</code>
è·å–ä¸Šä¸‹æ–‡</li>
<li>å¦åˆ™ï¼Œç›´æ¥å›å¤ç”¨æˆ·</li>
</ul>
<p>å¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹æŒ‰ä¸é—®é¢˜çš„ç›¸å…³æ€§ï¼ˆ <code>grade_documents</code>
ï¼‰è¿›è¡Œè¯„åˆ†ï¼Œå¹¶è·¯ç”±åˆ°ä¸‹ä¸€æ­¥ï¼š</p>
<ul>
<li>å¦‚æœä¸ç›¸å…³ï¼Œä½¿ç”¨ <code>rewrite_question</code>
é‡å†™é—®é¢˜ï¼Œç„¶åå†æ¬¡è°ƒç”¨ <code>generate_query_or_respond</code></li>
<li>å¦‚æœç›¸å…³ï¼Œè¯·ç»§ç»­åˆ° <code>generate_answer</code>
å¹¶ä½¿ç”¨æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸Šä¸‹æ–‡ç”Ÿæˆæœ€ç»ˆå“åº” <code>ToolMessage</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line">from langgraph.prebuilt import ToolNode</span><br><span class="line">from langgraph.prebuilt import tools_condition</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªåŸºäºçŠ¶æ€å›¾ï¼ˆStateGraphï¼‰çš„æµç¨‹ï¼Œç”¨äºç®¡ç†å¯¹è¯æˆ–ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹</span><br><span class="line">workflow = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"># å®šä¹‰æµç¨‹ä¸­å°†å¾ªç¯æ‰§è¡Œçš„å„ä¸ªèŠ‚ç‚¹</span><br><span class="line">workflow.add_node(generate_query_or_respond)          # åˆ¤æ–­æ˜¯ç”Ÿæˆæ£€ç´¢æŸ¥è¯¢è¿˜æ˜¯ç›´æ¥å›å¤ç”¨æˆ·</span><br><span class="line">workflow.add_node(&quot;retrieve&quot;, ToolNode([retriever_tool]))  # æ£€ç´¢èŠ‚ç‚¹ï¼šä½¿ç”¨æ£€ç´¢å·¥å…·ï¼ˆretriever_toolï¼‰ä»çŸ¥è¯†åº“ä¸­æŸ¥æ‰¾ç›¸å…³æ–‡æ¡£</span><br><span class="line">workflow.add_node(rewrite_question)                  # é‡å†™é—®é¢˜èŠ‚ç‚¹ï¼šå½“æ£€ç´¢ç»“æœä¸ç›¸å…³æ—¶ï¼Œä¼˜åŒ–å¹¶é‡å†™ç”¨æˆ·çš„é—®é¢˜</span><br><span class="line">workflow.add_node(generate_answer)                   # ç”Ÿæˆç­”æ¡ˆèŠ‚ç‚¹ï¼šåŸºäºæ£€ç´¢åˆ°çš„ä¿¡æ¯ç”Ÿæˆæœ€ç»ˆå›ç­”</span><br><span class="line"></span><br><span class="line"># è®¾ç½®æµç¨‹çš„èµ·å§‹ç‚¹ï¼šä» `generate_query_or_respond` èŠ‚ç‚¹å¼€å§‹</span><br><span class="line">workflow.add_edge(START, &quot;generate_query_or_respond&quot;)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ æ¡ä»¶è¾¹ï¼šå†³å®šæ˜¯å¦è¿›è¡Œæ–‡æ¡£æ£€ç´¢</span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    &quot;generate_query_or_respond&quot;,</span><br><span class="line">    # ä½¿ç”¨ `tools_condition` å‡½æ•°åˆ¤æ–­ LLM çš„è¾“å‡ºæ„å›¾ï¼š</span><br><span class="line">    # å¦‚æœ LLM å†³å®šè°ƒç”¨ `retriever_tool` å·¥å…·ï¼Œåˆ™è¿›å…¥æ£€ç´¢ï¼›å¦‚æœé€‰æ‹©ç›´æ¥å›å¤ï¼Œåˆ™ç»“æŸæµç¨‹</span><br><span class="line">    tools_condition,</span><br><span class="line">    &#123;</span><br><span class="line">        # å°†æ¡ä»¶åˆ¤æ–­ç»“æœæ˜ å°„åˆ°å›¾ä¸­çš„å…·ä½“èŠ‚ç‚¹</span><br><span class="line">        &quot;tools&quot;: &quot;retrieve&quot;,   # è‹¥éœ€è°ƒç”¨å·¥å…·ï¼Œåˆ™è·³è½¬åˆ°æ£€ç´¢èŠ‚ç‚¹</span><br><span class="line">        END: END               # è‹¥æ— éœ€è°ƒç”¨å·¥å…·ï¼ˆå³å¯ä»¥ç›´æ¥å›ç­”ï¼‰ï¼Œåˆ™ç»“æŸæµç¨‹</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># åœ¨ `retrieve` èŠ‚ç‚¹æ‰§è¡Œåï¼Œæ ¹æ®æ–‡æ¡£ç›¸å…³æ€§åˆ¤æ–­ä¸‹ä¸€æ­¥æ“ä½œ</span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    &quot;retrieve&quot;,</span><br><span class="line">    # è°ƒç”¨ `grade_documents` å‡½æ•°è¯„ä¼°æ£€ç´¢åˆ°çš„æ–‡æ¡£æ˜¯å¦ä¸é—®é¢˜ç›¸å…³</span><br><span class="line">    grade_documents,</span><br><span class="line">    # æ ¹æ®è¯„åˆ†ç»“æœå†³å®šæµå‘ï¼š</span><br><span class="line">    # - å¦‚æœç›¸å…³ï¼Œè¿›å…¥ `generate_answer`</span><br><span class="line">    # - å¦‚æœä¸ç›¸å…³ï¼Œè¿›å…¥ `rewrite_question`</span><br><span class="line">    # ï¼ˆè¯¥é€»è¾‘åœ¨ `grade_documents` å‡½æ•°ä¸­è¿”å› &quot;generate_answer&quot; æˆ– &quot;rewrite_question&quot;ï¼‰</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å›ºå®šè¾¹ï¼šç”Ÿæˆç­”æ¡ˆåæµç¨‹ç»“æŸ</span><br><span class="line">workflow.add_edge(&quot;generate_answer&quot;, END)</span><br><span class="line"></span><br><span class="line"># é‡å†™é—®é¢˜åï¼Œå›åˆ°åˆå§‹èŠ‚ç‚¹é‡æ–°åˆ¤æ–­æ˜¯å¦éœ€è¦æ£€ç´¢</span><br><span class="line">workflow.add_edge(&quot;rewrite_question&quot;, &quot;generate_query_or_respond&quot;)</span><br><span class="line"></span><br><span class="line"># ç¼–è¯‘æ•´ä¸ªå·¥ä½œæµï¼Œç”Ÿæˆå¯æ‰§è¡Œçš„å›¾ç»“æ„</span><br><span class="line">graph = workflow.compile()</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/08/19/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/agentic-rag/image-20250826170834571.png" alt="image-20250826170834571">
<figcaption aria-hidden="true">image-20250826170834571</figcaption>
</figure>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/rag/langgraph_agentic_rag/#2-create-a-retriever-tool">ã€ŠAgentic
RAGã€‹ â€” Agentic RAG</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/18/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Multi-Agent%20Workflows%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/18/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Multi-Agent%20Workflows%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">Multi-Agent Workflowsæ¢³ç†ä¸å®æˆ˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-18 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-18T00:00:00+08:00">2025-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-28 15:13:55" itemprop="dateModified" datetime="2025-08-28T15:13:55+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent%E5%AE%9E%E6%88%98/" itemprop="url" rel="index"><span itemprop="name">agentå®æˆ˜</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€">å‰è¨€</h3>
<p>ä»£ç è§<a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain/tree/main/multi-agent">learn-rag-langchain/multi-agent
at main Â· zxj-2023/learn-rag-langchain</a></p>
<h3 id="ä»€ä¹ˆæ˜¯å¤šæ™ºèƒ½ä½“">ä»€ä¹ˆæ˜¯å¤šæ™ºèƒ½ä½“</h3>
<p>å½“æˆ‘ä»¬è°ˆè®ºâ€å¤šæ™ºèƒ½ä½“â€æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯ç”±llmé©±åŠ¨çš„å¤šä¸ªç‹¬ç«‹çš„agentä»¥<strong>ç‰¹å®šæ–¹å¼</strong>è¿æ¥åœ¨ä¸€èµ·ã€‚</p>
<p>æ¯ä¸ªagentå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„æç¤ºã€LLMã€å·¥å…·å’Œå…¶ä»–è‡ªå®šä¹‰ä»£ç ï¼Œä»¥æœ€ä½³æ–¹å¼ä¸å…¶ä»–æ™ºèƒ½ä½“åä½œã€‚</p>
<p>è¿™ç§æ€ç»´æ–¹å¼éå¸¸é€‚åˆç”¨å›¾æ¥è¡¨ç¤ºï¼Œå°±åƒ <code>langgraph</code>
æ‰€æä¾›çš„é‚£æ ·ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“éƒ½æ˜¯å›¾ä¸­çš„<strong>ä¸€ä¸ªèŠ‚ç‚¹</strong>ï¼Œè€Œå®ƒä»¬ä¹‹é—´çš„<strong>è¿æ¥åˆ™è¡¨ç¤ºä¸ºä¸€æ¡è¾¹</strong>ã€‚<strong>æ§åˆ¶æµç”±è¾¹ç®¡ç†</strong>ï¼Œå®ƒä»¬é€šè¿‡å‘å›¾çš„çŠ¶æ€ä¸­<strong>æ·»åŠ ä¿¡æ¯æ¥è¿›è¡Œé€šä¿¡</strong>ã€‚</p>
<h3 id="å¤šæ™ºèƒ½ä½“æ¶æ„æ¢³ç†">å¤šæ™ºèƒ½ä½“æ¶æ„æ¢³ç†</h3>
<p>langgraphç»™æˆ‘ä»¬æä¾›äº†å‡ ç§<strong>å¤šæ™ºèƒ½ä½“æ¶æ„</strong></p>
<figure>
<img src="/2025/08/18/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Multi-Agent%20Workflows%E5%AE%9E%E6%88%98/image-20250818163359517.png" alt="image-20250818163359517">
<figcaption aria-hidden="true">image-20250818163359517</figcaption>
</figure>
<p><strong>Network</strong>:
æ¯ä¸ªæ™ºèƒ½ä½“å¯ä»¥ä¸å…¶ä»–æ‰€æœ‰æ™ºèƒ½ä½“é€šä¿¡ã€‚ä»»ä½•æ™ºèƒ½ä½“éƒ½å¯ä»¥å†³å®šä¸‹ä¸€æ­¥è°ƒç”¨å“ªä¸ªå…¶ä»–æ™ºèƒ½ä½“ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/multi_agent/multi-agent-collaboration/">Multi-agent
network</a></p>
<p><strong>Supervisor</strong>ï¼šæ¯ä¸ªæ™ºèƒ½ä½“ä¸ä¸€ä¸ªå•ä¸€çš„ç›‘ç£è€…æ™ºèƒ½ä½“é€šä¿¡ã€‚ç›‘ç£è€…æ™ºèƒ½ä½“å†³å®šä¸‹ä¸€æ­¥åº”è¯¥è°ƒç”¨å“ªä¸ªæ™ºèƒ½ä½“ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/multi_agent/agent_supervisor/">ä»£ç†ç›‘ç£è€…
â€” Agent Supervisor</a></p>
<p><strong>Hierarchical</strong>:
ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå…·æœ‰ç›‘ç£è€…ç›‘ç£è€…çš„å¤šä»£ç†ç³»ç»Ÿã€‚è¿™æ˜¯ç›‘ç£è€…æ¶æ„çš„æ³›åŒ–ï¼Œå¹¶å…è®¸æ›´å¤æ‚çš„æ§åˆ¶æµç¨‹ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/multi_agent/hierarchical_agent_teams/">å±‚çº§ä»£ç†å›¢é˜Ÿ
â€” Hierarchical Agent Teams</a></p>
<p><strong>Custom multi-agent workflow</strong>:
æ¯ä¸ªä»£ç†åªä¸ä»£ç†å­é›†é€šä¿¡ã€‚æµç¨‹çš„éƒ¨åˆ†æ˜¯ç¡®å®šçš„ï¼Œåªæœ‰ä¸€äº›ä»£ç†å¯ä»¥å†³å®šä¸‹ä¸€æ­¥è°ƒç”¨å“ªäº›å…¶ä»–ä»£ç†ã€‚</p>
<h3 id="agent-supervisor">Agent Supervisor</h3>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†æ„å»ºä¸€ä¸ªåŒ…å«ä¸¤ä¸ªä»£ç†çš„ç›‘ç£è€…ç³»ç»Ÿâ€”â€”ä¸€ä¸ªç ”ç©¶ä¸“å®¶å’Œä¸€ä¸ªæ•°å­¦ä¸“å®¶ã€‚</p>
<h4 id="ç¯å¢ƒ">ç¯å¢ƒ</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U langgraph langgraph-supervisor langchain-tavily &quot;langchain[openai]&quot;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºå·¥ä½œä»£ç†">1. åˆ›å»ºå·¥ä½œä»£ç†</h4>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ä¸“ä¸šå·¥ä½œä»£ç†â€”â€”ç ”ç©¶ä»£ç†å’Œæ•°å­¦ä»£ç†ï¼š</p>
<ul>
<li>ç ”ç©¶ä»£ç†å°†ä½¿ç”¨ Tavily API è®¿é—®ç½‘ç»œæœç´¢å·¥å…· <a target="_blank" rel="noopener" href="https://www.tavily.com/">Tavily - The Web Access Layer for AI
Agents</a></li>
<li>æ•°å­¦ä»£ç†å°†è®¿é—®ç®€å•çš„æ•°å­¦å·¥å…·ï¼ˆ <code>add</code> ,
<code>multiply</code> , <code>divide</code> ï¼‰</li>
</ul>
<h5 id="ç ”ç©¶ä»£ç†">ç ”ç©¶ä»£ç†</h5>
<p>å¯¹äºç½‘ç»œæœç´¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>TavilySearch</code> å·¥å…·æ¥è‡ª
<code>langchain-tavily</code> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from langchain_tavily import TavilySearch</span><br><span class="line"></span><br><span class="line">web_search = TavilySearch(max_results=3,tavily_api_key=&quot;tvly-dev-&quot;)</span><br><span class="line">web_search_results = web_search.invoke(&quot;å—äº¬åœ¨å“ª&quot;)</span><br><span class="line"></span><br><span class="line">print(web_search_results[&quot;results&quot;][0][&quot;content&quot;])</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†åˆ›å»ºå•ä¸ªå·¥ä½œä»£ç†ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ LangGraph çš„<a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/agents/agents/">é¢„æ„å»ºä»£ç†</a>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.prebuilt import create_react_agent</span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line"></span><br><span class="line">llm=ChatOpenAI(</span><br><span class="line">    model=&quot;qwen3-235b-a22b-thinking-2507&quot;,</span><br><span class="line">    api_key=&quot;sk-&quot;,</span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">research_agent = create_react_agent(</span><br><span class="line">    model=llm,</span><br><span class="line">    tools=[web_search],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯ä¸€ä¸ªç ”ç©¶ä»£ç†ã€‚\n\næŒ‡ä»¤ï¼š\n- ä»…ååŠ©ä¸ç ”ç©¶ç›¸å…³çš„ä»»åŠ¡ï¼Œä¸å¾—è¿›è¡Œä»»ä½•æ•°å­¦è®¡ç®—\n- å®Œæˆä»»åŠ¡åï¼Œç›´æ¥å‘ä¸»ç®¡å›å¤\n- ä»…å›å¤ä½ çš„å·¥ä½œç»“æœï¼Œä¸å¾—åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    name=&quot;research_agent&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬è¿è¡Œä»£ç†æ¥éªŒè¯å®ƒçš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚<strong>æˆ‘ä»¬å°†ä½¿ç”¨</strong>
<code>pretty_print_messages</code>
<strong>è¾…åŠ©å·¥å…·æ¥ç¾è§‚åœ°æ¸²æŸ“æµå¼ä»£ç†è¾“å‡º</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import convert_to_messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pretty_print_message(message, indent=False):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç¾åŒ–æ‰“å°å•æ¡æ¶ˆæ¯</span><br><span class="line">    </span><br><span class="line">    Args:</span><br><span class="line">        message: è¦æ‰“å°çš„æ¶ˆæ¯å¯¹è±¡</span><br><span class="line">        indent: æ˜¯å¦éœ€è¦ç¼©è¿›æ‰“å°</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # å°†æ¶ˆæ¯è½¬æ¢ä¸ºç¾è§‚çš„HTMLæ ¼å¼è¡¨ç¤º</span><br><span class="line">    pretty_message = message.pretty_repr(html=True)</span><br><span class="line">    if not indent:</span><br><span class="line">        # å¦‚æœä¸éœ€è¦ç¼©è¿›ï¼Œç›´æ¥æ‰“å°</span><br><span class="line">        print(pretty_message)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # å¦‚æœéœ€è¦ç¼©è¿›ï¼Œä¸ºæ¯ä¸€è¡Œæ·»åŠ åˆ¶è¡¨ç¬¦å‰ç¼€</span><br><span class="line">    indented = &quot;\n&quot;.join(&quot;\t&quot; + c for c in pretty_message.split(&quot;\n&quot;))</span><br><span class="line">    print(indented)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def pretty_print_messages(update, last_message=False):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç¾åŒ–æ‰“å°æ¶ˆæ¯æ›´æ–°</span><br><span class="line">    </span><br><span class="line">    Args:</span><br><span class="line">        update: åŒ…å«æ¶ˆæ¯æ›´æ–°çš„æ•°æ®ç»“æ„</span><br><span class="line">        last_message: æ˜¯å¦åªæ‰“å°æœ€åä¸€æ¡æ¶ˆæ¯</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    is_subgraph = False  # æ ‡è®°æ˜¯å¦ä¸ºå­å›¾æ›´æ–°</span><br><span class="line">    </span><br><span class="line">    # æ£€æŸ¥æ›´æ–°æ˜¯å¦ä¸ºå…ƒç»„æ ¼å¼ï¼ˆåŒ…å«å‘½åç©ºé—´ä¿¡æ¯ï¼‰</span><br><span class="line">    if isinstance(update, tuple):</span><br><span class="line">        ns, update = update</span><br><span class="line">        # å¦‚æœå‘½åç©ºé—´ä¸ºç©ºï¼Œè·³è¿‡çˆ¶å›¾æ›´æ–°çš„æ‰“å°</span><br><span class="line">        if len(ns) == 0:</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        # æå–å›¾IDå¹¶æ‰“å°å­å›¾æ›´æ–°ä¿¡æ¯</span><br><span class="line">        graph_id = ns[-1].split(&quot;:&quot;)[0]</span><br><span class="line">        print(f&quot;æ¥è‡ªå­å›¾ &#123;graph_id&#125; çš„æ›´æ–°:&quot;)</span><br><span class="line">        print(&quot;\n&quot;)</span><br><span class="line">        is_subgraph = True</span><br><span class="line"></span><br><span class="line">    # éå†æ¯ä¸ªèŠ‚ç‚¹çš„æ›´æ–°</span><br><span class="line">    for node_name, node_update in update.items():</span><br><span class="line">        # æ„é€ æ›´æ–°æ ‡ç­¾</span><br><span class="line">        update_label = f&quot;æ¥è‡ªèŠ‚ç‚¹ &#123;node_name&#125; çš„æ›´æ–°:&quot;</span><br><span class="line">        if is_subgraph:</span><br><span class="line">            # å¦‚æœæ˜¯å­å›¾ï¼Œæ·»åŠ ç¼©è¿›</span><br><span class="line">            update_label = &quot;\t&quot; + update_label</span><br><span class="line"></span><br><span class="line">        print(update_label)</span><br><span class="line">        print(&quot;\n&quot;)</span><br><span class="line"></span><br><span class="line">        # å°†èŠ‚ç‚¹æ›´æ–°ä¸­çš„æ¶ˆæ¯è½¬æ¢ä¸ºæ¶ˆæ¯å¯¹è±¡åˆ—è¡¨</span><br><span class="line">        messages = convert_to_messages(node_update[&quot;messages&quot;])</span><br><span class="line">        # å¦‚æœåªè¦æ±‚æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œåˆ™æˆªå–æœ€åä¸€æ¡</span><br><span class="line">        if last_message:</span><br><span class="line">            messages = messages[-1:]</span><br><span class="line"></span><br><span class="line">        # æ‰“å°æ¯æ¡æ¶ˆæ¯</span><br><span class="line">        for m in messages:</span><br><span class="line">            pretty_print_message(m, indent=is_subgraph)</span><br><span class="line">        print(&quot;\n&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for chunk in research_agent.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å—äº¬åœ¨å“ª?&quot;&#125;]&#125;</span><br><span class="line">):</span><br><span class="line">    pretty_print_messages(chunk)</span><br></pre></td></tr></table></figure>
<h5 id="æ•°å­¦ä»£ç†">æ•°å­¦ä»£ç†</h5>
<p>å¯¹äºæ•°å­¦ä»£ç†å·¥å…·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨çº¯ Python å‡½æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def add(a: float, b: float):</span><br><span class="line">    &quot;&quot;&quot;å°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ ã€‚&quot;&quot;&quot;</span><br><span class="line">    return a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def multiply(a: float, b: float):</span><br><span class="line">    &quot;&quot;&quot;å°†ä¸¤ä¸ªæ•°å­—ç›¸ä¹˜ã€‚&quot;&quot;&quot;</span><br><span class="line">    return a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def divide(a: float, b: float):</span><br><span class="line">    &quot;&quot;&quot;å°†ä¸¤ä¸ªæ•°å­—ç›¸é™¤ã€‚&quot;&quot;&quot;</span><br><span class="line">    return a / b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">math_agent = create_react_agent(</span><br><span class="line">    model=llm,</span><br><span class="line">    tools=[add, multiply, divide],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯ä¸€ä¸ªæ•°å­¦ä»£ç†ã€‚\n\n&quot;</span><br><span class="line">        &quot;æŒ‡ä»¤ï¼š\n&quot;</span><br><span class="line">        &quot;- ä»…ååŠ©å¤„ç†æ•°å­¦ç›¸å…³ä»»åŠ¡\n&quot;</span><br><span class="line">        &quot;- å®Œæˆä»»åŠ¡åï¼Œç›´æ¥å›å¤ç»™ä¸»ç®¡\n&quot;</span><br><span class="line">        &quot;- ä»…å›å¤ä½ çš„å·¥ä½œç»“æœï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    name=&quot;math_agent&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬è¿è¡Œæ•°å­¦ä»£ç†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for chunk in math_agent.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;what&#x27;s (3 + 5) x 7&quot;&#125;]&#125;</span><br><span class="line">):</span><br><span class="line">    pretty_print_messages(chunk)</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºç›‘ç£è€…-langgraph-supervisor">2.åˆ›å»ºç›‘ç£è€…
<code>langgraph-supervisor</code></h4>
<p>ä¸ºäº†å®ç°æˆ‘ä»¬çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é¢„æ„å»ºçš„
<code>langgraph-supervisor</code> åº“ä¸­çš„ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/reference/supervisor/#langgraph_supervisor.supervisor.create_supervisor"><code>create_supervisor</code></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from langgraph_supervisor import create_supervisor</span><br><span class="line">from langchain.chat_models import init_chat_model</span><br><span class="line"></span><br><span class="line">supervisor = create_supervisor(</span><br><span class="line">    model=llm,</span><br><span class="line">    agents=[research_agent, math_agent],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯ä¸€ä¸ªç®¡ç†ä¸¤ä¸ªä»£ç†çš„ä¸»ç®¡ï¼š\n&quot;</span><br><span class="line">        &quot;- ä¸€ä¸ªç ”ç©¶ä»£ç†ã€‚å°†ç ”ç©¶ç›¸å…³ä»»åŠ¡åˆ†é…ç»™è¿™ä¸ªä»£ç†\n&quot;</span><br><span class="line">        &quot;- ä¸€ä¸ªæ•°å­¦ä»£ç†ã€‚å°†æ•°å­¦ç›¸å…³ä»»åŠ¡åˆ†é…ç»™è¿™ä¸ªä»£ç†\n&quot;</span><br><span class="line">        &quot;ä¸€æ¬¡åªåˆ†é…å·¥ä½œç»™ä¸€ä¸ªä»£ç†ï¼Œä¸è¦å¹¶è¡Œè°ƒç”¨ä»£ç†ã€‚\n&quot;</span><br><span class="line">        &quot;ä¸è¦è‡ªå·±åšä»»ä½•å·¥ä½œã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    add_handoff_back_messages=True,</span><br><span class="line">    output_mode=&quot;full_history&quot;,</span><br><span class="line">).compile()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import display, Image</span><br><span class="line"></span><br><span class="line">display(Image(supervisor.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/08/18/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Multi-Agent%20Workflows%E5%AE%9E%E6%88%98/image-20250819113009108.png" alt="image-20250819113009108">
<figcaption aria-hidden="true">image-20250819113009108</figcaption>
</figure>
<p>ç°åœ¨è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªéœ€è¦ä¸¤ä¸ªä»£ç†çš„æŸ¥è¯¢æ¥è¿è¡Œå®ƒï¼š</p>
<p>ç ”ç©¶ä»£ç†å°†æŸ¥æ‰¾å¿…è¦çš„ GDP ä¿¡æ¯ï¼›æ•°å­¦ä»£ç†å°†æ‰§è¡Œé™¤æ³•ä»¥æ‰¾åˆ°çº½çº¦å· GDP
çš„ç™¾åˆ†æ¯”ï¼Œå¦‚æ‰€è¯·æ±‚</p>
<h4 id="ä»å¤´åˆ›å»ºç›‘ç£è€…">3.ä»å¤´åˆ›å»ºç›‘ç£è€…</h4>
<p>ç°åœ¨è®©æˆ‘ä»¬ä»å¤´å®ç°è¿™ä¸ªå¤šæ™ºèƒ½ä½“ç³»ç»Ÿã€‚æˆ‘ä»¬éœ€è¦ï¼š</p>
<ol type="1">
<li>è®¾ç½®ä¸»ç®¡å¦‚ä½•ä¸å„ä¸ªä»£ç†è¿›è¡Œæ²Ÿé€š</li>
<li>åˆ›å»ºç›‘ç£ä»£ç†</li>
<li>å°†ç›‘ç£ä»£ç†å’Œå·¥ä½œä»£ç†ç»„åˆæˆä¸€ä¸ªå¤šä»£ç†å›¾ã€‚</li>
</ol>
<h5 id="è®¾ç½®ä»£ç†é€šä¿¡">è®¾ç½®ä»£ç†é€šä¿¡</h5>
<p>æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ç§æ–¹å¼ï¼Œè®©ç›‘ç£ä»£ç†èƒ½å¤Ÿä¸å·¥ä½œä»£ç†è¿›è¡Œé€šä¿¡ã€‚åœ¨å¤šä»£ç†æ¶æ„ä¸­ï¼Œå®ç°è¿™ä¸€åŠŸèƒ½çš„ä¸€ç§å¸¸è§æ–¹æ³•æ˜¯ä½¿ç”¨<strong>handoffs</strong>ï¼Œå³ä¸€ä¸ªä»£ç†å°†æ§åˆ¶æƒäº¤ç»™å¦ä¸€ä¸ªä»£ç†ã€‚äº¤æ¥å…è®¸ä½ æŒ‡å®šï¼š</p>
<ul>
<li><strong>destination</strong>:è¦è½¬ç§»åˆ°çš„ç›®æ ‡ä»£ç†</li>
<li><strong>payload</strong>:è¦ä¼ é€’ç»™è¯¥æ™ºèƒ½ä½“çš„ä¿¡æ¯</li>
</ul>
<p>æˆ‘ä»¬å°†é€šè¿‡<strong>handoff
tools</strong>ï¼ˆè½¬æ¥å·¥å…·ï¼‰å®ç°è½¬æ¥ï¼Œå¹¶å°†è¿™äº›å·¥å…·äº¤ç»™ç›‘ç£ä»£ç†ï¼šå½“ç›‘ç£ä»£ç†è°ƒç”¨è¿™äº›å·¥å…·æ—¶ï¼Œå®ƒå°†æ§åˆ¶æƒè½¬äº¤ç»™å·¥ä½œä»£ç†ï¼Œå¹¶å°†å®Œæ•´æ¶ˆæ¯å†å²ä¼ é€’ç»™è¯¥ä»£ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">from typing import Annotated</span><br><span class="line">from langchain_core.tools import tool, InjectedToolCallId</span><br><span class="line">from langgraph.prebuilt import InjectedState</span><br><span class="line">from langgraph.graph import StateGraph, START, MessagesState</span><br><span class="line">from langgraph.types import Command</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def create_handoff_tool(*, agent_name: str, description: str | None = None):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    åˆ›å»ºä¸€ä¸ªâ€œäº¤æ¥â€å·¥å…·å‡½æ•°ï¼Œç”¨äºåœ¨ LangGraph çš„ Supervisor-Worker æ¶æ„ä¸­</span><br><span class="line">    æŠŠå½“å‰å¯¹è¯çŠ¶æ€ç§»äº¤ç»™æŒ‡å®šåç§°çš„å­ Agentã€‚</span><br><span class="line"></span><br><span class="line">    å‚æ•°</span><br><span class="line">    ----</span><br><span class="line">    agent_name : str</span><br><span class="line">        ç›®æ ‡å­ Agent çš„åç§°ï¼Œå¿…é¡»ä¸ Supervisor å›¾ä¸­æ³¨å†Œçš„èŠ‚ç‚¹åä¸€è‡´ã€‚</span><br><span class="line">    description : str | None</span><br><span class="line">        å·¥å…·çš„æè¿°æ–‡æœ¬ã€‚å¦‚æœä¸º Noneï¼Œåˆ™ä½¿ç”¨é»˜è®¤æè¿° &quot;Ask &#123;agent_name&#125; for help.&quot;ã€‚</span><br><span class="line"></span><br><span class="line">    è¿”å›</span><br><span class="line">    ----</span><br><span class="line">    handoff_tool : Callable</span><br><span class="line">        ä¸€ä¸ªå·²ç”¨ @tool è£…é¥°çš„å‡½æ•°ï¼Œå¯ç›´æ¥æ³¨å…¥åˆ° Supervisor çš„å·¥å…·åˆ—è¡¨ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # åŠ¨æ€ç”Ÿæˆå·¥å…·åï¼Œä¾‹å¦‚ agent_name=&quot;math_agent&quot; -&gt; &quot;transfer_to_math_agent&quot;</span><br><span class="line">    name = f&quot;transfer_to_&#123;agent_name&#125;&quot;</span><br><span class="line"></span><br><span class="line">    # å¦‚æœè°ƒç”¨è€…æ²¡æœ‰æä¾›æè¿°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤æè¿°</span><br><span class="line">    description = description or f&quot;Ask &#123;agent_name&#125; for help.&quot;</span><br><span class="line"></span><br><span class="line">    # ç”¨ LangGraph çš„ @tool è£…é¥°å™¨æ³¨å†Œå·¥å…·</span><br><span class="line">    @tool(name, description=description)</span><br><span class="line">    def handoff_tool(</span><br><span class="line">        state: Annotated[MessagesState, InjectedState],</span><br><span class="line">        tool_call_id: Annotated[str, InjectedToolCallId],</span><br><span class="line">    ) -&gt; Command:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å®é™…æ‰§è¡Œäº¤æ¥é€»è¾‘çš„å·¥å…·å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line">        å‚æ•°</span><br><span class="line">        ----</span><br><span class="line">        state : MessagesState</span><br><span class="line">            å½“å‰å¯¹è¯çŠ¶æ€ï¼Œç”± LangGraph æ³¨å…¥ã€‚</span><br><span class="line">        tool_call_id : str</span><br><span class="line">            æœ¬æ¬¡å·¥å…·è°ƒç”¨çš„å”¯ä¸€ IDï¼Œç”± LangGraph æ³¨å…¥ã€‚</span><br><span class="line"></span><br><span class="line">        è¿”å›</span><br><span class="line">        ----</span><br><span class="line">        Command</span><br><span class="line">            ä¸€ä¸ª LangGraph Command å¯¹è±¡ï¼Œå‘Šè¯‰æ¡†æ¶ï¼š</span><br><span class="line">            - goto=agent_name        : è·³è½¬åˆ°å“ªä¸ªå­ Agent</span><br><span class="line">            - update                 : æ›´æ–°åçš„çŠ¶æ€</span><br><span class="line">            - graph=Command.PARENT   : åœ¨çˆ¶å›¾ï¼ˆSupervisorï¼‰ä½œç”¨åŸŸå†…æ‰§è¡Œ</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # æ„é€ ä¸€æ¡å·¥å…·æ¶ˆæ¯ï¼Œè®°å½•äº¤æ¥åŠ¨ä½œ</span><br><span class="line">        tool_message = &#123;</span><br><span class="line">            &quot;role&quot;: &quot;tool&quot;,</span><br><span class="line">            &quot;content&quot;: f&quot;Successfully transferred to &#123;agent_name&#125;&quot;,</span><br><span class="line">            &quot;name&quot;: name,</span><br><span class="line">            &quot;tool_call_id&quot;: tool_call_id,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # ä½¿ç”¨ Command æŠŠå¯¹è¯çŠ¶æ€è¿åŒæ–°æ¶ˆæ¯ä¸€èµ·å‘é€åˆ°ç›®æ ‡ Agent</span><br><span class="line">        return Command(</span><br><span class="line">            goto=agent_name,</span><br><span class="line">            update=&#123;**state, &quot;messages&quot;: state[&quot;messages&quot;] + [tool_message]&#125;,</span><br><span class="line">            graph=Command.PARENT,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    # è¿”å›å·²è£…é¥°çš„å·¥å…·å‡½æ•°ï¼Œä¾› Supervisor æ·»åŠ è¿› tools åˆ—è¡¨</span><br><span class="line">    return handoff_tool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># åˆ›å»ºç ”ç©¶ä»£ç†çš„äº¤æ¥å·¥å…·</span><br><span class="line">assign_to_research_agent = create_handoff_tool(</span><br><span class="line">    agent_name=&quot;research_agent&quot;,</span><br><span class="line">    description=&quot;Assign task to a researcher agent.&quot;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ•°å­¦ä»£ç†çš„äº¤æ¥å·¥å…·</span><br><span class="line">assign_to_math_agent = create_handoff_tool(</span><br><span class="line">    agent_name=&quot;math_agent&quot;,</span><br><span class="line">    description=&quot;Assign task to a math agent.&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºç›‘ç£ä»£ç†">åˆ›å»ºç›‘ç£ä»£ç†</h5>
<p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨åˆšåˆšå®šä¹‰çš„äº¤æ¥å·¥å…·æ¥åˆ›å»ºç›‘ç£ä»£ç†ã€‚æˆ‘ä»¬å°†ä½¿ç”¨é¢„æ„å»ºçš„
<code>create_react_agent</code> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">supervisor_agent = create_react_agent(</span><br><span class="line">    model=llm,</span><br><span class="line">    tools=[assign_to_research_agent, assign_to_math_agent],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯ä¸€ä¸ªç®¡ç†ä¸¤ä¸ªä»£ç†çš„ä¸»ç®¡ï¼š\n&quot;</span><br><span class="line">        &quot;- ä¸€ä¸ªç ”ç©¶ä»£ç†ã€‚å°†ç ”ç©¶ç›¸å…³ä»»åŠ¡åˆ†é…ç»™è¿™ä¸ªä»£ç†\n&quot;</span><br><span class="line">        &quot;- ä¸€ä¸ªæ•°å­¦ä»£ç†ã€‚å°†æ•°å­¦ç›¸å…³ä»»åŠ¡åˆ†é…ç»™è¿™ä¸ªä»£ç†\n&quot;</span><br><span class="line">        &quot;ä¸€æ¬¡åªåˆ†é…å·¥ä½œç»™ä¸€ä¸ªä»£ç†ï¼Œä¸è¦å¹¶è¡Œè°ƒç”¨ä»£ç†ã€‚\n&quot;</span><br><span class="line">        &quot;ä¸è¦è‡ªå·±åšä»»ä½•å·¥ä½œã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    name=&quot;supervisor&quot;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºå¤šæ™ºèƒ½ä½“å›¾">åˆ›å»ºå¤šæ™ºèƒ½ä½“å›¾</h5>
<p>å°†è¿™äº›å†…å®¹æ•´åˆèµ·æ¥ï¼Œè®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„æ•´ä½“å¤šä»£ç†ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªå›¾ã€‚æˆ‘ä»¬å°†æ·»åŠ ç›‘ç£ä»£ç†å’Œå„ä¸ªä»£ç†ä½œä¸ºå­å›¾èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import END</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¤šä»£ç†ä¸»ç®¡å›¾</span><br><span class="line">supervisor = (</span><br><span class="line">    StateGraph(MessagesState)</span><br><span class="line">    # æ³¨æ„ï¼š`destinations` ä»…ç”¨äºå¯è§†åŒ–ï¼Œä¸å½±å“è¿è¡Œæ—¶è¡Œä¸º</span><br><span class="line">    .add_node(supervisor_agent, destinations=(&quot;research_agent&quot;, &quot;math_agent&quot;, END))</span><br><span class="line">    .add_node(research_agent)</span><br><span class="line">    .add_node(math_agent)</span><br><span class="line">    .add_edge(START, &quot;supervisor&quot;)</span><br><span class="line">    # æ€»æ˜¯è¿”å›åˆ°ä¸»ç®¡</span><br><span class="line">    .add_edge(&quot;research_agent&quot;, &quot;supervisor&quot;)</span><br><span class="line">    .add_edge(&quot;math_agent&quot;, &quot;supervisor&quot;)</span><br><span class="line">    .compile()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œå» <code>research_agent</code> å’Œ
<code>math_agent</code>
çš„æ¡ä»¶è¾¹æ˜¯é€šè¿‡<strong>å·¥å…·è°ƒç”¨</strong>å®ç°çš„ï¼Œè€Œä¸æ˜¯æ˜¾å¼çš„æ¡ä»¶è¾¹ã€‚</p>
<p>å·¥ä½œæœºåˆ¶ï¼š</p>
<ol type="1">
<li><p><strong>å·¥å…·ä½œä¸ºäº¤æ¥æ‰‹æ®µ</strong>ï¼š</p>
<ul>
<li><code>assign_to_research_agent</code> å’Œ
<code>assign_to_math_agent</code> è¿™ä¸¤ä¸ªå·¥å…·è¢«æ·»åŠ åˆ°
<code>supervisor_agent</code> ä¸­</li>
<li>å½“ supervisor_agent å†³å®šéœ€è¦æŸä¸ªä»£ç†å¸®åŠ©æ—¶ï¼Œå®ƒä¼šè°ƒç”¨ç›¸åº”çš„å·¥å…·</li>
</ul></li>
<li><p><strong>å·¥å…·å†…éƒ¨å®ç°äº¤æ¥</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def handoff_tool(...) -&gt; Command:</span><br><span class="line">    return Command(</span><br><span class="line">        goto=agent_name,  # è¿™é‡ŒæŒ‡å®šäº†è¦è·³è½¬åˆ°å“ªä¸ªä»£ç†</span><br><span class="line">        update=&#123;...&#125;,</span><br><span class="line">        graph=Command.PARENT,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></li>
<li><p><strong>éšå¼çš„æ¡ä»¶è¾¹</strong>ï¼š</p>
<ul>
<li>å½“ supervisor_agent è°ƒç”¨ <code>assign_to_research_agent</code>
å·¥å…·æ—¶ â†’ è‡ªåŠ¨è·³è½¬åˆ° <code>research_agent</code></li>
<li>å½“ supervisor_agent è°ƒç”¨ <code>assign_to_math_agent</code> å·¥å…·æ—¶ â†’
è‡ªåŠ¨è·³è½¬åˆ° <code>math_agent</code></li>
</ul></li>
</ol>
</blockquote>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ Command æœºåˆ¶</p>
<p>Command æœºåˆ¶æ˜¯ LangGraph
æä¾›çš„ä¸€ç§<strong>æ˜¾å¼æ§åˆ¶æµç¨‹è·³è½¬</strong>çš„æ–¹å¼ã€‚å®ƒå…è®¸å·¥å…·æˆ–èŠ‚ç‚¹ç›´æ¥æŒ‡å®šä¸‹ä¸€æ­¥è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œè€Œä¸éœ€è¦é€šè¿‡ä¼ ç»Ÿçš„æ¡ä»¶è¾¹è·¯ç”±ã€‚</p>
<p>Command çš„æ ¸å¿ƒæ¦‚å¿µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.types import Command</span><br><span class="line"></span><br><span class="line">Command(</span><br><span class="line">    goto=agent_name,           # è¦è·³è½¬åˆ°çš„ç›®æ ‡èŠ‚ç‚¹</span><br><span class="line">    update=state_update,       # è¦æ›´æ–°çš„çŠ¶æ€</span><br><span class="line">    graph=Command.PARENT      # åœ¨å“ªä¸ªå›¾ä¸­æ‰§è¡Œï¼ˆçˆ¶å›¾/å­å›¾ï¼‰</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»ä»å·¥ä½œä»£ç†æ·»åŠ äº†æ˜ç¡®çš„è¾¹å›åˆ°ä¸»ç®¡â€”â€”è¿™æ„å‘³ç€å®ƒä»¬ä¿è¯ä¼šå°†æ§åˆ¶æƒè¿”å›ç»™ä¸»ç®¡ã€‚å¦‚æœä½ å¸Œæœ›ä»£ç†ç›´æ¥å“åº”ç”¨æˆ·ï¼ˆå³ï¼Œå°†ç³»ç»Ÿè½¬å˜ä¸ºè·¯ç”±å™¨ï¼‰ï¼Œä½ å¯ä»¥ç§»é™¤è¿™äº›è¾¹ã€‚</p>
<h3 id="multi-agent-network">Multi-agent network</h3>
<p>ä¸€ä¸ªå•ä¸€æ™ºèƒ½ä½“é€šå¸¸å¯ä»¥ä½¿ç”¨å•ä¸ªé¢†åŸŸå†…çš„ä¸€å°æ‰¹å·¥å…·æ¥æœ‰æ•ˆè¿ä½œï¼Œä½†å³ä½¿ä½¿ç”¨åƒ
<code>gpt-4</code> è¿™æ ·å¼ºå¤§çš„æ¨¡å‹ï¼Œä½¿ç”¨å¤šä¸ªå·¥å…·æ—¶ä¹Ÿå¯èƒ½æ•ˆæœä¸ä½³ã€‚</p>
<p>å¤„ç†å¤æ‚ä»»åŠ¡çš„ä¸€ç§æ–¹æ³•æ˜¯é‡‡ç”¨â€œåˆ†è€Œæ²»ä¹‹â€çš„æ–¹æ³•ï¼šä¸ºæ¯ä¸ªä»»åŠ¡æˆ–é¢†åŸŸåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æ™ºèƒ½ä½“ï¼Œå¹¶å°†ä»»åŠ¡è·¯ç”±åˆ°æ­£ç¡®çš„â€œä¸“å®¶â€ã€‚è¿™æ˜¯ä¸€ä¸ªå¤šæ™ºèƒ½ä½“ç½‘ç»œæ¶æ„çš„ä¾‹å­ã€‚</p>
<figure>
<img src="/2025/08/18/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Multi-Agent%20Workflows%E5%AE%9E%E6%88%98/image-20250819150039818.png" alt="image-20250819150039818">
<figcaption aria-hidden="true">image-20250819150039818</figcaption>
</figure>
<p><strong>è¿™ä¸ªå¤šagentæ¶æ„ï¼Œå°±åƒå¤šä¸ªagentè¿›è¡Œè®¨è®ºï¼Œæ‰€ä»¥ä¹Ÿå«Multi Agent
Collaborationï¼Œä½†æ˜¯ç»™æˆ‘çš„æ„Ÿè§‰ï¼Œæ¯”è¾ƒæ··ä¹±ï¼Œagentç›´æ¥çš„è·¯ç”±å¾ˆéš¾å»å®šä¹‰ï¼Œagentä¸€å¤šå°±æä¸æ¸…æ¥šäº†</strong>ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸å®æˆ˜äº†ã€‚</p>
<h3 id="hierarchical-agent-teams">Hierarchical Agent Teams</h3>
<p>å¯¹äºæŸäº›åº”ç”¨ï¼Œå¦‚æœå·¥ä½œæŒ‰å±‚æ¬¡åˆ†å¸ƒï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ›´æœ‰æ•ˆã€‚ä½ å¯ä»¥é€šè¿‡ç»„åˆä¸åŒçš„å­å›¾ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé¡¶å±‚ç›‘ç£è€…ä»¥åŠä¸­å±‚ç›‘ç£è€…æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<figure>
<img src="/2025/08/18/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Multi-Agent%20Workflows%E5%AE%9E%E6%88%98/image-20250819151813264.png" alt="image-20250819151813264">
<figcaption aria-hidden="true">image-20250819151813264</figcaption>
</figure>
<p>ä½¿ç”¨é¢„è®¾çš„supervisoræ„å»º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"># 1. å®šä¹‰ç ”ç©¶å›¢é˜Ÿçš„ä»£ç†</span><br><span class="line">@tool</span><br><span class="line">def web_search(query: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;æ‰§è¡Œç½‘ç»œæœç´¢&quot;&quot;&quot;</span><br><span class="line">    return f&quot;æœç´¢ç»“æœï¼šå…³äº&#x27;&#123;query&#125;&#x27;çš„æœ€æ–°ä¿¡æ¯...&quot;</span><br><span class="line"></span><br><span class="line">@tool</span><br><span class="line">def analyze_data(data: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;åˆ†ææ•°æ®&quot;&quot;&quot;</span><br><span class="line">    return f&quot;æ•°æ®åˆ†æç»“æœï¼š&#123;data&#125;çš„è¶‹åŠ¿æ˜¾ç¤º...&quot;</span><br><span class="line"></span><br><span class="line">research_agent = create_react_agent(</span><br><span class="line">    model=llm,</span><br><span class="line">    tools=[web_search, analyze_data],</span><br><span class="line">    prompt=&quot;ä½ æ˜¯ä¸€ä¸ªç ”ç©¶ä¸“å®¶ï¼Œè´Ÿè´£è¿›è¡Œç½‘ç»œæœç´¢å’Œæ•°æ®åˆ†æã€‚&quot;,</span><br><span class="line">    name=&quot;research_specialist&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 2. å®šä¹‰æ•°å­¦å›¢é˜Ÿçš„ä»£ç†</span><br><span class="line">@tool</span><br><span class="line">def calculate_statistics(numbers: list[float]) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;è®¡ç®—ç»Ÿè®¡å€¼&quot;&quot;&quot;</span><br><span class="line">    if not numbers:</span><br><span class="line">        return &quot;é”™è¯¯ï¼šæ•°æ®åˆ—è¡¨ä¸ºç©º&quot;</span><br><span class="line">    avg = sum(numbers) / len(numbers)</span><br><span class="line">    return f&quot;ç»Ÿè®¡ç»“æœï¼šå¹³å‡å€¼=&#123;avg:.2f&#125;ï¼Œæ•°æ®ç‚¹æ•°é‡=&#123;len(numbers)&#125;&quot;</span><br><span class="line"></span><br><span class="line">@tool</span><br><span class="line">def solve_equation(equation: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;è§£æ–¹ç¨‹&quot;&quot;&quot;</span><br><span class="line">    return f&quot;æ–¹ç¨‹ &#123;equation&#125; çš„è§£ä¸ºï¼šx = 42&quot;</span><br><span class="line"></span><br><span class="line">math_agent = create_react_agent(</span><br><span class="line">    model=llm,</span><br><span class="line">    tools=[calculate_statistics, solve_equation],</span><br><span class="line">    prompt=&quot;ä½ æ˜¯ä¸€ä¸ªæ•°å­¦ä¸“å®¶ï¼Œè´Ÿè´£ç»Ÿè®¡è®¡ç®—å’Œæ–¹ç¨‹æ±‚è§£ã€‚&quot;,</span><br><span class="line">    name=&quot;math_specialist&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># 3. åˆ›å»ºç ”ç©¶å›¢é˜Ÿä¸»ç®¡</span><br><span class="line">research_supervisor = create_supervisor(</span><br><span class="line">    model=llm,</span><br><span class="line">    agents=[research_agent],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯ç ”ç©¶å›¢é˜Ÿçš„ä¸»ç®¡ã€‚\n&quot;</span><br><span class="line">        &quot;ä½ çš„å›¢é˜Ÿæœ‰ä¸€ä¸ªç ”ç©¶ä¸“å®¶ï¼Œè´Ÿè´£ç½‘ç»œæœç´¢å’Œæ•°æ®åˆ†æã€‚\n&quot;</span><br><span class="line">        &quot;æ ¹æ®ä»»åŠ¡éœ€æ±‚ï¼Œå°†å·¥ä½œåˆ†é…ç»™ç ”ç©¶ä¸“å®¶ã€‚\n&quot;</span><br><span class="line">        &quot;ç­‰å¾…ä¸“å®¶å®Œæˆä»»åŠ¡åï¼Œæ€»ç»“ç»“æœå¹¶æŠ¥å‘Šç»™ä¸Šçº§ä¸»ç®¡ã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    name=&quot;research_supervisor&quot;</span><br><span class="line">).compile(name=&quot;research_supervisor&quot;)</span><br><span class="line"></span><br><span class="line"># 4. åˆ›å»ºæ•°å­¦å›¢é˜Ÿä¸»ç®¡</span><br><span class="line">math_supervisor = create_supervisor(</span><br><span class="line">    model=llm,</span><br><span class="line">    agents=[math_agent],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯æ•°å­¦å›¢é˜Ÿçš„ä¸»ç®¡ã€‚\n&quot;</span><br><span class="line">        &quot;ä½ çš„å›¢é˜Ÿæœ‰ä¸€ä¸ªæ•°å­¦ä¸“å®¶ï¼Œè´Ÿè´£ç»Ÿè®¡è®¡ç®—å’Œæ–¹ç¨‹æ±‚è§£ã€‚\n&quot;</span><br><span class="line">        &quot;æ ¹æ®ä»»åŠ¡éœ€æ±‚ï¼Œå°†å·¥ä½œåˆ†é…ç»™æ•°å­¦ä¸“å®¶ã€‚\n&quot;</span><br><span class="line">        &quot;ç­‰å¾…ä¸“å®¶å®Œæˆä»»åŠ¡åï¼Œæ€»ç»“ç»“æœå¹¶æŠ¥å‘Šç»™ä¸Šçº§ä¸»ç®¡ã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    name=&quot;math_supervisor&quot;</span><br><span class="line">).compile(name=&quot;math_supervisor&quot;)</span><br><span class="line"></span><br><span class="line"># 5. åˆ›å»ºé¡¶å±‚ä¸»ç®¡</span><br><span class="line">top_supervisor = create_supervisor(</span><br><span class="line">    model=llm,</span><br><span class="line">    agents=[research_supervisor, math_supervisor],</span><br><span class="line">    prompt=(</span><br><span class="line">        &quot;ä½ æ˜¯é¡¶å±‚ä¸»ç®¡ï¼Œç®¡ç†ä¸¤ä¸ªä¸“ä¸šå›¢é˜Ÿï¼š\n&quot;</span><br><span class="line">        &quot;- ç ”ç©¶å›¢é˜Ÿï¼šè´Ÿè´£å¸‚åœºè°ƒç ”ã€æ•°æ®åˆ†æç­‰ä»»åŠ¡\n&quot;</span><br><span class="line">        &quot;- æ•°å­¦å›¢é˜Ÿï¼šè´Ÿè´£ç»Ÿè®¡è®¡ç®—ã€æ–¹ç¨‹æ±‚è§£ç­‰ä»»åŠ¡\n&quot;</span><br><span class="line">        &quot;æ ¹æ®ä»»åŠ¡çš„æ€§è´¨ï¼Œå°†å·¥ä½œåˆ†é…ç»™ç›¸åº”çš„å›¢é˜Ÿä¸»ç®¡ã€‚\n&quot;</span><br><span class="line">        &quot;ç­‰å¾…å›¢é˜Ÿå®Œæˆä»»åŠ¡åï¼Œæ•´åˆæ‰€æœ‰ç»“æœå¹¶ç»™å‡ºæœ€ç»ˆæŠ¥å‘Šã€‚&quot;</span><br><span class="line">    ),</span><br><span class="line">    name=&quot;top_supervisor&quot;</span><br><span class="line">).compile(name=&quot;top_supervisor&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://blog.langchain.com/langgraph-multi-agent-workflows/">LangGraphï¼šå¤šæ™ºèƒ½ä½“å·¥ä½œæµ
â€” LangGraph: Multi-Agent Workflows</a></p>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/concepts/multi_agent/">Overview</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/15/%E5%AD%A6%E4%B9%A0/python-web/react/react/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/15/%E5%AD%A6%E4%B9%A0/python-web/react/react/" class="post-title-link" itemprop="url">python webâ€”â€”react</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-15T00:00:00+08:00">2025-08-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-18 15:44:22" itemprop="dateModified" datetime="2025-08-18T15:44:22+08:00">2025-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python-web/" itemprop="url" rel="index"><span itemprop="name">python-web</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python-web/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€">å‰è¨€</h3>
<p>ä¸ºäº†åç»­è‡ªå·±æ­å»ºå…¨æ ˆé¡¹ç›®åšå‡†å¤‡ï¼Œå¯¹reactåšä¸€å®šçš„äº†è§£</p>
<p>å­¦ä¹ ç›®æ ‡ï¼šå¤§è‡´çœ‹æ‡‚reactçš„åŸºæœ¬è¯­æ³•ï¼Œå¯ä»¥åœ¨aiçš„ååŠ©ä¸‹å®Œæˆå‰ç«¯çš„æ­å»º</p>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>React æ˜¯ Facebookï¼ˆç° Metaï¼‰äº 2013 å¹´å¼€æºçš„ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„
JavaScript åº“ï¼Œç°ç”± React æ ¸å¿ƒå›¢é˜Ÿä¸ç¤¾åŒºå…±åŒç»´æŠ¤ã€‚</p>
<h3 id="é¡¹ç›®æ­å»º">é¡¹ç›®æ­å»º</h3>
<p>é¡¹ç›®åˆ›å»º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-app</span><br></pre></td></tr></table></figure>
<blockquote>
<p>npx æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>npm 5.2+ è‡ªå¸¦çš„â€œåŒ…è¿è¡Œå™¨â€ï¼ˆNode Package eXecuteï¼‰ã€‚ç±»ä¼¼uv</p>
<p>è„šæ‰‹æ¶ï¼ˆScaffold / Boilerplateï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<ol type="1">
<li>å®šä¹‰ï¼šå®˜æ–¹æˆ–ç¤¾åŒºæä¾›çš„â€œé¡¹ç›®æ¨¡æ¿ç”Ÿæˆå™¨â€ï¼Œä¸€æ¡å‘½ä»¤å°±èƒ½åˆ›å»ºå¸¦ç›®å½•ç»“æ„ã€é…ç½®ã€è„šæœ¬ã€ä¾èµ–çš„å®Œæ•´é¡¹ç›®éª¨æ¶ã€‚</li>
<li>ç›®çš„ï¼š â€¢ çœæ‰ç¹ççš„åˆå§‹åŒ–ã€Webpack/Rollup/Vite
é…ç½®ã€ESLint/TypeScript/æµ‹è¯•ç­‰ç¯å¢ƒæ­å»ºã€‚ â€¢
ç»Ÿä¸€å›¢é˜Ÿè§„èŒƒï¼Œé™ä½æ–°äººä¸Šæ‰‹æˆæœ¬ã€‚</li>
</ol>
</blockquote>
<p>å¯åŠ¨å¼€å‘æœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> my-app</span><br><span class="line">npm start        <span class="comment"># æˆ– yarn start</span></span><br></pre></td></tr></table></figure>
<p>ç›®å½•é€Ÿè§ˆï¼ˆæ ¸å¿ƒï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my-app</span><br><span class="line">â”œâ”€ public/         # é™æ€èµ„æºï¼Œindex.html æ˜¯é¡µé¢æ¨¡æ¿</span><br><span class="line">â”œâ”€ src/</span><br><span class="line">â”‚  â”œâ”€ App.js       # æ ¹ç»„ä»¶</span><br><span class="line">â”‚  â”œâ”€ index.js     # åº”ç”¨å…¥å£ï¼ˆReactDOM.createRootï¼‰</span><br><span class="line">â””â”€ package.json    # ä¾èµ–ä¸è„šæœ¬</span><br></pre></td></tr></table></figure>
<h3 id="jsx">JSX</h3>
<p>JSXï¼ˆJavaScript XML çš„ç¼©å†™ï¼‰æ˜¯ React
å¼•å…¥çš„ä¸€ç§<strong>è¯­æ³•ç³–</strong>ï¼ˆsyntactic sugarï¼‰ã€‚å®ƒè®©ä½ åœ¨
JavaScript æ–‡ä»¶é‡Œç›´æ¥å†™<strong>ç±» HTML
æ ‡è®°</strong>ï¼Œç„¶åç”±æ„å»ºå·¥å…·ï¼ˆBabelã€TypeScriptã€esbuildã€swcï¼‰æŠŠå®ƒç¿»è¯‘æˆ<strong>æ™®é€šçš„
JavaScript å‡½æ•°è°ƒç”¨</strong>ã€‚</p>
<p>å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 1. æ‰¾åˆ° public/index.html ä¸­ id=&quot;root&quot; çš„ DOM èŠ‚ç‚¹ï¼Œä½œä¸º React åº”ç”¨çš„æŒ‚è½½ç‚¹</span><br><span class="line">const root = ReactDOM.createRoot(document.getElementById(&#x27;root&#x27;));</span><br><span class="line"></span><br><span class="line">// 2. å°†æ ¹ç»„ä»¶ &lt;App /&gt; æ¸²æŸ“åˆ°è¯¥æŒ‚è½½ç‚¹</span><br><span class="line">root.render(</span><br><span class="line">  // 3. &lt;React.StrictMode&gt; æ˜¯ React æä¾›çš„å¼€å‘æ¨¡å¼è¾…åŠ©å·¥å…·</span><br><span class="line">  //    ä½œç”¨ï¼šåœ¨å¼€å‘é˜¶æ®µè‡ªåŠ¨æ£€æµ‹æ½œåœ¨é—®é¢˜ï¼ˆå¦‚è¿‡æ—¶çš„ APIã€å‰¯ä½œç”¨é‡å¤æ‰§è¡Œç­‰ï¼‰</span><br><span class="line">  //    æ³¨æ„ï¼šå®ƒä»…åœ¨å¼€å‘ç¯å¢ƒç”Ÿæ•ˆï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¼šæ¸²æŸ“ä»»ä½•é¢å¤– DOM</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &#123;/* 4. é¡¹ç›®çœŸæ­£çš„æ ¹ç»„ä»¶ Appï¼Œæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½ä»è¿™é‡Œå¼€å§‹ */&#125;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;/React.StrictMode&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="ç®­å¤´å‡½æ•°">ç®­å¤´å‡½æ•°</h3>
<p>Reactï¼ˆä»¥åŠæ‰€æœ‰ç°ä»£ JavaScriptï¼‰é‡Œï¼Œâ€œç®­å¤´â€æŒ‡çš„æ˜¯
<strong>ç®­å¤´å‡½æ•°ï¼ˆArrow Functionï¼‰</strong>ï¼Œè¯­æ³•æ˜¯ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> å‡½æ•°å = <span class="function">(<span class="params">å‚æ•°</span>) =&gt;</span> è¿”å›å€¼æˆ–è¯­å¥å—</span><br></pre></td></tr></table></figure>
<p>å®ƒçš„ä½œç”¨å¯ä»¥æ¦‚æ‹¬ä¸º <strong>â€œæ›´ç®€æ´çš„å‡½æ•°å£°æ˜ + è¯æ³•ä½œç”¨åŸŸçš„
thisâ€</strong>ã€‚</p>
<p>é€šä¿—ç†è§£ï¼šæŠŠå°æ‹¬å·çš„å†…å®¹å˜æˆç®­å¤´åçš„å†…å®¹</p>
<h3 id="å‡½æ•°ç»„ä»¶">å‡½æ•°ç»„ä»¶</h3>
<p>å‡½æ•°ç»„ä»¶ + JSX çš„ç»„åˆä½œç”¨æ˜¯ï¼š <strong>ä»¥å‡½æ•°çš„å½¢å¼è¿”å›â€œè™šæ‹Ÿ DOM
æè¿°â€ï¼Œäº¤ç”± React æ¸²æŸ“æˆçœŸå® DOM</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å› HTML
ç»„ä»¶æˆ–å­—ç¬¦ä¸²ã€‚</p>
<ol type="1">
<li>å‡½æ•°ç»„ä»¶çš„â€œè¿”å›å€¼â€</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡ Babel ç¼–è¯‘åç­‰ä»·äºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Welcome</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="literal">null</span>, <span class="string">&#x27;Hello &#x27;</span>, props.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>React.createElement</code> ä¼šç”Ÿæˆä¸€ä¸ª<strong>çº¯ JS
å¯¹è±¡</strong>ï¼ˆè™šæ‹ŸèŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€æ®µ HTML å­—ç¬¦ä¸²ã€‚</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„ props</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Card</span>(<span class="params">&#123; title, children &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 2. è¿”å›ä¸€æ®µ JSXï¼ˆæœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆè™šæ‹Ÿ DOMï¼‰</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Card</span> title=<span class="string">&quot;å‡½æ•°ç»„ä»¶&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">Card</span>&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>DOMï¼ˆDocument Object Modelï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰æ˜¯æµè§ˆå™¨åœ¨å†…å­˜é‡ŒæŠŠä¸€ä»½
HTML/XML
æ–‡æ¡£è¡¨ç¤ºæˆ<strong>æ ‘å½¢ç»“æ„</strong>çš„<strong>ç¼–ç¨‹æ¥å£</strong>ï¼ˆAPIï¼‰ã€‚</p>
<p>æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå…ƒç´ ã€æ–‡æœ¬ã€æ³¨é‡Šâ€¦ï¼‰éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‹¥æœ‰å±æ€§ä¸æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> title = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">title.<span class="property">textContent</span> = <span class="string">&#x27;Hi React&#x27;</span>;   <span class="comment">// æ”¹æ–‡æœ¬</span></span><br><span class="line">title.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;red&#x27;</span>;        <span class="comment">// æ”¹æ ·å¼</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="æ’å€¼å†™æ³•">æ’å€¼å†™æ³•</h3>
<p>åœ¨ React ä¸­ï¼Œâ€œæ’å€¼â€ä¸“æŒ‡<strong>æŠŠä¸€æ®µ JavaScript è¡¨è¾¾å¼çš„å®æ—¶ç»“æœå¡è¿›
JSX</strong> çš„å†™æ³•ã€‚ æ ¸å¿ƒç¬¦å·åªæœ‰ä¸€å¯¹èŠ±æ‹¬å·
<code>&#123; &#125;</code>ï¼Œè®°ä½å£è¯€ï¼š<strong>â€œJSX é‡Œå‡¡æ˜¯ {} åŒ…èµ·æ¥çš„ï¼Œå°±æ˜¯
JavaScript è¿è¡Œåçš„å€¼ã€‚â€</strong></p>
<p><strong>åŸºæœ¬æ–‡æœ¬æ’å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const name = &#x27;React&#x27;;</span><br><span class="line">&lt;h1&gt;Hello, &#123;name&#125;!&lt;/h1&gt;          // â†’ Hello, React!</span><br></pre></td></tr></table></figure>
<p><strong>å±æ€§æ’å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const mytitle=&quot;hello&quot;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div title=&#123;mytitle&#125;&gt;&lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®æ¸²æŸ“">æ•°æ®æ¸²æŸ“</h3>
<p><strong>æ¡ä»¶æ¸²æŸ“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const mytitle=&quot;hello&quot;</span><br><span class="line"></span><br><span class="line">  let mycontent=null</span><br><span class="line">  const flag=true</span><br><span class="line">  if(flag)&#123;</span><br><span class="line">    mycontent=&lt;h2&gt;hello&lt;/h2&gt;</span><br><span class="line">  &#125;</span><br><span class="line">  else&#123;</span><br><span class="line">    mycontent=&lt;h2&gt;world&lt;/h2&gt;</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div title=&#123;mytitle&#125;&gt;&#123;mycontent&#125;&lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ—è¡¨æ¸²æŸ“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const list=[&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;]</span><br><span class="line">  const mycontent=list.map((item)=&gt;&#123;</span><br><span class="line">    return &lt;li&gt;&#123;item&#125;&lt;/li&gt;</span><br><span class="line">  &#125;)</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;&#123;mycontent&#125;&lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ol type="1">
<li><code>.map((item) =&gt; &#123; ... &#125;)</code> â€‘
<code>Array.prototype.map</code>ï¼šéå†æ•°ç»„ï¼ŒæŠŠæ¯ä¸ªå…ƒç´ ä¾æ¬¡äº¤ç»™å›è°ƒå‡½æ•°å¤„ç†ï¼Œå¹¶<strong>è¿”å›ä¸€ä¸ªæ–°æ•°ç»„</strong>ã€‚
â€‘ <code>(item)</code> æ˜¯æ¯æ¬¡å¾ªç¯æ‹¿åˆ°çš„å½“å‰å…ƒç´ ã€‚</li>
<li><code>return &lt;li&gt;&#123;item&#125;&lt;/li&gt;</code> â€‘
æ¯ä¸€æ¬¡å¾ªç¯é‡Œï¼ŒæŠŠå½“å‰å…ƒç´  <code>item</code> ç”¨ JSX æ’å€¼è¯­æ³•
<code>&#123;item&#125;</code> æ”¾è¿› <code>&lt;li&gt;</code> æ ‡ç­¾é‡Œã€‚</li>
</ol>
</blockquote>
<h3 id="çŠ¶æ€å¤„ç†">çŠ¶æ€å¤„ç†</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line">function App() &#123;</span><br><span class="line">  const [mycontent,setmycontent]=useState(&quot;hello world&quot;);</span><br><span class="line">  function changeContent()&#123;</span><br><span class="line">    setmycontent(&quot;hello world2&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;div&gt;&#123;mycontent&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;changeContent&#125;&gt;change&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>useState æ˜¯ React æä¾›çš„
<strong>Hook</strong>ï¼Œè®©<strong>å‡½æ•°ç»„ä»¶ä¹Ÿèƒ½æ‹¥æœ‰å†…éƒ¨çŠ¶æ€</strong>ï¼ˆstateï¼‰ã€‚å¯ä»¥é€šè¿‡æ›´æ–°å‡½æ•°ï¼Œè°ƒç”¨åè§¦å‘é‡æ–°æ¸²æŸ“ã€‚</p>
<p><strong>å¯¹è±¡çš„çŠ¶æ€æ›´æ–°</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line">function App() &#123;</span><br><span class="line">  const [mycontent,setmycontent]=useState(&#123;</span><br><span class="line">    title:&#x27;hello world&#x27;,</span><br><span class="line">    content :&#x27;hello world content&#x27;</span><br><span class="line">&#125;);</span><br><span class="line">  function changeContent()&#123;</span><br><span class="line">    setmycontent(&#123;</span><br><span class="line">      ...mycontent,</span><br><span class="line">      content:&#x27;new content&#x27;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;div title=&#123;mycontent.title&#125;&gt;&#123;mycontent.content&#125;&lt;/div&gt;</span><br><span class="line">      &lt;button onClick=&#123;changeContent&#125;&gt;change&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>...mycontent</code> æ˜¯ ES6 çš„ <strong>å¯¹è±¡å±•å¼€è¿ç®—ç¬¦ï¼ˆobject
spreadï¼‰</strong>ã€‚ ä¸€å¥è¯ï¼šæŠŠ <code>mycontent</code>
é‡Œæ‰€æœ‰â€œæ—§å±æ€§â€å…ˆæŠ„å‡ºæ¥ï¼Œç„¶åå†è¦†ç›–/æ–°å¢ä½ åé¢å†™çš„å±æ€§ã€‚</p>
<h3 id="reactç»„ä»¶çš„ä½¿ç”¨">reactç»„ä»¶çš„ä½¿ç”¨</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line">function App() &#123;</span><br><span class="line">return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;img src=&#123;logo&#125; className=&quot;App-logo&quot; alt=&quot;logo&quot; style=&#123;&#123; width: &#x27;100px&#x27;,backgroundColor: &#x27;grey&#x27;&#125;&#125;/&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol type="1">
<li><p><code>className</code> ä»£æ›¿ <code>class</code> ä¼ ç»Ÿ HTML å†™
<code>&lt;img class="App-logo"&gt;</code>ï¼›React ç»„ä»¶é‡Œå¿…é¡»ç”¨
<code>className</code>ï¼Œå› ä¸º JSX æœ€ç»ˆä¼šè¢«ç¼–è¯‘æˆ JavaScript å¯¹è±¡ï¼Œè€Œ
<code>class</code> æ˜¯ JS çš„ä¿ç•™å…³é”®å­—ã€‚</p></li>
<li><p>æ ·å¼å†™æˆ<strong>å¯¹è±¡</strong></p></li>
</ol>
<p>HTML
å†™è¡Œå†…æ ·å¼ï¼š<code>style="width:100px;background-color:grey"</code> React
å¿…é¡»å†™æˆå¯¹è±¡ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">style=&#123;&#123;</span><br><span class="line">  <span class="attr">width</span>: <span class="string">&#x27;100px&#x27;</span>,</span><br><span class="line">  <span class="attr">backgroundColor</span>: <span class="string">&#x27;grey&#x27;</span>   <span class="comment">// é©¼å³°å‘½å</span></span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸º JSX å±æ€§æœ€ç»ˆä¼šå˜æˆ JS
å¯¹è±¡çš„é”®å€¼å¯¹ï¼Œé”®åå¿…é¡»åˆæ³•ï¼ˆé©¼å³°ï¼‰ï¼Œå€¼å¯ä»¥æ˜¯ä»»ä½• JS
å€¼ï¼ˆæ•°å­—ã€å˜é‡ã€è®¡ç®—ç»“æœï¼‰ã€‚</p>
<ol start="3" type="1">
<li>æœ€ç»ˆäº§ç‰©æ˜¯<strong>è™šæ‹Ÿ DOM èŠ‚ç‚¹</strong></li>
</ol>
<p><code>&lt;img src=&#123;logo&#125; ... /&gt;</code> åœ¨æµè§ˆå™¨é‡Œä¸ä¼šç›´æ¥å˜æˆ
<code>&lt;img&gt;</code> æ ‡ç­¾ï¼Œè€Œæ˜¯å…ˆè¢«ç¼–è¯‘æˆï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">React</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;img&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">src</span>: logo,</span><br><span class="line">  <span class="attr">className</span>: <span class="string">&#x27;App-logo&#x27;</span>,</span><br><span class="line">  <span class="attr">alt</span>: <span class="string">&#x27;logo&#x27;</span>,</span><br><span class="line">  <span class="attr">style</span>: &#123; <span class="attr">width</span>: <span class="string">&#x27;100px&#x27;</span>, <span class="attr">backgroundColor</span>: <span class="string">&#x27;grey&#x27;</span> &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>React å†æ‹¿è¿™ä¸ªå¯¹è±¡å»åš diffã€æ›´æ–°çœŸå® DOMï¼Œè€Œä¸æ˜¯ç›´æ¥ innerHTMLã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line"></span><br><span class="line">  const imgdata=&#123;</span><br><span class="line">    className:&quot;App-logo&quot;,</span><br><span class="line">    style:&#123;</span><br><span class="line">      width:&#x27;100px&#x27;,</span><br><span class="line">      backgroundColor:&#x27;grey&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;img src=&#123;logo&#125; alt=&quot;logo&quot; &#123;...imgdata&#125;/&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ <strong>JSX å±•å¼€è¿ç®—ç¬¦ï¼ˆspread attributesï¼‰</strong> æŠŠ
<code>imgdata</code> é‡Œçš„æ‰€æœ‰é”®å€¼ä¸€æ¬¡æ€§â€œæ‹å¹³â€åˆ° <code>&lt;img&gt;</code>
æ ‡ç­¾ä¸Š</p>
<h3 id="ç»„ä»¶å¤ç”¨">ç»„ä»¶å¤ç”¨</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function Article(props) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h2&gt;&#123;props.title&#125;&lt;/h2&gt;</span><br><span class="line">      &lt;p&gt;&#123;props.content&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Article title=&quot;æ ‡ç­¾1&quot; content=&quot;å†…å®¹1&quot; /&gt;</span><br><span class="line">      &lt;Article title=&quot;æ ‡ç­¾2&quot; content=&quot;å†…å®¹2&quot; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç»„ä»¶é€šä¿¡">ç»„ä»¶é€šä¿¡</h3>
<p>ç»„ä»¶é€šä¿¡çš„ 4 æ¡ä¸»çº¿</p>
<p>1ï¸âƒ£ çˆ¶ â†’ å­ï¼šprops 2ï¸âƒ£ å­ â†’ çˆ¶ï¼šå›è°ƒå‡½æ•° 3ï¸âƒ£ éš”ä»£/ä»»æ„ï¼šContext 4ï¸âƒ£
å…¨å±€/è¿œç«¯ï¼šçŠ¶æ€ç®¡ç†åº“ï¼ˆZustandã€Reduxã€React Queryï¼‰</p>
<h4 id="çˆ¶-å­">çˆ¶ â†’ å­</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;</span><br><span class="line">  const title = &#x27;Hello React&#x27;;</span><br><span class="line">  return &lt;Child title=&#123;title&#125; /&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; title &#125;) &#123;</span><br><span class="line">  return &lt;h1&gt;&#123;title&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å­-çˆ¶">å­ â†’ çˆ¶</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Parent() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;p&gt;çˆ¶ï¼š&#123;count&#125;&lt;/p&gt;</span><br><span class="line">      &lt;Child onInc=&#123;() =&gt; setCount(c =&gt; c + 1)&#125; /&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Child(&#123; onInc &#125;) &#123;</span><br><span class="line">  return &lt;button onClick=&#123;onInc&#125;&gt;å­æŒ‰é’® +1&lt;/button&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>çˆ¶ç»„ä»¶æŠŠâ€œä¿®æ”¹å‡½æ•°â€é€šè¿‡ props
ä¼ ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶åœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨å®ƒï¼ŒæŠŠæ•°æ®ä½œä¸ºå‚æ•°ä¼ å›å»ã€‚</strong></p>
<h3 id="react-hooks">react hooks</h3>
<p><strong>Hook æ˜¯ä»€ä¹ˆï¼Ÿ</strong> Hook æ˜¯ React 16.8 å¼•å…¥çš„
<strong>å‡½æ•°çº§ API</strong>ï¼Œè®©å‡½æ•°ç»„ä»¶æ‹¥æœ‰</p>
<ul>
<li>çŠ¶æ€ï¼ˆuseStateï¼‰</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼ˆuseEffectï¼‰</li>
<li>ä¸Šä¸‹æ–‡ï¼ˆuseContextï¼‰</li>
<li>è‡ªå®šä¹‰é€»è¾‘ï¼ˆè‡ªå®šä¹‰ Hookï¼‰ è€Œä¸å¿…å†™ classã€‚</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1kc411D7F9?spm_id_from=333.788.videopod.sections&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">20åˆ†é’Ÿå­¦ä¼šReact
Hooks å‰ç«¯å¼€å‘å¿…çœ‹ AIç¼–ç¨‹å·¥å…· CodeGeeX ä½“éªŒ_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/" class="post-title-link" itemprop="url">A2Aåè®®</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-14 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-14T00:00:00+08:00">2025-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-28 15:09:26" itemprop="dateModified" datetime="2025-08-28T15:09:26+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">aiç›¸å…³</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">A2Aåè®®</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€">å‰è¨€</h3>
<p>å°±æ˜¯clientè°ƒç”¨agenté‚£ä¸€å—ï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒå›°æƒ‘ï¼Œæˆ‘çœ‹ä¾‹å­æ˜¯è¦é€šè¿‡å®šä¹‰ç»™çš„executå’Œcancelå‡½æ•°ï¼Œé‚£å°±æ„å‘³ç€agentæä¾›è€…éƒ½è¦å»è‡ªå·±å»å®šä¹‰è¿™äº›æ€ä¹ˆæ‰§è¡Œçš„å‡½æ•°ï¼Œè¿˜æœ‰æè¿°agentçš„skillå’Œcardï¼Œå·¥ä½œé‡æ˜æ˜¾æ¯”mcpå¤§äº†å¾ˆå¤šï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯ç°åœ¨a2aä¼ æ’­æ²¡æœ‰mcpå¥½çš„ä¸€å¤§åŸå› å§ï¼Œæˆ‘çš„ç†è§£ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹</p>
<hr>
<p>æ€è€ƒï¼šç°åœ¨åˆ©ç”¨a2aæ­å»ºå¤šagentçš„ç°å®ä¾‹å­å¤šå—ï¼Œä»æ¦‚å¿µä¸Šï¼Œæˆ‘è®¤ä¸ºa2açš„æ€è·¯æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ„Ÿè§‰ä¸‹æ¥ï¼Œç°åœ¨å¤§å¤šæ•°çš„å¤šagentçš„å®ç°æ–¹å¼è¿˜æ˜¯åƒlanggraphä¸­<strong>æ¡ä»¶è¾¹</strong>æ¥æ§åˆ¶ä½¿ç”¨å“ªä¸ªagentï¼Œæ˜¯ä¸æ˜¯å› ä¸ºa2aå¯¹äºä¸­å°å¼€å‘è€…æ­å»ºèµ·æ¥è¿˜æ˜¯æœ‰äº›å¤æ‚ï¼Œä½†æˆ‘è¿˜æ˜¯è®¤ä¸ºä»–è¿™ç§äºmcpç±»ä¼¼ï¼Œæ¨¡å—åŒ–ï¼Œå¯ä»¥è‡ªå®šä¹‰çš„å½¢å¼ä¼šæ˜¯åç»­æ–¹å‘ã€‚å°±åƒç°åœ¨çš„mcp
clientï¼Œå¯ä»¥åœ¨å¸‚åœºä¸Šä¸‹è½½è‡ªå·±æƒ³è¦çš„mcpï¼Œåˆ©ç”¨a2aåè®®ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¸‚åœºä¸Šä¸‹è½½æƒ³ç”¨çš„agentï¼Œæ­å»ºè‡ªå·±çš„å¤šagentç®¡å®¶ï¼Œç°åœ¨å¸‚åœºä¸Šæœ‰ç±»ä¼¼çš„äº§å“å—ï¼Ÿ</p>
<p>a2aåè®®å…¶å®ä¸mcpç±»ä¼¼ï¼Œå¯¹è±¡ä¸åŒï¼Œä¸€ä¸ªæ˜¯mcp clientä¸mcp
serverï¼ˆtoolï¼‰ï¼Œä¸€ä¸ªæ˜¯agent clientä¸agent
serverã€‚å…·ä½“å®ç°ä¸­ï¼Œéœ€è¦å®Œæˆå¯¹agent
serverçš„ä¿¡æ¯æš´éœ²ä¸executorçš„ç¼–å†™ï¼Œä»¥ä¾¿è®©clientæ­£ç¡®è°ƒç”¨agentï¼Œè°ƒç”¨å‰è¦å¯åŠ¨æœåŠ¡ã€‚</p>
<p>ä¸€ä¸ªagent
serveræ‰€è¦åŒ…å«çš„è¦ç´ åŒ…æ‹¬ï¼š1.AgentSkillï¼Œç”¨äºæè¿°agentå¯ä»¥å®ç°çš„èƒ½åŠ›</p>
<p>2.AgentCardï¼Œæè¿°agentçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿è¡Œçš„urlï¼Œè¾“å…¥å’Œè¿”å›çš„æ•°æ®ç±»å‹ï¼Œæ‰€åŒ…å«çš„skills</p>
<p>3.AgentExecutorï¼Œå®šä¹‰äº†å¦‚ä½•æ‰§è¡Œæ™ºèƒ½ä½“ï¼Œé€šè¿‡å®šä¹‰executeæ–¹æ³•ï¼Œä»¥ä¾¿æ­£ç¡®è°ƒç”¨agent
server</p>
<p>4.é€šè¿‡DefaultRequestHandlerï¼Œå°è£…è°ƒç”¨agentçš„æ¥å£ï¼Œä¸ç”¨å†æ‰‹å†™æ¥å£ï¼Œåªè¦æä¾›ä¸€ä¸ª
executor å’Œä¸€ä¸ª store
å³å¯ï¼Œæ”¶åˆ°å¯¹è¯å†…å®¹åï¼Œ<code>DefaultRequestHandler</code>
ä¼šæŠŠå¯¹è¯æ‰“åŒ…æˆä»»åŠ¡ï¼Œäº¤ç»™ <code>HelloWorldAgentExecutor</code>
å»æ‰§è¡Œã€‚ã€</p>
<p>5.é€šè¿‡A2AStarletteApplicationæ‰“åŒ…æˆåº”ç”¨ï¼ˆå¦‚fastapiï¼‰ï¼Œä»–çš„ä½œç”¨å¦‚ä¸‹ï¼š1.æŠŠè¿™ä¸ª
handler æ³¨å†ŒæˆçœŸæ­£çš„ HTTP è·¯ç”±ï¼Œäºæ˜¯å¤–éƒ¨å°±èƒ½é€šè¿‡ <code>POST /</code>
è°ƒç”¨ä¸Šè¿° JSON-RPC æ–¹æ³•ã€‚2.å¯¹å¤–æš´éœ²åç‰‡</p>
<h3 id="ä»€ä¹ˆæ˜¯a2aåè®®">ä»€ä¹ˆæ˜¯A2Aåè®®</h3>
<p>A2A åè®®ï¼ˆAgent2Agent Protocolï¼Œæ™ºèƒ½ä½“é—´é€šä¿¡åè®®ï¼‰æ˜¯ Google åœ¨ 2025
å¹´ 4 æœˆå‘å¸ƒå¹¶å¼€æºçš„é¦–ä¸ª AI
æ™ºèƒ½ä½“äº¤äº’æ ‡å‡†ã€‚å®ƒé€šè¿‡ç»Ÿä¸€çš„é€šä¿¡è§„èŒƒï¼Œè§£å†³ä¸åŒå›¢é˜Ÿã€ä¸åŒæ¡†æ¶ã€ä¸åŒä¾›åº”å•†å¼€å‘çš„
AI æ™ºèƒ½ä½“å¦‚ä½•â€œå¯¹è¯â€å’ŒååŒå·¥ä½œçš„é—®é¢˜ã€‚</p>
<blockquote>
<p>ä¸mcpåŒºåˆ†ï¼Œ<strong>MCP</strong> è§£å†³
<strong>â€œå•ä¸ªæ™ºèƒ½ä½“å¦‚ä½•è°ƒç”¨å¤–éƒ¨å·¥å…·/æ•°æ®â€</strong>
çš„é—®é¢˜ï¼Œè€Œ<strong>A2A</strong> è§£å†³
<strong>â€œå¤šä¸ªæ™ºèƒ½ä½“å¦‚ä½•ååŒå®Œæˆä»»åŠ¡â€</strong> çš„é—®é¢˜ã€‚</p>
</blockquote>
<figure>
<img src="/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/image-20250809222720192.png" alt="image-20250809222720192">
<figcaption aria-hidden="true">image-20250809222720192</figcaption>
</figure>
<h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨a2aåè®®">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨A2Aåè®®</h3>
<p>éšç€ AI åº”ç”¨æ·±åŒ–ï¼Œå•ä¸€â€œä¸‡èƒ½â€æ¨¡å‹éš¾ä»¥å…¼é¡¾æ‰€æœ‰é¢†åŸŸã€‚A2A
é¼“åŠ±æ„å»ºâ€œå°è€Œä¸“â€çš„æ™ºèƒ½ä½“ç”Ÿæ€ï¼š</p>
<ul>
<li>æ¯ä¸ªæ™ºèƒ½ä½“ä¸“æ³¨ä¸€ä¸ªé¢†åŸŸï¼ˆå¦‚è®¢ç¥¨ã€æŠ¥ç¨ã€å›¾åƒå¤„ç†ï¼‰ã€‚</li>
<li>é€šè¿‡ A2A
åè®®ï¼Œå®ƒä»¬åƒä¹é«˜ç§¯æœ¨ä¸€æ ·è‡ªç”±ç»„åˆï¼Œå¿«é€Ÿå“åº”æ–°çš„ä¸šåŠ¡éœ€æ±‚ã€‚</li>
</ul>
<p>æ¯”å¦‚ä½ è®©ä¸€ä¸ªagentä½¿ç”¨å¤šä¸ªå·¥å…·ï¼Œä¸ä»…ä¼šæµªè´¹tokensï¼Œä¹Ÿä¼šé™ä½å…¶è°ƒç”¨å·¥å…·çš„å‡†ç¡®æ€§ã€‚æ‰€æœ‰ï¼Œä¸“ä¸šçš„é¢†åŸŸä½¿ç”¨ä¸“ä¸šçš„agentï¼Œè€Œagenté—´çš„é€šä¿¡ä¾¿è¦ä¾é A2Aåè®®</p>
<h3 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h3>
<p><strong>å…‹éš†ä»“åº“</strong></p>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰å…‹éš†ï¼Œè¯·å…‹éš† A2A Samples ä»“åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/a2aproject/a2a-samples.git -b main --depth 1</span><br><span class="line">cd a2a-samples</span><br></pre></td></tr></table></figure>
<p><strong>Python ç¯å¢ƒå’Œ SDK å®‰è£…</strong></p>
<p>æˆ‘ä»¬æ¨èä¸º Python é¡¹ç›®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚A2A Python SDK ä½¿ç”¨
<code>uv</code> è¿›è¡Œä¾èµ–ç®¡ç†ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>pip</code> ä¸
<code>venv</code>ã€‚</p>
<ol type="1">
<li><p><strong>åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š</strong></p>
<p>ä½¿ç”¨ <code>venv</code>ï¼ˆæ ‡å‡†åº“ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m venv .venv</span><br><span class="line">source .venv/bin/activate</span><br></pre></td></tr></table></figure></li>
<li><p><strong>å®‰è£…æ‰€éœ€çš„ Python ä¾èµ–é¡¹ä»¥åŠ A2A SDK
åŠå…¶ä¾èµ–é¡¹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r samples/python/requirements.txt</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="agent-skills-agent-card">Agent Skills &amp; Agent Card</h3>
<h4 id="agent-skills">Agent Skills</h4>
<p>ä¸€ä¸ª<strong>ä»£ç†æŠ€èƒ½</strong>æè¿°äº†ä»£ç†å¯ä»¥æ‰§è¡Œçš„å…·ä½“èƒ½åŠ›æˆ–åŠŸèƒ½ã€‚å®ƒæ˜¯å‘Šè¯‰å®¢æˆ·ç«¯ä»£ç†æ“…é•¿å“ªäº›ä»»åŠ¡çš„æ„å»ºæ¨¡å—ã€‚</p>
<p><code>AgentSkill</code> çš„å…³é”®å±æ€§ï¼ˆå®šä¹‰åœ¨ <code>a2a.types</code>
ä¸­ï¼‰ï¼š</p>
<ul>
<li><code>id</code>: æŠ€èƒ½çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li>
<li><code>name</code>: äººç±»å¯è¯»çš„åç§°ã€‚</li>
<li><code>description</code>ï¼šå¯¹æŠ€èƒ½åŠŸèƒ½çš„æ›´è¯¦ç»†è¯´æ˜ã€‚</li>
<li><code>tags</code>ï¼šç”¨äºåˆ†ç±»å’Œå‘ç°çš„å…³é”®è¯ã€‚</li>
<li><code>examples</code>ï¼šç¤ºä¾‹æç¤ºæˆ–ä½¿ç”¨æ¡ˆä¾‹ã€‚</li>
<li><code>inputModes</code> / <code>outputModes</code>:
æ”¯æŒçš„è¾“å…¥å’Œè¾“å‡ºåª’ä½“ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œâ€œtext/plainâ€ï¼Œâ€œapplication/jsonâ€ï¼‰ã€‚</li>
</ul>
<p>åœ¨ <code>__main__.py</code> ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä½•ä¸º Helloworld
ä»£ç†å®šä¹‰ä¸€ä¸ªæŠ€èƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">skill = AgentSkill(</span><br><span class="line">    id=&#x27;hello_world&#x27;,</span><br><span class="line">    name=&#x27;Returns hello world&#x27;,</span><br><span class="line">    description=&#x27;just returns hello world&#x27;,</span><br><span class="line">    tags=[&#x27;hello world&#x27;],</span><br><span class="line">    examples=[&#x27;hi&#x27;, &#x27;hello world&#x27;],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæŠ€èƒ½éå¸¸ç®€å•ï¼šå®ƒçš„åç§°æ˜¯ â€œReturns hello
worldâ€ï¼Œå¹¶ä¸”ä¸»è¦å¤„ç†æ–‡æœ¬ã€‚</p>
<h4 id="agent-card">Agent Card</h4>
<p><strong>ä»£ç†å¡</strong>æ˜¯ä¸€ä¸ª A2A æœåŠ¡å™¨æä¾›çš„ JSON æ–‡æ¡£ï¼Œé€šå¸¸ä½äº
<code>.well-known/agent-card.json</code>
ç«¯ç‚¹ã€‚å®ƒå°±åƒä»£ç†çš„æ•°å­—åç‰‡ã€‚</p>
<p><code>AgentCard</code> çš„å…³é”®å±æ€§ï¼ˆå®šä¹‰åœ¨ <code>a2a.types</code>
ä¸­ï¼‰ï¼š</p>
<ul>
<li><code>name</code>, <code>description</code>, <code>version</code>:
åŸºæœ¬èº«ä»½ä¿¡æ¯ã€‚</li>
<li><code>url</code>ï¼šA2A æœåŠ¡å¯è®¿é—®çš„ç«¯ç‚¹ã€‚</li>
<li><code>capabilities</code>ï¼šæŒ‡å®šæ”¯æŒçš„ A2A åŠŸèƒ½ï¼Œå¦‚
<code>streaming</code> æˆ– <code>pushNotifications</code>ã€‚</li>
<li><code>defaultInputModes</code> / <code>defaultOutputModes</code>:
ä»£ç†çš„é»˜è®¤åª’ä½“ç±»å‹ã€‚</li>
<li><code>skills</code>: ä»£ç†æä¾›çš„ <code>AgentSkill</code>
å¯¹è±¡åˆ—è¡¨ã€‚</li>
</ul>
<p><code>helloworld</code> ç¤ºä¾‹å®šä¹‰å…¶ Agent Card å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># This will be the public-facing agent card</span><br><span class="line">public_agent_card = AgentCard(</span><br><span class="line">    name=&#x27;Hello World Agent&#x27;,</span><br><span class="line">    description=&#x27;Just a hello world agent&#x27;,</span><br><span class="line">    url=&#x27;http://localhost:9999/&#x27;,</span><br><span class="line">    version=&#x27;1.0.0&#x27;,</span><br><span class="line"> 	# é»˜è®¤è¾“å…¥æ¨¡å¼ï¼šAgent èƒ½å¤Ÿæ¥æ”¶çš„è¾“å…¥ç±»å‹åˆ—è¡¨ï¼Œè¿™é‡Œä»…æ”¯æŒçº¯æ–‡æœ¬</span><br><span class="line">    default_input_modes=[&#x27;text&#x27;],</span><br><span class="line">    # é»˜è®¤è¾“å‡ºæ¨¡å¼ï¼šAgent èƒ½å¤Ÿäº§ç”Ÿçš„è¾“å‡ºç±»å‹åˆ—è¡¨ï¼Œè¿™é‡Œä»…è¿”å›çº¯æ–‡æœ¬</span><br><span class="line">    default_output_modes=[&#x27;text&#x27;],</span><br><span class="line">    # èƒ½åŠ›å£°æ˜ï¼šå‘ŠçŸ¥è°ƒç”¨æ–¹ Agent æ”¯æŒçš„èƒ½åŠ›ï¼Œä¾‹å¦‚æ˜¯å¦æ”¯æŒæµå¼è¾“å‡ºï¼ˆstreamingï¼‰</span><br><span class="line">    capabilities=AgentCapabilities(streaming=True),</span><br><span class="line">    skills=[skill],  # Only the basic skill for the public card</span><br><span class="line">    supports_authenticated_extended_card=True,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è¿™å¼ å¡ç‰‡å‘Šè¯‰æˆ‘ä»¬ä»£ç†åä¸º â€œHello World Agentâ€ï¼Œè¿è¡Œåœ¨
<code>http://localhost:9999/</code>ï¼Œæ”¯æŒæ–‡æœ¬äº¤äº’ï¼Œå¹¶å…·æœ‰
<code>hello_world</code>
æŠ€èƒ½ã€‚å®ƒè¿˜è¡¨æ˜æ”¯æŒå…¬å¼€è®¤è¯ï¼Œæ„å‘³ç€æ— éœ€ç‰¹å®šå‡­è¯ã€‚</p>
<h3 id="agent-executor">Agent Executor</h3>
<p>A2A ä»£ç†å¤„ç†è¯·æ±‚å’Œç”Ÿæˆå“åº”/äº‹ä»¶çš„æ ¸å¿ƒé€»è¾‘ç”±ä¸€ä¸ª <strong>Agent
Executor</strong> è´Ÿè´£ã€‚A2A Python SDK æä¾›äº†ä¸€ä¸ªæŠ½è±¡åŸºç±»
<code>a2a.server.agent_execution.AgentExecutor</code> ä¾›ä½ å®ç°ã€‚</p>
<p><strong><code>AgentExecutor</code> æ¥å£</strong></p>
<p><code>AgentExecutor</code> ç±»å®šä¹‰äº†ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š</p>
<ul>
<li><code>async def execute(self, context: RequestContext, event_queue: EventQueue)</code>
: å¤„ç†æœŸæœ›å“åº”æˆ–äº‹ä»¶æµçš„ä¼ å…¥è¯·æ±‚ã€‚å®ƒå¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆå¯é€šè¿‡
<code>context</code> è·å–ï¼‰å¹¶ä½¿ç”¨ <code>event_queue</code> å‘é€
<code>Message</code>ã€<code>Task</code>ã€<code>TaskStatusUpdateEvent</code>
æˆ– <code>TaskArtifactUpdateEvent</code> å¯¹è±¡ã€‚</li>
<li><code>async def cancel(self, context: RequestContext, event_queue: EventQueue)</code>
: å¤„ç†å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡çš„è¯·æ±‚ã€‚</li>
</ul>
<p><code>RequestContext</code>
æä¾›æœ‰å…³ä¼ å…¥è¯·æ±‚çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç”¨æˆ·æ¶ˆæ¯å’Œä»»ä½•ç°æœ‰çš„ä»»åŠ¡è¯¦æƒ…ã€‚<code>EventQueue</code>
ç”±æ‰§è¡Œå™¨ä½¿ç”¨ï¼Œç”¨äºå°†äº‹ä»¶å‘é€å›å®¢æˆ·ç«¯ã€‚</p>
<p><strong>Helloworld AgentExecutor</strong></p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹ <code>agent_executor.py</code>ã€‚å®ƒå®šä¹‰äº†
<code>HelloWorldAgentExecutor</code>ã€‚</p>
<ol type="1">
<li><p><strong>ä»£ç†ï¼ˆ<code>HelloWorldAgent</code>ï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªç®€å•çš„è¾…åŠ©ç±»ï¼Œå°è£…äº†å®é™…çš„â€œä¸šåŠ¡é€»è¾‘â€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class HelloWorldAgent:</span><br><span class="line">    &quot;&quot;&quot;Hello World Agent.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    async def invoke(self) -&gt; str:</span><br><span class="line">        return &#x27;Hello World&#x27;</span><br></pre></td></tr></table></figure>
<p>å®ƒæœ‰ä¸€ä¸ªç®€å•çš„ <code>invoke</code> æ–¹æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²â€Hello
Worldâ€ã€‚</p></li>
<li><p><strong>æ‰§è¡Œå™¨ï¼ˆ<code>HelloWorldAgentExecutor</code>ï¼‰</strong>ï¼šè¿™ä¸ªç±»å®ç°äº†
<code>AgentExecutor</code> æ¥å£ã€‚</p>
<ul>
<li><p><strong><code>__init__</code></strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class HelloWorldAgentExecutor(AgentExecutor):</span><br><span class="line">    &quot;&quot;&quot;Test AgentProxy Implementation.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.agent = HelloWorldAgent()</span><br></pre></td></tr></table></figure>
<p>å®ƒå®ä¾‹åŒ–äº† <code>HelloWorldAgent</code>ã€‚</p></li>
<li><p><strong><code>execute</code></strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">async def execute(</span><br><span class="line">    self,</span><br><span class="line">    context: RequestContext,</span><br><span class="line">    event_queue: EventQueue,</span><br><span class="line">) -&gt; None:</span><br><span class="line">    result = await self.agent.invoke()</span><br><span class="line">    await event_queue.enqueue_event(new_agent_text_message(result))</span><br></pre></td></tr></table></figure>
<p>å½“æ”¶åˆ°ä¸€ä¸ª <code>message/send</code> æˆ– <code>message/stream</code>
è¯·æ±‚æ—¶ï¼ˆè¿™ä¸¤ç§è¯·æ±‚åœ¨è¿™ä¸ªç®€åŒ–çš„æ‰§è¡Œå™¨ä¸­å‡ç”± <code>execute</code>
å¤„ç†ï¼‰ï¼š</p>
<ol type="1">
<li>å®ƒè°ƒç”¨ <code>self.agent.invoke()</code> æ¥è·å– â€œHello Worldâ€
å­—ç¬¦ä¸²ã€‚</li>
<li>å®ƒä½¿ç”¨ <code>new_agent_text_message</code> å·¥å…·å‡½æ•°åˆ›å»ºä¸€ä¸ª A2A
<code>Message</code> å¯¹è±¡ã€‚</li>
<li>å®ƒå°†æ­¤æ¶ˆæ¯å…¥é˜Ÿåˆ° <code>event_queue</code>ã€‚åº•å±‚çš„
<code>DefaultRequestHandler</code>
éšåä¼šå¤„ç†è¿™ä¸ªé˜Ÿåˆ—ä»¥å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚å¯¹äºåƒè¿™æ ·çš„ä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨æµå…³é—­ä¹‹å‰ï¼Œå®ƒå°†å¯¼è‡´ä¸€ä¸ª
<code>message/send</code> çš„å•ä¸€å“åº”æˆ–ä¸€ä¸ª <code>message/stream</code>
çš„å•ä¸€äº‹ä»¶ã€‚</li>
</ol></li>
<li><p><strong><code>cancel</code></strong>: Helloworld ç¤ºä¾‹çš„
<code>cancel</code>
æ–¹æ³•ç®€å•åœ°æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¡¨æ˜è¿™ä¸ªåŸºæœ¬ä»£ç†ä¸æ”¯æŒå–æ¶ˆæ“ä½œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">async def cancel(</span><br><span class="line">    self, context: RequestContext, event_queue: EventQueue</span><br><span class="line">) -&gt; None:</span><br><span class="line">    raise Exception(&#x27;cancel not supported&#x27;)</span><br></pre></td></tr></table></figure></li>
</ul></li>
</ol>
<p><code>AgentExecutor</code> å……å½“ A2A
åè®®ï¼ˆç”±è¯·æ±‚å¤„ç†å™¨å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºç®¡ç†ï¼‰ä¸æ‚¨çš„ä»£ç†ç‰¹å®šé€»è¾‘ä¹‹é—´çš„æ¡¥æ¢ã€‚å®ƒæ¥æ”¶å…³äºè¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—æ¥é€šä¿¡ç»“æœæˆ–æ›´æ–°ã€‚</p>
<h3 id="å¯åŠ¨server">å¯åŠ¨server</h3>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº† Agent Card å’Œ Agent Executorï¼Œå¯ä»¥è®¾ç½®å¹¶å¯åŠ¨ A2A
æœåŠ¡å™¨ã€‚</p>
<p>A2A Python SDK æä¾›äº†ä¸€ä¸ª <code>A2AStarletteApplication</code>
ç±»ï¼Œç®€åŒ–äº†è¿è¡Œç¬¦åˆ A2A æ ‡å‡†çš„ HTTP æœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ <a target="_blank" rel="noopener" href="https://www.starlette.io/">Starlette</a> ä½œä¸º Web æ¡†æ¶ï¼Œé€šå¸¸ä¸ <a target="_blank" rel="noopener" href="https://www.uvicorn.org/">Uvicorn</a> ç­‰ ASGI æœåŠ¡å™¨ä¸€èµ·è¿è¡Œã€‚</p>
<p>è®©æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹
<code>__main__.py</code>ï¼Œçœ‹çœ‹æœåŠ¡å™¨æ˜¯å¦‚ä½•åˆå§‹åŒ–å’Œå¯åŠ¨çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">import uvicorn</span><br><span class="line"></span><br><span class="line">from a2a.server.apps import A2AStarletteApplication</span><br><span class="line">from a2a.server.request_handlers import DefaultRequestHandler</span><br><span class="line">from a2a.server.tasks import InMemoryTaskStore</span><br><span class="line">from a2a.types import (</span><br><span class="line">    AgentCapabilities,</span><br><span class="line">    AgentCard,</span><br><span class="line">    AgentSkill,</span><br><span class="line">)</span><br><span class="line">from agent_executor import (</span><br><span class="line">    HelloWorldAgentExecutor,  # type: ignore[import-untyped]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    skill = AgentSkill(</span><br><span class="line">        id=&#x27;hello_world&#x27;,</span><br><span class="line">        name=&#x27;è¿”å› hello world&#x27;,</span><br><span class="line">        description=&#x27;ç®€å•åœ°è¿”å› hello world&#x27;,</span><br><span class="line">        tags=[&#x27;hello world&#x27;],</span><br><span class="line">        examples=[&#x27;hi&#x27;, &#x27;hello world&#x27;],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    extended_skill = AgentSkill(</span><br><span class="line">        id=&#x27;super_hello_world&#x27;,</span><br><span class="line">        name=&#x27;è¿”å› SUPER Hello World&#x27;,</span><br><span class="line">        description=&#x27;ä»…é™å·²è®¤è¯ç”¨æˆ·ä½¿ç”¨çš„æ›´çƒ­æƒ…çš„é—®å€™ã€‚&#x27;,</span><br><span class="line">        tags=[&#x27;hello world&#x27;, &#x27;super&#x27;, &#x27;extended&#x27;],</span><br><span class="line">        examples=[&#x27;super hi&#x27;, &#x27;give me a super hello&#x27;],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # è¿™æ˜¯é¢å‘å…¬ä¼—çš„ Agent å¡ç‰‡</span><br><span class="line">    public_agent_card = AgentCard(</span><br><span class="line">        name=&#x27;Hello World Agent&#x27;,</span><br><span class="line">        description=&#x27;åªæ˜¯ä¸€ä¸ª hello world ä»£ç†&#x27;,</span><br><span class="line">        url=&#x27;http://localhost:9999/&#x27;,</span><br><span class="line">        version=&#x27;1.0.0&#x27;,</span><br><span class="line">        default_input_modes=[&#x27;text&#x27;],</span><br><span class="line">        default_output_modes=[&#x27;text&#x27;],</span><br><span class="line">        capabilities=AgentCapabilities(streaming=True),</span><br><span class="line">        skills=[skill],  # å…¬å¼€å¡ç‰‡ä»…åŒ…å«åŸºç¡€æŠ€èƒ½</span><br><span class="line">        supports_authenticated_extended_card=True,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # è¿™æ˜¯å·²è®¤è¯ç”¨æˆ·çš„æ‰©å±• Agent å¡ç‰‡</span><br><span class="line">    # é¢å¤–åŒ…å« &#x27;extended_skill&#x27;</span><br><span class="line">    specific_extended_agent_card = public_agent_card.model_copy(</span><br><span class="line">        update=&#123;</span><br><span class="line">            &#x27;name&#x27;: &#x27;Hello World Agent - Extended Edition&#x27;,  # ä½¿ç”¨ä¸åŒåç§°ä»¥ä¾¿åŒºåˆ†</span><br><span class="line">            &#x27;description&#x27;: &#x27;é¢å‘å·²è®¤è¯ç”¨æˆ·çš„å®Œæ•´åŠŸèƒ½ hello world ä»£ç†ã€‚&#x27;,</span><br><span class="line">            &#x27;version&#x27;: &#x27;1.0.1&#x27;,  # ç”šè‡³å¯ä»¥æ˜¯ä¸åŒçš„ç‰ˆæœ¬</span><br><span class="line">            # capabilities åŠå…¶ä»–å­—æ®µï¼ˆå¦‚ urlã€default_input_modesã€default_output_modesã€</span><br><span class="line">            # supports_authenticated_extended_cardï¼‰å‡ä» public_agent_card ç»§æ‰¿ï¼Œ</span><br><span class="line">            # é™¤éåœ¨æ­¤å¤„å¦è¡ŒæŒ‡å®šã€‚</span><br><span class="line">            &#x27;skills&#x27;: [</span><br><span class="line">                skill,</span><br><span class="line">                extended_skill,</span><br><span class="line">            ],  # æ‰©å±•å¡ç‰‡åŒ…å«ä¸¤ä¸ªæŠ€èƒ½</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    request_handler = DefaultRequestHandler(</span><br><span class="line">        agent_executor=HelloWorldAgentExecutor(),</span><br><span class="line">        task_store=InMemoryTaskStore(),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    server = A2AStarletteApplication(</span><br><span class="line">        agent_card=public_agent_card,</span><br><span class="line">        http_handler=request_handler,</span><br><span class="line">        extended_agent_card=specific_extended_agent_card,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # ä½¿ç”¨ uvicorn å¯åŠ¨æœåŠ¡ï¼Œç›‘å¬ 0.0.0.0:9999</span><br><span class="line">    uvicorn.run(server.build(), host=&#x27;0.0.0.0&#x27;, port=9999)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹ï¼š</p>
<ol type="1">
<li><strong><code>DefaultRequestHandler</code></strong>:
<ul>
<li>SDK æä¾›äº† <code>DefaultRequestHandler</code>ã€‚è¿™ä¸ªå¤„ç†å™¨æ¥æ”¶ä½ çš„
<code>AgentExecutor</code>
å®ç°ï¼ˆè¿™é‡Œï¼Œ<code>HelloWorldAgentExecutor</code>ï¼‰å’Œä¸€ä¸ª
<code>TaskStore</code>ï¼ˆè¿™é‡Œï¼Œ<code>InMemoryTaskStore</code>ï¼‰ã€‚</li>
<li>å®ƒå°†ä¼ å…¥çš„ A2A RPC è°ƒç”¨è·¯ç”±åˆ°ä½ çš„æ‰§è¡Œå™¨çš„é€‚å½“æ–¹æ³•ä¸Šï¼ˆæ¯”å¦‚
<code>execute</code> æˆ– <code>cancel</code>ï¼‰ã€‚</li>
<li><code>TaskStore</code> è¢« <code>DefaultRequestHandler</code>
ç”¨æ¥ç®¡ç†ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç‰¹åˆ«æ˜¯å¯¹äºæœ‰çŠ¶æ€äº¤äº’ã€æµå¼ä¼ è¾“å’Œé‡æ–°è®¢é˜…ã€‚å³ä½¿ä½ çš„ä»£ç†æ‰§è¡Œå™¨å¾ˆç®€å•ï¼Œå¤„ç†å™¨ä¹Ÿéœ€è¦ä¸€ä¸ªä»»åŠ¡å­˜å‚¨ã€‚</li>
</ul></li>
<li><strong><code>A2AStarletteApplication</code></strong>:
<ul>
<li><code>A2AStarletteApplication</code> ç±»ä½¿ç”¨ <code>agent_card</code>
å’Œ <code>request_handler</code>ï¼ˆåœ¨å…¶æ„é€ å‡½æ•°ä¸­ç§°ä¸º
<code>http_handler</code>ï¼‰è¿›è¡Œå®ä¾‹åŒ–ã€‚</li>
<li><code>agent_card</code> è‡³å…³é‡è¦ï¼Œå› ä¸ºæœåŠ¡å™¨å°†åœ¨
<code>/.well-known/agent-card.json</code>
ç«¯ç‚¹ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ä¸Šå…¬å¼€å®ƒã€‚</li>
<li><code>request_handler</code> è´Ÿè´£é€šè¿‡ä¸å…¶ <code>AgentExecutor</code>
äº¤äº’æ¥å¤„ç†æ‰€æœ‰ä¼ å…¥çš„ A2A æ–¹æ³•è°ƒç”¨ã€‚</li>
</ul></li>
<li><strong><code>uvicorn.run(server_app_builder.build(), ...)</code></strong>:
<ul>
<li><code>A2AStarletteApplication</code> æœ‰ä¸€ä¸ª <code>build()</code>
æ–¹æ³•ï¼Œç”¨äºæ„å»ºå®é™…çš„ Starlette åº”ç”¨ç¨‹åºã€‚</li>
<li>ç„¶åä½¿ç”¨ <code>uvicorn.run()</code> è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œä½¿æ‚¨çš„ä»£ç†å¯é€šè¿‡
HTTP è®¿é—®ã€‚</li>
<li><code>host='0.0.0.0'</code>
ä½¿æœåŠ¡å™¨å¯åœ¨æ‚¨æœºå™¨ä¸Šçš„æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Šè®¿é—®ã€‚</li>
<li><code>port=9999</code> æŒ‡å®šç›‘å¬çš„ç«¯å£ã€‚è¿™éœ€è¦ä¸
<code>AgentCard</code> ä¸­çš„ <code>url</code> åŒ¹é…ã€‚</li>
</ul></li>
<li><code>specific_extended_agent_card</code>
<ul>
<li><strong>ç»™åŒä¸€ä¸ª Agent
å‡†å¤‡â€œä¸¤å¼ ä¸åŒæƒé™çš„åç‰‡â€</strong>ï¼Œåˆ†åˆ«ç”¨äºâ€œæ™®é€šè®¿å®¢â€å’Œâ€œå·²è®¤è¯ç”¨æˆ·â€ã€‚ã€</li>
</ul></li>
</ol>
<h3 id="ä¸æœåŠ¡å™¨äº¤äº’">ä¸æœåŠ¡å™¨äº¤äº’</h3>
<p>Helloworld A2A æœåŠ¡å™¨è¿è¡Œåï¼Œè®©æˆ‘ä»¬å‘å®ƒå‘é€ä¸€äº›è¯·æ±‚ã€‚SDK
åŒ…å«ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆ<code>A2AClient</code>ï¼‰ï¼Œå¯ä»¥ç®€åŒ–è¿™äº›äº¤äº’ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>test_client.py</code> çš„å…³é”®éƒ¨åˆ†ï¼š</p>
<ol type="1">
<li><p><strong>è·å–ä»£ç†å¡ &amp; åˆå§‹åŒ–å®¢æˆ·ç«¯</strong> ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">base_url = &#x27;http://localhost:9999&#x27;</span><br><span class="line"></span><br><span class="line">async with httpx.AsyncClient() as httpx_client:</span><br><span class="line">    # åˆå§‹åŒ– A2ACardResolver</span><br><span class="line">    resolver = A2ACardResolver(</span><br><span class="line">        httpx_client=httpx_client,</span><br><span class="line">        base_url=base_url,</span><br><span class="line">        # agent_card_path ä½¿ç”¨é»˜è®¤å€¼ï¼Œextended_agent_card_path ä¹Ÿä½¿ç”¨é»˜è®¤å€¼</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><code>A2ACardResolver</code> ç±»æ˜¯ä¸€ä¸ªä¾¿æ·å·¥å…·ã€‚å®ƒé¦–å…ˆä»æœåŠ¡å™¨ç«¯çš„
<code>/.well-known/agent-card.json</code> ç«¯ç‚¹ï¼ˆåŸºäºæä¾›çš„åŸº URLï¼‰è·å–
<code>AgentCard</code>ï¼Œç„¶åä½¿ç”¨å®ƒåˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚</p></li>
<li><p><strong>å‘é€éæµå¼æ¶ˆæ¯ (<code>send_message</code>)</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">client = A2AClient(</span><br><span class="line">    httpx_client=httpx_client, </span><br><span class="line">    agent_card=final_agent_card_to_use#è¿™ä¸ªcardä¸ºç»è¿‡è®¤è¯å¤„ç†åæš´éœ²çš„card</span><br><span class="line">)</span><br><span class="line">logger.info(&#x27;A2AClient initialized.&#x27;)</span><br><span class="line"></span><br><span class="line">send_message_payload: dict[str, Any] = &#123;</span><br><span class="line">    &#x27;message&#x27;: &#123;</span><br><span class="line">        &#x27;role&#x27;: &#x27;user&#x27;,</span><br><span class="line">        &#x27;parts&#x27;: [</span><br><span class="line">            &#123;&#x27;kind&#x27;: &#x27;text&#x27;, &#x27;text&#x27;: &#x27;how much is 10 USD in INR?&#x27;&#125;</span><br><span class="line">        ],</span><br><span class="line">        &#x27;messageId&#x27;: uuid4().hex,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">request = SendMessageRequest(</span><br><span class="line">    id=str(uuid4()), params=MessageSendParams(**send_message_payload)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = await client.send_message(request)</span><br><span class="line">print(response.model_dump(mode=&#x27;json&#x27;, exclude_none=True))</span><br></pre></td></tr></table></figure>
<ul>
<li><code>send_message_payload</code> æ„å»ºäº†
<code>MessageSendParams</code> çš„æ•°æ®ã€‚</li>
<li>è¿™äº›æ•°æ®è¢«å°è£…åœ¨ <code>SendMessageRequest</code> ä¸­ã€‚</li>
<li>å®ƒåŒ…å«ä¸€ä¸ª <code>message</code> å¯¹è±¡ï¼Œå…¶ä¸­ <code>role</code>
è®¾ç½®ä¸ºâ€ç”¨æˆ·â€ï¼Œå†…å®¹åœ¨ <code>parts</code> ä¸­ã€‚</li>
<li>Helloworld ä»£ç†çš„ <code>execute</code> æ–¹æ³•å°†å…¥é˜Ÿä¸€æ¡â€Hello
Worldâ€æ¶ˆæ¯ã€‚<code>DefaultRequestHandler</code>
å°†è·å–è¿™æ¡æ¶ˆæ¯å¹¶å°†å…¶ä½œä¸ºå“åº”å‘é€ã€‚</li>
<li><code>response</code> å°†æ˜¯ä¸€ä¸ª <code>SendMessageResponse</code>
å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å« <code>SendMessageSuccessResponse</code>ï¼ˆä»¥ä»£ç†çš„
<code>Message</code> ä½œä¸ºç»“æœï¼‰æˆ–
<code>JSONRPCErrorResponse</code>ã€‚</li>
</ul></li>
<li><p><strong>å¤„ç†ä»»åŠ¡ IDï¼ˆHelloworld çš„è¯´æ˜æ€§æ³¨é‡Šï¼‰</strong>:</p>
<p>Helloworld å®¢æˆ·ç«¯ï¼ˆ<code>test_client.py</code>ï¼‰ä¸ä¼šç›´æ¥å°è¯•
<code>get_task</code> æˆ– <code>cancel_task</code>ï¼Œå› ä¸ºç®€å•çš„ Helloworld
ä»£ç†çš„ <code>execute</code> æ–¹æ³•ï¼Œé€šè¿‡ <code>message/send</code>
è°ƒç”¨æ—¶ï¼Œä¼šå¯¼è‡´ <code>DefaultRequestHandler</code> è¿”å›ä¸€ä¸ªç›´æ¥çš„
<code>Message</code> å“åº”ï¼Œè€Œä¸æ˜¯ <code>Task</code>
å¯¹è±¡ã€‚æ›´å¤æ‚çš„ã€æ˜ç¡®ç®¡ç†ä»»åŠ¡çš„ä»£ç†ï¼ˆå¦‚ LangGraph ç¤ºä¾‹ï¼‰ä¼šä»
<code>message/send</code> è¿”å›ä¸€ä¸ª <code>Task</code> å¯¹è±¡ï¼Œç„¶åå…¶
<code>id</code> å¯ç”¨äº <code>get_task</code> æˆ–
<code>cancel_task</code>ã€‚</p></li>
<li><p><strong>å‘é€æµå¼æ¶ˆæ¯ï¼ˆ<code>send_message_streaming</code>ï¼‰</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">streaming_request = SendStreamingMessageRequest(</span><br><span class="line">    id=str(uuid4()), params=MessageSendParams(**send_message_payload)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">stream_response = client.send_message_streaming(streaming_request)</span><br><span class="line"></span><br><span class="line">async for chunk in stream_response:</span><br><span class="line">    print(chunk.model_dump(mode=&#x27;json&#x27;, exclude_none=True))</span><br></pre></td></tr></table></figure>
<ul>
<li>æ­¤æ–¹æ³•è°ƒç”¨ä»£ç†çš„ <code>message/stream</code>
ç«¯ç‚¹ã€‚<code>DefaultRequestHandler</code> å°†è°ƒç”¨
<code>HelloWorldAgentExecutor.execute</code> æ–¹æ³•ã€‚</li>
<li><code>execute</code> æ–¹æ³•å°†ä¸€ä¸ªâ€Hello
Worldâ€æ¶ˆæ¯å…¥é˜Ÿï¼Œç„¶åå…³é—­äº‹ä»¶é˜Ÿåˆ—ã€‚</li>
<li>å®¢æˆ·ç«¯å°†æ¥æ”¶è¿™æ¡å•æ¡æ¶ˆæ¯ä¸ºä¸€ä¸ª
<code>SendStreamingMessageResponse</code> äº‹ä»¶ï¼Œç„¶åæµå°†ç»ˆæ­¢ã€‚</li>
<li><code>stream_response</code> æ˜¯ä¸€ä¸ª
<code>AsyncGenerator</code>ã€‚</li>
</ul></li>
</ol>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/a2aproject/a2a-samples?tab=readme-ov-file">a2aproject/a2a-samples:
Samples using the Agent2Agent (A2A) Protocol</a></p>
<p><a target="_blank" rel="noopener" href="https://a2a-protocol.org/latest/">Agent2Agent (A2A)
Protocol</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/a2aproject/a2a-python">a2aproject/a2a-python:
Agent2Agent (A2A) åè®®çš„å®˜æ–¹ Python SDK â€” a2aproject/a2a-python:
Official Python SDK for the Agent2Agent (A2A) Protocol</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langmem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langmem/" class="post-title-link" itemprop="url">Langmemå¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-14 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š17:42:03" itemprop="dateCreated datePublished" datetime="2025-08-14T00:00:00+08:00">2025-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langmem/" itemprop="url" rel="index"><span itemprop="name">langmem</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€">å‰è¨€</h3>
<p>æœ¬æ–‡ç®€å•æµ‹è¯•äº†ä¸€ä¸‹langgraphå®˜æ–¹æä¾›çš„è®°å¿†ç®¡ç†å·¥å…·ï¼Œå‘ç°è¿˜æ˜¯å­˜åœ¨bugï¼Œæˆ‘åœ¨açº¿ç¨‹å…ˆè®©ä»–è®°ä½æˆ‘æ˜¯å¼ ç†™æµšï¼Œç„¶ååˆå‘Šè¯‰ä»–æˆ‘ä¸æ˜¯å¼ ç†™æµšæˆ‘æ˜¯å¼ ä¿Šç»†ï¼Œåœ¨çº¿ç¨‹bè¯¢é—®ä»–æˆ‘æ˜¯è°æ—¶ï¼Œä»–è¿˜æ˜¯è®¤ä¸ºæˆ‘æ˜¯å¼ ç†™æµšã€‚è®°å¿†çš„ç®¡ç†éƒ¨åˆ†ç¡®å®æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œä½†ä¸­å°å¼€å‘è€…æˆ‘è®¤ä¸ºè¿˜æ˜¯ç›´æ¥ä½¿ç”¨äººå®¶é€ å¥½çš„è½®å­æ–¹ä¾¿äº›ï¼ˆæˆ‘å°è¯•å»é˜…è¯»äº†ä»–çš„è®°å¿†ç®¡ç†å·¥å…·çš„æºç ï¼Œä»¥æˆ‘ç›®å‰çš„æ°´å¹³ï¼Œæƒ³æ‰‹æ“èŠ±è´¹çš„ç²¾åŠ›è¿˜æ˜¯å¤ªå¤šäº†ï¼‰</p>
<p>æˆ‘è¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼Œå½“å‰è®°å¿†çš„å­˜å‚¨åŸºæœ¬ä¸Šä¾èµ–äºagentçš„å†³å®šï¼Œæ‰€ä»¥å¹¶ä¸ç¨³å®šï¼Œæˆ‘ä¹Ÿæä¸æ¸…æ¥šä»–ä»€ä¹ˆæ—¶å€™ä¼šæŠŠå“ªäº›ä¿¡æ¯å­˜å…¥è®°å¿†ï¼Œå¯ä»¥è®¾ç½®
schemasç»“æ„ï¼Œæ§åˆ¶å­˜å‚¨çš„å†…å®¹ï¼Œä½†æ˜¯é•¿æœŸè®°å¿†ä»…å­˜å‚¨æŒ‡å®šçš„è¿™äº›ä¿¡æ¯ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰äº›é¸¡è‚‹å•Š</p>
<p>ä»£ç è§<a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain/tree/main/langmem">learn-rag-langchain/langmem
at main Â· zxj-2023/learn-rag-langchain</a></p>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>LangMem æ˜¯ LangChain æ¨å‡ºçš„å¼€æº SDKï¼Œé€šè¿‡ä¸€å¥—å­˜å‚¨-æå–-ä¼˜åŒ–æœºåˆ¶ï¼Œè®©
Agent
èƒ½å¤Ÿåœ¨å¤šè½®ã€å¤šå¤©ç”šè‡³å¤šç”¨æˆ·ä¹‹é—´æŒç»­å­¦ä¹ ã€è®°ä½ç”¨æˆ·åå¥½å¹¶ä¸æ–­æ”¹è¿›å›ç­”ã€‚</p>
<p>LangMem çš„è®°å¿†å·¥å…·æŒ‰ä¸¤ä¸ªå±‚æ¬¡çš„é›†æˆæ¨¡å¼ç»„ç»‡ï¼š</p>
<ol type="1">
<li>æ ¸å¿ƒ API</li>
</ol>
<p>LangMem
çš„æ ¸å¿ƒæ˜¯æä¾›æ— å‰¯ä½œç”¨åœ°è½¬æ¢è®°å¿†çŠ¶æ€çš„å‡½æ•°ã€‚è¿™äº›åŸè¯­æ˜¯è®°å¿†æ“ä½œçš„æ„å»ºå—ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/reference/memory/#langmem.create_memory_manager"><strong>è®°å¿†ç®¡ç†å™¨</strong></a>ï¼šæ ¹æ®æ–°çš„å¯¹è¯ä¿¡æ¯ï¼Œæå–æ–°è®°å¿†ã€æ›´æ–°æˆ–åˆ é™¤è¿‡æ—¶è®°å¿†ï¼Œå¹¶ä»ç°æœ‰è®°å¿†ä¸­è¿›è¡Œæ•´åˆå’Œæ³›åŒ–ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/reference/prompt_optimization/#langmem.create_prompt_optimizer"><strong>æç¤ºä¼˜åŒ–å™¨</strong></a>ï¼šæ ¹æ®å¯¹è¯ä¿¡æ¯ï¼ˆå¯é€‰åé¦ˆï¼‰æ›´æ–°æç¤ºè§„åˆ™å’Œæ ¸å¿ƒè¡Œä¸ºã€‚</li>
</ul>
<p>è¿™äº›æ ¸å¿ƒå‡½æ•°ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šçš„æ•°æ®åº“æˆ–å­˜å‚¨ç³»ç»Ÿã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p>
<ol start="2" type="1">
<li>æœ‰çŠ¶æ€é›†æˆ</li>
</ol>
<p>ä¸Šä¸€å±‚ä¾èµ–äº LangGraph çš„é•¿æœŸè®°å¿†å­˜å‚¨ã€‚è¿™äº›ç»„ä»¶ä½¿ç”¨ä¸Šè¿°æ ¸å¿ƒ API
æ¥è½¬æ¢å­˜å‚¨ä¸­å­˜åœ¨çš„è®°å¿†ï¼Œå¹¶åœ¨æ–°å¯¹è¯ä¿¡æ¯ä¼ å…¥æ—¶æ ¹æ®éœ€è¦è¿›è¡Œæ›´æ–°/æ’å…¥æˆ–åˆ é™¤ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/reference/memory/#langmem.create_memory_store_manager"><strong>å­˜å‚¨ç®¡ç†å™¨</strong></a>ï¼šè‡ªåŠ¨æŒä¹…åŒ–æå–çš„è®°å¿†ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/reference/tools/#langmem.create_manage_memory_tool"><strong>è®°å¿†ç®¡ç†å·¥å…·</strong></a>ï¼šè®©æ™ºèƒ½ä½“ç›´æ¥è®¿é—®è®°å¿†æ“ä½œã€‚</li>
</ul>
<figure>
<img src="/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langmem/image-20250814152044798.png" alt="image-20250814152044798">
<figcaption aria-hidden="true">image-20250814152044798</figcaption>
</figure>
<p>langmemå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼åˆ›å»ºè®°å¿†</p>
<ol type="1">
<li><strong>åœ¨çƒ­è·¯å¾„ä¸­ï¼š</strong> Agent ä½¿ç”¨å·¥å…·ä¸»åŠ¨ä¿å­˜ç¬”è®°ã€‚</li>
<li><strong>åœ¨åå°ï¼š</strong>è®°å¿†ä»å¯¹è¯ä¸­è‡ªåŠ¨â€œæ½œæ„è¯†åœ°â€æå–ã€‚</li>
</ol>
<h3 id="çƒ­è·¯å¾„å¿«é€Ÿå…¥é—¨æŒ‡å—">çƒ­è·¯å¾„å¿«é€Ÿå…¥é—¨æŒ‡å—</h3>
<p>åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª LangGraph Agentï¼Œå®ƒé€šè¿‡ LangMem çš„
<code>manage_memory</code> å·¥å…·æ¥ä¸»åŠ¨ç®¡ç†è‡ªå·±çš„é•¿æœŸè®°å¿†ã€‚</p>
<h4 id="create_manage_memory_tool">create_manage_memory_tool</h4>
<p>create_manage_memory_toolé€šè¿‡åˆ›å»ºä¸€ä¸ªå·¥å…·ï¼ˆToolï¼‰ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥è¢«
agentç”¨æ¥<strong>ç®¡ç†æŒä¹…åŒ–è®°å¿†</strong>ã€‚è¿™äº›è®°å¿†å¯ä»¥åœ¨ä¸åŒçš„å¯¹è¯ã€ä¼šè¯ç”šè‡³åº”ç”¨é‡å¯åä¾ç„¶å­˜åœ¨ã€‚</p>
<ol type="1">
<li><p><strong>æŒä¹…åŒ–å­˜å‚¨ (Persistent Storage):</strong> å®ƒåˆ©ç”¨äº†
LangGraph æä¾›çš„ <code>BaseStore</code>
æ¥å£ã€‚è¿™ä½¿å¾—æ•°æ®å¯ä»¥å­˜å‚¨åœ¨å†…å­˜ã€æ•°æ®åº“ï¼ˆå¦‚
Postgresï¼‰ç­‰åœ°æ–¹ï¼Œè€Œä¸æ˜¯ä»…ä»…å­˜åœ¨äºç¨‹åºçš„è¿è¡Œæ—¶å†…å­˜ä¸­ã€‚</p></li>
<li><p><strong>å‘½åç©ºé—´ (Namespace):</strong>
ä¸ºäº†ç»„ç»‡å’Œéš”ç¦»ä¸åŒç”¨æˆ·æˆ–ä¸åŒç±»å‹çš„è®°å¿†ï¼Œæ•°æ®è¢«å­˜å‚¨åœ¨å±‚çº§åŒ–çš„å‘½åç©ºé—´ä¸­ã€‚ä¾‹å¦‚ï¼Œ<code>("memories", "user-123")</code>
å¯ä»¥ç¡®ä¿ç”¨æˆ· â€œuser-123â€
çš„è®°å¿†ä¸å…¶ä»–ç”¨æˆ·æˆ–ç³»ç»Ÿè®°å¿†åˆ†å¼€ã€‚å‘½åç©ºé—´å¯ä»¥åŒ…å«å ä½ç¬¦ï¼ˆå¦‚
<code>&#123;langgraph_user_id&#125;</code>ï¼‰ï¼Œåœ¨å®é™…æ‰§è¡Œæ—¶ä¼šè¢«å…·ä½“çš„é…ç½®å€¼æ›¿æ¢ã€‚</p></li>
<li><p><strong>è®°å¿† (Memory):</strong>
åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œä¸€ä¸ªâ€œè®°å¿†â€å°±æ˜¯å­˜å‚¨åœ¨ <code>BaseStore</code>
ä¸­çš„ä¸€ä¸ªæ•°æ®é¡¹ï¼ˆ<code>Item</code>ï¼‰ã€‚å®ƒæœ‰ä¸€ä¸ªå”¯ä¸€çš„
<code>key</code>ï¼ˆé€šå¸¸æ˜¯ UUIDï¼‰ï¼Œä¸€ä¸ª <code>namespace</code>ï¼Œä¸€ä¸ª
<code>value</code>ï¼ˆå­˜å‚¨å®é™…å†…å®¹ï¼‰ï¼Œä»¥åŠåˆ›å»ºå’Œæ›´æ–°æ—¶é—´æˆ³ã€‚</p></li>
<li><p><strong>å·¥å…· (Tool):</strong> åœ¨ AI
åº”ç”¨ä¸­ï¼Œå·¥å…·æ˜¯ä»£ç†ï¼ˆAgentï¼‰å¯ä»¥è°ƒç”¨çš„å‡½æ•°æˆ–èƒ½åŠ›ã€‚è¿™ä¸ªå‡½æ•°åˆ›å»ºçš„å·¥å…·å°±æ˜¯ä¸€ä¸ªå°è£…å¥½çš„ã€å¯ä»¥è¢«
Agent è°ƒç”¨çš„å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤è®°å¿†çš„æ“ä½œã€‚</p></li>
</ol>
<h4 id="ä»€ä¹ˆæ—¶å€™agentä¼šè°ƒç”¨è®°å¿†å·¥å…·">ä»€ä¹ˆæ—¶å€™agentä¼šè°ƒç”¨è®°å¿†å·¥å…·</h4>
<figure>
<img src="/2025/08/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langmem/image-20250814163150589.png" alt="image-20250814163150589">
<figcaption aria-hidden="true">image-20250814163150589</figcaption>
</figure>
<p>aiæ˜¯è¿™æ ·å›ç­”çš„ï¼ŒReActæ¶æ„çš„agentæ˜¯å¦è°ƒç”¨å·¥å…·ç”±ä»–è‡ªå·±å†³å®š</p>
<h4 id="å®æˆ˜">å®æˆ˜</h4>
<p><strong>å¯¼å…¥åº“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">from langgraph.prebuilt import create_react_agent</span><br><span class="line">from langgraph.store.memory import InMemoryStore</span><br><span class="line">from langgraph.utils.config import get_store </span><br><span class="line">from langmem import (</span><br><span class="line">    # è®©æ™ºèƒ½ä½“åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤è®°å¿† </span><br><span class="line">    create_manage_memory_tool,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>è¿”å›è®°å¿†æç¤ºè¯</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def prompt(state):</span><br><span class="line">    &quot;&quot;&quot;ä¸ºLLMå‡†å¤‡æ¶ˆæ¯ã€‚&quot;&quot;&quot;</span><br><span class="line">    # ä»é…ç½®çš„ä¸Šä¸‹æ–‡å˜é‡ä¸­è·å–å­˜å‚¨; </span><br><span class="line">    store = get_store() # ä¸æä¾›ç»™ `create_react_agent` çš„ç›¸åŒ</span><br><span class="line">    memories = store.search(</span><br><span class="line">        # åœ¨ä¸æˆ‘ä»¬ä¸ºæ™ºèƒ½ä½“é…ç½®çš„ç›¸åŒå‘½åç©ºé—´å†…æœç´¢</span><br><span class="line">        (&quot;memories&quot;,),</span><br><span class="line">        query=state[&quot;messages&quot;][-1].content,</span><br><span class="line">    )</span><br><span class="line">    system_msg = f&quot;&quot;&quot;You are a helpful assistant.</span><br><span class="line"></span><br><span class="line">## Memories</span><br><span class="line">&lt;memories&gt;</span><br><span class="line">&#123;memories&#125;</span><br><span class="line">&lt;/memories&gt;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">    return [&#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_msg&#125;, *state[&quot;messages&quot;]]</span><br></pre></td></tr></table></figure>
<p><strong>å®šä¹‰storeä¸checkpoint</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from langchain import embeddings</span><br><span class="line">from langchain_openai import OpenAIEmbeddings</span><br><span class="line">embedding=OpenAIEmbeddings(</span><br><span class="line">    api_key=&quot;sk-&quot;, </span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">    model=&quot;text-embedding-v4&quot;,</span><br><span class="line">    check_embedding_ctx_length = False,</span><br><span class="line">    dimensions=1536 </span><br><span class="line">)</span><br><span class="line">store = InMemoryStore(</span><br><span class="line">    index=&#123; # å­˜å‚¨æå–çš„è®°å¿† </span><br><span class="line">        &quot;dims&quot;: 1536,</span><br><span class="line">        &quot;embed&quot;: embedding,</span><br><span class="line">    &#125;</span><br><span class="line">) </span><br><span class="line">checkpointer = MemorySaver() # æ£€æŸ¥ç‚¹å›¾çŠ¶æ€ </span><br></pre></td></tr></table></figure>
<p><strong>å®šä¹‰agent</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">model_qwen=ChatOpenAI(</span><br><span class="line">    api_key=&quot;sk-&quot;, </span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">    model=&quot;qwen3-30b-a3b-instruct-2507&quot;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">agent = create_react_agent( </span><br><span class="line">    model=model_qwen,</span><br><span class="line">    prompt=prompt,</span><br><span class="line">    tools=[ # æ·»åŠ è®°å¿†å·¥å…· </span><br><span class="line">        # æ™ºèƒ½ä½“å¯ä»¥è°ƒç”¨ &quot;manage_memory&quot; æ¥</span><br><span class="line">        # é€šè¿‡IDåˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤è®°å¿†</span><br><span class="line">        # å‘½åç©ºé—´ä¸ºè®°å¿†æ·»åŠ ä½œç”¨åŸŸã€‚è¦</span><br><span class="line">        # ä¸ºæ¯ä¸ªç”¨æˆ·é™å®šè®°å¿†èŒƒå›´ï¼Œä½¿ç”¨ (&quot;memories&quot;, &quot;&#123;user_id&#125;&quot;): </span><br><span class="line">        create_manage_memory_tool(namespace=(&quot;memories&quot;,)),</span><br><span class="line">    ],</span><br><span class="line">    # æˆ‘ä»¬çš„è®°å¿†å°†å­˜å‚¨åœ¨è¿™ä¸ªæä¾›çš„BaseStoreå®ä¾‹ä¸­</span><br><span class="line">    store=store,</span><br><span class="line">    # å›¾çš„&quot;çŠ¶æ€&quot;å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹å®Œæˆæ‰§è¡Œåè¿›è¡Œæ£€æŸ¥ç‚¹</span><br><span class="line">    # ç”¨äºè·Ÿè¸ªèŠå¤©å†å²å’ŒæŒä¹…æ‰§è¡Œ</span><br><span class="line">    checkpointer=checkpointer, </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>å¯è§†åŒ–å›¾</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">agent.get_graph().draw_mermaid_png(output_file_path=&quot;agent.png&quot;)</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨çº¿ç¨‹aè®©agentè®°ä½æˆ‘ä»¬çš„åå¥½</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;thread-a&quot;&#125;&#125; </span><br><span class="line">agent.invoke( </span><br><span class="line">    &#123; </span><br><span class="line">        &quot;messages&quot;: [ </span><br><span class="line">            &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;æˆ‘å–œæ¬¢é»‘è‰²çš„æ˜¾ç¤ºæ¨¡å¼&quot;&#125; </span><br><span class="line">        ] </span><br><span class="line">    &#125;, </span><br><span class="line">    # æˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨å…·æœ‰ç›¸åŒthread_idçš„config</span><br><span class="line">    # æ¥ç»§ç»­å¯¹è¯(thread-a)</span><br><span class="line">    config=config, </span><br><span class="line">) </span><br><span class="line">print(response[&quot;messages&quot;][-1].content) </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜¯çš„ï¼Œæˆ‘çŸ¥é“ï¼ä½ åå¥½é»‘è‰²æ˜¾ç¤ºæ¨¡å¼ã€‚æˆ‘ä¼šåœ¨åç»­äº¤äº’ä¸­ä¿æŒè¿™ä¸€è®¾ç½®ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>åœ¨çº¿ç¨‹bæŸ¥çœ‹æ˜¯å¦è®°ä½</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æ–°çº¿ç¨‹ = æ–°å¯¹è¯ï¼</span><br><span class="line">new_config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;thread-b&quot;&#125;&#125; </span><br><span class="line"># æ™ºèƒ½ä½“åªèƒ½å›å¿†èµ·</span><br><span class="line"># å®ƒä½¿ç”¨manage_memorieså·¥å…·æ˜ç¡®ä¿å­˜çš„å†…å®¹</span><br><span class="line">response = agent.invoke( </span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ å¥½ã€‚ä½ è¿˜è®°å¾—æˆ‘å—ï¼Ÿä½ çŸ¥é“æˆ‘æœ‰ä»€ä¹ˆåå¥½å—ï¼Ÿ&quot;&#125;]&#125;,</span><br><span class="line">    config=new_config, </span><br><span class="line">) </span><br><span class="line">print(response[&quot;messages&quot;][-1].content) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½ å¥½ï¼è™½ç„¶æˆ‘æ— æ³•è®°ä½ä½ ä½œä¸ºä¸ªä½“çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†æˆ‘å¯ä»¥è®¿é—®ä¸€äº›å…³äºä½ çš„åå¥½ä¿¡æ¯ã€‚æ ¹æ®ä¹‹å‰çš„è®°å½•ï¼Œæˆ‘çŸ¥é“ä½ åå¥½ä½¿ç”¨é»‘è‰²æ˜¾ç¤ºæ¨¡å¼ã€‚å¦‚æœä½ è¿˜æœ‰å…¶ä»–åå¥½æˆ–å¸Œæœ›æˆ‘è®°ä½ä»€ä¹ˆï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šå¸®ä½ è®°å½•ä¸‹æ¥ã€‚</span><br></pre></td></tr></table></figure>
<h3 id="åå°å¿«é€Ÿå…¥é—¨æŒ‡å—">åå°å¿«é€Ÿå…¥é—¨æŒ‡å—</h3>
<p>æœ¬æŒ‡å—å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/background_quickstart/"><code>create_memory_store_manager</code></a>
åœ¨åå°æå–å’Œæ•´åˆè®°å¿†ã€‚å½“è®°å¿†åœ¨åå°å¤„ç†æ—¶ï¼Œæ™ºèƒ½ä½“å°†æ­£å¸¸ç»§ç»­è¿è¡Œã€‚</p>
<ol type="1">
<li><p><strong>Runnable:</strong> LangChain/LangGraph
ä¸­çš„æ ¸å¿ƒæŠ½è±¡ï¼Œä»£è¡¨ä¸€ä¸ªå¯ä»¥è¢«è°ƒç”¨ï¼ˆ<code>invoke</code>/<code>ainvoke</code>ï¼‰æ¥å¤„ç†è¾“å…¥å¹¶äº§ç”Ÿè¾“å‡ºçš„å•å…ƒã€‚<code>MemoryStoreManager</code>
æœ¬èº«å°±æ˜¯ä¸€ä¸ª Runnableã€‚</p></li>
<li><p><strong>BaseStore:</strong> LangGraph
æä¾›çš„æŒä¹…åŒ–å­˜å‚¨æ¥å£ã€‚Manager
ä¼šä½¿ç”¨å®ƒæ¥è¯»å–ï¼ˆæœç´¢ï¼‰å’Œå†™å…¥ï¼ˆåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰è®°å¿†ã€‚</p></li>
<li><p><strong>Memory (è®°å¿†):</strong> åœ¨ Manager
çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè®°å¿†é€šå¸¸æ˜¯æŒ‡ä»å¯¹è¯ä¸­æå–çš„ã€å€¼å¾—ä¿å­˜çš„ç‰‡æ®µä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·åå¥½ã€äº‹å®ç­‰ï¼‰ã€‚å®ƒä»¬å­˜å‚¨åœ¨
<code>BaseStore</code> ä¸­ï¼Œæœ‰è‡ªå·±çš„ <code>namespace</code> å’Œ
<code>key</code>ã€‚</p></li>
<li><p><strong>Schema (æ¨¡å¼):</strong> ä¸€ä¸ª Pydantic
æ¨¡å‹ï¼Œç”¨äºå®šä¹‰è®°å¿†çš„ç»“æ„ã€‚è¿™å…è®¸ä½ å¼ºåˆ¶è®°å¿†éµå¾ªç‰¹å®šçš„æ ¼å¼ï¼ˆä¾‹å¦‚ï¼ŒåŒ…å«
<code>category</code>, <code>preference</code>, <code>context</code>
å­—æ®µï¼‰ã€‚å¦‚æœæœªæä¾›
<code>schemas</code>ï¼Œåˆ™é»˜è®¤ä½¿ç”¨éç»“æ„åŒ–çš„å­—ç¬¦ä¸²ã€‚</p></li>
<li><p><strong>Namespace (å‘½åç©ºé—´):</strong> ç”¨äºç»„ç»‡å­˜å‚¨åœ¨
<code>BaseStore</code> ä¸­çš„è®°å¿†ã€‚æ”¯æŒä½¿ç”¨å ä½ç¬¦ï¼ˆå¦‚
<code>&#123;langgraph_user_id&#125;</code>ï¼‰è¿›è¡ŒåŠ¨æ€é…ç½®ã€‚</p></li>
<li><p>è‡ªåŠ¨åŒ–æµç¨‹:</p>
<p>Manager ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li><strong>æœç´¢ (Search):</strong> æ ¹æ®æ–°å¯¹è¯å†…å®¹ï¼Œåœ¨
<code>BaseStore</code> ä¸­æŸ¥æ‰¾ç›¸å…³çš„ç°æœ‰è®°å¿†ã€‚</li>
<li><strong>åˆ†æ/æå– (Analyze/Extract):</strong> ä½¿ç”¨ LLM
åˆ†ææ–°å¯¹è¯å’Œæ£€ç´¢åˆ°çš„è®°å¿†ï¼Œå†³å®šæ˜¯å¦éœ€è¦åˆ›å»ºæ–°è®°å¿†ã€æ›´æ–°ç°æœ‰è®°å¿†æˆ–åˆ é™¤è¿‡æ—¶è®°å¿†ã€‚</li>
<li><strong>åº”ç”¨æ›´æ”¹ (Apply Changes):</strong>
å°†åˆ†æç»“æœï¼ˆè®°å¿†çš„å¢åˆ æ”¹ï¼‰å†™å›åˆ° <code>BaseStore</code>ã€‚</li>
</ul></li>
</ol>
<h4 id="å®æˆ˜-1">å®æˆ˜</h4>
<p><strong>å¯¼å…¥åº“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from langchain.chat_models import init_chat_model </span><br><span class="line">from langgraph.func import entrypoint </span><br><span class="line">from langgraph.store.memory import InMemoryStore </span><br><span class="line"></span><br><span class="line">from langmem import ReflectionExecutor, create_memory_store_manager </span><br></pre></td></tr></table></figure>
<p><strong>å®šä¹‰store</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from langchain_openai import OpenAIEmbeddings</span><br><span class="line">embedding=OpenAIEmbeddings(</span><br><span class="line">    api_key=&quot;sk-&quot;, </span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">    model=&quot;text-embedding-v4&quot;,</span><br><span class="line">    check_embedding_ctx_length = False,</span><br><span class="line">    dimensions=1536 </span><br><span class="line">)</span><br><span class="line">store = InMemoryStore(</span><br><span class="line">    index=&#123; # å­˜å‚¨æå–çš„è®°å¿† </span><br><span class="line">        &quot;dims&quot;: 1536,</span><br><span class="line">        &quot;embed&quot;: embedding,</span><br><span class="line">    &#125;</span><br><span class="line">) </span><br></pre></td></tr></table></figure>
<p><strong>åˆ›å»ºè®°å¿†ç®¡ç†å™¨</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºè®°å¿†ç®¡ç†å™¨ Runnable æ¥ä»å¯¹è¯ä¸­æå–è®°å¿†</span><br><span class="line">memory_manager = create_memory_store_manager( </span><br><span class="line">    model_qwen, </span><br><span class="line">    # å°†è®°å¿†å­˜å‚¨åœ¨ &quot;memories&quot; å‘½åç©ºé—´ï¼ˆå³ç›®å½•ï¼‰ä¸­</span><br><span class="line">    namespace=(&quot;memories&quot;,),  </span><br><span class="line">    instructions=&quot;ç”¨ä¸­æ–‡å­˜å‚¨è®°å¿†ã€‚&quot;</span><br><span class="line">) </span><br><span class="line"></span><br><span class="line"># åŒ…è£… memory_manager ä»¥å¤„ç†å»¶è¿Ÿçš„åå°å¤„ç†</span><br><span class="line">executor = ReflectionExecutor(memory_manager) </span><br></pre></td></tr></table></figure>
<p>å¯¹æ¯æ¡æ¶ˆæ¯éƒ½è¿›è¡Œè®°å¿†å¤„ç†å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š -
å½“æ¶ˆæ¯å¿«é€Ÿè¿ç»­åˆ°è¾¾æ—¶ï¼Œä¼šäº§ç”Ÿå†—ä½™å·¥ä½œ -
åœ¨å¯¹è¯ä¸­é€”è¿›è¡Œå¤„ç†æ—¶ï¼Œä¸Šä¸‹æ–‡ä¸å®Œæ•´ - ä¸å¿…è¦çš„ token æ¶ˆè€—</p>
<p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/reference/utils/#langmem.ReflectionExecutor"><code>ReflectionExecutor</code></a>
å¯ä»¥å»¶è¿Ÿè®°å¿†å¤„ç†å¹¶å–æ¶ˆå†—ä½™å·¥ä½œã€‚</p>
<p><strong>åˆ›å»ºå·¥ä½œæµ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">model_qwen=ChatOpenAI(</span><br><span class="line">    api_key=&quot;sk-&quot;, </span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">    model=&quot;qwen3-30b-a3b-instruct-2507&quot;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">@entrypoint(store=store)  # åˆ›å»ºä¸€ä¸ª LangGraph å·¥ä½œæµ</span><br><span class="line">async def chat(message: str): </span><br><span class="line">    response = model_qwen.invoke(message) </span><br><span class="line"></span><br><span class="line">    # memory_manager ä»å¯¹è¯å†å²ä¸­æå–è®°å¿†</span><br><span class="line">    # æˆ‘ä»¬å°†ä»¥ OpenAI çš„æ¶ˆæ¯æ ¼å¼æä¾›å®ƒ</span><br><span class="line">    to_process = &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: message&#125;] + [response]&#125; </span><br><span class="line">    await memory_manager.ainvoke(to_process)  </span><br><span class="line">    return response.content </span><br><span class="line"></span><br><span class="line"># æ­£å¸¸è¿è¡Œå¯¹è¯</span><br><span class="line">response = await chat.ainvoke( </span><br><span class="line">    &quot;è®°ä½æˆ‘æ˜¯å¼ ç†™æµš&quot;, </span><br><span class="line">) </span><br><span class="line">print(response) </span><br></pre></td></tr></table></figure>
<p><strong>æŸ¥çœ‹è®°å¿†</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(store.search((&quot;memories&quot;,)))</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/">ç®€ä»‹ - LangChain
æ¡†æ¶</a></p>
<p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langmem/concepts/conceptual_guide/#semantic-memory-facts-and-knowledge">æ ¸å¿ƒæ¦‚å¿µ
- LangChain æ¡†æ¶</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83qwen3-32b/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83qwen3-32b/" class="post-title-link" itemprop="url">åˆ†å¸ƒå¼è®­ç»ƒqwen3-32b</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-12T00:00:00+08:00">2025-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-28 14:58:37" itemprop="dateModified" datetime="2025-08-28T14:58:37+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">æ¨¡å‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E5%9E%8B/%E5%BE%AE%E8%B0%83/" itemprop="url" rel="index"><span itemprop="name">å¾®è°ƒ</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="è®­ç»ƒæ¡†æ¶-llama-factor">è®­ç»ƒæ¡†æ¶-<a target="_blank" rel="noopener" href="https://github.com/hiyouga/LLaMA-Factory">LLaMA-Factor</a></h3>
<p><a target="_blank" rel="noopener" href="https://llamafactory.readthedocs.io/zh-cn/latest/getting_started/installation.html">å®‰è£…
- LLaMA Factory</a></p>
<p><strong>dockeréƒ¨ç½²é•œåƒ</strong>ï¼Œä»¥ä¾¿åç»­ä¼ å…¥å†…ç½‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth 1 https://github.com/hiyouga/LLaMA-Factory.git</span><br><span class="line">cd LLaMA-Factory</span><br><span class="line"></span><br><span class="line">docker build -f ./docker/docker-cuda/Dockerfile \</span><br><span class="line">    --build-arg PIP_INDEX=https://pypi.org/simple \</span><br><span class="line">    --build-arg EXTRAS=metrics \</span><br><span class="line">    -t llamafactory:latest .</span><br><span class="line"></span><br><span class="line">docker run -dit --ipc=host --gpus=all \</span><br><span class="line">    -p 7860:7860 \</span><br><span class="line">    -p 8001:8000 \    # ä¸»æœº 8001 â†’ å®¹å™¨ 8000ï¼Œä¸»æœº8000ç«¯å£è¢«å ç”¨äº†</span><br><span class="line">    --name llamafactory \</span><br><span class="line">    -v /aisys/:/aisys/ \</span><br><span class="line">    docker.1ms.run/hiyouga/llamafactory</span><br><span class="line"></span><br><span class="line">docker run -dit --ipc=host --gpus=all -p 7860:7860 -p 8001:8000 -v /aisys/:/aisys/ --name llamafactory docker.1ms.run/hiyouga/llamafactory</span><br><span class="line"></span><br><span class="line">docker exec -it llamafactory bash</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.1ms.run/hiyouga/llamafactory                                    </span><br><span class="line"></span><br><span class="line">docker save docker.1ms.run/hiyouga/llamafactory:latest -o llamafactory-image.tar</span><br><span class="line"></span><br><span class="line">docker load -i llamafactory-image.tar</span><br></pre></td></tr></table></figure>
<p><strong>LLaMA Board å¯è§†åŒ–å¾®è°ƒï¼ˆç”± <a target="_blank" rel="noopener" href="https://github.com/gradio-app/gradio">Gradio</a>
é©±åŠ¨ï¼‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llamafactory-cli webui</span><br></pre></td></tr></table></figure>
<ul>
<li>Web UI è®¿é—®ï¼š<code>http://localhost:7860</code></li>
<li>API æœåŠ¡è®¿é—®ï¼š<code>http://localhost:8001</code></li>
</ul>
<h3 id="æ•°æ®é›†-easy-dataset">æ•°æ®é›†-<a target="_blank" rel="noopener" href="https://github.com/ConardLi/easy-dataset">easy-dataset</a></h3>
<p><strong>dockeréƒ¨ç½²é•œåƒ</strong>ï¼Œä»¥ä¾¿åç»­ä¼ å…¥å†…ç½‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ConardLi/easy-dataset.git</span><br><span class="line">cd easy-dataset</span><br><span class="line"></span><br><span class="line">docker build -t easy-dataset .</span><br><span class="line"></span><br><span class="line">docker load -i easy-dataset.tar</span><br><span class="line"></span><br><span class="line">docker run -d \</span><br><span class="line">  -p 1717:1717 \</span><br><span class="line">  -v /aisys/repo_dev/xizhang/lora_database:/app/local-db \</span><br><span class="line">  -v /aisys/repo_dev/xizhang/lora_databse_prisma:/app/prisma \</span><br><span class="line">  --name easy-dataset \</span><br><span class="line">  easy-dataset</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">docker exec -it easy-dataset sh</span><br><span class="line"></span><br><span class="line">docker stop easy-dataset</span><br><span class="line">docker rm easy-dataset</span><br><span class="line"></span><br><span class="line">#å®æ—¶è·Ÿè¸ª</span><br><span class="line"> docker logs -f easy-dataset</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> è¯·å°†
<code>&#123;YOUR_LOCAL_DB_PATH&#125;</code>ã€<code>&#123;LOCAL_PRISMA_PATH&#125;</code>
æ›¿æ¢ä¸ºä½ å¸Œæœ›å­˜å‚¨æœ¬åœ°æ•°æ®åº“çš„å®é™…è·¯å¾„ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨å½“å‰ä»£ç ä»“åº“ç›®å½•ä¸‹çš„
<code>local-db</code> å’Œ <code>prisma</code> æ–‡ä»¶å¤¹ï¼Œè¿™æ ·å¯ä»¥å’Œ NPM
å¯åŠ¨æ—¶çš„æ•°æ®åº“è·¯å¾„ä¿æŒä¸€è‡´ã€‚</p>
</blockquote>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong>
å¦‚æœéœ€è¦æŒ‚è½½æ•°æ®åº“æ–‡ä»¶ï¼ˆPRISMAï¼‰ï¼Œéœ€è¦æå‰æ‰§è¡Œ
<code>npm run db:push</code> åˆå§‹åŒ–æ•°æ®åº“æ–‡ä»¶ã€‚</p>
</blockquote>
<p>ä½¿ç”¨å¼€æºé¡¹ç›®åˆ¶ä½œæ•°æ®é›†</p>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <code>http://localhost:1717</code></p>
<h3 id="ä¸Šä¼ å†…ç½‘">ä¸Šä¼ å†…ç½‘</h3>
<p>ä½¿ç”¨scp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r &quot;F:\project python\å®ä¹ \å¾®è°ƒ\universal-llm_latest.tar&quot; root@10.117.128.50:/aisys/repo_dev/xizhang/images</span><br></pre></td></tr></table></figure>
<p><strong>SCP</strong> å…¨ç§°æ˜¯ <strong>Secure Copy
Protocol</strong>ï¼ˆå®‰å…¨å¤åˆ¶åè®®ï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨äºåœ¨è®¡ç®—æœºä¹‹é—´<strong>å®‰å…¨åœ°å¤åˆ¶æ–‡ä»¶</strong>çš„ç½‘ç»œåè®®ã€‚</p>
<p>å®ƒåŸºäº <strong>SSH</strong>ï¼ˆSecure
Shellï¼‰åè®®å·¥ä½œï¼Œå› æ­¤æ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½æ˜¯<strong>åŠ å¯†çš„</strong>ï¼Œå¯ä»¥é˜²æ­¢è¢«çªƒå¬æˆ–ç¯¡æ”¹ï¼Œéå¸¸é€‚åˆåœ¨ä¸å®‰å…¨çš„ç½‘ç»œï¼ˆå¦‚äº’è”ç½‘ï¼‰ä¸­ä½¿ç”¨ã€‚</p>
<h3 id="æ¨¡å‹éƒ¨ç½²ä¸è°ƒç”¨">æ¨¡å‹éƒ¨ç½²ä¸è°ƒç”¨</h3>
<h4 id="åˆ¶ä½œæ¨¡å‹è¿è¡Œé•œåƒ">åˆ¶ä½œæ¨¡å‹è¿è¡Œé•œåƒ</h4>
<p>qwen3éƒ¨ç½²ç‰ˆæœ¬è¦æ±‚å¦‚ä¸‹</p>
<p>ä½¿ç”¨ Python 3.10 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼Œ PyTorch 2.6 æˆ–ä»¥ä¸Šç‰ˆæœ¬</p>
<p><code>transformers&gt;=4.51.0</code> ç‰ˆæœ¬</p>
<p>ä½¿ç”¨ <code>sglang&gt;=0.4.6.post1</code> æˆ–
<code>vllm&gt;=0.8.5</code> æ¥åˆ›å»ºä¸€ä¸ªä¸ OpenAI å…¼å®¹çš„ API ç«¯ç‚¹</p>
<h4 id="é•œåƒä¿¡æ¯">é•œåƒä¿¡æ¯</h4>
<table>
<colgroup>
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 21%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>ç±»åˆ«</th>
<th>ç»„ä»¶</th>
<th>ç‰ˆæœ¬ / æ¥æº</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>OS</strong></td>
<td>Ubuntu</td>
<td>22.04 LTS (Jammy)</td>
<td>ä¸Šæ¸¸é•œåƒç»§æ‰¿</td>
</tr>
<tr class="even">
<td><strong>Python</strong></td>
<td>CPython</td>
<td>3.11</td>
<td>é•œåƒè‡ªå¸¦</td>
</tr>
<tr class="odd">
<td><strong>PyTorch</strong></td>
<td>PyTorch</td>
<td>2.6.0+cu126</td>
<td>å®˜æ–¹ wheelï¼ŒCUDA 12.6</td>
</tr>
<tr class="even">
<td><strong>CUDA</strong></td>
<td>Runtime</td>
<td>12.6.3</td>
<td>ä¸å®¿ä¸»æœº 535 é©±åŠ¨å…¼å®¹</td>
</tr>
<tr class="odd">
<td><strong>cuDNN</strong></td>
<td>cuDNN</td>
<td>9</td>
<td>åŒ…å«åœ¨é•œåƒ</td>
</tr>
<tr class="even">
<td><strong>æ ¸å¿ƒåº“</strong></td>
<td>transformers</td>
<td>â‰¥4.51.0</td>
<td>å®˜æ–¹æœ€æ–°</td>
</tr>
<tr class="odd">
<td></td>
<td>tokenizers</td>
<td>â‰¥0.21</td>
<td>transformers ä¾èµ–</td>
</tr>
<tr class="even">
<td></td>
<td>accelerate</td>
<td>â‰¥1.0.0</td>
<td>è®­ç»ƒ / æ¨ç†åŠ é€Ÿ</td>
</tr>
<tr class="odd">
<td></td>
<td>sentencepiece</td>
<td>â‰¥0.2.0</td>
<td>Qwen3 åˆ†è¯å™¨å¿…éœ€</td>
</tr>
<tr class="even">
<td></td>
<td>protobuf</td>
<td>â‰¥5.28.0</td>
<td>åºåˆ—åŒ– / æ¨¡å‹åŠ è½½</td>
</tr>
<tr class="odd">
<td></td>
<td>tiktoken</td>
<td>â‰¥0.8.0</td>
<td>OpenAI æ ¼å¼åˆ†è¯</td>
</tr>
<tr class="even">
<td><strong>æ¨ç†æ¡†æ¶</strong></td>
<td>vLLM</td>
<td>â‰¥0.8.5</td>
<td>æ”¯æŒ tensor-parallelã€PagedAttention</td>
</tr>
<tr class="odd">
<td></td>
<td>SGLang</td>
<td>â‰¥0.4.6.post1</td>
<td>æ”¯æŒ outline è§£ç ã€MoE ä¼˜åŒ–</td>
</tr>
<tr class="even">
<td><strong>å¯é€‰åŠ é€Ÿ</strong></td>
<td>flash-attn</td>
<td>â‰¥2.7</td>
<td>é•¿ä¸Šä¸‹æ–‡ / å¤§ batch æ¨ç†</td>
</tr>
<tr class="odd">
<td><strong>æƒé‡ä¸‹è½½</strong></td>
<td>modelscope</td>
<td>æœ€æ–°</td>
<td>å›½å†…é•œåƒåŠ é€Ÿ</td>
</tr>
<tr class="even">
<td><strong>å·¥å…·é“¾</strong></td>
<td>git / git-lfs</td>
<td>æœ€æ–°</td>
<td>æ‹‰å– HuggingFace æƒé‡</td>
</tr>
<tr class="odd">
<td></td>
<td>curl / jq / vim</td>
<td>æœ€æ–°</td>
<td>è°ƒè¯• &amp; å¥åº·æ£€æŸ¥</td>
</tr>
</tbody>
</table>
<p><strong>åŸºç¡€é•œåƒ</strong><code>pytorch/pytorch:2.6.0-cuda12.6-cudnn9-devel</code>
æ˜¯ <strong>PyTorch å®˜æ–¹åœ¨ Docker Hub
ä¸Šæä¾›çš„â€œå…¨å®¶æ¡¶â€å¼€å‘é•œåƒ</strong>ï¼Œå‘å¸ƒæ—¥æœŸ 2025-01-29ï¼Œé•œåƒå¤§å°çº¦ 13
GBï¼Œå®šä½æ˜¯ <strong>â€œå¼€ç®±å³ç”¨â€çš„ GPU è®­ç»ƒ / æ¨ç† / è°ƒè¯•ç¯å¢ƒ</strong></p>
<h4 id="dockerfile">dockerfile</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># ---------- 1. åŸºç¡€é•œåƒ ----------</span><br><span class="line">FROM pytorch/pytorch:2.6.0-cuda12.6-cudnn9-devel</span><br><span class="line"></span><br><span class="line"># ---------- 2. å›½å†…é•œåƒæº ----------</span><br><span class="line">RUN sed -i &#x27;s|http://archive.ubuntu.com|https://mirrors.tuna.tsinghua.edu.cn|g&#x27; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    sed -i &#x27;s|http://security.ubuntu.com|https://mirrors.tuna.tsinghua.edu.cn|g&#x27; /etc/apt/sources.list &amp;&amp; \</span><br><span class="line">    pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \</span><br><span class="line">    pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn</span><br><span class="line"></span><br><span class="line"># ---------- 3. ç³»ç»Ÿä¾èµ– ----------</span><br><span class="line">RUN apt-get update &amp;&amp; \</span><br><span class="line">    DEBIAN_FRONTEND=noninteractive apt-get install -y \</span><br><span class="line">    git git-lfs build-essential ninja-build curl wget vim jq &amp;&amp; \</span><br><span class="line">    rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"># ---------- 4. Python ä¾èµ– ----------</span><br><span class="line">RUN pip install --no-cache-dir --upgrade pip setuptools wheel &amp;&amp; \</span><br><span class="line">    pip install --no-cache-dir \</span><br><span class="line">    &quot;torch==2.6.0+cu126&quot; \</span><br><span class="line">    &quot;transformers&gt;=4.51.0&quot; \</span><br><span class="line">    &quot;tokenizers&gt;=0.21&quot; \</span><br><span class="line">    &quot;accelerate&gt;=1.0.0&quot; \</span><br><span class="line">    &quot;sentencepiece&gt;=0.2.0&quot; \</span><br><span class="line">    &quot;protobuf&gt;=5.28.0&quot; \</span><br><span class="line">    &quot;tiktoken&gt;=0.8.0&quot; \</span><br><span class="line">    &quot;vllm&gt;=0.8.5&quot; \</span><br><span class="line">    &quot;sglang[all]&gt;=0.4.6.post1&quot; \</span><br><span class="line">    &quot;modelscope&quot; \</span><br><span class="line">    &quot;fastapi&quot; &quot;uvicorn[standard]&quot; &quot;pydantic&quot;</span><br><span class="line"></span><br><span class="line"># ---------- 5. å¯é€‰æ€§èƒ½åŠ é€Ÿ ----------</span><br><span class="line">RUN pip install --no-cache-dir &quot;flash-attn&gt;=2.7&quot; --no-build-isolation || true</span><br><span class="line"></span><br><span class="line"># ---------- 6. å›½å†… HuggingFace é•œåƒ ----------</span><br><span class="line">ENV HF_ENDPOINT=https://hf-mirror.com</span><br><span class="line"></span><br><span class="line"># ---------- 7. å·¥ä½œç›®å½• ----------</span><br><span class="line">WORKDIR /app</span><br><span class="line">EXPOSE 4000 4001 4002</span><br><span class="line"></span><br><span class="line"># ---------- 8. é»˜è®¤å‘½ä»¤ ----------</span><br><span class="line">CMD [&quot;/bin/bash&quot;]</span><br></pre></td></tr></table></figure>
<h4 id="è¿è¡Œå®¹å™¨">è¿è¡Œå®¹å™¨</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -it \</span><br><span class="line">  --name llm-service \</span><br><span class="line">  --gpus all \</span><br><span class="line">  -p 4000:4000 \</span><br><span class="line">  -p 4001:4001 \</span><br><span class="line">  -p 4002:4002 \</span><br><span class="line">  -v /aisys/repo_dev/xizhang/models:/app/models \</span><br><span class="line">  -v /aisys/repo_dev/xizhang/models/cache:/app/models/.cache \</span><br><span class="line">  --shm-size=8g \</span><br><span class="line">  universal-llm:latest bash</span><br></pre></td></tr></table></figure>
<h4 id="vllméƒ¨ç½²qwen3">vllméƒ¨ç½²qwen3</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vllm serve /app/models/qwen3-32b-lora-new \</span><br><span class="line">    --port 4001 \</span><br><span class="line">    --tensor-parallel-size 4 \</span><br><span class="line">    --max-model-len 1024 \</span><br><span class="line">    --reasoning-parser qwen3 \</span><br><span class="line">    --gpu-memory-utilization 0.8 \</span><br><span class="line">    --max-num-seqs 8 \</span><br><span class="line">    --host 0.0.0.0</span><br></pre></td></tr></table></figure>
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
<th>æ¨è/æ³¨æ„</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>--port 8000</code></td>
<td>æœåŠ¡ç›‘å¬ç«¯å£</td>
<td>ä¸ <code>-p 8000:8000</code> ä¿æŒä¸€è‡´ï¼›å¦‚éœ€å¤šå®ä¾‹ï¼Œå¯æ”¹ 8001/8002
â€¦</td>
</tr>
<tr class="even">
<td><code>--tensor-parallel-size 4</code></td>
<td>æŠŠæ¨¡å‹æƒé‡åˆ‡æˆ 4 ä»½ï¼Œè·¨ 4 å¼  GPU å¹¶è¡Œè®¡ç®—</td>
<td>å¿…é¡» â‰¤ å®é™… GPU æ•°é‡ï¼›Qwen3-32B åœ¨ 4Ã—L20
ä¸Šæ˜¾å­˜åˆšå¥½å¤Ÿï¼Œ<strong>ä¸å¯å†å¤§</strong></td>
</tr>
<tr class="odd">
<td><code>--max-model-len 1024</code></td>
<td>å•æ¬¡æ¨ç†æœ€å¤§ token æ•°ï¼ˆå« prompt + ç”Ÿæˆï¼‰</td>
<td>è‹¥åœºæ™¯éœ€è¦ 4k/8k/32kï¼Œå¯è°ƒåˆ° 4096/8192ï¼›æ˜¾å­˜å ç”¨ âˆ é•¿åº¦Â²</td>
</tr>
<tr class="even">
<td><code>--reasoning-parser qwen3</code></td>
<td>vLLM â‰¥0.8.5 æ–°å¢å¼€å…³ï¼Œè§£æ Qwen3 çš„
<code>&lt;think&gt;â€¦&lt;/think&gt;</code> æ ‡ç­¾ï¼ŒæŠŠæ¨ç†è¿‡ç¨‹å•ç‹¬è¿”å›</td>
<td>ä»…åœ¨ <strong>Qwen3</strong> ç³»åˆ—æ¨¡å‹æœ‰æ•ˆï¼Œå…¶ä»–æ¨¡å‹è¯·å»æ‰</td>
</tr>
<tr class="odd">
<td><code>--gpu-memory-utilization 0.8</code></td>
<td>æ˜¾å­˜ä½¿ç”¨ä¸Šé™ 80 %ï¼›å‰©ä½™ 20 % ç•™ç»™ CUDA kernelã€KV cache è†¨èƒ€</td>
<td>è‹¥å‡ºç° OOMï¼Œå¯é™åˆ° 0.7ï¼›è‹¥æƒ³å¤šå¹¶å‘ï¼Œå¯å°è¯• 0.85ï¼ˆé£é™© OOMï¼‰</td>
</tr>
<tr class="even">
<td><code>--max-num-seqs 8</code></td>
<td>åŒä¸€æ—¶åˆ»æœ€å¤šå¹¶å‘å¤„ç†çš„ <strong>è¯·æ±‚æ¡æ•°</strong></td>
<td>ä¸ <code>--max-model-len</code> å’Œæ˜¾å­˜åŒæ—¶å†³å®šï¼›è‹¥é•¿åº¦ â†‘ï¼Œæ­¤å€¼éœ€
â†“</td>
</tr>
<tr class="odd">
<td><code>--host 0.0.0.0</code></td>
<td>ç›‘å¬æ‰€æœ‰ç½‘å¡ï¼Œä½¿å®¹å™¨å¤–å¯è®¿é—®</td>
<td>ç”Ÿäº§ç¯å¢ƒå¯æ”¹ä¸ºå†…ç½‘ IP æˆ– 127.0.0.1 æé«˜å®‰å…¨æ€§</td>
</tr>
</tbody>
</table>
<h4 id="æµ‹è¯•">æµ‹è¯•</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:4001/v1/chat/completions \</span><br><span class="line">   -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">   -d &#x27;&#123;</span><br><span class="line">       &quot;model&quot;: &quot;/app/models/qwen3-32b-lora-new&quot;,</span><br><span class="line">       &quot;messages&quot;: [</span><br><span class="line">           &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;è¯·ç”¨ä¸­æ–‡ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±&quot;&#125;</span><br><span class="line">       ],</span><br><span class="line">       &quot;temperature&quot;: 0.7,</span><br><span class="line">       &quot;max_tokens&quot;: 512</span><br><span class="line">   &#125;&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="è°ƒç”¨">è°ƒç”¨</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">from openai import OpenAI</span><br><span class="line"></span><br><span class="line"># æŒ‡å‘æœ¬åœ° vLLM</span><br><span class="line">client = OpenAI(</span><br><span class="line">    base_url=&quot;http://localhost:8000/v1&quot;,</span><br><span class="line">    api_key=&quot;dummy&quot;          # vLLM ä¸åšé‰´æƒï¼Œéšä¾¿å¡«</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">resp = client.chat.completions.create(</span><br><span class="line">    model=&quot;qwen3-32b&quot;,       # å¿…é¡»å’Œ vLLM å¯åŠ¨è·¯å¾„æˆ– --served-model-name ä¿æŒä¸€è‡´</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;9.9 å’Œ 9.11 å“ªä¸ªå¤§ï¼Ÿ&quot;&#125;</span><br><span class="line">    ],</span><br><span class="line">    max_tokens=512,</span><br><span class="line">    temperature=0.7,</span><br><span class="line">    stream=False             # True å¯å¼€æµå¼</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">print(resp.choices[0].message.content)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://qwen.readthedocs.io/en/latest/getting_started/quickstart.html">å¿«é€Ÿå…¥é—¨
- Qwen â€” Quickstart - Qwen</a></p>
<p><a target="_blank" rel="noopener" href="https://www.modelscope.cn/models/Qwen/Qwen3-32B">é€šä¹‰åƒé—®3-32B Â·
æ¨¡å‹åº“</a></p>
<h3 id="å¾®è°ƒæ•°æ®é›†">å¾®è°ƒæ•°æ®é›†</h3>
<h4 id="alpacaå’Œsharegptçš„åŒºåˆ«">alpacaå’Œsharegptçš„åŒºåˆ«</h4>
<p>â–¶ Alpaca å…¸å‹å­—æ®µ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;instruction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æŠŠä¸‹é¢å¥å­ç¿»è¯‘æˆè‹±æ–‡&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;The weather is nice today.&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;system&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªç¿»è¯‘åŠ©æ‰‹&quot;</span><span class="punctuation">,</span>   <span class="comment">// å¯é€‰</span></span><br><span class="line">  <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span>                 <span class="comment">// å¯é€‰ï¼Œæ”¾å‰å‡ è½®</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸€æ¡æ•°æ® = ä¸€æ¬¡ç‹¬ç«‹ä»»åŠ¡</li>
<li>å­—æ®µå›ºå®šï¼š<code>instruction / input / output</code> ä¸‰æ¿æ–§</li>
</ul>
<p>â–¶ ShareGPT å…¸å‹å­—æ®µ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;conversations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;human&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆ‘ä»Šå¤©å¿ƒæƒ…ä¸å¥½&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gpt&quot;</span><span class="punctuation">,</span>   <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ€ä¹ˆå•¦ï¼Ÿæƒ³èŠèŠå—&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;human&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®ºæ–‡åˆè¢«æ‹’äº†&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gpt&quot;</span><span class="punctuation">,</span>   <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç†è§£ä½ çš„æŒ«è´¥æ„Ÿâ€¦&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;system&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ æ˜¯è´´å¿ƒèŠå¤©æœºå™¨äºº&quot;</span><span class="punctuation">,</span>   <span class="comment">// å¯é€‰</span></span><br><span class="line">  <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>...<span class="punctuation">]</span>                   <span class="comment">// å¯é€‰ï¼Œæ”¾å‡½æ•°æè¿°</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸€æ¡æ•°æ® = ä¸€æ®µå®Œæ•´çš„å¤šè½®å¯¹è¯</li>
<li>è§’è‰²äº¤æ›¿ï¼š<code>human / gpt / function / observation</code> ç­‰</li>
</ul>
<table>
<colgroup>
<col style="width: 9%">
<col style="width: 47%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>ç»´åº¦</th>
<th>Alpaca</th>
<th>ShareGPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>æ¥æº</strong></td>
<td>æ–¯å¦ç¦ Alpaca é¡¹ç›®ï¼Œä¸ºäº†ä½æˆæœ¬åšæŒ‡ä»¤å¾®è°ƒ</td>
<td>ShareGPT ç½‘ç«™çˆ¬å–çš„çœŸå® ChatGPT å¯¹è¯</td>
</tr>
<tr class="even">
<td><strong>ç›®æ ‡</strong></td>
<td>è®©æ¨¡å‹å­¦ä¼šâ€œçœ‹åˆ°æŒ‡ä»¤+è¾“å…¥â†’ç»™å‡ºç­”æ¡ˆâ€</td>
<td>è®©æ¨¡å‹å­¦ä¼šâ€œåƒ ChatGPT ä¸€æ ·å¤šè½®å¯¹è¯â€</td>
</tr>
</tbody>
</table>
<h4 id="è¯¦è§£">è¯¦è§£</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;instruction&quot;: &quot;ç”µé˜»ç‡æµ‹å®šæ³•çš„ç¯å¢ƒæ¸©æ¹¿åº¦æ§åˆ¶å¯¹æ£€æµ‹ç»“æœçš„å¯ä¿¡åº¦æœ‰ä½•å½±å“ï¼Ÿ&quot;,</span><br><span class="line">    &quot;input&quot;: &quot;- \&quot;æ£€æµ‹ä¾æ®ï¼šDL<span class="operator">/</span>T <span class="number">421</span><span class="number">-2009</span> ç”µåŠ›ç”¨æ²¹ä½“ç§¯ç”µé˜»ç‡æµ‹å®šæ³•\&quot;\n- \&quot;æ£€æµ‹åœ°ç‚¹åŠç¯å¢ƒæ¡ä»¶ï¼šæ²¹å“æ£€æµ‹å®¤ æ¸©åº¦ï¼š<span class="number">16</span>â„ƒ æ¹¿åº¦ï¼š<span class="number">57</span><span class="operator">%</span>RH\&quot;\n- \&quot;ç”µé˜»ç‡ï¼ˆ\&quot;&quot;,</span><br><span class="line">    &quot;output&quot;: &quot;&lt;think&gt;### \né¦–å…ˆï¼Œç†è§£é—®é¢˜çš„æ ¸å¿ƒï¼šç”µé˜»ç‡æµ‹å®šæ³•ä¸­ï¼Œç¯å¢ƒæ¸©æ¹¿åº¦æ§åˆ¶å¦‚ä½•å½±å“æ£€æµ‹ç»“æœçš„å¯ä¿¡åº¦ï¼Œè¿™æ¶‰åŠåˆ°æµ‹é‡è¿‡ç¨‹çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚\n\nç„¶åï¼Œåˆ†æå…³é”®ä¿¡æ¯ï¼šæ£€æµ‹ä¾æ®æ˜¯DL/T 421-2009æ ‡å‡†ï¼Œå®ƒè§„å®šäº†ç”µé˜»ç‡æµ‹å®šçš„æ–¹æ³•ï¼›ç¯å¢ƒæ¡ä»¶è¢«è®°å½•ä¸ºæ¸©åº¦16â„ƒå’Œæ¹¿åº¦57%RHï¼›æ£€æµ‹ç»“æœæ˜¾ç¤ºç”µé˜»ç‡ä¸º1.04Ã—10^10 Î©Â·cmï¼Œç¬¦åˆDL/T 571-2014æ ‡å‡†çš„è¦æ±‚ï¼ˆâ‰¥6Ã—10^9 Î©Â·cmï¼‰ã€‚\n\næ¥ç€ï¼Œæ¨ç†æ¸©æ¹¿åº¦æ§åˆ¶çš„å½±å“ï¼šç¯å¢ƒæ¸©æ¹¿åº¦æ˜¯æµ‹é‡è¿‡ç¨‹ä¸­çš„å…³é”®å˜é‡ï¼Œæ§åˆ¶è¿™äº›æ¡ä»¶ç¡®ä¿&quot;,</span><br><span class="line">    &quot;system&quot;: &quot;ä½œä¸ºç”µåŠ›èƒ½æºæŠ¥å‘Šè§£è¯»ä¸“å®¶ï¼Œæˆ‘åœ¨ç”Ÿæˆç­”æ¡ˆæ—¶ï¼Œå°†ä¸¥æ ¼éµå¾ªä»¥ä¸‹æ ¼å¼ï¼š\næ ¹æ®â€œä¿¡æ¯æ¥æºâ€ï¼Œâ€œä¿¡æ¯æ¥æºâ€æ˜¯åŸæ–‡ä¸­å¯ç›´æ¥æ”¯æ’‘ç»“è®ºçš„å¥å­ã€æ•°æ®æˆ–å›¾è¡¨ç¼–å·ç»™å‡ºâ€œç»“è®ºä¸æ¨ç†â€â€”â€”ç”¨ä¸Šè¿°é€æ¡å¤ç°çš„ä¿¡æ¯ä¸ºå”¯ä¸€ä¾æ®ï¼Œæ¨å¯¼å‡ºæœ€ç»ˆç­”æ¡ˆã€‚&quot;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>instructionä¸ºé—®é¢˜ï¼›inputä¸ºä¸Šä¸‹æ–‡ï¼›outputåŒ…å«æ€ç»´é“¾ä¸ç­”æ¡ˆï¼›systemä¸ºç³»ç»Ÿæç¤ºè¯</p>
<h3 id="å¾®è°ƒå‚æ•°è®¾ç½®">å¾®è°ƒå‚æ•°è®¾ç½®</h3>
<h4 id="deepspeed-stagedeepspeed-é˜¶æ®µ"><strong>DeepSpeed
stageï¼ˆDeepSpeed é˜¶æ®µï¼‰</strong></h4>
<p><strong>deepSpeed çš„ ZeRO åˆ†å¸ƒå¼ä¼˜åŒ–é˜¶æ®µ</strong>ï¼Œç”¨äºåœ¨å¤š GPU
ä¸Šé«˜æ•ˆè®­ç»ƒå¤§æ¨¡å‹ã€‚</p>
<table>
<colgroup>
<col style="width: 14%">
<col style="width: 43%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Stage</th>
<th>åŠŸèƒ½</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Stage 0</strong></td>
<td>ä¸åšä»»ä½•ä¼˜åŒ–</td>
<td>åŸºç¡€åˆ†å¸ƒå¼è®­ç»ƒï¼ˆDDPï¼‰ï¼Œæ˜¾å­˜å ç”¨é«˜</td>
</tr>
<tr class="even">
<td><strong>Stage 1</strong></td>
<td>æ¢¯åº¦åˆ†ç‰‡ï¼ˆGradient Shardingï¼‰</td>
<td>å°†æ¢¯åº¦åˆ‡åˆ†åˆ°ä¸åŒ GPUï¼Œå‡å°‘æ˜¾å­˜</td>
</tr>
<tr class="odd">
<td><strong>Stage 2</strong></td>
<td>å‚æ•° + æ¢¯åº¦åˆ†ç‰‡</td>
<td>è¿›ä¸€æ­¥é™ä½æ˜¾å­˜ï¼Œä½†éœ€é€šä¿¡åŒæ­¥</td>
</tr>
<tr class="even">
<td><strong>Stage 3</strong></td>
<td>âœ… <strong>å‚æ•° + æ¢¯åº¦ + ä¼˜åŒ–å™¨çŠ¶æ€åˆ†ç‰‡</strong></td>
<td>æœ€å¼ºæ˜¾å­˜ä¼˜åŒ–ï¼Œæ”¯æŒè¶…å¤§æ¨¡å‹</td>
</tr>
</tbody>
</table>
<h4 id="ä½¿ç”¨-deepspeed-offloadä½¿ç”¨-offload">ä½¿ç”¨ DeepSpeed offloadï¼ˆä½¿ç”¨
offloadï¼‰</h4>
<p>å°† <strong>éƒ¨åˆ†æˆ–å…¨éƒ¨æ¨¡å‹å‚æ•°ã€ä¼˜åŒ–å™¨çŠ¶æ€å¸è½½åˆ° CPU
å†…å­˜</strong>ï¼Œè¿›ä¸€æ­¥é‡Šæ”¾ GPU æ˜¾å­˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">llamafactory-cli train \</span><br><span class="line">    --stage sft \</span><br><span class="line">    --do_train True \</span><br><span class="line">    --model_name_or_path /aisys/repo_dev/xizhang/models/qwen3-32b-lora-new \</span><br><span class="line">    --preprocessing_num_workers 16 \</span><br><span class="line">    --finetuning_type lora \</span><br><span class="line">    --template qwen3 \</span><br><span class="line">    --flash_attn auto \</span><br><span class="line">    --dataset_dir /aisys/repo_dev/xizhang/lora_database/P9er76jCWCFW \</span><br><span class="line">    --dataset [Easy Dataset] [P9er76jCWCFW] Alpaca \</span><br><span class="line">    --cutoff_len 4096 \</span><br><span class="line">    --learning_rate 5e-05 \</span><br><span class="line">    --num_train_epochs 3.0 \</span><br><span class="line">    --max_samples 100000 \</span><br><span class="line">    --per_device_train_batch_size 2 \</span><br><span class="line">    --gradient_accumulation_steps 1 \</span><br><span class="line">    --lr_scheduler_type cosine \</span><br><span class="line">    --max_grad_norm 1.0 \</span><br><span class="line">    --logging_steps 5 \</span><br><span class="line">    --save_steps 200 \</span><br><span class="line">    --warmup_steps 0 \</span><br><span class="line">    --packing False \</span><br><span class="line">    --enable_thinking True \</span><br><span class="line">    --report_to none \</span><br><span class="line">    --output_dir saves/Qwen3-32B-Thinking/lora/train_2025-08-28-03-04-52 \</span><br><span class="line">    --bf16 True \</span><br><span class="line">    --plot_loss True \</span><br><span class="line">    --trust_remote_code True \</span><br><span class="line">    --ddp_timeout 180000000 \</span><br><span class="line">    --include_num_input_tokens_seen True \</span><br><span class="line">    --optim adamw_torch \</span><br><span class="line">    --lora_rank 8 \</span><br><span class="line">    --lora_alpha 16 \</span><br><span class="line">    --lora_dropout 0 \</span><br><span class="line">    --lora_target all \</span><br><span class="line">    --val_size 0.15 \</span><br><span class="line">    --eval_strategy steps \</span><br><span class="line">    --eval_steps 200 \</span><br><span class="line">    --per_device_eval_batch_size 2 \</span><br><span class="line">    --deepspeed cache/ds_z3_config.json</span><br></pre></td></tr></table></figure>
<h3 id="è®­ç»ƒç»“æœ">è®­ç»ƒç»“æœ</h3>
<figure>
<img src="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83qwen3-32b/image-20250827091214108.png" alt="image-20250827091214108">
<figcaption aria-hidden="true">image-20250827091214108</figcaption>
</figure>
<h3 id="è¯„ä¼°">è¯„ä¼°</h3>
<p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆä½¿ç”¨llamafactoryçš„è¯„ä¼°ä¼šçˆ†æ˜¾å­˜ï¼Œæˆ‘æ€€ç–‘æ˜¯å› ä¸ºé‚£ä¸ªwebuiè¯„ä¼°å¯èƒ½ä¸æ”¯æŒå¤šå¡ï¼Œå°±è¿›è¡Œä¸€ä¸‹äººå·¥è¯„ä¼°å§</p>
<p>è¾“å…¥</p>
<figure>
<img src="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83qwen3-32b/image-20250828144300339.png" alt="image-20250828144300339">
<figcaption aria-hidden="true">image-20250828144300339</figcaption>
</figure>
<p>å¾®è°ƒæ¨¡å‹</p>
<figure>
<img src="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83qwen3-32b/image-20250828145106050.png" alt="image-20250828145106050">
<figcaption aria-hidden="true">image-20250828145106050</figcaption>
</figure>
<p>åˆå§‹æ¨¡å‹</p>
<figure>
<img src="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83qwen3-32b/image-20250828145750115.png" alt="image-20250828145750115">
<figcaption aria-hidden="true">image-20250828145750115</figcaption>
</figure>
<h3 id="åœ¨å†…ç½‘è®¡ç®—èŠ‚ç‚¹è®¿é—®swanlab-cloud">åœ¨å†…ç½‘è®¡ç®—èŠ‚ç‚¹è®¿é—®SwanLab
Cloud</h3>
<p><a target="_blank" rel="noopener" href="https://docs.swanlab.cn/guide_cloud/experiment_track/ssh-portforwarding.html">åœ¨å†…ç½‘è®¡ç®—èŠ‚ç‚¹è®¿é—®SwanLab
Cloud | SwanLabå®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="å¦‚ä½•è®¡ç®—è®­ç»ƒæ­¥æ•°">å¦‚ä½•è®¡ç®—è®­ç»ƒæ­¥æ•°</h3>
<h4 id="è®­ç»ƒé›†æ ·æœ¬é‡">1. è®­ç»ƒé›†æ ·æœ¬é‡</h4>
<p><strong>å…¬å¼</strong> è®­ç»ƒé›†æ ·æœ¬é‡ = æ€»æ•°æ®é‡ Ã— (1 âˆ’ éªŒè¯é›†æ¯”ä¾‹)</p>
<p><strong>ç¤ºä¾‹</strong> æ€»æ•°æ® 2876 æ¡ï¼ŒéªŒè¯é›†å  15% 2876 Ã— (1 âˆ’ 0.15)
= 2876 Ã— 0.85 = <strong>2446 æ¡</strong></p>
<h4 id="æ¯æ¬¡å‚æ•°æ›´æ–°å¤„ç†çš„æ ·æœ¬æ•°effective-batch-size">2.
æ¯æ¬¡å‚æ•°æ›´æ–°å¤„ç†çš„æ ·æœ¬æ•°ï¼ˆeffective batch sizeï¼‰</h4>
<p><strong>å…¬å¼</strong> æ¯æ¬¡æ›´æ–°æ ·æœ¬æ•° = å•è®¾å¤‡æ‰¹æ¬¡å¤§å° Ã— GPU æ•° Ã—
æ¢¯åº¦ç´¯ç§¯æ­¥æ•°</p>
<p><strong>ç¤ºä¾‹</strong></p>
<ul>
<li>per_device_train_batch_size = 1</li>
<li>GPU æ•° = 2</li>
<li>gradient_accumulation_steps = 8</li>
</ul>
<p>1 Ã— 2 Ã— 8 = <strong>16 æ¡</strong></p>
<blockquote>
<p>é€šä¿—ç†è§£ï¼š GPU ä¸€æ¬¡åªèƒ½çœ‹ 1 æ¡ â†’ 2 å¡å¹¶è¡Œå°±æ˜¯ 2 æ¡ â†’ ç´¯ç§¯ 8
æ¬¡æ‰æ›´æ–°ä¸€æ¬¡å‚æ•°ï¼Œæ‰€ä»¥ä¸€æ¬¡æ›´æ–°çœŸæ­£çœ‹äº† 16 æ¡æ•°æ®ã€‚</p>
</blockquote>
<h4 id="æ¯è½®epochçš„è®­ç»ƒæ­¥æ•°">3. æ¯è½®ï¼ˆepochï¼‰çš„è®­ç»ƒæ­¥æ•°</h4>
<p><strong>å…¬å¼</strong> æ¯è½®æ­¥æ•° = âŒŠ è®­ç»ƒé›†æ ·æœ¬é‡ Ã· æ¯æ¬¡æ›´æ–°æ ·æœ¬æ•° âŒ‹
ï¼ˆâŒŠ âŒ‹ è¡¨ç¤ºå‘ä¸‹å–æ•´ï¼‰</p>
<p><strong>ç¤ºä¾‹</strong> 2446 Ã· 16 = 152.875 â†’ <strong>152
æ­¥</strong></p>
<h4 id="æ€»è®­ç»ƒæ­¥æ•°">4. æ€»è®­ç»ƒæ­¥æ•°</h4>
<p><strong>å…¬å¼</strong> æ€»æ­¥æ•° = æ¯è½®æ­¥æ•° Ã— è®­ç»ƒè½®æ•° (epochs)</p>
<p><strong>ç¤ºä¾‹</strong> 152 Ã— 3 = <strong>456 æ­¥</strong></p>
<h3 id="å¦‚ä½•è®¡ç®—ä¸€ä¸ªæ¨¡å‹å ç”¨çš„æ˜¾å­˜">å¦‚ä½•è®¡ç®—ä¸€ä¸ªæ¨¡å‹å ç”¨çš„æ˜¾å­˜</h3>
<h4 id="åŸºç¡€æ¨¡å‹çš„æƒé‡">åŸºç¡€æ¨¡å‹çš„æƒé‡</h4>
<ul>
<li>å®šä¹‰ï¼šé¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°çŸ©é˜µï¼Œå³é€‰æ‹©çš„é¢„è®­ç»ƒæ¨¡å‹æ‰€å ç”¨æ˜¾å­˜çš„å¤§å°ã€‚</li>
<li><strong>è®¡ç®—å…¬å¼</strong>ï¼š <strong>æ˜¾å­˜å ç”¨ = æ¨¡å‹å‚æ•°æ•°é‡ Ã—
å•ä¸ªå‚æ•°çš„å­—èŠ‚æ•°</strong></li>
</ul>
<h4 id="å¸¸è§æ¨¡å‹ç²¾åº¦ä¸‹çš„å•ä¸ªå‚æ•°æ˜¾å­˜å ç”¨">å¸¸è§æ¨¡å‹ç²¾åº¦ä¸‹çš„å•ä¸ªå‚æ•°æ˜¾å­˜å ç”¨ï¼š</h4>
<p>è¡¨æ ¼</p>
<p>å¤åˆ¶</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">ç²¾åº¦ç±»å‹</th>
<th style="text-align: left;">äºŒè¿›åˆ¶ä½æ•°</th>
<th style="text-align: left;">å­—èŠ‚æ•°</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">FP32</td>
<td style="text-align: left;">32ä½</td>
<td style="text-align: left;">4å­—èŠ‚</td>
</tr>
<tr class="even">
<td style="text-align: left;">FP16</td>
<td style="text-align: left;">16ä½</td>
<td style="text-align: left;">2å­—èŠ‚</td>
</tr>
<tr class="odd">
<td style="text-align: left;">BF16</td>
<td style="text-align: left;">16ä½</td>
<td style="text-align: left;">2å­—èŠ‚ï¼ˆæŒ‡æ•°ä½åŒFP32ï¼‰</td>
</tr>
<tr class="even">
<td style="text-align: left;">INT8</td>
<td style="text-align: left;">8ä½</td>
<td style="text-align: left;">1å­—èŠ‚</td>
</tr>
<tr class="odd">
<td style="text-align: left;">INT4</td>
<td style="text-align: left;">4ä½</td>
<td style="text-align: left;">0.5å­—èŠ‚</td>
</tr>
<tr class="even">
<td style="text-align: left;">INT2</td>
<td style="text-align: left;">2ä½</td>
<td style="text-align: left;">0.25å­—èŠ‚</td>
</tr>
</tbody>
</table>
<p>ä¾‹å¦‚</p>
<ul>
<li><strong>æ¨¡å‹é€‰æ‹©</strong>ï¼šQwen2.5-7B-Instruct</li>
<li><strong>å‚æ•°è§„æ¨¡</strong>ï¼š70äº¿ï¼ˆ7Bï¼‰</li>
<li><strong>è®¡ç®—ç²¾åº¦</strong>ï¼šBF16ï¼ˆ2å­—èŠ‚/å‚æ•°ï¼‰</li>
<li><strong>é¢„ä¼°æ˜¾å­˜å ç”¨</strong>ï¼š <strong>70äº¿ Ã— 2å­—èŠ‚ = 140äº¿å­—èŠ‚ =
14GB</strong></li>
</ul>
<h4 id="æ¡†æ¶å¼€é”€framework-overhead">æ¡†æ¶å¼€é”€ï¼ˆFramework Overheadï¼‰</h4>
<ul>
<li><strong>å®šä¹‰</strong>ï¼šLLaMAFactory åº•å±‚ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚
PyTorchï¼‰æœ¬èº«çš„æ˜¾å­˜å ç”¨ã€‚</li>
<li><strong>åŒ…å«å†…å®¹</strong>ï¼š
<ul>
<li>å¼ é‡ç¼“å­˜</li>
<li>çº¿ç¨‹èµ„æº</li>
<li>å†…æ ¸è°ƒåº¦å¼€é”€</li>
<li>è‡ªåŠ¨å¾®åˆ†å›¾ç»“æ„ç­‰</li>
</ul></li>
<li><strong>è®¡ç®—æ–¹æ³•</strong>ï¼šéš¾ä»¥ç²¾ç¡®è®¡ç®—</li>
<li><strong>ä¼°ç®—æ–¹æ³•</strong>ï¼šé€šå¸¸å ç”¨ä¸å¤§ï¼Œé»˜è®¤ä¼°ç®—ä¸º <strong>1
GB</strong></li>
</ul>
<h4 id="lora-é€‚é…å™¨lora-adapters">LoRA é€‚é…å™¨ï¼ˆLoRA Adaptersï¼‰</h4>
<ul>
<li><p><strong>å®šä¹‰</strong>ï¼šåœ¨ LoRA
å¾®è°ƒä¸­ï¼Œä¸ç›´æ¥ä¿®æ”¹åŸå§‹æ¨¡å‹çš„åºå¤§æƒé‡ï¼Œè€Œæ˜¯æ’å…¥è½»é‡çº§çš„â€œLoRAé€‚é…å™¨æ¨¡å—â€æ¥å­¦ä¹ å¾®è°ƒæ‰€éœ€çš„å˜åŒ–ã€‚</p></li>
<li><p><strong>è®¡ç®—æ–¹æ³•</strong>ï¼š</p>
<p>æ˜¾å­˜å ç”¨=LoRAå±‚æ•°Ã—ç§©ï¼ˆRankï¼‰Ã—(è¾“å…¥ç»´åº¦+è¾“å‡ºç»´åº¦)Ã—2<em>B</em></p></li>
<li><p><strong>ä¼°ç®—æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>ä¸ LoRA çš„ç§©ï¼ˆRankï¼‰å¤§å°ç›¸å…³</li>
<li>ä¸€èˆ¬å ç”¨ä¸å¤§ï¼Œå¸¸è§„é…ç½®ä¸‹é€šå¸¸ä¸è¶…è¿‡ <strong>0.5
GB</strong>ï¼Œä¿å®ˆä¼°è®¡ä¸º <strong>0.5 GB</strong></li>
</ul></li>
</ul>
<h4 id="æ¿€æ´»å€¼activations">æ¿€æ´»å€¼ï¼ˆActivationsï¼‰</h4>
<ul>
<li><p><strong>å®šä¹‰</strong>ï¼šå‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­å„å±‚çš„è¾“å‡ºå¼ é‡ï¼ˆå¦‚éšè—å±‚çŠ¶æ€ã€æ³¨æ„åŠ›çŸ©é˜µç­‰ï¼‰ï¼Œå³æ¨¡å‹â€œå¤„ç†æ•°æ®æ—¶äº§ç”Ÿçš„æ‰€æœ‰ä¸­é—´ç»“æœâ€ã€‚</p></li>
<li><p><strong>è®¡ç®—æ–¹æ³•</strong>ï¼š</p>
<p>æ˜¾å­˜å ç”¨=æ‰¹é‡å¤§å°Ã—åºåˆ—é•¿åº¦Ã—éšè—å±‚ç»´åº¦Ã—æ¨¡å‹å±‚æ•°Ã—å•ä¸ªå…ƒç´ å­—èŠ‚æ•°</p></li>
<li><p><strong>ä¼°ç®—æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>å•æ¬¡å¤„ç†çš„ Token é‡æ¯å¢åŠ  <strong>1K</strong>ï¼Œæ˜¾å­˜çº¦å¢åŠ 
<strong>2.5 GB</strong></li>
<li>ä¸å• GPU çš„æ‰¹é‡å¤§å°å’Œæ•°æ®é›†çš„æˆªæ–­é•¿åº¦ï¼ˆåºåˆ—é•¿åº¦ï¼‰æ­£ç›¸å…³</li>
<li>åœ¨å›ºå®šå…¶ä»–é…ç½®ï¼ˆåŸºç¡€æ¨¡å‹æƒé‡ã€æ¡†æ¶å¼€é”€ã€LoRAé€‚é…å™¨ï¼‰åï¼Œå‰©ä½™æ˜¾å­˜å³ä¸ºæ¿€æ´»å€¼å ç”¨</li>
</ul></li>
</ul>
<h3 id="åŠ é€Ÿæ–¹å¼">åŠ é€Ÿæ–¹å¼</h3>
<table>
<colgroup>
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 37%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>åŠ é€Ÿæ–¹å¼</th>
<th>å…¨ç§° / æ¥æº</th>
<th>æ ¸å¿ƒåŸç†ä¸ç‰¹ç‚¹</th>
<th>é€‚ç”¨åœºæ™¯ä¸æ³¨æ„äº‹é¡¹</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>auto</strong></td>
<td>è‡ªåŠ¨é€‰æ‹©</td>
<td>ç”±æ¡†æ¶ï¼ˆå¦‚ transformersã€LLaMA-Factoryã€DeepSpeed
ç­‰ï¼‰æ ¹æ®å½“å‰ç¡¬ä»¶ã€é©±åŠ¨ã€CUDA ç‰ˆæœ¬è‡ªåŠ¨æŒ‘é€‰æœ€å¿«çš„å¯ç”¨ç®—å­æˆ–è·¯å¾„ã€‚
ä¼˜ç‚¹ï¼šé›¶é…ç½®ã€å¼€ç®±å³ç”¨ï¼›ç¼ºç‚¹ï¼šä¸ä¸€å®šèƒ½å¯ç”¨æœ€æ–°ã€æœ€å¿«çš„å†…æ ¸ã€‚</td>
<td>åˆæ¬¡å®éªŒã€ä¸æƒ³æ‰‹åŠ¨è°ƒå‚æ—¶é¦–é€‰ã€‚</td>
</tr>
<tr class="even">
<td><strong>flashattn2</strong></td>
<td>FlashAttention-2</td>
<td>é€šè¿‡ IO-Aware çš„ç®—æ³•å’Œ GPU Tensor Core ä¼˜åŒ–ï¼Œå°†æ ‡å‡† Multi-Head
Attention çš„æ˜¾å­˜è®¿é—®æ¬¡æ•°å¤§å¹…é™ä½ï¼Œä»è€Œæ˜¾è‘—åŠ å¿«è®­ç»ƒ/æ¨ç†é€Ÿåº¦ï¼ˆé€šå¸¸
2-4Ã—ï¼‰ï¼Œå¹¶å‡å°‘æ˜¾å­˜å ç”¨ã€‚ éœ€è¦ A100ã€H100ã€RTX 30/40 ç³»åˆ—ç­‰
Ampere/Lovelace æ¶æ„ï¼›ä¾èµ– CUDAâ‰¥11.8ã€PyTorchâ‰¥2.0 ä¸”éœ€å®‰è£…
<code>flash-attn</code> wheelã€‚</td>
<td>è®­ç»ƒ/å¾®è°ƒ LLM æ—¶é¦–é€‰ï¼›åºåˆ—è¶Šé•¿æ”¶ç›Šè¶Šå¤§ã€‚è‹¥ç¼–è¯‘å¤±è´¥å¯é€€å› xformers
æˆ–åŸç”Ÿå®ç°ã€‚</td>
</tr>
<tr class="odd">
<td><strong>unsloth</strong></td>
<td>Unsloth å¼€æºåº“</td>
<td>é’ˆå¯¹ Llamaã€Mistralã€Qwen ç­‰æ¶æ„ï¼Œä½¿ç”¨åŠ¨æ€é‡åŒ–ã€æ‰‹å·¥ fused-kernel
å’Œæ¢¯åº¦æ£€æŸ¥ç‚¹ä¼˜åŒ–ï¼Œä½¿ LoRA å¾®è°ƒåœ¨æ¶ˆè´¹çº§ GPU ä¸Šä¹Ÿèƒ½è·‘æ›´å¤§
batch/æ›´é•¿åºåˆ—ã€‚å®˜æ–¹å®£ç§°é€Ÿåº¦æå‡ 2-5Ã—ï¼Œæ˜¾å­˜èŠ‚çœ 50-70%ã€‚
å®‰è£…ç®€å•ï¼š<code>pip install unsloth</code>ï¼ˆä¼šè‡ªåŠ¨æ›¿æ¢éƒ¨åˆ† PyTorch
å±‚ï¼‰ã€‚</td>
<td>å•å¡ 4090/3090 ä¸Š LoRA å¾®è°ƒ 7B-13B
æ¨¡å‹æ•ˆæœæœ€ä½³ï¼›ç›®å‰ä»…æ”¯æŒæœ‰é™æ¨¡å‹ã€‚</td>
</tr>
<tr class="even">
<td><strong>liger_kernel</strong></td>
<td>Liger-Kernelï¼ˆå¾®è½¯å¼€æºï¼‰</td>
<td>ä»¥ Triton ç¼–å†™çš„é«˜æ€§èƒ½ fused-kernel
åˆé›†ï¼ˆSwiGLUã€RMSNormã€CrossEntropyã€RoPE ç­‰ï¼‰ï¼Œåœ¨ä¿æŒæ•°å€¼ç²¾åº¦çš„åŒæ—¶å‡å°‘
kernel launch å’Œæ˜¾å­˜å†™å›ï¼Œè®­ç»ƒååé‡å¯æå‡ 10-20%ã€‚ çº¯ Python/Triton
å®ç°ï¼Œæ— éœ€é¢å¤– CUDA ç¼–è¯‘ã€‚</td>
<td>å¯¹è®­ç»ƒæ¡†æ¶ä¾µå…¥æ€§å°ï¼Œå¯ä¸ FlashAttention å¹¶å­˜ï¼›é€‚åˆæƒ³â€œæ— ç—›â€æé€Ÿ
10-20% çš„åœºæ™¯ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://llamafactory.readthedocs.io/zh-cn/latest/">LLaMA
Factory</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/qwen3-8b%E5%BE%AE%E8%B0%83%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/qwen3-8b%E5%BE%AE%E8%B0%83%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">qwen3-8bå¾®è°ƒå®æˆ˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-12 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-12T00:00:00+08:00">2025-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-13 15:10:05" itemprop="dateModified" datetime="2025-08-13T15:10:05+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">æ¨¡å‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E5%9E%8B/%E5%BE%AE%E8%B0%83/" itemprop="url" rel="index"><span itemprop="name">å¾®è°ƒ</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€">å‰è¨€</h3>
<p>åœ¨å®Œæˆå¾®è°ƒå‰å¤‡çŸ¥è¯†çš„å­¦ä¹ åï¼Œæ­£å¼å¼€å§‹ä½¿ç”¨unslothå¯¹Qwen3-8B-unsloth-bnb-4bitæ¨¡å‹çš„loraå¾®è°ƒå®æˆ˜</p>
<h3 id="æ¨¡å‹åŠ è½½">æ¨¡å‹åŠ è½½</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from unsloth import FastLanguageModel</span><br><span class="line">import torch</span><br><span class="line"></span><br><span class="line">max_seq_length = 8192</span><br><span class="line">dtype = None</span><br><span class="line">load_in_4bit = True</span><br><span class="line"></span><br><span class="line">model, tokenizer = FastLanguageModel.from_pretrained(</span><br><span class="line">    model_name = &quot;/workspace/qwen3-8b&quot;,</span><br><span class="line">    max_seq_length = max_seq_length,</span><br><span class="line">    dtype = dtype,</span><br><span class="line">    load_in_4bit = load_in_4bit,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>FastLanguageModel</code> æ˜¯ <strong>Unsloth
æ¡†æ¶çš„æ ¸å¿ƒå…¥å£ç±»</strong>ï¼Œå³<strong>â€œæŠŠ Hugging Face çš„ transformers
æ¨¡å‹â€˜åŠ é€Ÿâ€™æˆæ”¯æŒ QLoRA å¾®è°ƒã€æ˜¾å­˜å ç”¨å‡åŠã€é€Ÿåº¦æå‡ 2-5
å€çš„å°è£…å™¨ã€‚â€</strong></p>
<p><code>max_seq_length = 8192</code><strong>ä½œç”¨</strong>ï¼šå‘Šè¯‰æ¡†æ¶
<strong>â€œåç»­æ‰€æœ‰è¾“å…¥åºåˆ—çš„æœ€å¤§é•¿åº¦â€</strong>ã€‚<strong>å†…éƒ¨ä¸€æ¬¡æ€§ä¸ºä½ç½®ç¼–ç ã€æ³¨æ„åŠ›æ©ç ã€KV-Cache
ç­‰å¼€è¾Ÿçš„å¼ é‡å°ºå¯¸</strong>ï¼Œå› æ­¤æ˜¾å­˜éšå®ƒ
<strong>å¹³æ–¹çº§å¢é•¿</strong>ã€‚</p>
<p><code>dtype = None</code><strong>ä½œç”¨</strong>ï¼šè®© Unsloth
<strong>è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æµ®ç‚¹ç²¾åº¦</strong>ã€‚</p>
<p><code>load_in_4bit = True</code><strong>ä½œç”¨</strong>ï¼šæŠŠæ¨¡å‹<strong>æƒé‡é‡åŒ–æˆ
4-bit</strong>ï¼Œæ˜¾å­˜é™åˆ° 1/4ï¼ŒQLoRA å¾®è°ƒå¿…å¤‡ã€‚</p>
</blockquote>
<h3 id="æŸ¥çœ‹æ¨¡å‹ä¸åˆ†è¯å™¨ä¿¡æ¯">æŸ¥çœ‹æ¨¡å‹ä¸åˆ†è¯å™¨ä¿¡æ¯</h3>
<h4 id="æ¨¡å‹ä¿¡æ¯">æ¨¡å‹ä¿¡æ¯</h4>
<p>è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡é˜…è¯»æ¨¡å‹ä¿¡æ¯æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(embed_tokens): Embedding(151936, 4096, padding_idx=151654)</span><br></pre></td></tr></table></figure>
<p><strong>æ¨¡å‹æœ‰ 15 ä¸‡ä¸ª token çš„å­—å…¸ï¼Œæ¯ä¸ªå­—/è¯è¢«ç¿»è¯‘æˆ 4096
ç»´å‘é‡ï¼Œç¬¬ 151 654 å· token è¢«å®˜æ–¹æŒ‡å®šä¸ºå¡«å……ç¬¦ã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(layers): ModuleList(</span><br><span class="line">      (0-2): 3 x Qwen3DecoderLayer(</span><br><span class="line">        (self_attn): Qwen3Attention(</span><br><span class="line">          (q_proj): Linear4bit(in_features=4096, out_features=4096, bias=False)</span><br><span class="line">          (k_proj): Linear4bit(in_features=4096, out_features=1024, bias=False)</span><br><span class="line">          (v_proj): Linear4bit(in_features=4096, out_features=1024, bias=False)</span><br><span class="line">          (o_proj): Linear4bit(in_features=4096, out_features=4096, bias=False)</span><br><span class="line">          (q_norm): Qwen3RMSNorm((128,), eps=1e-06)</span><br><span class="line">          (k_norm): Qwen3RMSNorm((128,), eps=1e-06)</span><br><span class="line">          (rotary_emb): LlamaRotaryEmbedding()</span><br><span class="line">        )</span><br><span class="line">        (mlp): Qwen3MLP(</span><br><span class="line">          (gate_proj): Linear(in_features=4096, out_features=12288, bias=False)</span><br><span class="line">          (up_proj): Linear(in_features=4096, out_features=12288, bias=False)</span><br><span class="line">          (down_proj): Linear(in_features=12288, out_features=4096, bias=False)</span><br><span class="line">          (act_fn): SiLU()</span><br><span class="line">        )</span><br><span class="line">        (input_layernorm): Qwen3RMSNorm((4096,), eps=1e-06)</span><br><span class="line">        (post_attention_layernorm): Qwen3RMSNorm((4096,), eps=1e-06)</span><br><span class="line">      )</span><br></pre></td></tr></table></figure>
<p>å…±æœ‰36å±‚<strong>Qwen3DecoderLayer</strong>ï¼Œæ¯å±‚åŒ…å«<strong>Qwen3Attention</strong>ï¼Œ<strong>Qwen3MLP</strong>ï¼ˆ<strong>ä¸€ä¸ª
SwiGLU
å‰é¦ˆç½‘ç»œ</strong>ï¼‰ï¼Œ<strong>Qwen3RMSNorm</strong>ï¼ˆä¸¤ä¸ª<strong>å½’ä¸€åŒ–å±‚</strong>ï¼Œå¯¹
4096 ç»´çš„éšè—å‘é‡åšâ€œå‡æ–¹æ ¹å½’ä¸€åŒ–â€ï¼Œé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ã€ç¨³å®šè®­ç»ƒã€‚ï¼‰</p>
<figure>
<img src="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/qwen3-8b%E5%BE%AE%E8%B0%83%E5%AE%9E%E6%88%98/image-20250812153659843.png" alt="image-20250812153659843">
<figcaption aria-hidden="true">image-20250812153659843</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/cavalier-chen/p/18937098">å¤§æ¨¡å‹-qwen3
æ¨¡å‹ç»“æ„è§£è¯»-66 - jack-chen666 - åšå®¢å›­</a></p>
<blockquote>
<p><strong>LoRAå¯ä»¥æ’åˆ°å“ªé‡Œå‘¢ï¼Ÿ</strong></p>
<p><strong>å‡¡æ˜¯æ‰“å°é‡Œæ¯å±‚ Decoder ä¸­å‡ºç°çš„
<code>Linear4bit</code>ï¼ˆq/k/v/o + gate/up/downï¼‰å°±æ˜¯ LoRA
å¯æ’ã€ä¸”é»˜è®¤ä¼šè¢«æ’å…¥çš„ä½ç½®ã€‚</strong></p>
</blockquote>
<h4 id="åˆ†è¯å™¨ä¿¡æ¯">åˆ†è¯å™¨ä¿¡æ¯</h4>
<p>è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tokenizer</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹tokenizerä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Qwen2TokenizerFast(name_or_path=&#x27;/workspace/qwen3-8b&#x27;, vocab_size=151643, model_max_length=40960, is_fast=True, padding_side=&#x27;left&#x27;, truncation_side=&#x27;right&#x27;, special_tokens=&#123;&#x27;eos_token&#x27;: &#x27;&lt;|im_end|&gt;&#x27;, &#x27;pad_token&#x27;: &#x27;&lt;|vision_pad|&gt;&#x27;, &#x27;additional_special_tokens&#x27;: [&#x27;&lt;|im_start|&gt;&#x27;, &#x27;&lt;|im_end|&gt;&#x27;, &#x27;&lt;|object_ref_start|&gt;&#x27;, &#x27;&lt;|object_ref_end|&gt;&#x27;, &#x27;&lt;|box_start|&gt;&#x27;, &#x27;&lt;|box_end|&gt;&#x27;, &#x27;&lt;|quad_start|&gt;&#x27;, &#x27;&lt;|quad_end|&gt;&#x27;, &#x27;&lt;|vision_start|&gt;&#x27;, &#x27;&lt;|vision_end|&gt;&#x27;, &#x27;&lt;|vision_pad|&gt;&#x27;, &#x27;&lt;|image_pad|&gt;&#x27;, &#x27;&lt;|video_pad|&gt;&#x27;]&#125;, clean_up_tokenization_spaces=False, added_tokens_decoder=&#123;</span><br><span class="line">	151643: AddedToken(&quot;&lt;|endoftext|&gt;&quot;, rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),</span><br><span class="line">	151644: AddedToken(&quot;&lt;|im_start|&gt;&quot;, rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),</span><br><span class="line">	151645: AddedToken(&quot;&lt;|im_end|&gt;&quot;, rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),</span><br><span class="line">	151646: AddedToken(&quot;&lt;|object_ref_start|&gt;&quot;, rstrip=False, lstrip=False, single_word=False, normalized=False, special=True),</span><br><span class="line">	æˆªå–éƒ¨åˆ†</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>vocab_size=151643ï¼š<strong>æ¨¡å‹çœŸæ­£èƒ½ç†è§£å’Œç”Ÿæˆçš„å­è¯/ç¬¦å·æœ‰è¿™ 151643
ç§ï¼Œå…¶ä½™ä½ç½®æ˜¯é¢„ç•™ç©ºç™½ã€‚</strong></p>
<p>model_max_length=40960ï¼š<strong>ç†è®ºæœ€å¤§è¾“å…¥é•¿åº¦ 40k
token</strong>ï¼ˆå®é™…å—æ˜¾å­˜é™åˆ¶ï¼‰</p>
<p>is_fast=Trueï¼šè¡¨ç¤º <strong>tokenizer ä½¿ç”¨çš„æ˜¯ Hugging Face çš„ã€ŒRust
é«˜é€Ÿå®ç°ã€</strong>ï¼ˆå³ <em>tokenizers</em> åº“ï¼‰</p>
<p>special_tokensï¼šæ‰“å°çš„ <code>special_tokens</code> å­—å…¸ &amp;
<code>added_tokens_decoder</code> å·²ç»æŠŠ <strong>151643-151668</strong>
å…¨éƒ¨åˆ—å‡ºï¼Œå…± <strong>26 ä¸ª</strong>ã€‚</p>
<h3 id="æ¨¡æ‹Ÿä¸€æ¬¡æ¨¡å‹å¤„ç†æµç¨‹">æ¨¡æ‹Ÿä¸€æ¬¡æ¨¡å‹å¤„ç†æµç¨‹</h3>
<p>å°†å¯¹è¯å†…å®¹é€šè¿‡tokenizerè¿›è¡Œå¤„ç†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">messages = [</span><br><span class="line">    &#123;&quot;role&quot; : &quot;user&quot;, &quot;content&quot; : &quot;ä½ å¥½ï¼Œå¥½ä¹…ä¸è§ï¼&quot;&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">text = tokenizer.apply_chat_template(</span><br><span class="line">    messages,</span><br><span class="line">    tokenize = False,</span><br><span class="line">    add_generation_prompt = True, </span><br><span class="line">    enable_thinking = False, # è®¾ç½®ä¸æ€è€ƒ</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><code>apply_chat_template</code> æ˜¯æŠŠã€Œäººç±»å¯¹è¯æ ¼å¼çš„ Python
åˆ—è¡¨ã€ä¸€é”®ç¿»è¯‘æˆ <strong>æ¨¡å‹èƒ½ç›´æ¥ç†è§£çš„å¸¦ç‰¹æ®Šæ ‡è®°çš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼ˆæˆ–
token id åºåˆ—ï¼‰</strong> çš„â€œå®˜æ–¹æ¨¡æ¿å¼•æ“â€ã€‚</p>
<p>è½¬åŒ–åçš„æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;|im_start|&gt;user\nä½ å¥½ï¼Œå¥½ä¹…ä¸è§ï¼&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n&lt;think&gt;\n\n&lt;/think&gt;\n\n&#x27;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°†è½¬åŒ–åçš„å­—ç¬¦ä¸²<strong>è½¬æˆ GPU ä¸Šçš„ PyTorch token
å¼ é‡ï¼Œå‡†å¤‡ç›´æ¥é€è¿›æ¨¡å‹æ¨ç†æˆ–è®­ç»ƒã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inputs = tokenizer(text, return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç å…±åšäº†ä¸‰æ­¥ï¼š</p>
<ol type="1">
<li><strong>tokenizer(text)</strong> æŠŠå‰é¢
<code>apply_chat_template</code> å¾—åˆ°çš„å­—ç¬¦ä¸²æŒ‰è¯è¡¨åˆ‡æˆ <strong>token id
åˆ—è¡¨</strong>ã€‚</li>
<li><strong>return_tensors=â€œptâ€</strong> æŠŠåˆ—è¡¨åŒ…æˆ <strong>PyTorch
å¼ é‡</strong>ï¼ˆshape = [1, seq_len]ï¼‰ã€‚</li>
<li><strong>.to(â€œcudaâ€)</strong> æŠŠå¼ é‡æ¬åˆ° <strong>GPU
æ˜¾å­˜</strong>ã€‚</li>
</ol>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;input_ids&#x27;: tensor([[151644,    872,    198, 108386,   3837, 111920, 101571,   6313, 151645,</span><br><span class="line">            198, 151644,  77091,    198, 151667,    271, 151668,    271]],</span><br><span class="line">       device=&#x27;cuda:0&#x27;), &#x27;attention_mask&#x27;: tensor([[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]], device=&#x27;cuda:0&#x27;)&#125;</span><br></pre></td></tr></table></figure>
<table>
<colgroup>
<col style="width: 24%">
<col style="width: 11%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>é”®</th>
<th>å½¢çŠ¶</th>
<th>æ¯ä¸ªæ•°å­—çš„å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>input_ids</strong></td>
<td><code>[1, 17]</code></td>
<td>17 ä¸ª token çš„ ID åˆ—è¡¨ï¼Œå·²æ”¾åˆ° GPU</td>
</tr>
<tr class="even">
<td><strong>attention_mask</strong></td>
<td><code>[1, 17]</code></td>
<td>17 ä¸ª <strong>1</strong>ï¼Œè¡¨ç¤ºâ€œè¿™äº›ä½ç½®éƒ½æ˜¯æœ‰æ•ˆ tokenï¼Œæ— å¡«å……â€</td>
</tr>
</tbody>
</table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">outputs = model.generate(</span><br><span class="line">    input_ids=inputs.input_ids,</span><br><span class="line">    attention_mask=inputs.attention_mask,</span><br><span class="line">    max_new_tokens=max_seq_length,</span><br><span class="line">    use_cache=True,#å¯ç”¨ KV-Cacheï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œæ˜¾å­˜æ¢æ—¶é—´</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è®©æ¨¡å‹åœ¨ GPU ä¸Š <strong>æ ¹æ®å·²æœ‰ token
ç»§ç»­ç”Ÿæˆæ–‡æœ¬</strong>ï¼Œç›´åˆ°è¾¾åˆ° <code>max_new_tokens</code>
æˆ–é‡åˆ°ç»ˆæ­¢ç¬¦ã€‚</p>
<p>outputsæ ¼å¼å’Œinputsç±»ä¼¼ï¼Œä½¿ç”¨nput_idsè¡¨ç¤ºåç»­å­—ç¬¦</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = tokenizer.batch_decode(outputs)</span><br></pre></td></tr></table></figure>
<p>æŠŠæ¨¡å‹è¾“å‡ºçš„ <strong>token id
åºåˆ—</strong>ï¼ˆ<code>outputs</code>ï¼‰ä¸€æ¬¡æ€§è¿˜åŸæˆ
<strong>äººç±»å¯è¯»çš„å­—ç¬¦ä¸²</strong>ã€‚</p>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;|im_start|&gt;user\nä½ å¥½ï¼Œå¥½ä¹…ä¸è§ï¼&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n&lt;think&gt;\n\n&lt;/think&gt;\n\nä½ å¥½ï¼å¥½ä¹…ä¸è§ï¼æœ€è¿‘è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæ–°é²œäº‹æƒ³å’Œæˆ‘åˆ†äº«å—ï¼ŸğŸ˜Š&lt;|im_end|&gt;&#x27;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå±•ç¤ºçš„æ˜¯æ²¡æœ‰æ€è€ƒè¿‡ç¨‹çš„ï¼Œæœ€ç®€å•å¯¹è¯æµç¨‹ï¼Œè‹¥è®¾ç½®æ€è€ƒæ¨¡å¼ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">text = tokenizer.apply_chat_template(</span><br><span class="line">    messages,</span><br><span class="line">    tools = tools,#åŒæ ·ï¼Œå¯ä»¥è®¾ç½®function calling</span><br><span class="line">    tokenize = False,</span><br><span class="line">    add_generation_prompt = True, </span><br><span class="line">    enable_thinking = True, # è®¾ç½®æ€è€ƒ</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">inputs = tokenizer(text, return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)</span><br><span class="line"></span><br><span class="line">outputs = model.generate(</span><br><span class="line">    input_ids=inputs.input_ids,</span><br><span class="line">    attention_mask=inputs.attention_mask,</span><br><span class="line">    max_new_tokens=max_seq_length,</span><br><span class="line">    use_cache=True,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response = tokenizer.batch_decode(outputs)</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œé™¤äº†ä½¿ç”¨ä¸Šè¿°åº•å±‚APIè¿›è¡Œå¯¹è¯å¤–ï¼ŒUnslothè¿˜æä¾›äº†æ›´åŠ ä¾¿æ·çš„æµå¼è¾“å‡ºæ¨¡å‹å¯¹è¯ä¿¡æ¯çš„å‡½æ•°ï¼ŒåŸºæœ¬å¯¹è¯æ•ˆæœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">messages = [</span><br><span class="line">    &#123;&quot;role&quot; : &quot;user&quot;, &quot;content&quot; : &quot;ä½ å¥½ï¼Œå¥½ä¹…ä¸è§ï¼&quot;&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">text = tokenizer.apply_chat_template(</span><br><span class="line">    messages,</span><br><span class="line">    tokenize = False,</span><br><span class="line">    add_generation_prompt = True, </span><br><span class="line">    enable_thinking = False, </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">_ = model.generate(</span><br><span class="line">    **tokenizer(text, return_tensors = &quot;pt&quot;).to(&quot;cuda&quot;),</span><br><span class="line">    max_new_tokens = 256, # Increase for longer outputs!</span><br><span class="line">    temperature = 0.7, top_p = 0.8, top_k = 20, # For non thinking</span><br><span class="line">    streamer = TextStreamer(tokenizer, skip_prompt = True),#å®æ—¶æµå¼è¾“å‡ºï¼šæ¯è§£ç ä¸€ä¸ª token å°±ç«‹åˆ»æ‰“å°åˆ°ç»ˆç«¯</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="å‡†å¤‡æ•°æ®é›†">å‡†å¤‡æ•°æ®é›†</h3>
<h4 id="ä¸‹è½½æ•°æ®é›†">ä¸‹è½½æ•°æ®é›†</h4>
<p>é€‰å–çš„ä¸¤ä¸ªæ•°æ®é›†</p>
<ol type="1">
<li>æˆ‘ä»¬ä½¿ç”¨ Open Math Reasoning æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†æ›¾è¢«ç”¨äºèµ¢å¾— AIMOï¼ˆAI
æ•°å­¦å¥¥æ—åŒ¹å…‹ - ç¬¬äºŒå±Šè¿›æ­¥å¥–ï¼‰æŒ‘æˆ˜ï¼æˆ‘ä»¬ä»ä¸­æŠ½å–äº† 10%
å¯éªŒè¯çš„æ¨ç†è½¨è¿¹ï¼Œè¿™äº›è½¨è¿¹æ˜¯åŸºäº DeepSeek R1 æ¨¡å‹ç”Ÿæˆçš„ï¼Œå¹¶ä¸”å‡†ç¡®ç‡è¶…è¿‡
95%ã€‚æ•°æ®é›†åœ°å€ï¼šhttps://huggingface.co/datasets/unsloth/OpenMathReasoning-mini</li>
<li>æˆ‘ä»¬è¿˜åˆ©ç”¨äº† Maxime Labonne çš„ FineTome-100k
æ•°æ®é›†ï¼Œè¯¥æ•°æ®é›†é£æ ¼ç±»ä¼¼ ShareGPTã€‚ä½†æˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸º HuggingFace
é€šç”¨çš„å¤šè½®å¯¹è¯æ ¼å¼ã€‚æ•°æ®é›†åœ°å€ï¼šhttps://huggingface.co/datasets/mlabonne/FineTome-100k</li>
</ol>
<p>åœ¨å®é™…å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œå¤§å¤šéƒ½ä¼šä½¿ç”¨huggingfaceçš„datasetsåº“è¿›è¡Œæ•°æ®é›†ä¸‹è½½å’Œç®¡ç†ï¼Œå®é™…ä¸‹è½½æµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install --upgrade datasets huggingface_hub</span><br></pre></td></tr></table></figure>
<p><code>datasets</code> æ˜¯ Hugging Face
æä¾›çš„ä¸€ä¸ªé«˜æ•ˆæ•°æ®å¤„ç†åº“ï¼Œä¸“ä¸ºæœºå™¨å­¦ä¹ å’Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è®­ç»ƒè€Œè®¾è®¡ã€‚å®ƒæ”¯æŒåŠ è½½ã€å¤„ç†ã€è½¬æ¢å’Œä¿å­˜å„ç§æ ¼å¼çš„æ•°æ®ï¼ˆå¦‚
JSONã€CSVã€Parquet ç­‰ï¼‰ï¼Œå¹¶èƒ½ä¸ <code>transformers</code>
æ¨¡å‹æ— ç¼é›†æˆã€‚é€šè¿‡
<code>datasets</code>ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿå®Œæˆæ•°æ®æ¸…æ´—ã€åˆ‡åˆ†ã€tokenization
ç­‰å¸¸è§ä»»åŠ¡ï¼Œå¤§å¤§æå‡è®­ç»ƒæ•ˆç‡ï¼Œç‰¹åˆ«é€‚åˆç”¨äºæŒ‡ä»¤å¾®è°ƒã€å¯¹è¯ç”Ÿæˆã€Function
Calling ç­‰ä»»åŠ¡çš„æ•°æ®é¢„å¤„ç†ã€‚</p>
<p>ç„¶ååˆ†åˆ«ä¸‹è½½å¹¶å¯¼å…¥è¿™ä¸¤ä¸ªåº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reasoning_dataset = load_dataset(&quot;unsloth/OpenMathReasoning-mini&quot;, split = &quot;cot&quot;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>cotå…¨ç§°ä¸º<strong>Chain-of-Thoughtï¼Œæ€ç»´é“¾</strong>ï¼Œæ˜¯ã€Œ<strong>ä¸€æ­¥ä¸€æ­¥æŠŠæ€è€ƒè¿‡ç¨‹å†™å‡ºæ¥</strong>ã€çš„è§£é¢˜æ–¹å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚</p>
<p><strong>åªä¸‹ cot
æ˜¯å› ä¸ºä»»åŠ¡åªéœ€è¦â€œå¸¦æ¨ç†è¿‡ç¨‹â€çš„é‚£éƒ¨åˆ†æ•°æ®ï¼Œå…¶ä»–å­é›†å¯¹å½“å‰å¾®è°ƒç›®æ ‡æ— ç”¨ï¼Œé¿å…å†—ä½™ä¸‹è½½ã€‚</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">non_reasoning_dataset = load_dataset(&quot;mlabonne/FineTome-100k&quot;, split = &quot;train&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥çœ‹æ•°æ®é›†">æŸ¥çœ‹æ•°æ®é›†</h4>
<p>ç„¶åè¾“å…¥æ•°æ®é›†åç§°ï¼Œå³å¯æŸ¥çœ‹æ•°æ®é›†åŸºæœ¬ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reasoning_dataset</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Dataset(&#123;</span><br><span class="line">    features: [&#x27;expected_answer&#x27;, &#x27;problem_type&#x27;, &#x27;problem_source&#x27;, &#x27;generation_model&#x27;, &#x27;pass_rate_72b_tir&#x27;, &#x27;problem&#x27;, &#x27;generated_solution&#x27;, &#x27;inference_mode&#x27;],</span><br><span class="line">    num_rows: 19252</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>ä¸€å…± 19 252 æ¡</strong>
<strong>CoTï¼ˆæ€ç»´é“¾ï¼‰æ•°å­¦é¢˜</strong>ï¼Œæ¯æ¡åŒ…å« 8
ä¸ªå­—æ®µï¼Œå¯ç›´æ¥ç”¨æ¥è®­ç»ƒ/è¯„ä¼°æ¨¡å‹çš„é€æ­¥æ¨ç†èƒ½åŠ›ã€‚</p>
<p>generated_solutionï¼šæ¨¡å‹è‡ªå·±å†™çš„ é€æ­¥æ¨ç† + æœ€ç»ˆç­”æ¡ˆï¼ˆå°±æ˜¯ä½ æƒ³è¦çš„
CoTï¼‰</p>
<p>expected_answerï¼šæ ‡å‡†ç­”æ¡ˆï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç®€æ´æ•°å­—æˆ–è¡¨è¾¾å¼ï¼‰</p>
<p>generation_modelï¼šç”Ÿæˆè¿™æ¡ CoT çš„â€œæ•™å¸ˆæ¨¡å‹â€åå­—ï¼Œæ¯”å¦‚ qwen2-72b</p>
<p>åŠ ä¸Šç´¢å¼•åˆ™å¯ä»¥ç›´æ¥æŸ¥çœ‹å¯¹åº”æ•°æ®é›†ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reasoning_dataset[0]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;expected_answer&#x27;: &#x27;14&#x27;,</span><br><span class="line"> &#x27;problem_type&#x27;: &#x27;has_answer_extracted&#x27;,</span><br><span class="line"> &#x27;problem_source&#x27;: &#x27;aops_c4_high_school_math&#x27;,</span><br><span class="line"> &#x27;generation_model&#x27;: &#x27;DeepSeek-R1&#x27;,</span><br><span class="line"> &#x27;pass_rate_72b_tir&#x27;: &#x27;0.96875&#x27;,</span><br><span class="line"> &#x27;problem&#x27;: &#x27;Given $\\sqrt&#123;x^2+165&#125;-\\sqrt&#123;x^2-52&#125;=7$ and $x$ is positive, find all possible values of $x$.&#x27;,</span><br><span class="line"> &#x27;generated_solution&#x27;: &quot;&lt;think&gt;\nOkay, let&#x27;s see. I need to solve the equation âˆš(xÂ² + 165) - âˆš(xÂ² - 52) = 7, aæˆªå–éƒ¨åˆ†&quot;,</span><br><span class="line"> &#x27;inference_mode&#x27;: &#x27;cot&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>èƒ½å¤Ÿçœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªåŸºäºDeepSeek
R1å›ç­”çš„æ•°å­¦æ•°æ®é›†ï¼Œå…¶ä¸­<code>problem</code>æ˜¯é—®é¢˜ï¼Œ<code>generated_solution</code>æ˜¯æ•°å­¦æ¨å¯¼è¿‡ç¨‹ï¼ˆå³æ€è€ƒè¿‡ç¨‹ï¼‰ï¼Œè€Œ<code>expected_answer</code>åˆ™æ˜¯æœ€ç»ˆçš„ç­”æ¡ˆã€‚è¯¥æ•°æ®é›†æ€»å…±æ¥è¿‘2ä¸‡æ¡æ•°æ®</p>
<p>è€Œå¯¹è¯æ•°æ®é›†å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">non_reasoning_dataset</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Dataset(&#123;</span><br><span class="line">    features: [&#x27;conversations&#x27;, &#x27;source&#x27;, &#x27;score&#x27;],</span><br><span class="line">    num_rows: 100000</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">non_reasoning_dataset[0]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;conversations&#x27;: [&#123;&#x27;from&#x27;: &#x27;human&#x27;,</span><br><span class="line">   &#x27;value&#x27;: &#x27;Explain what boolean operators are, what they do, and provide examples of how they can be used in programming. Additionally, describe the concept of operator precedence and provæˆªå–&#x27;&#125;,</span><br><span class="line">  &#123;&#x27;from&#x27;: &#x27;gpt&#x27;,</span><br><span class="line">   &#x27;value&#x27;: &#x27;Boolean operators are logical operators used in programming to manipulate boolean values. Theæˆªå–&#x27;&#125;],</span><br><span class="line"> &#x27;source&#x27;: &#x27;infini-instruct-top-500k&#x27;,</span><br><span class="line"> &#x27;score&#x27;: 5.212620735168457&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æ¯ä¸€æ¡æ•°æ®éƒ½æ˜¯ä¸€ä¸ªå¯¹è¯ï¼ŒåŒ…å«ä¸€ç»„æˆ–è€…å¤šç»„ChatGPTçš„èŠå¤©ä¿¡æ¯ï¼Œå…¶ä¸­<code>from</code>ä»£è¡¨æ˜¯ç”¨æˆ·æ¶ˆæ¯è¿˜æ˜¯å¤§æ¨¡å‹å›å¤æ¶ˆæ¯ï¼Œè€Œ<code>value</code>åˆ™æ˜¯å¯¹åº”çš„æ–‡æœ¬ã€‚è¯¥å¯¹è¯æ•°æ®é›†æ€»å…±åŒ…å«10ä¸‡æ¡æ•°æ®</p>
<p>èƒ½å¤Ÿçœ‹å‡ºdatasetæ˜¯ä¸€ç§ç±»ä¼¼jsonçš„æ•°æ®æ ¼å¼ï¼Œæ¯æ¡æ•°æ®éƒ½ä»¥å­—æ®µæ ¼å¼è¿›è¡Œå­˜å‚¨ï¼Œåœ¨å®é™…å¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†æ•°æ®é›†çš„ç›®æ ‡å­—æ®µè¿›è¡Œæå–å’Œæ‹¼æ¥ï¼Œç„¶ååŠ è½½åˆ°Qwen3æ¨¡å‹çš„æç¤ºè¯æ¨¡æ¿ä¸­ï¼Œå¹¶æœ€ç»ˆå¸¦å…¥Unslothè¿›è¡Œå¾®è°ƒã€‚</p>
<h3 id="æ•°æ®é›†æ¸…æ´—">æ•°æ®é›†æ¸…æ´—</h3>
<h4 id="å¯¹è¯æ•°æ®é›†çš„æ¸…æ´—">å¯¹è¯æ•°æ®é›†çš„æ¸…æ´—</h4>
<p>æ¥ä¸‹æ¥å°è¯•å¯¹ä¸Šè¿°ä¸¤ä¸ªæ ¼å¼å„å¼‚çš„æ•°æ®é›†è¿›è¡Œæ•°æ®æ¸…æ´—ï¼Œä¸»è¦æ˜¯å›´ç»•æ•°æ®é›†è¿›è¡Œ<strong>æ•°æ®æ ¼å¼</strong>çš„è°ƒæ•´ï¼Œä¾¿äºåç»­<strong>å¸¦å…¥Qwen3æç¤ºè¯æ¨¡æ¿</strong>ã€‚å¯¹äºdatasetæ ¼å¼çš„æ•°æ®å¯¹è±¡æ¥è¯´ï¼Œå¯ä»¥å…ˆåˆ›å»ºæ»¡è¶³æ ¼å¼è°ƒæ•´çš„å‡½æ•°ï¼Œç„¶åä½¿ç”¨mapæ–¹æ³•å¯¹æ•°æ®é›†æ ¼å¼è¿›è¡Œè°ƒæ•´ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def generate_conversation(examples):</span><br><span class="line">    problems  = examples[&quot;problem&quot;]</span><br><span class="line">    solutions = examples[&quot;generated_solution&quot;]</span><br><span class="line">    conversations = []</span><br><span class="line">    for problem, solution in zip(problems, solutions):</span><br><span class="line">        conversations.append([</span><br><span class="line">            &#123;&quot;role&quot; : &quot;user&quot;,      &quot;content&quot; : problem&#125;,</span><br><span class="line">            &#123;&quot;role&quot; : &quot;assistant&quot;, &quot;content&quot; : solution&#125;,</span><br><span class="line">        ])</span><br><span class="line">    return &#123; &quot;conversations&quot;: conversations, &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…ˆåˆ›å»ºgenerate_conversationå‡½æ•°ï¼Œç”¨äºå¯¹reasoning_datasetä¸­çš„æ¯ä¸€æ¡æ•°æ®è¿›è¡Œæ ¼å¼è°ƒæ•´ï¼Œå³é€šè¿‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰¹å¾conversationsï¼Œæ¥ä»¥å¯¹è¯å½¢å¼ä¿å­˜å†å²é—®ç­”æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reasoning_data = reasoning_dataset.map(</span><br><span class="line">    generate_conversation,  # å¤„ç†å‡½æ•°</span><br><span class="line">    batched=True            # æ‰¹é‡å¤„ç†ï¼ŒåŠ å¿«é€Ÿåº¦</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>mapï¼šå¯¹æ•°æ®é›†ä¸­çš„æ¯ä¸€æ‰¹æ ·æœ¬è°ƒç”¨ generate_conversation</p>
<p>batched=Trueï¼šä¸€æ¬¡ä¼ å…¥ä¸€æ‰¹ï¼ˆå‡ ç™¾åˆ°å‡ åƒæ¡ï¼‰æ ·æœ¬ï¼Œé¿å…é€è¡Œæ…¢é€Ÿ Python
å¾ªç¯</p>
</blockquote>
<p>æ¥ä¸‹æ¥å°†å…¶å¸¦å…¥Qwen3çš„æç¤ºè¯æ¨¡æ¿ä¸­è¿›è¡Œè½¬åŒ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reasoning_conversations = tokenizer.apply_chat_template(</span><br><span class="line">    reasoning_data[&quot;conversations&quot;],</span><br><span class="line">    tokenize = False,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ä¹‹åå³å¯å¸¦å…¥è¿™äº›æ•°æ®è¿›è¡Œå¾®è°ƒã€‚èƒ½çœ‹å‡ºæ¯æ¡æ•°æ®çš„æ ¼å¼éƒ½å’ŒUnslothåº•å±‚å¯¹è¯APIåˆ›å»ºçš„æ•°æ®æ ¼å¼ç±»ä¼¼ï¼Œä¹‹åæˆ‘ä»¬æˆ–è®¸å¯ä»¥å€ŸåŠ©Unslothåº•å±‚å¯¹è¯APIæ¥åˆ›å»ºå¾®è°ƒæ•°æ®é›†ã€‚</p>
<h4 id="æ¨ç†æ•°æ®é›†çš„æ¨ç†">æ¨ç†æ•°æ®é›†çš„æ¨ç†</h4>
<p>ç„¶åç»§ç»­å¤„ç†non_reasoning_conversationsæ•°æ®é›†ï¼Œç”±äºè¯¥æ•°æ®é›†é‡‡ç”¨äº†sharegptå¯¹è¯æ ¼å¼ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å€ŸåŠ©Unslothçš„standardize_sharegptåº“è¿›è¡Œæ•°æ®é›†çš„æ ¼å¼è½¬åŒ–ï¼Œè½¬åŒ–æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from unsloth.chat_templates import standardize_sharegpt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>standardize_sharegptçš„ä½œç”¨</p>
<p><strong>æŠŠâ€œShareGPT æ ¼å¼â€çš„å¯¹è¯æ•°æ®ä¸€é”®è½¬æˆ Unsloth / Hugging Face
é€šç”¨çš„ <code>role/content</code> åˆ—è¡¨ï¼Œåç»­å°±èƒ½ç›´æ¥ç”¨
<code>apply_chat_template</code> ç”Ÿæˆè®­ç»ƒæ–‡æœ¬ã€‚</strong></p>
<p>1ï¸âƒ£ ShareGPT åŸå§‹é•¿ä»€ä¹ˆæ ·ï¼Ÿ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;human&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1+1=?&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gpt&quot;</span><span class="punctuation">,</span>  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>2ï¸âƒ£ è½¬æ¢åé•¿ä»€ä¹ˆæ ·ï¼Ÿ</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;user&quot;</span><span class="punctuation">,</span>      <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1+1=?&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;assistant&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset = standardize_sharegpt(non_reasoning_dataset)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å³å¯ç›´æ¥å¸¦å…¥Qwen3å¯¹è¯æ¨¡æ¿ä¸­è¿›è¡Œæ ¼å¼è°ƒæ•´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">non_reasoning_conversations = tokenizer.apply_chat_template(</span><br><span class="line">    dataset[&quot;conversations&quot;],</span><br><span class="line">    tokenize = False,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®é›†é‡‡æ ·">æ•°æ®é›†é‡‡æ ·</h4>
<p>è‡ªæ­¤å³å®Œæˆäº†æ¯ä¸ªæ•°æ®é›†çš„æ ¼å¼è°ƒæ•´å·¥ä½œï¼Œä¸è¿‡è¿™ä¸¤ä¸ªæ•°æ®é›†å¹¶ä¸å‡è¡¡ï¼Œèƒ½çœ‹å¾—å‡ºéæ¨ç†ç±»æ•°æ®é›†çš„é•¿åº¦æ›´é•¿ã€‚æˆ‘ä»¬å‡è®¾å¸Œæœ›æ¨¡å‹ä¿ç•™ä¸€å®šçš„æ¨ç†èƒ½åŠ›ï¼Œä½†åˆç‰¹åˆ«å¸Œæœ›å®ƒä½œä¸ºä¸€ä¸ªèŠå¤©æ¨¡å‹æ¥ä½¿ç”¨ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª
<strong>ä»…èŠå¤©æ•°æ®çš„æ¯”ä¾‹</strong>ã€‚<strong>ç›®æ ‡æ˜¯ä»ä¸¤ä¸ªæ•°æ®é›†ä¸­æ„å»ºä¸€ä¸ªæ··åˆè®­ç»ƒé›†</strong>ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥è®¾å®šä¸€ä¸ª
25% æ¨ç†æ•°æ®ã€75% èŠå¤©æ•°æ®çš„æ¯”ä¾‹ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œä»æ¨ç†æ•°æ®é›†ä¸­æŠ½å–
25%ï¼ˆæˆ–è€…è¯´ï¼ŒæŠ½å–å æ¯”ä¸º 100% - èŠå¤©æ•°æ®å æ¯”
çš„éƒ¨åˆ†ï¼‰ï¼Œæœ€åå°†è¿™ä¸¤ä¸ªæ•°æ®é›†åˆå¹¶èµ·æ¥å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">chat_percentage = 0.75</span><br><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">#å…ˆæŠŠéæ¨ç†å¯¹è¯åˆ—è¡¨è½¬æˆ Pandas Seriesï¼Œæ–¹ä¾¿åç»­æŠ½æ ·</span><br><span class="line">non_reasoning_subset = pd.Series(non_reasoning_conversations)</span><br><span class="line"></span><br><span class="line">non_reasoning_subset = non_reasoning_subset.sample(#sample(...)ä¸ºæ— æ”¾å›éšæœºæŠ½æ ·</span><br><span class="line">    int(len(reasoning_conversations) * (1.0 - chat_percentage)),#è®¡ç®— éœ€è¦æŠ½å¤šå°‘æ¡éæ¨ç†æ ·æœ¬</span><br><span class="line">    random_state = 2407,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å…ˆå°†ä¸Šè¿°listæ ¼å¼çš„æ•°æ®è½¬åŒ–ä¸ºpd.Seriesæ•°æ®ï¼Œç„¶åè¿›è¡Œé‡‡æ ·ï¼Œå¹¶æœ€ç»ˆå°†å…¶è½¬åŒ–ä¸ºdatasetç±»å‹å¯¹è±¡ã€‚ï¼ˆæ­¤å¤–ä¹Ÿå¯ä»¥å…ˆè½¬åŒ–ä¸ºdatasetå¯¹è±¡ç±»å‹ï¼Œç„¶åå†è¿›è¡Œé‡‡æ ·ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data = pd.concat([</span><br><span class="line">    pd.Series(reasoning_conversations),</span><br><span class="line">    pd.Series(non_reasoning_subset)</span><br><span class="line">])</span><br><span class="line">data.name = &quot;text&quot;</span><br><span class="line"></span><br><span class="line">from datasets import Dataset</span><br><span class="line"></span><br><span class="line">combined_dataset = Dataset.from_pandas(pd.DataFrame(data))</span><br><span class="line">combined_dataset = combined_dataset.shuffle(seed = 3407)#ç”¨å›ºå®šç§å­éšæœºæ‰“ä¹±é¡ºåº</span><br></pre></td></tr></table></figure>
<blockquote>
<p>pd.concat([â€¦])ï¼šçºµå‘æ‹¼æ¥ â†’ ä¸€æ¡é•¿ Seriesï¼Œé¡ºåºï¼šå…ˆæ¨ç†ï¼Œåéæ¨ç†</p>
<p>Dataset.from_pandas(â€¦)ï¼šæŠŠ Pandas Series è½¬æˆ Hugging Face
Dataset</p>
</blockquote>
<p><strong>æŠŠâ€œæ¨ç†å¯¹è¯â€å’Œâ€œæŠ½æ ·åçš„éæ¨ç†å¯¹è¯â€åˆå¹¶æˆä¸€ä¸ª</strong>
<strong>éšæœºæ‰“ä¹±</strong> <strong>çš„ <code>Dataset</code>
å¯¹è±¡ï¼Œåé¢å¯ç›´æ¥æ‹¿å»è®­ç»ƒã€‚</strong></p>
<h4 id="æŸ¥çœ‹æ•°æ®é›†-1">æŸ¥çœ‹æ•°æ®é›†</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">combined_dataset[0]</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;text&#x27;: &quot;&lt;|im_start|&gt;user\nCalculate the pH during a titration when 9.54 mL of a 0.15 M HCl solution has reacted with 22.88 mL of a 0.14 M NaOH solution?&lt;|im_end|&gt;\n&lt;|im_stæˆªå–&quot;,</span><br><span class="line"> &#x27;__index_level_0__&#x27;: 49038&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­textå­—æ®µå°±æ˜¯åç»­å¸¦å…¥å¾®è°ƒçš„å­—æ®µã€‚</p>
<h4 id="æ•°æ®é›†ä¿å­˜">æ•°æ®é›†ä¿å­˜</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">combined_dataset.save_to_disk(&quot;/workspace/cleaned_qwen3_dataset&quot;)</span><br></pre></td></tr></table></figure>
<p>åç»­ä½¿ç”¨æ—¶å³å¯ä½¿ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œè¯»å–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from datasets import load_from_disk</span><br><span class="line">combined_dataset = load_from_disk(&quot;cleaned_qwen3_dataset&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="qwen3æ¨ç†èƒ½åŠ›é«˜æ•ˆå¾®è°ƒæµç¨‹">Qwen3æ¨ç†èƒ½åŠ›é«˜æ•ˆå¾®è°ƒæµç¨‹</h3>
<p>å‡†å¤‡å®Œæ•°æ®ä¹‹åï¼Œå³å¯å¼€å§‹è¿›è¡Œå¾®è°ƒã€‚è¿™é‡Œæˆ‘ä»¬å…ˆè¿›è¡Œå°‘é‡æ•°æ®å¾®è°ƒæµ‹è¯•ï¼Œç¨‹åºèƒ½å¤ŸåŸºæœ¬è·‘é€šåï¼Œæˆ‘ä»¬å†è¿›è¡Œå¤§è§„æ¨¡æ•°æ®é›†å¾®è°ƒã€‚</p>
<h4 id="è¿›è¡Œloraå‚æ•°æ³¨å…¥">è¿›è¡ŒLoRAå‚æ•°æ³¨å…¥</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">model = FastLanguageModel.get_peft_model(</span><br><span class="line">    model,</span><br><span class="line">    r = 32,           # ç§©ï¼ˆLoRA ä½ç§©çŸ©é˜µçš„åˆ—æ•°ï¼‰ã€‚è¶Šå¤§å¯å­¦ä¹ å‚æ•°è¶Šå¤šï¼Œæ˜¾å­˜ä¹Ÿè¶Šé«˜ã€‚å¸¸ç”¨ 8/16/32/64/128</span><br><span class="line">    target_modules = [&quot;q_proj&quot;, &quot;k_proj&quot;, &quot;v_proj&quot;, &quot;o_proj&quot;,</span><br><span class="line">                      &quot;gate_proj&quot;, &quot;up_proj&quot;, &quot;down_proj&quot;],  # åœ¨å“ªäº›çº¿æ€§å±‚æ’å…¥ LoRA é€‚é…å™¨ï¼ˆAttention + MLPï¼‰</span><br><span class="line">    lora_alpha = 32,  # ç¼©æ”¾å› å­ã€‚ç»éªŒå€¼ = rank æˆ– 2Ã—rankï¼Œæ§åˆ¶æ›´æ–°å¼ºåº¦</span><br><span class="line">    lora_dropout = 0, # LoRA æœ¬èº«çš„ dropout æ¯”ä¾‹ï¼›0 çœæ˜¾å­˜ä¸”é€Ÿåº¦æœ€å¿«</span><br><span class="line">    bias = &quot;none&quot;,    # æ˜¯å¦è®­ç»ƒåŸ Linear çš„åç½®ã€‚è®¾ä¸º &quot;none&quot; ä¸è®­ç»ƒï¼Œè¿›ä¸€æ­¥èŠ‚çœæ˜¾å­˜</span><br><span class="line">    use_gradient_checkpointing = &quot;unsloth&quot;,  # æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼šTrue çœæ˜¾å­˜ï¼Œ&quot;unsloth&quot; å†çœ 30 %ï¼Œè¶…é•¿ä¸Šä¸‹æ–‡å¿…å¼€</span><br><span class="line">    random_state = 3407,  # éšæœºç§å­ï¼Œä¿è¯ LoRA åˆå§‹åŒ–å¯å¤ç°</span><br><span class="line">    use_rslora = False,   # é»˜è®¤ Falseï¼ŒTrue åˆ™å¯ç”¨ Rank-Stabilized LoRAï¼ˆè®­ç»ƒæ›´ç¨³ï¼Œä½†æ˜¾å­˜ç¨é«˜ï¼‰</span><br><span class="line">    loftq_config = None,  # LoftQ é‡åŒ–åˆå§‹åŒ–ï¼ŒNone è¡¨ç¤ºä¸ç”¨ï¼›è‹¥é…ç½®å¯è¿›ä¸€æ­¥å‹ç¼©åˆå§‹æƒé‡</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥<strong>â€œLoRA
å‚æ•°æ³¨å…¥â€</strong>å°±æ˜¯ï¼š<strong>åœ¨ä¸æ”¹åŠ¨åŸæ¨¡å‹æƒé‡çš„å‰æä¸‹ï¼Œç»™æŒ‡å®šå±‚æ’å…¥å°‘é‡</strong>
<strong>å¯è®­ç»ƒä½ç§©çŸ©é˜µ</strong> <strong>ï¼ˆLoRA é€‚é…å™¨ï¼‰ï¼Œä»è€Œåªæ›´æ–° &lt;
1 % çš„å‚æ•°ï¼Œå®Œæˆé«˜æ•ˆå¾®è°ƒã€‚</strong></p>
<blockquote>
<p>ä¸æ˜¯â€œåœ¨åŸæœ‰å±‚ä¹‹å¤–å†å¢åŠ ä¸€å±‚â€ï¼Œè€Œæ˜¯<strong>æŠŠ LoRA
çš„â€œå°çŸ©é˜µâ€æ’åˆ°</strong> <strong>åŸæœ‰çº¿æ€§å±‚å†…éƒ¨</strong>ï¼š</p>
<ul>
<li>åŸå±‚ç»“æ„ï¼ˆå†»ç»“ï¼‰ï¼š <code>x â†’ Linear4bit(W) â†’ y</code></li>
<li>æ³¨å…¥åç»“æ„ï¼ˆå†»ç»“ + å¯è®­ç»ƒï¼‰ï¼š
<code>x â†’ [Linear4bit(W)  +  LoRA(AÂ·B)] â†’ y</code></li>
</ul>
<p><code>A</code> å’Œ <code>B</code> ä¸¤ä¸ªä½ç§©çŸ©é˜µè¢«
<strong>æ³¨å†Œä¸ºåŒä¸€å±‚çš„æ–°å‚æ•°</strong>ï¼Œ<strong>ä¸æ–°å»ºç½‘ç»œå±‚</strong>ï¼Œå‚æ•°åœ¨
<strong>å‰å‘æ—¶ç›¸åŠ </strong>ï¼Œ<strong>åå‘åªæ›´æ–° A å’Œ B</strong>ã€‚</p>
</blockquote>
<h4 id="è®¾ç½®å¾®è°ƒå‚æ•°">è®¾ç½®å¾®è°ƒå‚æ•°</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from trl import SFTTrainer, SFTConfig</span><br><span class="line"></span><br><span class="line">trainer = SFTTrainer(</span><br><span class="line">    model=model,                       # å·²æ’å…¥ LoRA çš„ 4-bit æ¨¡å‹</span><br><span class="line">    tokenizer=tokenizer,               # å¯¹åº” tokenizerï¼ˆå« chat æ¨¡æ¿ï¼‰</span><br><span class="line">    train_dataset=combined_dataset,    # è®­ç»ƒé›†ï¼šèŠå¤©+æ¨ç†å¯¹è¯</span><br><span class="line">    eval_dataset=None,                 # å¦‚éœ€éªŒè¯ï¼ŒæŠŠéªŒè¯é›†æ”¾è¿›æ¥å³å¯</span><br><span class="line"></span><br><span class="line">    args=SFTConfig(</span><br><span class="line">        dataset_text_field=&quot;text&quot;,      # è®­ç»ƒé›†ä¸­æ¯æ¡æ ·æœ¬çš„å­—æ®µåï¼ˆå¯¹è¯åˆ—è¡¨ï¼‰</span><br><span class="line">        per_device_train_batch_size=2,  # æ¯å¼ æ˜¾å¡ä¸Šçš„ batch_sizeï¼ˆæ˜¾å­˜å†³å®šï¼‰</span><br><span class="line">        gradient_accumulation_steps=4,  # 4 æ¬¡ç´¯ç§¯ â†’ å…¨å±€æœ‰æ•ˆ batch = 2Ã—4 = 8</span><br><span class="line">        warmup_steps=5,                # å‰ 5 æ­¥çº¿æ€§é¢„çƒ­å­¦ä¹ ç‡</span><br><span class="line">        max_steps=30,                  # è®­ç»ƒ 30 æ­¥ï¼ˆè°ƒè¯•é˜¶æ®µï¼‰ï¼›æ­£å¼å¯ç”¨ num_train_epochs</span><br><span class="line">        learning_rate=2e-4,            # LoRA å¸¸ç”¨ 2e-4ï¼›é•¿è®­é™åˆ° 2e-5</span><br><span class="line">        logging_steps=1,               # æ¯ 1 æ­¥æ‰“å°ä¸€æ¬¡æ—¥å¿—</span><br><span class="line">        optim=&quot;adamw_8bit&quot;,            # 8-bit AdamWï¼Œçœæ˜¾å­˜</span><br><span class="line">        weight_decay=0.01,             # L2 æ­£åˆ™</span><br><span class="line">        lr_scheduler_type=&quot;linear&quot;,    # çº¿æ€§è¡°å‡åˆ° 0</span><br><span class="line">        seed=3407,                     # å›ºå®šéšæœºç§å­</span><br><span class="line">        report_to=&quot;swanlab&quot;,             # æŠŠæŒ‡æ ‡æ¨é€åˆ° swanlab</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/huggingface/trl">TRL</a> (Transformers
Reinforcement Learningï¼Œç”¨å¼ºåŒ–å­¦ä¹ è®­ç»ƒTransformersæ¨¡å‹)
æ˜¯ä¸€ä¸ªé¢†å…ˆçš„Pythonåº“ï¼Œæ—¨åœ¨é€šè¿‡ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰ã€è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ï¼ˆPPOï¼‰å’Œç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰ç­‰å…ˆè¿›æŠ€æœ¯ï¼Œå¯¹åŸºç¡€æ¨¡å‹è¿›è¡Œè®­ç»ƒåä¼˜åŒ–ã€‚TRL
å»ºç«‹åœ¨ ğŸ¤— Transformers
ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šï¼Œæ”¯æŒå¤šç§æ¨¡å‹æ¶æ„å’Œæ¨¡æ€ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨å„ç§ç¡¬ä»¶é…ç½®ä¸Šè¿›è¡Œæ‰©å±•ã€‚</p>
<p>å…¶ä¸­<code>SFTTrainer</code>ï¼šä¸€ä¸ªä¸“é—¨ä¸ºæŒ‡ä»¤å¾®è°ƒè®¾è®¡çš„è®­ç»ƒå™¨ï¼Œå°è£…äº†
Hugging Face çš„
<code>Trainer</code>ï¼Œè€Œ<code>SFTConfig</code>ï¼šé…ç½®è®­ç»ƒå‚æ•°çš„ä¸“ç”¨ç±»ï¼ŒåŠŸèƒ½ç±»ä¼¼
<code>TrainingArguments</code>ã€‚è€ŒSFTConfigæ ¸å¿ƒå‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š</p>
<table>
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>å‚æ•°å</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dataset_text_field="text"</code></td>
<td>æ•°æ®é›†ä¸­ç”¨äºè®­ç»ƒçš„å­—æ®µåç§°ï¼Œå¦‚ <code>text</code> æˆ–
<code>prompt</code></td>
</tr>
<tr class="even">
<td><code>per_device_train_batch_size=2</code></td>
<td>æ¯å¼  GPU ä¸Šçš„ batch size æ˜¯ 2</td>
</tr>
<tr class="odd">
<td><code>gradient_accumulation_steps=4</code></td>
<td>æ¢¯åº¦ç´¯è®¡ 4 æ¬¡åæ‰è¿›è¡Œä¸€æ¬¡åå‘ä¼ æ’­ï¼ˆç­‰æ•ˆäºæ€» batch size = 2 Ã— 4 =
8ï¼‰</td>
</tr>
<tr class="even">
<td><code>warmup_steps=5</code></td>
<td>å‰ 5 æ­¥è¿›è¡Œ warmupï¼ˆç¼“æ…¢æå‡å­¦ä¹ ç‡ï¼‰</td>
</tr>
<tr class="odd">
<td><code>max_steps=30</code></td>
<td>æœ€å¤šè®­ç»ƒ 30 æ­¥ï¼ˆé€‚åˆè°ƒè¯•æˆ–å¿«é€Ÿå®éªŒï¼‰</td>
</tr>
<tr class="even">
<td><code>learning_rate=2e-4</code></td>
<td>åˆå§‹å­¦ä¹ ç‡ï¼ˆçŸ­è®­ç»ƒå¯ç”¨è¾ƒé«˜å€¼ï¼‰</td>
</tr>
<tr class="odd">
<td><code>logging_steps=1</code></td>
<td>æ¯è®­ç»ƒ 1 æ­¥å°±æ‰“å°ä¸€æ¬¡æ—¥å¿—</td>
</tr>
<tr class="even">
<td><code>optim="adamw_8bit"</code></td>
<td>ä½¿ç”¨ 8-bit AdamW ä¼˜åŒ–å™¨ï¼ˆèŠ‚çœå†…å­˜ï¼ŒUnsloth æ”¯æŒï¼‰</td>
</tr>
<tr class="odd">
<td><code>weight_decay=0.01</code></td>
<td>æƒé‡è¡°å‡ï¼Œç”¨äºé˜²æ­¢è¿‡æ‹Ÿåˆ</td>
</tr>
<tr class="even">
<td><code>lr_scheduler_type="linear"</code></td>
<td>çº¿æ€§å­¦ä¹ ç‡è°ƒåº¦å™¨ï¼ˆä»é«˜åˆ°ä½çº¿æ€§ä¸‹é™ï¼‰</td>
</tr>
<tr class="odd">
<td><code>seed=3407</code></td>
<td>å›ºå®šéšæœºç§å­ï¼Œç¡®ä¿ç»“æœå¯å¤ç°</td>
</tr>
<tr class="even">
<td><code>report_to="none"</code></td>
<td>ä¸ä½¿ç”¨ WandB æˆ– TensorBoard ç­‰æ—¥å¿—å¹³å°ï¼ˆå¯æ”¹ä¸º
<code>"wandb"</code>ï¼‰</td>
</tr>
</tbody>
</table>
<blockquote>
<ol type="1">
<li><p><strong>per_device_train_batch_size=2</strong>
<strong>æ¯æ¬¡å‰å‘åªç”¨äº† 2 æ¡æ ·æœ¬</strong> â†’ æ˜¾å­˜å ç”¨å°ï¼Œå•å¡å°±èƒ½è·‘ã€‚</p>
<p><strong>batch_size
å†³å®šã€Œæ¯ä¸€æ­¥çœŸæ­£å–‚ç»™æ¨¡å‹çš„æ ·æœ¬æ•°é‡ã€ï¼Œè¶Šå¤§è®­ç»ƒè¶Šç¨³ï¼Œä½†å¯¹æ˜¾å­˜è¦æ±‚è¶Šé«˜ã€‚</strong></p></li>
<li><p><strong>gradient_accumulation_steps=4</strong> <strong>æŠŠè¿™ 2
æ¡æ ·æœ¬ç®—å‡ºçš„æ¢¯åº¦å…ˆæ”’èµ·æ¥ï¼Œæ”’å¤Ÿ 4 æ¬¡å†ä¸€æ¬¡æ€§åšåå‘ä¼ æ’­</strong> â†’
ç­‰æ•ˆäºä¸€æ¬¡æ€§çœ‹äº† <strong>2 Ã— 4 = 8 æ¡æ ·æœ¬</strong>ï¼Œä½†æ˜¾å­˜ä»æŒ‰ 2
æ¡ç®—ã€‚</p></li>
</ol>
</blockquote>
<p>æ­¤æ—¶åŸºæœ¬è®­ç»ƒè¿‡ç¨‹ä¸ºï¼š 1. ä» <code>combined_dataset</code>
ä¸­å–å‡ºä¸€æ‰¹æ ·æœ¬ï¼ˆ2 æ¡ï¼‰ 2. é‡å¤ä¸Šé¢è¿‡ç¨‹ 4
æ¬¡ï¼ˆ<code>gradient_accumulation_steps=4</code>ï¼‰ 3.
å°†ç´¯è®¡çš„æ¢¯åº¦ç”¨äºæ›´æ–°æ¨¡å‹ä¸€æ¬¡å‚æ•°ï¼ˆç­‰æ•ˆäºä¸€æ¬¡å¤§ batch æ›´æ–°ï¼‰ 4.
é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ° <code>max_steps=30</code> åœæ­¢</p>
<h4 id="è®¾ç½®è®­ç»ƒå¯è§†åŒ–swanlab">è®¾ç½®è®­ç»ƒå¯è§†åŒ–swanlab</h4>
<p><a target="_blank" rel="noopener" href="https://docs.swanlab.cn/guide_cloud/integration/integration-huggingface-trl.html">ğŸ¤—HuggingFace
Trl | SwanLabå®˜æ–¹æ–‡æ¡£</a></p>
<p>åªéœ€è¦åœ¨ä½ çš„è®­ç»ƒä»£ç ä¸­ï¼Œæ‰¾åˆ°HFçš„<code>Config</code>éƒ¨åˆ†ï¼ˆæ¯”å¦‚<code>SFTConfig</code>ã€<code>GRPOConfig</code>ç­‰ï¼‰ï¼Œæ·»åŠ <code>report_to="swanlab"</code>å‚æ•°ï¼Œå³å¯å®Œæˆé›†æˆã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from trl import SFTConfig, SFTTrainer</span><br><span class="line"></span><br><span class="line">args = SFTConfig(</span><br><span class="line">    ...,</span><br><span class="line">    report_to=&quot;swanlab&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">trainer = Trainer(..., args=args)</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤ä¸‹ï¼Œé¡¹ç›®åä¼šä½¿ç”¨ä½ è¿è¡Œä»£ç çš„<code>ç›®å½•å</code>ã€‚</p>
<p>å¦‚æœä½ æƒ³è‡ªå®šä¹‰é¡¹ç›®åï¼Œå¯ä»¥è®¾ç½®<code>SWANLAB_PROJECT</code>ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.environ[&quot;SWANLAB_PROJECT&quot;]=&quot;qwen2-sft&quot;</span><br></pre></td></tr></table></figure>
<h4 id="å¾®è°ƒæ‰§è¡Œæµç¨‹">å¾®è°ƒæ‰§è¡Œæµç¨‹</h4>
<p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œæ¥ä¸‹æ¥å³å¯å¼€å§‹è¿›è¡Œå¾®è°ƒã€‚ç”±äºæœ¬æ¬¡å¾®è°ƒæ€»å…±åªè¿è¡Œ30ä¸ªstepï¼Œæ•´ä¸ªè¿‡ç¨‹å¹¶ä¸ä¼šå¾ˆé•¿ï¼Œå®é™…æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trainer_stats = trainer.train()</span><br></pre></td></tr></table></figure>
<h4 id="ä¿å­˜æ¨¡å‹">ä¿å­˜æ¨¡å‹</h4>
<p><strong>1. ä¿å­˜ LoRA Adapter</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ä¿å­˜ LoRA adapterï¼ˆä»…å‡ å MBï¼‰</span><br><span class="line">save_path = &quot;./lora-adapter&quot;</span><br><span class="line">model.save_pretrained(save_path)          # LoRA æƒé‡</span><br><span class="line">tokenizer.save_pretrained(save_path)      # è¯è¡¨</span><br></pre></td></tr></table></figure>
<p>ä»¥ååŠ è½½ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> unsloth <span class="keyword">import</span> FastLanguageModel</span><br><span class="line">model, tokenizer = FastLanguageModel.from_pretrained(</span><br><span class="line">    model_name = <span class="string">&quot;base-model-name-or-path&quot;</span>,</span><br><span class="line">    max_seq_length = <span class="number">2048</span>,</span><br><span class="line">    load_in_4bit = <span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line">model = FastLanguageModel.get_peft_model(model, ...)  <span class="comment"># åŒè®­ç»ƒæ—¶å‚æ•°</span></span><br><span class="line">model.load_adapter(save_path)   <span class="comment"># æŠŠ LoRA æƒé‡æŒ‚å›å»</span></span><br></pre></td></tr></table></figure>
<p><strong>2.åˆå¹¶ LoRA â†’ å®Œæ•´æ¨¡å‹</strong></p>
<p>å¦‚æœä½ æƒ³æŠŠ <strong>LoRA æƒé‡åˆå¹¶åˆ°åŸºåº§</strong>
å¾—åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å¤§æ¨¡å‹ï¼ˆæ–¹ä¾¿æ¨ç†ã€ä¸Šä¼  Hubï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå¹¶æƒé‡</span></span><br><span class="line">merged_model = model.merge_and_unload()   <span class="comment"># è¿”å›æ™®é€š transformers æ¨¡å‹</span></span><br><span class="line">merged_model.save_pretrained(<span class="string">&quot;./merged-model&quot;</span>)</span><br><span class="line">tokenizer.save_pretrained(<span class="string">&quot;./merged-model&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶åå°±æ˜¯å®Œæ•´çš„å¤§æ¨¡å‹ï¼ˆGB çº§ï¼‰ï¼Œå¯ç›´æ¥ç”¨
<code>AutoModelForCausalLM.from_pretrained("./merged-model")</code>
åŠ è½½ï¼Œä¸ä¾èµ– Unslothã€‚</p>
<h3 id="å¾®è°ƒç»“æœ">å¾®è°ƒç»“æœ</h3>
<h4 id="å¯è§†åŒ–ç»“æœ">å¯è§†åŒ–ç»“æœ</h4>
<figure>
<img src="/2025/08/12/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/qwen3-8b%E5%BE%AE%E8%B0%83%E5%AE%9E%E6%88%98/image-20250813111238359.png" alt="image-20250813111238359">
<figcaption aria-hidden="true">image-20250813111238359</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://swanlab.cn/@zxj123/Fine-tune-Qwen-8B/runs/e2l6g6s3v7dlb7hmfircv/chart">å›¾è¡¨
ï½œ Fine-tune-Qwen-8B/rat-2</a></p>
<table>
<colgroup>
<col style="width: 18%">
<col style="width: 22%">
<col style="width: 28%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>æŒ‡æ ‡åç§°</th>
<th>å«ä¹‰</th>
<th>å•ä½/èŒƒå›´æç¤º</th>
<th>å¸¸è§å…³æ³¨ç‚¹</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>train/loss</td>
<td>è®­ç»ƒæŸå¤±ï¼ˆTraining Lossï¼‰</td>
<td>æ ‡é‡ï¼Œè¶Šå°è¶Šå¥½</td>
<td>æ˜¯å¦æŒç»­ä¸‹é™ã€æ˜¯å¦éœ‡è¡ã€æ˜¯å¦è¿‡æ‹Ÿåˆ</td>
</tr>
<tr class="even">
<td>train/grad_norm</td>
<td>æ¢¯åº¦èŒƒæ•°ï¼ˆGradient Normï¼‰</td>
<td>æ ‡é‡ï¼Œé€šå¸¸ 0.01â€“1.0 ä¸ºåˆç†åŒºé—´</td>
<td>æ˜¯å¦çˆ†ç‚¸ï¼ˆ&gt;10ï¼‰æˆ–æ¶ˆå¤±ï¼ˆ&lt;1e-4ï¼‰</td>
</tr>
<tr class="odd">
<td>train/learning_rate</td>
<td>å­¦ä¹ ç‡ï¼ˆLearning Rateï¼‰</td>
<td>æ ‡é‡ï¼Œå¦‚ 1e-4ã€5e-4 ç­‰</td>
<td>æ˜¯å¦è¿‡å¤§å¯¼è‡´éœ‡è¡ã€è¿‡å°å¯¼è‡´æ”¶æ•›æ…¢</td>
</tr>
<tr class="even">
<td>train/epoch</td>
<td>å·²è®­ç»ƒçš„è½®æ¬¡ï¼ˆEpochï¼‰</td>
<td>æ ‡é‡ï¼Œ1.0 è¡¨ç¤ºå®Œæ•´éå†ä¸€æ¬¡è®­ç»ƒé›†</td>
<td>å½“å‰å·²è®­ç»ƒå¤šå°‘è½®ã€æ˜¯å¦è¿˜éœ€ç»§ç»­è®­ç»ƒ</td>
</tr>
<tr class="odd">
<td>train/global_step</td>
<td>å…¨å±€æ­¥æ•°ï¼ˆGlobal Stepï¼‰</td>
<td>æ•´æ•°ï¼Œæ¯ä¸ª batch +1</td>
<td>ä¸ epoch å¯¹åº”ï¼Œè®¡ç®—å·²è§æ ·æœ¬é‡</td>
</tr>
</tbody>
</table>
<h4 id="å¯¹è¯æµ‹è¯•">å¯¹è¯æµ‹è¯•</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">messages = [</span><br><span class="line">    &#123;&quot;role&quot; : &quot;user&quot;, &quot;content&quot; : &quot;è§£å†³(x + 2)^2 = 0.&quot;&#125;</span><br><span class="line">]</span><br><span class="line">text = tokenizer.apply_chat_template(</span><br><span class="line">    messages,</span><br><span class="line">    tokenize = False,</span><br><span class="line">    add_generation_prompt = True, # Must add for generation</span><br><span class="line">    enable_thinking = True, # Disable thinking</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">from transformers import TextStreamer</span><br><span class="line">_ = model.generate(</span><br><span class="line">    **tokenizer(text, return_tensors = &quot;pt&quot;).to(&quot;cuda&quot;),</span><br><span class="line">    max_new_tokens = 20488, # Increase for longer outputs!</span><br><span class="line">    temperature = 0.6, top_p = 0.95, top_k = 20, # For thinking</span><br><span class="line">    streamer = TextStreamer(tokenizer, skip_prompt = True),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/11/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/LoRA%E5%85%B6%E4%BB%96%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/11/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/LoRA%E5%85%B6%E4%BB%96%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">LoRAå…¶ä»–çš„æ¨¡å‹å¾®è°ƒæ–¹æ³•</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-11 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-11T00:00:00+08:00">2025-08-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-14 10:58:52" itemprop="dateModified" datetime="2025-08-14T10:58:52+08:00">2025-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">æ¨¡å‹</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A8%A1%E5%9E%8B/%E5%BE%AE%E8%B0%83/" itemprop="url" rel="index"><span itemprop="name">å¾®è°ƒ</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure>
<img src="/2025/08/11/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/LoRA%E5%85%B6%E4%BB%96%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83%E6%96%B9%E6%B3%95/image-20250814105851771.png" alt="image-20250814105851771">
<figcaption aria-hidden="true">image-20250814105851771</figcaption>
</figure>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzkzODI1NzQyNA==&amp;mid=2247494667&amp;idx=1&amp;sn=c3af7d2472de61752ef8b8df28746f2e&amp;poc_token=HCyNmWijps0ViWD6wPgqFiDYUZVRSs7xUDRfowWE">å¤§æ¨¡å‹å¾®è°ƒæŠ€å·§ï¼šLoRA
ä¸ QLoRAè®²è§£</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/javatiange/article/details/149964743?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=149964743&amp;sharerefer=PC&amp;sharesource=2501_91530961&amp;sharefrom=from_link">ä¸€æ–‡è¯¦è§£ï¼š8ç§å¸¸è§çš„å¤§æ¨¡å‹å¾®è°ƒæ–¹æ³•ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/682082440">å¤§æ¨¡å‹å¾®è°ƒæŠ€æœ¯ -
çŸ¥ä¹</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å¼ ç†™æµš</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™è®¿é—®æ•° fa fa-user æ¬¡"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™æ€»è®¿é—®é‡ fa fa-eye æ¬¡"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="400" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
