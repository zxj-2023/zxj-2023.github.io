<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="zxj Blogs">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhang XiJun">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Zhang XiJun">
<meta property="og:description" content="zxj Blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="å¼ ç†™æµš">
<meta property="article:tag" content="zxj">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhang XiJun</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhang XiJun</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">BLOGS</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å¼ ç†™æµš"
      src="/images/zxjavatar.gif">
  <p class="site-author-name" itemprop="name">å¼ ç†™æµš</p>
  <div class="site-description" itemprop="description">zxj Blogs</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zxj-2023" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zxj-2023" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=2902065320&site=qq&menu=yes" title="QQ â†’ http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;2902065320&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener me" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          é“¾æ¥
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://zxj-2023.github.io/" title="https:&#x2F;&#x2F;zxj-2023.github.io" rel="noopener" target="_blank">Zhang XiJun</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://theme-next.js.org/" title="https:&#x2F;&#x2F;theme-next.js.org" rel="noopener" target="_blank">NexT</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/05/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/%E4%B8%83%E6%9C%88%E5%A4%8D%E7%9B%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/05/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/%E4%B8%83%E6%9C%88%E5%A4%8D%E7%9B%98/" class="post-title-link" itemprop="url">å®ä¹ ä¸ƒæœˆå¤ç›˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-05 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š15:46:49" itemprop="dateCreated datePublished" datetime="2025-08-05T00:00:00+08:00">2025-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ–‡ä»¶å¤„ç†é˜¶æ®µ"><a href="#æ–‡ä»¶å¤„ç†é˜¶æ®µ" class="headerlink" title="æ–‡ä»¶å¤„ç†é˜¶æ®µ"></a>æ–‡ä»¶å¤„ç†é˜¶æ®µ</h3><ol>
<li>ä½¿ç”¨libreofficeå°†docï¼Œdocxæ–‡ä»¶å¤„ç†æˆpdfæ–‡ä»¶ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨mineruè¿›è¡Œæå–</li>
<li>å®Œæˆmineruçš„dockeræœ¬åœ°éƒ¨ç½²ï¼›æ­å»ºfastapiæœåŠ¡ï¼Œä¸é¡¹ç›®å®¹å™¨æ„å»ºè‡ªå®šä¹‰ç½‘ç»œï¼Œæ–¹ä¾¿åç»­æœåŠ¡è°ƒç”¨ï¼›ä½¿ç”¨locustå®Œæˆå¯¹mineruçš„å¹¶å‘æ€§èƒ½æµ‹è¯•ï¼Œå’Œååé‡æµ‹è¯•</li>
<li>å¯¹mineruæå–çš„htmlæ ¼å¼çš„è¡¨æ ¼è¿›è¡Œé¢„å¤„ç†å·¥ä½œï¼Œå°†å…¶è½¬åŒ–æˆmdæ ¼å¼ï¼Œæ–¹ä¾¿åç»­åˆ†å—ï¼ŒèŠ‚çœtokens</li>
</ol>
<h4 id="éƒ¨åˆ†æŠ€æœ¯ç»†èŠ‚"><a href="#éƒ¨åˆ†æŠ€æœ¯ç»†èŠ‚" class="headerlink" title="éƒ¨åˆ†æŠ€æœ¯ç»†èŠ‚"></a>éƒ¨åˆ†æŠ€æœ¯ç»†èŠ‚</h4><p><strong>mineruæå–æ•ˆæœè¯´æ˜</strong></p>
<p>å¯ä»¥å®Œæ•´æå–è¡¨æ ¼ä¸å›¾ç‰‡ï¼Œå°†å›¾ç‰‡ä»¥ç›¸å¯¹é“¾æ¥å½¢å¼å‚¨å­˜åœ¨imagesæ–‡ä»¶å¤¹ä¸‹ï¼›å¯ä»¥å®Œæˆpdfä¸æ‰«æä»¶çš„æå–ï¼Œå¯ä»¥å®ç°å¯¹å›¾ç‰‡ä¸­æ–‡å­—çš„è¯†åˆ«ï¼›è¾“å‡ºç¬¦åˆäººç±»é˜…è¯»é¡ºåºçš„æ–‡æœ¬ï¼Œé€‚ç”¨äºå•æ ã€å¤šæ åŠå¤æ‚æ’ç‰ˆï¼›åˆ é™¤é¡µçœ‰ã€é¡µè„šã€è„šæ³¨ã€é¡µç ç­‰å…ƒç´ ï¼Œç¡®ä¿è¯­ä¹‰è¿è´¯</p>
<p>ç›®å‰é—®é¢˜ï¼šä»æ— æ³•å®ç°å¯¹å¤šçº§æ ‡é¢˜çš„è¯†åˆ«</p>
<p><strong>mineruçš„fastapiå¯åŠ¨æŒ‡ä»¤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MINERU_MODEL_SOURCE=local CUDA_VISIBLE_DEVICES=1,2,3 mineru-api --host 0.0.0.0 --port 30000 --dp-size 3 --enable-torch-compile</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MinerUæ”¯æŒé€šè¿‡sglangçš„å¤šGPUå¹¶è¡Œæ¨¡å¼æ¥æå‡æ¨ç†é€Ÿåº¦ã€‚</p>
<ul>
<li>å¦‚æœæ‚¨æœ‰è¶…è¿‡å¤šå¼ æ˜¾å¡ï¼Œå¯ä»¥ä½¿ç”¨sglangçš„å¤šå¡å¹¶è¡Œæ¨¡å¼æ¥å¢åŠ ååé‡ï¼š<code>--dp-size 2</code></li>
<li>åŒæ—¶æ‚¨å¯ä»¥å¯ç”¨<code>torch.compile</code>æ¥å°†æ¨ç†é€Ÿåº¦åŠ é€Ÿçº¦15%ï¼š<code>--enable-torch-compile</code></li>
</ul>
<p>æ³¨æ„è®¾ç½®ç¯å¢ƒå˜é‡<code>MINERU_MODEL_SOURCE=local CUDA_VISIBLE_DEVICES=1,2,3</code>ä¿è¯æ¨¡å‹æœ¬åœ°åŠ è½½ä¸è°ƒç”¨æŒ‡å®šgpu</p>
</blockquote>
<p><strong>mineruå®¹å™¨å¯åŠ¨æŒ‡ä»¤</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mineru-server --gpus all --shm-size 32g -p 30000:30000 --ipc=host -v /aisys/:/aisys/ --network network_test mineru-sglang:latest tail -f /dev/null</span><br><span class="line">docker start mineru-server</span><br></pre></td></tr></table></figure>
<p><strong>mineruä¸‰ç§åç«¯æ¨¡å¼æµ‹è¯•</strong></p>
<p>pipeline (é»˜è®¤åç«¯) ï¼Œvlm-sglang-engineï¼Œvlm-sglang-client</p>
<p>é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯vlm-sglang-engineï¼ŒåŸå› å¦‚ä¸‹ï¼Œpipelineåº”ç”¨åœºæ™¯æ›´å¤šæ˜¯ä»…èƒ½cpuæ¨ç†ï¼Œè§£æé€Ÿåº¦å¤§å¤§è½åä¸vlmæ¨¡å¼ï¼Œè€Œæˆ‘ä»¬gpuèµ„æºå……è¶³ï¼Œè‡ªç„¶ä¸è€ƒè™‘ï¼›vlm-sglang-clientåº”ç”¨åœºæ™¯æ›´å¤šæ˜¯æœ‰SGLangæœåŠ¡å™¨ï¼Œè¿™æ ·å®¢æˆ·ç«¯æ—¢å¯ä»¥ä¸ç”¨å®‰è£…sglangï¼ŒåŒæ ·ä¸ç¬¦åˆæˆ‘ä»¬çš„æ¡ä»¶</p>
<p><strong>mineruå¹¶å‘ä¸ååé‡æµ‹è¯•</strong></p>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼š10é¡µçš„pdfï¼Œ50ç”¨æˆ·å¹¶å‘</p>
<p><strong>å·¥å…·</strong>ï¼šlocust</p>
<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<p>å¯¹äºæ¨ç†æ¨¡å‹çš„ååé‡ï¼Œåœ¨3ä¸ªgpuå¼€å¯æ•°æ®å¹¶è¡Œçš„æƒ…å†µä¸‹ï¼Œå¹³å‡æ¯ç§’å•ä¸ªgpuå¤„ç†tokensä¸º1500å·¦å³</p>
<p>gpuçŠ¶æ€å¦‚ä¸Š:<strong>æ˜¾å­˜å‡ ä¹æ‰“æ»¡ 85â€“87 %</strong>,<strong>GPU åˆ©ç”¨ç‡ 59â€“63 %</strong>,<strong>åŠŸè€— 170â€“188 W / 350 W</strong></p>
<p>å‹æµ‹ç»“æœå¦‚ä¸‹ï¼Œé€‰å–éƒ¨åˆ†æŒ‡æ ‡</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>æ•°å€¼</th>
<th>é€šä¿—è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¹³å‡å“åº”æ—¶é—´</strong></td>
<td><strong>241 ç§’</strong> â‰ˆ <strong>4 åˆ†é’Ÿ</strong></td>
<td>ä¸Šä¼ ä¸€ä¸ª PDF â†’ æ‹¿åˆ°è§£æç»“æœï¼Œå¹³å‡è¦ç­‰ 4 åˆ†é’Ÿã€‚</td>
</tr>
<tr>
<td><strong>ä¸­ä½æ•°</strong></td>
<td><strong>215 ç§’</strong> â‰ˆ <strong>3.6 åˆ†é’Ÿ</strong></td>
<td>ä¸€åŠè¯·æ±‚åœ¨ 3.6 åˆ†é’Ÿå†…å®Œæˆã€‚</td>
</tr>
<tr>
<td><strong>95% ç”¨æˆ·</strong></td>
<td><strong>361 ç§’</strong> â‰ˆ <strong>6 åˆ†é’Ÿ</strong></td>
<td>æœ€æ…¢çš„ 5% è¦ç­‰ 6 åˆ†é’Ÿä»¥ä¸Šã€‚</td>
</tr>
<tr>
<td><strong>ååé‡</strong></td>
<td><strong>0.18 req/s</strong></td>
<td>è¿™å° MinerU <strong>æ¯åˆ†é’Ÿåªèƒ½å¤„ç†çº¦11 ä¸ª PDF</strong>ã€‚</td>
</tr>
</tbody>
</table>
</div>
<h3 id="åˆ†å—é˜¶æ®µ"><a href="#åˆ†å—é˜¶æ®µ" class="headerlink" title="åˆ†å—é˜¶æ®µ"></a>åˆ†å—é˜¶æ®µ</h3><p>å½“å‰ä¸»æµçš„åˆ†å—æ–¹å¼å…±äº”ç§ï¼šå›ºå®šé•¿åº¦åˆ†å—ï¼Œè¯­ä¹‰åˆ†å—ï¼Œé€’å½’åˆ†å—ï¼Œæ–‡æ¡£ç»“æ„åˆ†å—ï¼Œllmåˆ†å—ã€‚</p>
<p>æœ€åé¡¹ç›®æˆ‘é€‰æ‹©äº†é€’å½’åˆ†å—ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>
<ol>
<li>mineruæ— æ³•æ­£ç¡®æå–mdæ–‡æ¡£ç»“æ„ï¼Œå› æ­¤æˆ‘èˆå¼ƒäº†æ–‡æ¡£ç»“æ„åˆ†å—</li>
<li>æµ‹è¯•äº†agentic chunkï¼ˆå…¶ä¸»è¦æ€æƒ³æ˜¯ï¼Œå…ˆè¿›è¡Œåˆæ­¥åˆ†æ®µï¼ŒæŒ‰ç…§é•¿åº¦æˆ–é€’å½’ï¼Œç„¶åè®©å¤§æ¨¡å‹ç”Ÿæˆè¿™ä¸€æ®µçš„æ¦‚è¦ï¼Œå°†æ®µä¸æ®µåˆå¹¶ç”Ÿæˆå—ï¼‰ï¼Œä½†æ˜¯æµ‹è¯•ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿™ä¸ªä¸€ä¸ªæ–‡æ¡£çš„å†…å®¹åŒè´¨åŒ–å¾ˆä¸¥é‡ï¼ŒåŸºæœ¬ä¸Šéƒ½åˆ†åˆ°ä¸€å—é‡Œäº†ï¼Œæˆ‘çŒœæµ‹è¯­ä¹‰åˆ†å—ä¹Ÿæ˜¯è¿™ç§æ•ˆæœï¼Œå› æ­¤èˆå¼ƒ</li>
<li>æˆ‘ä»¬çš„æ–‡æ¡£ä¸­å­˜åœ¨å¤§é‡è¡¨æ ¼ï¼Œæˆ‘åœ¨é¢„å¤„ç†é˜¶æ®µå¢åŠ äº†å¯¹è¡¨æ ¼çš„é¦–å°¾æ ‡è®°ï¼Œä½¿ç”¨é€’å½’åˆ†å—å¯ä»¥æ›´å¥½çš„ä¿ç•™è¿™äº›ç»“æ„</li>
</ol>
<h3 id="æ£€ç´¢é˜¶æ®µ"><a href="#æ£€ç´¢é˜¶æ®µ" class="headerlink" title="æ£€ç´¢é˜¶æ®µ"></a>æ£€ç´¢é˜¶æ®µ</h3><p>åŸºäºlangchain_elasticsearchå®Œæˆäº†å‘é‡æœç´¢ï¼Œbm25ï¼Œæ··åˆæ£€ç´¢ï¼Œæ¨¡ç³Šæ£€ç´¢çš„æ£€ç´¢å‡½æ•°çš„ç¼–å†™ã€‚</p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ··åˆæ£€ç´¢elasticsearchéœ€è¦ä»˜è´¹ä½¿ç”¨</li>
<li>bm25çš„å¤šå­—æ®µæœç´¢æœ‰ä¸‰ç§æ¨¡å¼ä¸”å­—æ®µçš„æƒé‡å¯ä»¥è°ƒæ•´ï¼Œåç»­è¯„ä¼°æ—¶è°ƒæ•´è¿›è¡Œæµ‹è¯•</li>
<li>æ£€ç´¢çš„æ•ˆæœéœ€è¦åç»­è¿›è¡Œragè¯„ä¼°æ—¶åˆ¤å®š</li>
</ol>
<h3 id="elasticsearchç›¸å…³"><a href="#elasticsearchç›¸å…³" class="headerlink" title="elasticsearchç›¸å…³"></a>elasticsearchç›¸å…³</h3><p>å®Œæˆå¯¹é¡¹ç›®esæ¨¡å—çš„ç†Ÿæ‚‰é˜…è¯»ï¼›å®ç°å¯¹elasticsearchçš„è¿æ¥ä¸å­—æ®µçš„æ„å»ºä¸å­˜å…¥ã€‚</p>
<p>å…³äºå­—æ®µçš„å­˜å‚¨ï¼Œæˆ‘é€‰å–äº†report_nameï¼Œreport_urlï¼Œpage_content</p>
<h4 id="ç›¸å…³ç»†èŠ‚"><a href="#ç›¸å…³ç»†èŠ‚" class="headerlink" title="ç›¸å…³ç»†èŠ‚"></a>ç›¸å…³ç»†èŠ‚</h4><h5 id="é˜…è¯»elasticsearchä»£ç ç›¸å…³è®°å½•"><a href="#é˜…è¯»elasticsearchä»£ç ç›¸å…³è®°å½•" class="headerlink" title="é˜…è¯»elasticsearchä»£ç ç›¸å…³è®°å½•:"></a><strong>é˜…è¯»elasticsearchä»£ç ç›¸å…³è®°å½•:</strong></h5><ol>
<li><strong>embedding_model</strong>.select_embeddings_model:æ ¹æ®æŒ‡å®šçš„æ¨¡å‹åç§°åŠ è½½</li>
<li><strong>make_es_vector_store</strong>ï¼š<ol>
<li>docs_url = pd.read_excel(â€˜docs_new.xlsxâ€™)ï¼Œä»excelåŠ è½½urlå¹¶è¿›è¡Œæ•°æ®å¤„ç†ï¼Œä¿å­˜ç­›é€‰åçš„ur</li>
<li>å®Œæˆæ–‡ä»¶åŠ è½½æµ‹è¯•ï¼šxizhang/retrival/docfile_test/test.pyï¼›</li>
<li>åˆå§‹åŒ–esï¼Œä½¿ç”¨elastic_search.load_es_indexåŠ è½½å­˜å‚¨ç´¢å¼•</li>
<li>å®Œæˆæµ‹è¯•elasticsearchè¿æ¥ä¸ç´¢å¼•æ„å»ºï¼ˆç´¢å¼•åzxj_testï¼‰ï¼š/aisys/repo_dev/xizhang/retrival/elasticsearch_test/test_es_connect.pyï¼Œ/aisys/repo_dev/xizhang/retrival/elasticsearch_test/test_add_es.py</li>
<li>é¡ºåºæ‰¹é‡å¤„ç†æ–‡ä»¶ï¼šå…±16000å¤šä»½ï¼Œæ¯åä»½ä¸ºä¸€æ‰¹è¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨download_pdf.pyè¿›è¡Œæ–‡ä»¶ä¸‹è½½ï¼Œä½¿ç”¨ï¼Œä½¿ç”¨vector_base.rewrite_fileå¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œå¯ä»¥ä¿®æ”¹ä»£ç ï¼Œå¢åŠ å¯¹mineruå¤„ç†pdfçš„markdownæ–‡ä»¶çš„å¤„ç†ï¼Œè¿”å›Documentå¯¹è±¡åˆ—è¡¨ï¼›</li>
</ol>
</li>
<li><strong>elastic_search</strong></li>
</ol>
<p>é‡å†™äº†æ£€ç´¢ç­–ç•¥çš„å‡½æ•°ï¼ŒåŒ…æ‹¬BM25ï¼ŒKNNï¼Œæ··åˆæœç´¢</p>
<ol>
<li><p>elastic_retrieveråˆ›å»ºElasticsearchæ£€ç´¢å™¨ï¼šæ ¹æ®æœç´¢ç±»å‹é€‰æ‹©å¯¹åº”çš„æŸ¥è¯¢å‡½æ•°ï¼Œåˆ›å»ºElasticsearchæ£€ç´¢å™¨ElasticsearchRetriever.from_es_params</p>
</li>
<li><p><strong>retrievers</strong></p>
<ol>
<li>å®šä¹‰å‡½æ•°select_retrieverï¼Œæ ¹æ®æŒ‡å®šçš„åç§°é€‰æ‹©å¹¶è¿”å›ç›¸åº”çš„æ£€ç´¢å™¨ï¼Œç›®å‰åªæœ‰bm25</li>
</ol>
</li>
</ol>
<h5 id="æ–‡æ¡£ç»“æ„"><a href="#æ–‡æ¡£ç»“æ„" class="headerlink" title="æ–‡æ¡£ç»“æ„"></a>æ–‡æ¡£ç»“æ„</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">doc = Document(</span><br><span class="line">            page_content=text_content,</span><br><span class="line">            metadata=&#123;</span><br><span class="line">                &quot;report_name&quot;: folder_name,</span><br><span class="line">                &quot;report_url&quot;: report_url,</span><br><span class="line">                &quot;chunk_id&quot;: chunk_id</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h3 id="ragè¯„ä¼°"><a href="#ragè¯„ä¼°" class="headerlink" title="ragè¯„ä¼°"></a>ragè¯„ä¼°</h3><p>å¾…è¡¥å……</p>
<h3 id="åç»­ä¼˜åŒ–æ€è€ƒ"><a href="#åç»­ä¼˜åŒ–æ€è€ƒ" class="headerlink" title="åç»­ä¼˜åŒ–æ€è€ƒ"></a>åç»­ä¼˜åŒ–æ€è€ƒ</h3><ol>
<li>é‡æ’åºéƒ¨åˆ†æˆ‘æ²¡æœ‰åšè¿‡ï¼Œä¸çŸ¥é“æ€ä¹ˆåšï¼Œä¹Ÿä¸çŸ¥é“æ•ˆæœä¼šæ€æ ·ï¼ˆæˆ‘æ„Ÿè§‰åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯åº”è¯¥æå‡æœ‰é™ï¼Œå¬ä½ è¯´ä¹Ÿæ˜¯è¿™æ ·ï¼‰</li>
<li>å¦‚ä½•å­˜å…¥æ•°æ®åº“çš„éƒ¨åˆ†ï¼Œå¯èƒ½ä¹Ÿæ˜¯ä¼˜åŒ–çš„ç‚¹ï¼Œæ¯”å¦‚å¯ä»¥å°è¯•agentic ragè¿™ç§ï¼Œåœ¨å­˜å…¥æ•°æ®åº“å‰å†è¿›è¡Œä¸€æ­¥å¤„ç†</li>
<li>è¿˜æœ‰ä¸€ä¸ªç‚¹æˆ‘æ¯”è¾ƒå¥½å¥‡ï¼Œæˆ‘ä»¬é¡¹ç›®åœ¨å¬å›åæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œå°±æ˜¯ä¸Šä¸‹æ–‡æ‹¼æ¥å—</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/04/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/04/%E5%AD%A6%E4%B9%A0/%E6%A8%A1%E5%9E%8B/%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/" class="post-title-link" itemprop="url">æœªå‘½å</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-04 16:14:31 / ä¿®æ”¹æ—¶é—´ï¼š16:16:48" itemprop="dateCreated datePublished" datetime="2025-08-04T16:14:31+08:00">2025-08-04</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13BKozLEXE/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">DIYä½ çš„AIæ¢¦ä¸­æƒ…äººï¼ŸQwen3å¾®è°ƒæ‰‹æŠŠæ‰‹æ•™ä½ ï¼_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/04/%E5%AD%A6%E4%B9%A0/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/04/%E5%AD%A6%E4%B9%A0/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/" class="post-title-link" itemprop="url">A2Aåè®®</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-04 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š17:52:58" itemprop="dateCreated datePublished" datetime="2025-08-04T00:00:00+08:00">2025-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E7%9B%B8%E5%85%B3/" itemprop="url" rel="index"><span itemprop="name">aiç›¸å…³</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E7%9B%B8%E5%85%B3/A2A%E5%8D%8F%E8%AE%AE/" itemprop="url" rel="index"><span itemprop="name">A2Aåè®®</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/02/%E5%AD%A6%E4%B9%A0/%E6%9D%82%E9%A1%B9/python-uv%E5%8C%85%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/02/%E5%AD%A6%E4%B9%A0/%E6%9D%82%E9%A1%B9/python-uv%E5%8C%85%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">python-uvåŒ…ç®¡ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-02 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-02T00:00:00+08:00">2025-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-04 16:20:46" itemprop="dateModified" datetime="2025-08-04T16:20:46+08:00">2025-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å­¦ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/%E6%9D%82%E9%A1%B9/" itemprop="url" rel="index"><span itemprop="name">æ‚é¡¹</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ä»€ä¹ˆæ˜¯uv"><a href="#ä»€ä¹ˆæ˜¯uv" class="headerlink" title="ä»€ä¹ˆæ˜¯uv"></a>ä»€ä¹ˆæ˜¯uv</h3><p><code>uv</code> æ˜¯ç”± <strong>Astral</strong> å›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ª<strong>è¶…é«˜é€Ÿ Python åŒ…ç®¡ç†å™¨</strong>ï¼Œç”¨ <strong>Rust</strong> ç¼–å†™ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ <code>pip</code>ã€<code>venv</code>ã€<code>pip-tools</code>ã€<code>poetry</code> ç­‰å¤šä¸ªå·¥å…·ã€‚</p>
<h3 id="uvå¸¸ç”¨å‘½ä»¤"><a href="#uvå¸¸ç”¨å‘½ä»¤" class="headerlink" title="uvå¸¸ç”¨å‘½ä»¤"></a>uvå¸¸ç”¨å‘½ä»¤</h3><p>uv init myproj    åˆ›å»ºæ–°é¡¹ç›®</p>
<p>source .venv/bin/activateï¼ˆLinux/macOSï¼‰æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</p>
<p>uv add requests    å®‰è£…ä¾èµ–å¹¶å†™å…¥ pyproject.toml</p>
<p>uv remove requests    ç§»é™¤ä¾èµ–</p>
<p>uv sync    åŒæ­¥ä¾èµ–åˆ°è™šæ‹Ÿç¯å¢ƒ</p>
<p>uv export    å¯¼å‡º lock æ–‡ä»¶ä¸º requirements.txt ç­‰æ ¼å¼</p>
<p>uv build    æ„å»ºæºç åŒ…å’Œ wheel</p>
<p>uv publish    å‘å¸ƒåˆ° PyPI</p>
<h3 id="uvxæ˜¯ä»€ä¹ˆ"><a href="#uvxæ˜¯ä»€ä¹ˆ" class="headerlink" title="uvxæ˜¯ä»€ä¹ˆ"></a>uvxæ˜¯ä»€ä¹ˆ</h3><p><strong><code>uvx</code></strong> æ˜¯ï¼š</p>
<blockquote>
<p><strong>uv tool run</strong> çš„<strong>å¿«æ·åˆ«å</strong>ï¼ˆaliasï¼‰ï¼Œç”¨äº<strong>æ— éœ€å®‰è£…å³å¯è¿è¡Œ Python åŒ…æä¾›çš„å‘½ä»¤è¡Œå·¥å…·</strong>ã€‚</p>
</blockquote>
<p><code>uvx</code> å°±åƒ Python ä¸–ç•Œçš„ <strong><code>npx</code></strong> æˆ– <strong><code>pipx run</code></strong> â€”â€”<br><strong>ä¸´æ—¶æ‹‰å–ã€æ„å»ºéš”ç¦»ç¯å¢ƒã€è¿è¡Œå·¥å…·ï¼Œç”¨å®Œå³èµ°ï¼Œä¸ç•™ç—•è¿¹</strong>ã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ajJ7zPEa5/?spm_id_from=333.1387.upload.video_card.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">ã€uvã€‘Pythonè¿„ä»Šæœ€å¥½çš„é¡¹ç›®ç®¡ç†+ç¯å¢ƒç®¡ç†å·¥å…·ï¼ˆå§ï¼Ÿï¼‰_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13WGHz8EEz?spm_id_from=333.788.videopod.sections&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">ä»pipåˆ°uvï¼šä¸€å£æ°”æ¢³ç†ç°ä»£Pythoné¡¹ç›®ç®¡ç†å…¨æµç¨‹ï¼_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/02/%E5%AD%A6%E4%B9%A0/%E6%9D%82%E9%A1%B9/python-logging%E6%A8%A1%E5%9D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/02/%E5%AD%A6%E4%B9%A0/%E6%9D%82%E9%A1%B9/python-logging%E6%A8%A1%E5%9D%97/" class="post-title-link" itemprop="url">python-loggingæ¨¡å—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-02 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-02T00:00:00+08:00">2025-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-03 18:50:57" itemprop="dateModified" datetime="2025-08-03T18:50:57+08:00">2025-08-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å­¦ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/%E6%9D%82%E9%A1%B9/" itemprop="url" rel="index"><span itemprop="name">æ‚é¡¹</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h3><div class="table-container">
<table>
<thead>
<tr>
<th>çº§åˆ«</th>
<th>æ–¹æ³•</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>DEBUG</td>
<td><code>logging.debug()</code></td>
<td>è°ƒè¯•ä¿¡æ¯</td>
</tr>
<tr>
<td>INFO</td>
<td><code>logging.info()</code></td>
<td>æ™®é€šä¿¡æ¯</td>
</tr>
<tr>
<td>WARNING</td>
<td><code>logging.warning()</code></td>
<td>è­¦å‘Šä¿¡æ¯</td>
</tr>
<tr>
<td>ERROR</td>
<td><code>logging.error()</code></td>
<td>é”™è¯¯ä¿¡æ¯</td>
</tr>
<tr>
<td>CRITICAL</td>
<td><code>logging.critical()</code></td>
<td>ä¸¥é‡é”™è¯¯</td>
</tr>
</tbody>
</table>
</div>
<p>pythoné»˜è®¤åªä¼šæ‰“å°warningä»¥ä¸Šçº§åˆ«çš„æ—¥å¿—ï¼Œå¯é€šè¿‡<code>basicConfig</code>è¿›è¡Œè®¾ç½®ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åŸºç¡€é…ç½®</span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line"># è®°å½•ä¸åŒçº§åˆ«çš„æ—¥å¿—</span><br><span class="line">logging.debug(&quot;è¿™æ˜¯ä¸€ä¸ªDEBUGçº§åˆ«çš„æ—¥å¿—&quot;)</span><br><span class="line">logging.info(&quot;è¿™æ˜¯ä¸€ä¸ªINFOçº§åˆ«çš„æ—¥å¿—&quot;)</span><br><span class="line">logging.warning(&quot;è¿™æ˜¯ä¸€ä¸ªWARNINGçº§åˆ«çš„æ—¥å¿—&quot;)</span><br><span class="line">logging.error(&quot;è¿™æ˜¯ä¸€ä¸ªERRORçº§åˆ«çš„æ—¥å¿—&quot;)</span><br><span class="line">logging.critical(&quot;è¿™æ˜¯ä¸€ä¸ªCRITICALçº§åˆ«çš„æ—¥å¿—&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="æ ¼å¼åŒ–logå¹¶è¾“å‡º"><a href="#æ ¼å¼åŒ–logå¹¶è¾“å‡º" class="headerlink" title="æ ¼å¼åŒ–logå¹¶è¾“å‡º"></a>æ ¼å¼åŒ–logå¹¶è¾“å‡º</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¨å±€é…ç½®ï¼Œå®Œæˆlogçš„æ ¼å¼åŒ–å’Œè¾“å‡ºæˆæ–‡ä»¶ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.DEBUG,format=&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;,filename=&#x27;basic.log&#x27;,filemode=&#x27;w&#x27;)</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰logger</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºè‡ªå®šä¹‰logger</span><br><span class="line">logger = logging.getLogger(&#x27;my_app&#x27;)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"># æ¸…é™¤ä¹‹å‰çš„å¤„ç†å™¨</span><br><span class="line">logger.handlers.clear()</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ–‡ä»¶å¤„ç†å™¨</span><br><span class="line">file_handler = logging.FileHandler(&#x27;logs/my_app.log&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">file_handler.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ§åˆ¶å°å¤„ç†å™¨</span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setLevel(logging.WARNING)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸åŒçš„æ ¼å¼å™¨</span><br><span class="line">file_formatter = logging.Formatter(</span><br><span class="line">    &#x27;%(asctime)s | %(name)s | %(levelname)s | %(funcName)s:%(lineno)d | %(message)s&#x27;</span><br><span class="line">)</span><br><span class="line">console_formatter = logging.Formatter(</span><br><span class="line">    &#x27;ğŸš¨ %(levelname)s: %(message)s&#x27;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">file_handler.setFormatter(file_formatter)</span><br><span class="line">console_handler.setFormatter(console_formatter)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å¤„ç†å™¨</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•ä¸åŒçº§åˆ«çš„æ—¥å¿—</span><br><span class="line">logger.debug(&quot;è°ƒè¯•ä¿¡æ¯ - åªå†™å…¥æ–‡ä»¶&quot;)</span><br><span class="line">logger.info(&quot;æ™®é€šä¿¡æ¯ - åªå†™å…¥æ–‡ä»¶&quot;)</span><br><span class="line">logger.warning(&quot;è­¦å‘Šä¿¡æ¯ - æ§åˆ¶å°å’Œæ–‡ä»¶éƒ½æœ‰&quot;)</span><br><span class="line">logger.error(&quot;é”™è¯¯ä¿¡æ¯ - æ§åˆ¶å°å’Œæ–‡ä»¶éƒ½æœ‰&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="å¼‚å¸¸æ•è·"><a href="#å¼‚å¸¸æ•è·" class="headerlink" title="å¼‚å¸¸æ•è·"></a>å¼‚å¸¸æ•è·</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    result = divide(10, 0)</span><br><span class="line">except ZeroDivisionError as exc:</span><br><span class="line">    # æ–¹å¼ 1ï¼šè®°å½•å¼‚å¸¸å¯¹è±¡</span><br><span class="line">    logger.error(&quot;é™¤é›¶å¼‚å¸¸å‘ç”Ÿ: &#123;&#125;&quot;, exc)</span><br><span class="line"></span><br><span class="line">    # æ–¹å¼ 2ï¼šè®°å½•å®Œæ•´ tracebackï¼ˆæ¨èï¼‰</span><br><span class="line">    logger.exception(&quot;æ•è·åˆ°å¼‚å¸¸ï¼Œè¯¦æƒ…å¦‚ä¸‹&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="loguruçš„å¸¸ç”¨ä½¿ç”¨æ–¹æ³•"><a href="#loguruçš„å¸¸ç”¨ä½¿ç”¨æ–¹æ³•" class="headerlink" title="loguruçš„å¸¸ç”¨ä½¿ç”¨æ–¹æ³•"></a>loguruçš„å¸¸ç”¨ä½¿ç”¨æ–¹æ³•</h3><p>åŸºç¡€ç”¨æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">logger.debug(&quot;è¿™æ˜¯ debug&quot;)</span><br><span class="line">logger.info(&quot;è¿™æ˜¯ info&quot;)</span><br><span class="line">logger.warning(&quot;è¿™æ˜¯ warning&quot;)</span><br><span class="line">logger.error(&quot;è¿™æ˜¯ error&quot;)</span><br><span class="line">logger.critical(&quot;è¿™æ˜¯ critical&quot;)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºåˆ°æ–‡ä»¶    logger.add(â€œapp.logâ€)</p>
<p>è¿‡æ»¤çº§åˆ«    logger.add(â€œapp.logâ€, level=â€WARNINGâ€)</p>
<p>ç§»é™¤é»˜è®¤æ§åˆ¶å°è¾“å‡º       logger.remove()</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1rJv8eNE1x?spm_id_from=333.788.videopod.sections&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">[Python] loggingæ¨¡å—æ€ä¹ˆç”¨_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1VnW7edEq7?spm_id_from=333.788.videopod.sections&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">[Python] æ‰“å°logç¥å™¨ â€”â€” loguru_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/langgraph%E5%AE%9E%E6%88%98mcp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/langgraph%E5%AE%9E%E6%88%98mcp/" class="post-title-link" itemprop="url">langgraphå®æˆ˜mcp</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-01T00:00:00+08:00">2025-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-02 11:47:14" itemprop="dateModified" datetime="2025-08-02T11:47:14+08:00">2025-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/mcp/" itemprop="url" rel="index"><span itemprop="name">mcp</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install langchain-mcp-adapters</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨langgraphè°ƒç”¨mcp"><a href="#ä½¿ç”¨langgraphè°ƒç”¨mcp" class="headerlink" title="ä½¿ç”¨langgraphè°ƒç”¨mcp"></a>ä½¿ç”¨langgraphè°ƒç”¨mcp</h3><p>è¦ç‚¹ä¸»è¦æ˜¯åˆ©ç”¨MultiServerMCPClientæ„å»ºæœåŠ¡ï¼Œè·å–tool</p>
<p>åˆ©ç”¨é¢„è®¾çš„create_react_agentæ„å»ºReActæ¶æ„çš„æ™ºèƒ½ä½“å¹¶è°ƒç”¨å·¥å…·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">import asyncio # éœ€è¦å¯¼å…¥ asyncio æ¥è¿è¡Œå¼‚æ­¥å‡½æ•°</span><br><span class="line"># ä»langchain_mcp_adapters.clientæ¨¡å—å¯¼å…¥MultiServerMCPClientç±»</span><br><span class="line"># ä»langgraph.prebuiltæ¨¡å—å¯¼å…¥create_react_agentå‡½æ•°</span><br><span class="line">from langchain_mcp_adapters.client import MultiServerMCPClient</span><br><span class="line">from langgraph.prebuilt import create_react_agent</span><br><span class="line"></span><br><span class="line"># å¯¼å…¥ LLM ç›¸å…³åº“</span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line"></span><br><span class="line"># å°†ä¸»è¦é€»è¾‘å°è£…åœ¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä¸­</span><br><span class="line">async def main():</span><br><span class="line">    # åˆ›å»ºMultiServerMCPClientå®ä¾‹ï¼Œé…ç½®ä¸¤ä¸ªä¸åŒçš„æœåŠ¡</span><br><span class="line">    client = MultiServerMCPClient(</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;math&quot;: &#123;  # æ•°å­¦è®¡ç®—æœåŠ¡</span><br><span class="line">                &quot;command&quot;: &quot;python&quot;,  # ä½¿ç”¨pythonå‘½ä»¤å¯åŠ¨</span><br><span class="line">                # æ›¿æ¢ä¸ºä½ çš„math_server.pyæ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span><br><span class="line">                &quot;args&quot;: [&quot;/workspace/langgraph-mcp/math_server.py&quot;],</span><br><span class="line">                &quot;transport&quot;: &quot;stdio&quot;,  # ä½¿ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºä¼ è¾“</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;weather&quot;: &#123;  # å¤©æ°”æœåŠ¡</span><br><span class="line">                # ç¡®ä¿ä½ çš„å¤©æ°”æœåŠ¡å™¨åœ¨8000ç«¯å£è¿è¡Œ</span><br><span class="line">                # *** ç¡®ä¿è¿™ä¸ª URL æ˜¯æ­£ç¡®çš„ï¼Œå¹¶ä¸”æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ ***</span><br><span class="line">                &quot;url&quot;: &quot;http://localhost:8000/mcp&quot;,</span><br><span class="line">                &quot;transport&quot;: &quot;streamable_http&quot;,  # ä½¿ç”¨å¯æµå¼HTTPä¼ è¾“</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    tools = []</span><br><span class="line">    try:</span><br><span class="line">        # åœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨æ­£ç¡®ä½¿ç”¨ await</span><br><span class="line">        tools = await client.get_tools()</span><br><span class="line">        print(f&quot;æˆåŠŸè·å–åˆ° &#123;len(tools)&#125; ä¸ªMCPå·¥å…·ã€‚&quot;)</span><br><span class="line">        for tool_item in tools:</span><br><span class="line">            print(f&quot;  - &#123;tool_item.name&#125;: &#123;tool_item.description&#125;&quot;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;è·å–MCPå·¥å…·å¤±è´¥: &#123;e&#125;&quot;)</span><br><span class="line">        print(&quot;è¯·ç¡®ä¿MCPæœåŠ¡URLæœ‰æ•ˆä¸”å¯è®¿é—®ï¼Œæˆ–è€…æ‚¨å·²æ­£ç¡®é…ç½®äº†è®¤è¯ä¿¡æ¯ã€‚&quot;)</span><br><span class="line">        # åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¦‚æœå‡ºé”™å¯ä»¥é€‰æ‹©è¿”å›æˆ–ç»§ç»­å¤„ç†</span><br><span class="line">        # return # è¿™é‡Œå¯ä»¥ returnï¼Œä½†ä¼šç»“æŸ main å‡½æ•°</span><br><span class="line"></span><br><span class="line">    if not tools:</span><br><span class="line">        print(&quot;æ²¡æœ‰è·å–åˆ°å·¥å…·ï¼Œæ— æ³•åˆ›å»ºä»£ç†ã€‚&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # åˆ›å»ºReActä»£ç†</span><br><span class="line">    llm = ChatOpenAI(</span><br><span class="line">        model=&quot;qwen3-235b-a22b-thinking-2507&quot;,</span><br><span class="line">        api_key=&quot;sk-a8ef27c47ea84224ac6eed6d4bba1bab&quot;,</span><br><span class="line">        base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot; # ä¿®æ­£äº†æœ«å°¾å¤šä½™çš„ç©ºæ ¼</span><br><span class="line">    )</span><br><span class="line">    agent = create_react_agent(llm, tools)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    # å¼‚æ­¥è°ƒç”¨ä»£ç†æ¥è§£å†³æ•°å­¦é—®é¢˜</span><br><span class="line">    # ç¡®ä¿åœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨ä½¿ç”¨ await</span><br><span class="line">    math_response = await agent.ainvoke(</span><br><span class="line">        &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;what&#x27;s (3 + 5) x 12?&quot;&#125;]&#125;</span><br><span class="line">    )</span><br><span class="line">    print(&quot;\n--- æ•°å­¦é—®é¢˜å›ç­” ---&quot;)</span><br><span class="line">    print(math_response[&quot;messages&quot;][-1].content) # æ‰“å°æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆLLMçš„å›ç­”ï¼‰</span><br><span class="line"></span><br><span class="line">    # å¼‚æ­¥è°ƒç”¨ä»£ç†æ¥æŸ¥è¯¢å¤©æ°”</span><br><span class="line">    weather_response = await agent.ainvoke(</span><br><span class="line">        &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;what is the weather in nyc?&quot;&#125;]&#125;</span><br><span class="line">    )</span><br><span class="line">    print(&quot;\n--- å¤©æ°”é—®é¢˜å›ç­” ---&quot;)</span><br><span class="line">    print(weather_response[&quot;messages&quot;][-1].content) # æ‰“å°æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆLLMçš„å›ç­”ï¼‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --- è¿™æ˜¯è„šæœ¬çš„å…¥å£ç‚¹ ---</span><br><span class="line"># ä½¿ç”¨ asyncio.run() æ¥è¿è¡Œä½ çš„ä¸»å¼‚æ­¥å‡½æ•°</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    asyncio.run(main())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/agents/mcp/">ä½¿ç”¨ MCP - LangChain æ¡†æ¶</a></p>
<h3 id="æ¡†æ¶æµç¨‹"><a href="#æ¡†æ¶æµç¨‹" class="headerlink" title="æ¡†æ¶æµç¨‹"></a>æ¡†æ¶æµç¨‹</h3><p><img src="/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/langgraph%E5%AE%9E%E6%88%98mcp/image-20250801164905578.png" alt="image-20250801164905578"></p>
<p>âœ… ä¸‰ä¸ªè§’è‰²ï¼ˆç³»ç»Ÿç»„ä»¶ï¼‰</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>è§’è‰²</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Client</strong></td>
<td>å‰ç«¯æˆ–ç”¨æˆ·ç•Œé¢ï¼Œå‘èµ·è¯·æ±‚</td>
</tr>
<tr>
<td><strong>Auth Provider</strong></td>
<td>è®¤è¯æœåŠ¡ï¼ˆå¦‚ OAuthã€JWT æä¾›è€…ï¼‰ï¼Œè´Ÿè´£ç™»å½•å’Œç­¾å‘ token</td>
</tr>
<tr>
<td><strong>LangGraph Backend</strong></td>
<td>åº”ç”¨çš„åç«¯æœåŠ¡ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</td>
</tr>
<tr>
<td><strong>Secret Store</strong></td>
<td>å­˜æ”¾ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ tokenã€å¯†é’¥ç­‰ï¼‰</td>
</tr>
<tr>
<td><strong>MCP Server</strong></td>
<td>åç«¯å·¥å…·æœåŠ¡ï¼Œæä¾›å…·ä½“çš„å·¥å…·æˆ–èµ„æºæ¥å£</td>
</tr>
</tbody>
</table>
</div>
<p>âœ… æµç¨‹è¯¦è§£ï¼ˆ12æ­¥ï¼‰</p>
<p>ğŸ” é˜¶æ®µä¸€ï¼šç”¨æˆ·ç™»å½• &amp; è·å– Tokenï¼ˆ1~6ï¼‰</p>
<ol>
<li><p><strong>ç”¨æˆ·ç™»å½•</strong><br>Client æäº¤ç”¨æˆ·åå’Œå¯†ç ç»™ Auth Providerã€‚</p>
</li>
<li><p><strong>è¿”å› Token</strong><br>Auth Provider éªŒè¯æˆåŠŸåï¼Œè¿”å›ä¸€ä¸ªè®¿é—®ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚</p>
</li>
<li><p><strong>æºå¸¦ Token è¯·æ±‚</strong><br>Client å°† token é™„åŠ åœ¨è¯·æ±‚å¤´ä¸­ï¼Œå‘ç»™ LangGraph Backendã€‚</p>
</li>
<li><p><strong>éªŒè¯ Token</strong><br>LangGraph Backend ä½¿ç”¨ <code>@auth.authenticate</code> ä¸­é—´ä»¶éªŒè¯ token æ˜¯å¦æœ‰æ•ˆã€‚</p>
</li>
<li><p><strong>è·å–ç”¨æˆ·ä¿¡æ¯</strong><br>éªŒè¯é€šè¿‡åï¼ŒLangGraph Backend ä» Auth Provider æ‹‰å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>ç¡®è®¤æœ‰æ•ˆæ€§</strong><br>åç«¯ç¡®è®¤ç”¨æˆ·ä¿¡æ¯æ— è¯¯ï¼Œæµç¨‹ç»§ç»­ã€‚</p>
</li>
</ol>
<p>ğŸ”‘ é˜¶æ®µäºŒï¼šè·å–ç”¨æˆ·æƒé™ Tokenï¼ˆ6a~6bï¼‰</p>
<p>6a. <strong>æ‹‰å–ç”¨æˆ·æƒé™ Token</strong><br>   LangGraph Backend ä» Secret Store è·å–è¯¥ç”¨æˆ·å¯¹åº”çš„æƒé™ tokenï¼ˆå¯èƒ½æ˜¯ MCP æ‰€éœ€çš„è®¿é—®å‡­è¯ï¼‰ã€‚</p>
<p>6b. <strong>è¿”å›æƒé™ Token</strong><br>   Secret Store è¿”å›è¯¥ tokenã€‚</p>
<p>ğŸ› ï¸ é˜¶æ®µä¸‰ï¼šè°ƒç”¨å·¥å…· &amp; è¿”å›ç»“æœï¼ˆ7~12ï¼‰</p>
<ol>
<li><p><strong>æƒé™æ§åˆ¶æ£€æŸ¥</strong><br>LangGraph Backend ä½¿ç”¨ <code>@auth.on.*</code> æƒé™æ§åˆ¶é€»è¾‘ï¼Œç¡®è®¤ç”¨æˆ·æ˜¯å¦æœ‰æƒè°ƒç”¨è¯¥å·¥å…·ã€‚</p>
</li>
<li><p><strong>æ„å»º MCP Client</strong><br>åç«¯ç”¨ç”¨æˆ·çš„æƒé™ token æ„å»ºä¸€ä¸ª MCP å®¢æˆ·ç«¯ã€‚</p>
</li>
<li><p><strong>è°ƒç”¨ MCP å·¥å…·</strong><br>MCP Client å‘èµ·è¯·æ±‚ï¼Œè°ƒç”¨æŸä¸ªå…·ä½“å·¥å…·ï¼Œæºå¸¦ tokenï¼ˆé€šå¸¸æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼‰ã€‚</p>
</li>
<li><p><strong>MCP éªŒè¯å¹¶æ‰§è¡Œ</strong><br>MCP Server éªŒè¯ token æ˜¯å¦æœ‰æ•ˆï¼Œç¡®è®¤æ— è¯¯åæ‰§è¡Œå·¥å…·é€»è¾‘ã€‚</p>
</li>
<li><p><strong>å·¥å…·è¿”å›ç»“æœ</strong><br>MCP Server è¿”å›å·¥å…·æ‰§è¡Œç»“æœæˆ–èµ„æºæ•°æ®ã€‚</p>
</li>
<li><p><strong>è¿”å›ç»™å‰ç«¯</strong><br>LangGraph Backend å°†ç»“æœè¿”å›ç»™ Clientï¼Œå®Œæˆæ•´ä¸ªé“¾è·¯ã€‚</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/mcp%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/mcp%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">MCP å®¢æˆ·ç«¯å®æˆ˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-01 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š17:03:37" itemprop="dateCreated datePublished" datetime="2025-08-01T00:00:00+08:00">2025-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/mcp/" itemprop="url" rel="index"><span itemprop="name">mcp</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºé¡¹ç›®ç›®å½•</span><br><span class="line">uv init mcp-client</span><br><span class="line">cd mcp-client</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span><br><span class="line">uv venv</span><br><span class="line"></span><br><span class="line"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line"># åœ¨ Windows ä¸Š:</span><br><span class="line">.venv\Scripts\activate</span><br><span class="line"># åœ¨ Unix æˆ– MacOS ä¸Š:</span><br><span class="line">source .venv/bin/activate</span><br><span class="line"></span><br><span class="line"># å®‰è£…æ‰€éœ€åŒ…</span><br><span class="line">uv add mcp anthropic python-dotenv</span><br><span class="line">#ä½¿ç”¨é•œåƒæºå®‰è£…</span><br><span class="line">uv add mcp anthropic python-dotenv --index-url https://pypi.tuna.tsinghua.edu.cn/simple/</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æ ·æ¿æ–‡ä»¶</span><br><span class="line"># åœ¨ Windows ä¸Š:</span><br><span class="line">del main.py</span><br><span class="line"># åœ¨ Unix æˆ– MacOS ä¸Š:</span><br><span class="line">rm main.py</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæˆ‘ä»¬çš„ä¸»æ–‡ä»¶</span><br><span class="line">touch client.py</span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®-API-å¯†é’¥"><a href="#è®¾ç½®-API-å¯†é’¥" class="headerlink" title="è®¾ç½® API å¯†é’¥"></a>è®¾ç½® API å¯†é’¥</h3><p>åˆ›å»ºä¸€ä¸ª <code>.env</code> æ–‡ä»¶æ¥å­˜å‚¨å®ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Create .env file</span><br><span class="line">touch .env</span><br></pre></td></tr></table></figure>
<p>å°†æ‚¨çš„å¯†é’¥æ·»åŠ åˆ° <code>.env</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANTHROPIC_API_KEY=&lt;your key here&gt;</span><br></pre></td></tr></table></figure>
<p>å°† <code>.env</code> æ·»åŠ åˆ°æ‚¨çš„ <code>.gitignore</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;.env&quot; &gt;&gt; .gitignore</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å°† <code>.env</code> æ–‡ä»¶åæ·»åŠ åˆ° <code>.gitignore</code> æ–‡ä»¶ä¸­ï¼Œè¿™æ · Git å°±ä¼šå¿½ç•¥ <code>.env</code> æ–‡ä»¶ï¼Œä¸ä¼šå°†å…¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
</blockquote>
<h3 id="åˆ›å»ºå®¢æˆ·ç«¯"><a href="#åˆ›å»ºå®¢æˆ·ç«¯" class="headerlink" title="åˆ›å»ºå®¢æˆ·ç«¯"></a>åˆ›å»ºå®¢æˆ·ç«¯</h3><h4 id="åŸºæœ¬å®¢æˆ·ç«¯ç»“æ„"><a href="#åŸºæœ¬å®¢æˆ·ç«¯ç»“æ„" class="headerlink" title="åŸºæœ¬å®¢æˆ·ç«¯ç»“æ„"></a>åŸºæœ¬å®¢æˆ·ç«¯ç»“æ„</h4><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¾ç½®æˆ‘ä»¬çš„å¯¼å…¥å¹¶åˆ›å»ºåŸºæœ¬çš„å®¢æˆ·ç«¯ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">from typing import Optional</span><br><span class="line">from contextlib import AsyncExitStack</span><br><span class="line"></span><br><span class="line">from mcp import ClientSession, StdioServerParameters</span><br><span class="line">from mcp.client.stdio import stdio_client</span><br><span class="line"></span><br><span class="line">from anthropic import Anthropic</span><br><span class="line">from dotenv import load_dotenv</span><br><span class="line"></span><br><span class="line">load_dotenv()  # ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">class MCPClient:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        # åˆå§‹åŒ–ä¼šè¯å’Œå®¢æˆ·ç«¯å¯¹è±¡</span><br><span class="line">        self.session: Optional[ClientSession] = None  # MCPå®¢æˆ·ç«¯ä¼šè¯</span><br><span class="line">        self.exit_stack = AsyncExitStack()  # å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å †æ ˆï¼Œç”¨äºèµ„æºæ¸…ç†</span><br><span class="line">        self.anthropic = Anthropic()  # Anthropic AI å®¢æˆ·ç«¯</span><br><span class="line">        </span><br><span class="line">    # åç»­æ–¹æ³•å°†åœ¨è¿™é‡Œå®šä¹‰</span><br></pre></td></tr></table></figure>
<h4 id="æœåŠ¡å™¨è¿æ¥ç®¡ç†"><a href="#æœåŠ¡å™¨è¿æ¥ç®¡ç†" class="headerlink" title="æœåŠ¡å™¨è¿æ¥ç®¡ç†"></a>æœåŠ¡å™¨è¿æ¥ç®¡ç†</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ç°è¿æ¥åˆ° MCP æœåŠ¡å™¨çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">async def connect_to_server(self, server_script_path: str):</span><br><span class="line">    &quot;&quot;&quot;è¿æ¥åˆ°MCPæœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        server_script_path: æœåŠ¡å™¨è„šæœ¬è·¯å¾„ (.py æˆ– .js æ–‡ä»¶)</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # æ£€æŸ¥æ˜¯å¦ä¸ºPythonæ–‡ä»¶</span><br><span class="line">    is_python = server_script_path.endswith(&#x27;.py&#x27;)</span><br><span class="line">    # æ£€æŸ¥æ˜¯å¦ä¸ºJavaScriptæ–‡ä»¶</span><br><span class="line">    is_js = server_script_path.endswith(&#x27;.js&#x27;)</span><br><span class="line">    </span><br><span class="line">    # å¦‚æœä¸æ˜¯Pythonæˆ–JavaScriptæ–‡ä»¶ï¼Œåˆ™æŠ›å‡ºé”™è¯¯</span><br><span class="line">    if not (is_python or is_js):</span><br><span class="line">        raise ValueError(&quot;æœåŠ¡å™¨è„šæœ¬å¿…é¡»æ˜¯ .py æˆ– .js æ–‡ä»¶&quot;)</span><br><span class="line"></span><br><span class="line">    # æ ¹æ®æ–‡ä»¶ç±»å‹ç¡®å®šæ‰§è¡Œå‘½ä»¤</span><br><span class="line">    command = &quot;python&quot; if is_python else &quot;node&quot;</span><br><span class="line">    </span><br><span class="line">    # åˆ›å»ºæœåŠ¡å™¨å‚æ•°å¯¹è±¡</span><br><span class="line">    server_params = StdioServerParameters(</span><br><span class="line">        command=command,           # æ‰§è¡Œå‘½ä»¤</span><br><span class="line">        args=[server_script_path], # è„šæœ¬è·¯å¾„ä½œä¸ºå‚æ•°</span><br><span class="line">        env=None                   # ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨é»˜è®¤ç¯å¢ƒï¼‰</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # å»ºç«‹stdioå®¢æˆ·ç«¯è¿æ¥å¹¶å°†å…¶æ·»åŠ åˆ°å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­</span><br><span class="line">    stdio_transport = await self.exit_stack.enter_async_context(stdio_client(server_params))</span><br><span class="line">    self.stdio, self.write = stdio_transport</span><br><span class="line">    </span><br><span class="line">    # åˆ›å»ºå®¢æˆ·ç«¯ä¼šè¯å¹¶å°†å…¶æ·»åŠ åˆ°å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­</span><br><span class="line">    self.session = await self.exit_stack.enter_async_context(ClientSession(self.stdio, self.write))</span><br><span class="line"></span><br><span class="line">    # åˆå§‹åŒ–ä¼šè¯</span><br><span class="line">    await self.session.initialize()</span><br><span class="line"></span><br><span class="line">    # åˆ—å‡ºå¯ç”¨çš„å·¥å…·</span><br><span class="line">    response = await self.session.list_tools()</span><br><span class="line">    tools = response.tools</span><br><span class="line">    </span><br><span class="line">    # æ‰“å°è¿æ¥çš„æœåŠ¡å™¨æä¾›çš„å·¥å…·åˆ—è¡¨</span><br><span class="line">    print(&quot;\nå·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¯ç”¨å·¥å…·:&quot;, [tool.name for tool in tools])</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥è¯¢å¤„ç†é€»è¾‘"><a href="#æŸ¥è¯¢å¤„ç†é€»è¾‘" class="headerlink" title="æŸ¥è¯¢å¤„ç†é€»è¾‘"></a>æŸ¥è¯¢å¤„ç†é€»è¾‘</h4><p>ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ å¤„ç†æŸ¥è¯¢å’Œè°ƒç”¨å·¥å…·çš„æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">async def process_query(self, query: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;ä½¿ç”¨Claudeå’Œå¯ç”¨å·¥å…·å¤„ç†æŸ¥è¯¢&quot;&quot;&quot;</span><br><span class="line">    # æ„å»ºæ¶ˆæ¯åˆ—è¡¨</span><br><span class="line">    messages = [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;role&quot;: &quot;user&quot;,      # ç”¨æˆ·è§’è‰²</span><br><span class="line">            &quot;content&quot;: query     # ç”¨æˆ·æŸ¥è¯¢å†…å®¹</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    # è·å–å¯ç”¨å·¥å…·åˆ—è¡¨</span><br><span class="line">    response = await self.session.list_tools()</span><br><span class="line">    available_tools = [&#123;</span><br><span class="line">        &quot;name&quot;: tool.name,           # å·¥å…·åç§°</span><br><span class="line">        &quot;description&quot;: tool.description,  # å·¥å…·æè¿°</span><br><span class="line">        &quot;input_schema&quot;: tool.inputSchema  # å·¥å…·è¾“å…¥æ¨¡å¼</span><br><span class="line">    &#125; for tool in response.tools]</span><br><span class="line"></span><br><span class="line">    # åˆå§‹Claude APIè°ƒç”¨</span><br><span class="line">    response = self.anthropic.messages.create(</span><br><span class="line">        model=&quot;qwen3-235b-a22b&quot;,  # ä½¿ç”¨çš„æ¨¡å‹</span><br><span class="line">        max_tokens=1000,                     # æœ€å¤§è¿”å›ä»¤ç‰Œæ•°</span><br><span class="line">        messages=messages,                   # æ¶ˆæ¯å†å²</span><br><span class="line">        tools=available_tools               # å¯ç”¨å·¥å…·</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # å¤„ç†å“åº”å¹¶å¤„ç†å·¥å…·è°ƒç”¨</span><br><span class="line">    final_text = []  # å­˜å‚¨æœ€ç»ˆæ–‡æœ¬ç»“æœ</span><br><span class="line"></span><br><span class="line">    assistant_message_content = []  # å­˜å‚¨åŠ©æ‰‹æ¶ˆæ¯å†…å®¹</span><br><span class="line">    for content in response.content:  # éå†å“åº”å†…å®¹</span><br><span class="line">        if content.type == &#x27;text&#x27;:  # å¦‚æœæ˜¯æ–‡æœ¬å†…å®¹</span><br><span class="line">            final_text.append(content.text)  # æ·»åŠ åˆ°æœ€ç»ˆç»“æœ</span><br><span class="line">            assistant_message_content.append(content)  # æ·»åŠ åˆ°åŠ©æ‰‹æ¶ˆæ¯</span><br><span class="line">        elif content.type == &#x27;tool_use&#x27;:  # å¦‚æœæ˜¯å·¥å…·è°ƒç”¨</span><br><span class="line">            tool_name = content.name    # å·¥å…·åç§°</span><br><span class="line">            tool_args = content.input   # å·¥å…·å‚æ•°</span><br><span class="line"></span><br><span class="line">            # æ‰§è¡Œå·¥å…·è°ƒç”¨</span><br><span class="line">            result = await self.session.call_tool(tool_name, tool_args)</span><br><span class="line">            final_text.append(f&quot;[è°ƒç”¨å·¥å…· &#123;tool_name&#125;ï¼Œå‚æ•° &#123;tool_args&#125;]&quot;)</span><br><span class="line"></span><br><span class="line">            assistant_message_content.append(content)</span><br><span class="line">            # æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯åˆ°å†å²</span><br><span class="line">            messages.append(&#123;</span><br><span class="line">                &quot;role&quot;: &quot;assistant&quot;,</span><br><span class="line">                &quot;content&quot;: assistant_message_content</span><br><span class="line">            &#125;)</span><br><span class="line">            # æ·»åŠ å·¥å…·æ‰§è¡Œç»“æœåˆ°å†å²</span><br><span class="line">            messages.append(&#123;</span><br><span class="line">                &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">                &quot;content&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;type&quot;: &quot;tool_result&quot;,      # å·¥å…·ç»“æœç±»å‹</span><br><span class="line">                        &quot;tool_use_id&quot;: content.id,  # å·¥å…·ä½¿ç”¨ID</span><br><span class="line">                        &quot;content&quot;: result.content   # å·¥å…·æ‰§è¡Œç»“æœ</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            # è·å–Claudeçš„ä¸‹ä¸€ä¸ªå“åº”</span><br><span class="line">            response = self.anthropic.messages.create(</span><br><span class="line">                model=&quot;qwen3-235b-a22b&quot;,</span><br><span class="line">                max_tokens=1000,</span><br><span class="line">                messages=messages,</span><br><span class="line">                tools=available_tools</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            # æ·»åŠ å“åº”æ–‡æœ¬åˆ°æœ€ç»ˆç»“æœ</span><br><span class="line">            final_text.append(response.content[0].text)</span><br><span class="line"></span><br><span class="line">    # è¿”å›è¿æ¥åçš„æœ€ç»ˆæ–‡æœ¬ç»“æœ</span><br><span class="line">    return &quot;\n&quot;.join(final_text)</span><br></pre></td></tr></table></figure>
<h4 id="äº¤äº’å¼èŠå¤©ç•Œé¢"><a href="#äº¤äº’å¼èŠå¤©ç•Œé¢" class="headerlink" title="äº¤äº’å¼èŠå¤©ç•Œé¢"></a>äº¤äº’å¼èŠå¤©ç•Œé¢</h4><p>ç°åœ¨æˆ‘ä»¬å°†æ·»åŠ èŠå¤©å¾ªç¯å’Œæ¸…ç†åŠŸèƒ½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">async def chat_loop(self):</span><br><span class="line">    &quot;&quot;&quot;è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯&quot;&quot;&quot;</span><br><span class="line">    print(&quot;\nMCPå®¢æˆ·ç«¯å·²å¯åŠ¨!&quot;)</span><br><span class="line">    print(&quot;è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–è¾“å…¥&#x27;quit&#x27;é€€å‡ºã€‚&quot;)</span><br><span class="line"></span><br><span class="line">    while True:  # æ— é™å¾ªç¯ï¼ŒæŒç»­æ¥æ”¶ç”¨æˆ·è¾“å…¥</span><br><span class="line">        try:</span><br><span class="line">            query = input(&quot;\né—®é¢˜: &quot;).strip()  # è·å–ç”¨æˆ·è¾“å…¥å¹¶å»é™¤é¦–å°¾ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">            if query.lower() == &#x27;quit&#x27;:  # å¦‚æœç”¨æˆ·è¾“å…¥&#x27;quit&#x27;ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</span><br><span class="line">                break  # é€€å‡ºå¾ªç¯</span><br><span class="line"></span><br><span class="line">            # å¤„ç†ç”¨æˆ·æŸ¥è¯¢å¹¶è·å–å“åº”</span><br><span class="line">            response = await self.process_query(query)</span><br><span class="line">            print(&quot;\n&quot; + response)  # æ‰“å°AIå“åº”ç»“æœ</span><br><span class="line"></span><br><span class="line">        except Exception as e:  # æ•è·æ‰€æœ‰å¼‚å¸¸</span><br><span class="line">            print(f&quot;\né”™è¯¯: &#123;str(e)&#125;&quot;)  # æ‰“å°é”™è¯¯ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">async def cleanup(self):</span><br><span class="line">    &quot;&quot;&quot;æ¸…ç†èµ„æº&quot;&quot;&quot;</span><br><span class="line">    await self.exit_stack.aclose()  # å¼‚æ­¥å…³é—­æ‰€æœ‰åœ¨exit_stackä¸­ç®¡ç†çš„èµ„æº</span><br></pre></td></tr></table></figure>
<h4 id="ä¸»å…¥å£ç‚¹"><a href="#ä¸»å…¥å£ç‚¹" class="headerlink" title="ä¸»å…¥å£ç‚¹"></a>ä¸»å…¥å£ç‚¹</h4><p>æœ€åï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸»è¦çš„æ‰§è¡Œé€»è¾‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">async def main():</span><br><span class="line">    # æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°æ•°é‡ï¼Œå¦‚æœå°‘äº2ä¸ªåˆ™æ˜¾ç¤ºä½¿ç”¨è¯´æ˜</span><br><span class="line">    if len(sys.argv) &lt; 2:</span><br><span class="line">        print(&quot;ç”¨æ³•: python client.py &lt;æœåŠ¡å™¨è„šæœ¬è·¯å¾„&gt;&quot;)</span><br><span class="line">        sys.exit(1)  # é€€å‡ºç¨‹åºï¼Œè¿”å›é”™è¯¯ç 1</span><br><span class="line"></span><br><span class="line">    # åˆ›å»ºMCPå®¢æˆ·ç«¯å®ä¾‹</span><br><span class="line">    client = MCPClient()</span><br><span class="line">    try:</span><br><span class="line">        # è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œsys.argv[1]æ˜¯ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼ˆæœåŠ¡å™¨è„šæœ¬è·¯å¾„ï¼‰</span><br><span class="line">        await client.connect_to_server(sys.argv[1])</span><br><span class="line">        # å¯åŠ¨äº¤äº’å¼èŠå¤©å¾ªç¯</span><br><span class="line">        await client.chat_loop()</span><br><span class="line">    finally:</span><br><span class="line">        # ç¡®ä¿ç¨‹åºç»“æŸæ—¶æ¸…ç†èµ„æº</span><br><span class="line">        await client.cleanup()</span><br><span class="line"></span><br><span class="line"># ç¨‹åºå…¥å£ç‚¹</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    import sys  # å¯¼å…¥sysæ¨¡å—ç”¨äºå¤„ç†å‘½ä»¤è¡Œå‚æ•°</span><br><span class="line">    # è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>
<p><img src="/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/mcp%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E6%88%98/QQ20250801-164738.png" alt="QQ20250801-164738"></p>
<h3 id="è¿è¡Œå®¢æˆ·ç«¯"><a href="#è¿è¡Œå®¢æˆ·ç«¯" class="headerlink" title="è¿è¡Œå®¢æˆ·ç«¯"></a>è¿è¡Œå®¢æˆ·ç«¯</h3><p>è¦ä½¿æ‚¨çš„å®¢æˆ·ç«¯ä¸ä»»ä½• MCP æœåŠ¡å™¨è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uv run client.py path/to/server.py # python server</span><br><span class="line">uv run client.py path/to/build/index.js # node server</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯å°†ï¼š</p>
<ol>
<li>è¿æ¥åˆ°æŒ‡å®šæœåŠ¡å™¨</li>
<li>åˆ—å‡ºå¯ç”¨å·¥å…·</li>
<li>å¼€å§‹ä¸€ä¸ªäº¤äº’å¼èŠå¤©ä¼šè¯ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ï¼š<ul>
<li>è¾“å…¥æŸ¥è¯¢</li>
<li>æŸ¥çœ‹å·¥å…·æ‰§è¡Œæƒ…å†µ</li>
<li>ä» Claude è·å–å“åº”</li>
</ul>
</li>
</ol>
<h3 id="è¿ä½œæµç¨‹"><a href="#è¿ä½œæµç¨‹" class="headerlink" title="è¿ä½œæµç¨‹"></a>è¿ä½œæµç¨‹</h3><p>å½“ä½ æäº¤æŸ¥è¯¢æ—¶ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯ä»æœåŠ¡å™¨è·å–å¯ç”¨å·¥å…·åˆ—è¡¨</li>
<li>ä½ çš„æŸ¥è¯¢è¿åŒå·¥å…·æè¿°ä¸€èµ·å‘é€ç»™ Claude</li>
<li>Claude å†³å®šä½¿ç”¨å“ªäº›å·¥å…·ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</li>
<li>å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨æ‰§è¡Œä»»ä½•è¯·æ±‚çš„å·¥å…·è°ƒç”¨</li>
<li>ç»“æœä¼šå‘é€å› Claude</li>
<li>Claude æä¾›è‡ªç„¶è¯­è¨€å“åº”</li>
<li>å“åº”æ˜¾ç¤ºç»™æ‚¨</li>
</ol>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/quickstart/client#main-entry-point">Build an MCP Client - Model Context Protocol</a></p>
<h3 id="é€‚é…openaiç‰ˆæœ¬"><a href="#é€‚é…openaiç‰ˆæœ¬" class="headerlink" title="é€‚é…openaiç‰ˆæœ¬"></a>é€‚é…openaiç‰ˆæœ¬</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">from typing import Optional</span><br><span class="line">from contextlib import AsyncExitStack</span><br><span class="line"></span><br><span class="line">from mcp import ClientSession, StdioServerParameters</span><br><span class="line">from mcp.client.stdio import stdio_client</span><br><span class="line"></span><br><span class="line">from openai import OpenAI</span><br><span class="line">from dotenv import load_dotenv</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">load_dotenv()  # ä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡</span><br><span class="line"></span><br><span class="line">class MCPClient:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        # åˆå§‹åŒ–ä¼šè¯å’Œå®¢æˆ·ç«¯å¯¹è±¡</span><br><span class="line">        self.session: Optional[ClientSession] = None  # MCPå®¢æˆ·ç«¯ä¼šè¯</span><br><span class="line">        self.exit_stack = AsyncExitStack()  # å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å †æ ˆï¼Œç”¨äºèµ„æºæ¸…ç†</span><br><span class="line">        self.anthropic = OpenAI(</span><br><span class="line">            api_key=os.getenv(&quot;DASHSCOPE_API_KEY&quot;),</span><br><span class="line">            base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">        )  # ä½¿ç”¨OpenAIå…¼å®¹æ¨¡å¼è¿æ¥é€šä¹‰åƒé—®</span><br><span class="line">        </span><br><span class="line">    async def connect_to_server(self, server_script_path: str):</span><br><span class="line">        &quot;&quot;&quot;è¿æ¥åˆ°MCPæœåŠ¡å™¨</span><br><span class="line">        </span><br><span class="line">        Args:</span><br><span class="line">            server_script_path (str): æœåŠ¡å™¨è„šæœ¬è·¯å¾„ï¼Œæ”¯æŒ.pyæˆ–.jsæ–‡ä»¶</span><br><span class="line">        </span><br><span class="line">        Raises:</span><br><span class="line">            ValueError: å½“è„šæœ¬æ–‡ä»¶ä¸æ˜¯.pyæˆ–.jsæ ¼å¼æ—¶æŠ›å‡º</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # æ£€æŸ¥æ˜¯å¦ä¸ºPythonæ–‡ä»¶</span><br><span class="line">        is_python = server_script_path.endswith(&#x27;.py&#x27;)</span><br><span class="line">        # æ£€æŸ¥æ˜¯å¦ä¸ºJavaScriptæ–‡ä»¶</span><br><span class="line">        is_js = server_script_path.endswith(&#x27;.js&#x27;)</span><br><span class="line">        </span><br><span class="line">        # å¦‚æœä¸æ˜¯Pythonæˆ–JavaScriptæ–‡ä»¶ï¼Œåˆ™æŠ›å‡ºé”™è¯¯</span><br><span class="line">        if not (is_python or is_js):</span><br><span class="line">            raise ValueError(&quot;æœåŠ¡å™¨è„šæœ¬å¿…é¡»æ˜¯ .py æˆ– .js æ–‡ä»¶&quot;)</span><br><span class="line"></span><br><span class="line">        # æ ¹æ®æ–‡ä»¶ç±»å‹ç¡®å®šæ‰§è¡Œå‘½ä»¤</span><br><span class="line">        command = &quot;python&quot; if is_python else &quot;node&quot;</span><br><span class="line">        </span><br><span class="line">        # åˆ›å»ºæœåŠ¡å™¨å‚æ•°å¯¹è±¡</span><br><span class="line">        server_params = StdioServerParameters(</span><br><span class="line">            command=command,           # æ‰§è¡Œå‘½ä»¤</span><br><span class="line">            args=[server_script_path], # è„šæœ¬è·¯å¾„ä½œä¸ºå‚æ•°</span><br><span class="line">            env=None                   # ç¯å¢ƒå˜é‡ï¼ˆä½¿ç”¨é»˜è®¤ç¯å¢ƒï¼‰</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        # å»ºç«‹stdioå®¢æˆ·ç«¯è¿æ¥å¹¶å°†å…¶æ·»åŠ åˆ°å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­</span><br><span class="line">        stdio_transport = await self.exit_stack.enter_async_context(stdio_client(server_params))</span><br><span class="line">        self.stdio, self.write = stdio_transport</span><br><span class="line">        </span><br><span class="line">        # åˆ›å»ºå®¢æˆ·ç«¯ä¼šè¯å¹¶å°†å…¶æ·»åŠ åˆ°å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­</span><br><span class="line">        self.session = await self.exit_stack.enter_async_context(ClientSession(self.stdio, self.write))</span><br><span class="line"></span><br><span class="line">        # åˆå§‹åŒ–ä¼šè¯</span><br><span class="line">        await self.session.initialize()</span><br><span class="line"></span><br><span class="line">        # åˆ—å‡ºå¯ç”¨çš„å·¥å…·</span><br><span class="line">        response = await self.session.list_tools()</span><br><span class="line">        tools = response.tools</span><br><span class="line">        </span><br><span class="line">        # æ‰“å°è¿æ¥çš„æœåŠ¡å™¨æä¾›çš„å·¥å…·åˆ—è¡¨</span><br><span class="line">        print(&quot;\nå·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¯ç”¨å·¥å…·:&quot;, [tool.name for tool in tools])</span><br><span class="line"></span><br><span class="line">    async def process_query(self, query: str) -&gt; str:</span><br><span class="line">        &quot;&quot;&quot;ä½¿ç”¨Qwenå’Œå¯ç”¨å·¥å…·å¤„ç†æŸ¥è¯¢&quot;&quot;&quot;</span><br><span class="line">        # æ„å»ºæ¶ˆæ¯åˆ—è¡¨</span><br><span class="line">        messages = [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;role&quot;: &quot;user&quot;,</span><br><span class="line">                &quot;content&quot;: query</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        # è·å–å¯ç”¨å·¥å…·åˆ—è¡¨å¹¶è½¬æ¢ä¸ºOpenAIæ ¼å¼</span><br><span class="line">        response = await self.session.list_tools()</span><br><span class="line">        available_tools = []</span><br><span class="line">        for tool in response.tools:</span><br><span class="line">            schema = tool.inputSchema</span><br><span class="line">            if isinstance(schema, str):</span><br><span class="line">                schema = json.loads(schema)</span><br><span class="line">            if isinstance(schema, dict) and &quot;properties&quot; in schema:</span><br><span class="line">                schema = &#123;&quot;type&quot;: &quot;object&quot;, **schema&#125;</span><br><span class="line"></span><br><span class="line">            available_tools.append(&#123;</span><br><span class="line">                &quot;type&quot;: &quot;function&quot;,</span><br><span class="line">                &quot;function&quot;: &#123;</span><br><span class="line">                    &quot;name&quot;: tool.name,</span><br><span class="line">                    &quot;description&quot;: tool.description,</span><br><span class="line">                    &quot;parameters&quot;: schema</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        # ç¬¬ä¸€æ¬¡è°ƒç”¨æ¨¡å‹</span><br><span class="line">        response = self.anthropic.chat.completions.create(</span><br><span class="line">            model=&quot;qwen3-235b-a22b&quot;,</span><br><span class="line">            max_tokens=1000,</span><br><span class="line">            messages=messages,</span><br><span class="line">            tools=available_tools,</span><br><span class="line">            extra_body=&#123;&quot;enable_thinking&quot;: False&#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        final_text = []</span><br><span class="line">        message = response.choices[0].message</span><br><span class="line"></span><br><span class="line">        # å¤„ç†æ–‡æœ¬å†…å®¹</span><br><span class="line">        if message.content:</span><br><span class="line">            final_text.append(message.content)</span><br><span class="line"></span><br><span class="line">        # å¤„ç†å·¥å…·è°ƒç”¨</span><br><span class="line">        if message.tool_calls:</span><br><span class="line">            for tool_call in message.tool_calls:</span><br><span class="line">                tool_name = tool_call.function.name</span><br><span class="line">                tool_args = json.loads(tool_call.function.arguments)</span><br><span class="line">                </span><br><span class="line">                # æ‰§è¡Œå·¥å…·è°ƒç”¨</span><br><span class="line">                result = await self.session.call_tool(tool_name, tool_args)</span><br><span class="line">                final_text.append(f&quot;[è°ƒç”¨å·¥å…· &#123;tool_name&#125;ï¼Œå‚æ•° &#123;tool_args&#125;]&quot;)</span><br><span class="line">                </span><br><span class="line">                # å¤„ç†å·¥å…·ç»“æœ</span><br><span class="line">                tool_result_content = &quot;&quot;</span><br><span class="line">                if result.content:</span><br><span class="line">                    for item in result.content:</span><br><span class="line">                        if hasattr(item, &#x27;type&#x27;) and item.type == &#x27;text&#x27;:</span><br><span class="line">                            tool_result_content += item.text</span><br><span class="line">                        else:</span><br><span class="line">                            tool_result_content += str(item)</span><br><span class="line"></span><br><span class="line">                # æ·»åŠ åŠ©æ‰‹æ¶ˆæ¯åˆ°å†å²</span><br><span class="line">                messages.append(&#123;</span><br><span class="line">                    &quot;role&quot;: &quot;assistant&quot;,</span><br><span class="line">                    &quot;content&quot;: None,</span><br><span class="line">                    &quot;tool_calls&quot;: [tool_call]</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line">                # æ·»åŠ å·¥å…·æ‰§è¡Œç»“æœåˆ°å†å²</span><br><span class="line">                messages.append(&#123;</span><br><span class="line">                    &quot;role&quot;: &quot;tool&quot;,</span><br><span class="line">                    &quot;tool_call_id&quot;: tool_call.id,</span><br><span class="line">                    &quot;content&quot;: tool_result_content</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                # å†æ¬¡è°ƒç”¨æ¨¡å‹</span><br><span class="line">                response = self.anthropic.chat.completions.create(</span><br><span class="line">                    model=&quot;qwen3-235b-a22b&quot;,</span><br><span class="line">                    max_tokens=1000,</span><br><span class="line">                    messages=messages,</span><br><span class="line">                    tools=available_tools,</span><br><span class="line">                    extra_body=&#123;&quot;enable_thinking&quot;: False&#125;</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                # å¤„ç†æœ€ç»ˆå“åº”</span><br><span class="line">                if response.choices and response.choices[0].message.content:</span><br><span class="line">                    final_text.append(response.choices[0].message.content)</span><br><span class="line"></span><br><span class="line">        return &quot;\n&quot;.join(final_text)</span><br><span class="line"></span><br><span class="line">    async def chat_loop(self):</span><br><span class="line">        &quot;&quot;&quot;è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯&quot;&quot;&quot;</span><br><span class="line">        print(&quot;\nMCPå®¢æˆ·ç«¯å·²å¯åŠ¨!&quot;)</span><br><span class="line">        print(&quot;è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–è¾“å…¥&#x27;quit&#x27;é€€å‡ºã€‚&quot;)</span><br><span class="line"></span><br><span class="line">        while True:  # æ— é™å¾ªç¯ï¼ŒæŒç»­æ¥æ”¶ç”¨æˆ·è¾“å…¥</span><br><span class="line">            try:</span><br><span class="line">                query = input(&quot;\né—®é¢˜: &quot;).strip()  # è·å–ç”¨æˆ·è¾“å…¥å¹¶å»é™¤é¦–å°¾ç©ºæ ¼</span><br><span class="line"></span><br><span class="line">                if query.lower() == &#x27;quit&#x27;:  # å¦‚æœç”¨æˆ·è¾“å…¥&#x27;quit&#x27;ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰</span><br><span class="line">                    break  # é€€å‡ºå¾ªç¯</span><br><span class="line"></span><br><span class="line">                # å¤„ç†ç”¨æˆ·æŸ¥è¯¢å¹¶è·å–å“åº”</span><br><span class="line">                response = await self.process_query(query)</span><br><span class="line">                print(&quot;\n&quot; + response)  # æ‰“å°AIå“åº”ç»“æœ</span><br><span class="line"></span><br><span class="line">            except Exception as e:  # æ•è·æ‰€æœ‰å¼‚å¸¸</span><br><span class="line">                print(f&quot;\né”™è¯¯: &#123;str(e)&#125;&quot;)  # æ‰“å°é”™è¯¯ä¿¡æ¯</span><br><span class="line">                import traceback</span><br><span class="line">                traceback.print_exc()  # æ‰“å°è¯¦ç»†é”™è¯¯ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">    async def cleanup(self):</span><br><span class="line">        &quot;&quot;&quot;æ¸…ç†èµ„æº&quot;&quot;&quot;</span><br><span class="line">        await self.exit_stack.aclose()  # å¼‚æ­¥å…³é—­æ‰€æœ‰åœ¨exit_stackä¸­ç®¡ç†çš„èµ„æº</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    # æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°æ•°é‡ï¼Œå¦‚æœå°‘äº2ä¸ªåˆ™æ˜¾ç¤ºä½¿ç”¨è¯´æ˜</span><br><span class="line">    if len(sys.argv) &lt; 2:</span><br><span class="line">        print(&quot;ç”¨æ³•: python client.py &lt;æœåŠ¡å™¨è„šæœ¬è·¯å¾„&gt;&quot;)</span><br><span class="line">        sys.exit(1)  # é€€å‡ºç¨‹åºï¼Œè¿”å›é”™è¯¯ç 1</span><br><span class="line"></span><br><span class="line">    # åˆ›å»ºMCPå®¢æˆ·ç«¯å®ä¾‹</span><br><span class="line">    client = MCPClient()</span><br><span class="line">    try:</span><br><span class="line">        # è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œsys.argv[1]æ˜¯ç¬¬ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼ˆæœåŠ¡å™¨è„šæœ¬è·¯å¾„ï¼‰</span><br><span class="line">        await client.connect_to_server(sys.argv[1])</span><br><span class="line">        # å¯åŠ¨äº¤äº’å¼èŠå¤©å¾ªç¯</span><br><span class="line">        await client.chat_loop()</span><br><span class="line">    finally:</span><br><span class="line">        # ç¡®ä¿ç¨‹åºç»“æŸæ—¶æ¸…ç†èµ„æº</span><br><span class="line">        await client.cleanup()</span><br><span class="line"></span><br><span class="line"># ç¨‹åºå…¥å£ç‚¹</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    # è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h3 id="openaiå’Œclaudeåœ¨å·¥å…·è°ƒç”¨çš„å·®å¼‚"><a href="#openaiå’Œclaudeåœ¨å·¥å…·è°ƒç”¨çš„å·®å¼‚" class="headerlink" title="openaiå’Œclaudeåœ¨å·¥å…·è°ƒç”¨çš„å·®å¼‚"></a>openaiå’Œclaudeåœ¨å·¥å…·è°ƒç”¨çš„å·®å¼‚</h3><ol>
<li><strong>å·¥å…·æ ¼å¼è½¬æ¢ä¿®å¤</strong></li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼šMCPå·¥å…·æ ¼å¼ä¸OpenAI APIä¸å…¼å®¹<br><strong>ä¿®å¤</strong>ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸé”™è¯¯æ ¼å¼</span></span><br><span class="line">available_tools = [&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: tool.name,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: tool.description,</span><br><span class="line">    <span class="string">&quot;input_schema&quot;</span>: tool.inputSchema</span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®å¤åæ ¼å¼ï¼ˆç¬¦åˆOpenAIè§„èŒƒï¼‰</span></span><br><span class="line">available_tools = [&#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">    <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: tool.name,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: tool.description,</span><br><span class="line">        <span class="string">&quot;parameters&quot;</span>: schema  <span class="comment"># æ­£ç¡®çš„JSON Schemaæ ¼å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>APIå“åº”å¤„ç†ä¿®å¤</strong></li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼šé”™è¯¯è®¿é—®äº†OpenAIå“åº”å¯¹è±¡çš„å±æ€§<br><strong>ä¿®å¤</strong>ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸé”™è¯¯ä»£ç </span></span><br><span class="line"><span class="keyword">for</span> content <span class="keyword">in</span> response.content:  <span class="comment"># âŒ responseæ²¡æœ‰contentå±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®å¤åä»£ç </span></span><br><span class="line">message = response.choices[<span class="number">0</span>].message  <span class="comment"># âœ… æ­£ç¡®çš„è®¿é—®è·¯å¾„</span></span><br><span class="line"><span class="keyword">if</span> message.content:</span><br><span class="line">    final_text.append(message.content)</span><br><span class="line"><span class="keyword">if</span> message.tool_calls:</span><br><span class="line">    <span class="keyword">for</span> tool_call <span class="keyword">in</span> message.tool_calls:</span><br><span class="line">        <span class="comment"># å¤„ç†å·¥å…·è°ƒç”¨</span></span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>å·¥å…·è°ƒç”¨ç»“æœå¤„ç†ä¿®å¤</strong></li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼šé”™è¯¯å¤„ç†MCPå·¥å…·è°ƒç”¨è¿”å›çš„ç»“æœç»“æ„<br><strong>ä¿®å¤</strong>ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸé”™è¯¯ä»£ç </span></span><br><span class="line"><span class="string">&quot;content&quot;</span>: result.content  <span class="comment"># âŒ å¯èƒ½åŒ…å«å¤æ‚å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®å¤åä»£ç </span></span><br><span class="line">tool_result_content = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> result.content:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> result.content:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(item, <span class="string">&#x27;type&#x27;</span>) <span class="keyword">and</span> item.<span class="built_in">type</span> == <span class="string">&#x27;text&#x27;</span>:</span><br><span class="line">            tool_result_content += item.text</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tool_result_content += <span class="built_in">str</span>(item)</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>æ¶ˆæ¯å†å²æ„å»ºä¿®å¤</strong></li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼šå·¥å…·è°ƒç”¨åæ¶ˆæ¯å†å²æ ¼å¼ä¸æ­£ç¡®<br><strong>ä¿®å¤</strong>ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­£ç¡®çš„æ¶ˆæ¯å†å²æ ¼å¼</span></span><br><span class="line">messages.append(&#123;</span><br><span class="line">    <span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: <span class="literal">None</span>,</span><br><span class="line">    <span class="string">&quot;tool_calls&quot;</span>: [tool_call]</span><br><span class="line">&#125;)</span><br><span class="line">messages.append(&#123;</span><br><span class="line">    <span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tool_call_id&quot;</span>: tool_call.<span class="built_in">id</span>,</span><br><span class="line">    <span class="string">&quot;content&quot;</span>: tool_result_content</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<ol>
<li><strong>JSON Schemaå…¼å®¹æ€§å¤„ç†</strong></li>
</ol>
<p><strong>é—®é¢˜</strong>ï¼šMCPè¿”å›çš„schemaå¯èƒ½ç¼ºå°‘å¿…è¦çš„æ ¹ç±»å‹å®šä¹‰<br><strong>ä¿®å¤</strong>ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">schema = tool.inputSchema</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(schema, <span class="built_in">str</span>):</span><br><span class="line">    schema = json.loads(schema)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(schema, <span class="built_in">dict</span>) <span class="keyword">and</span> <span class="string">&quot;properties&quot;</span> <span class="keyword">in</span> schema:</span><br><span class="line">    schema = &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>, **schema&#125;  <span class="comment"># ç¡®ä¿æœ‰æ ¹ç±»å‹</span></span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/mcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/mcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">MCP æœåŠ¡ç«¯å®æˆ˜</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-08-01 00:00:00" itemprop="dateCreated datePublished" datetime="2025-08-01T00:00:00+08:00">2025-08-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-02 12:01:55" itemprop="dateModified" datetime="2025-08-02T12:01:55+08:00">2025-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/mcp/" itemprop="url" rel="index"><span itemprop="name">mcp</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Create a new directory for our project</span><br><span class="line">uv init weather</span><br><span class="line">cd weather</span><br><span class="line"></span><br><span class="line"># Create virtual environment and activate it</span><br><span class="line">uv venv</span><br><span class="line">source .venv/bin/activate</span><br><span class="line"></span><br><span class="line"># Install dependencies</span><br><span class="line">uv add &quot;mcp[cli]&quot; httpx</span><br><span class="line"></span><br><span class="line"># Create our server file</span><br><span class="line">touch weather.py</span><br></pre></td></tr></table></figure>
<h3 id="mcp-studioæ ·ä¾‹"><a href="#mcp-studioæ ·ä¾‹" class="headerlink" title="mcp studioæ ·ä¾‹"></a>mcp studioæ ·ä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from mcp.server.fastmcp import FastMCP</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(&quot;Math&quot;)</span><br><span class="line"></span><br><span class="line">@mcp.tool()</span><br><span class="line">def add(a: int, b: int) -&gt; int:</span><br><span class="line">    &quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span><br><span class="line">    return a + b</span><br><span class="line"></span><br><span class="line">@mcp.tool()</span><br><span class="line">def multiply(a: int, b: int) -&gt; int:</span><br><span class="line">    &quot;&quot;&quot;Multiply two numbers&quot;&quot;&quot;</span><br><span class="line">    return a * b</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    mcp.run(transport=&quot;stdio&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="mcp-streamable-http-æ ·ä¾‹"><a href="#mcp-streamable-http-æ ·ä¾‹" class="headerlink" title="mcp streamable-http æ ·ä¾‹"></a>mcp streamable-http æ ·ä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from mcp.server.fastmcp import FastMCP</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(&quot;Weather&quot;)</span><br><span class="line"></span><br><span class="line">@mcp.tool()</span><br><span class="line">async def get_weather(location: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;Get weather for location.&quot;&quot;&quot;</span><br><span class="line">    return &quot;It&#x27;s always sunny in New York&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    mcp.run(transport=&quot;streamable-http&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>mcpå¸‚åœº<a target="_blank" rel="noopener" href="https://www.modelscope.cn/mcp">MCP å¹¿åœº Â· é­”æ­ç¤¾åŒº</a></p>
<p><strong>ä½¿ç”¨ uvï¼ˆæ¨èï¼‰</strong></p>
<p>å½“ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://docs.astral.sh/uv/"><code>uv</code></a> æ—¶ä¸éœ€è¦ç‰¹å®šçš„å®‰è£…æ­¥éª¤ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://docs.astral.sh/uv/guides/tools/"><code>uvx</code></a> ç›´æ¥è¿è¡Œ <em>mcp-server-fetch</em>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;mcpServers&quot;: &#123;</span><br><span class="line">  &quot;fetch&quot;: &#123;</span><br><span class="line">    &quot;command&quot;: &quot;uvx&quot;,</span><br><span class="line">    &quot;args&quot;: [&quot;mcp-server-fetch&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä½¿ç”¨ PIP</strong></p>
<p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡ pip å®‰è£… <code>mcp-server-fetch</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mcp-server-fetch</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;mcpServers&quot;: &#123;</span><br><span class="line">  &quot;fetch&quot;: &#123;</span><br><span class="line">    &quot;command&quot;: &quot;python&quot;,</span><br><span class="line">    &quot;args&quot;: [&quot;-m&quot;, &quot;mcp_server_fetch&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>è¿œç¨‹æ‰˜ç®¡</strong></p>
<p><img src="/2025/08/01/%E5%AD%A6%E4%B9%A0/mcp%E5%AD%A6%E4%B9%A0/mcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E6%88%98/image-20250802120145192.png" alt="image-20250802120145192"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;mcpServers&quot;: &#123;</span><br><span class="line">    &quot;fetch&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;sse&quot;,</span><br><span class="line">      &quot;url&quot;: &quot;https://mcp.api-inference.modelscope.net/991cf46/sse&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://modelcontextprotocol.io/quickstart/server#core-mcp-concepts">æ„å»º MCP æœåŠ¡å™¨ - æ¨¡å‹ä¸Šä¸‹æ–‡åè®® â€”- Build an MCP Server - Model Context Protocol</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/31/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/%E5%82%A8%E5%AD%98%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93Chroma/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/31/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/%E5%82%A8%E5%AD%98%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93Chroma/" class="post-title-link" itemprop="url">å‚¨å­˜å‘é‡æ•°æ®åº“Chroma</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-31 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š15:54:10" itemprop="dateCreated datePublished" datetime="2025-07-31T00:00:00+08:00">2025-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent%E5%AE%9E%E6%88%98/" itemprop="url" rel="index"><span itemprop="name">agentå®æˆ˜</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="Chromaæ˜¯ä»€ä¹ˆ"><a href="#Chromaæ˜¯ä»€ä¹ˆ" class="headerlink" title="Chromaæ˜¯ä»€ä¹ˆ"></a>Chromaæ˜¯ä»€ä¹ˆ</h3><p>Chromaï¼ˆé€šå¸¸æŒ‡ <strong>ChromaDB</strong>ï¼‰æ˜¯ä¸€æ¬¾ <strong>å¼€æºã€AI åŸç”Ÿçš„å‘é‡æ•°æ®åº“</strong>ï¼Œä¸“ä¸ºå­˜å‚¨å’Œæ£€ç´¢ <strong>é«˜ç»´åµŒå…¥å‘é‡</strong> è€Œè®¾è®¡ï¼Œç›®æ ‡æ˜¯è®©å¼€å‘è€… <strong>5 åˆ†é’Ÿå†…åœ¨æœ¬åœ°è·‘èµ·ä¸€ä¸ªè¯­ä¹‰æœç´¢æˆ– RAG ç³»ç»Ÿ</strong>ã€‚</p>
<p><strong>æç®€å®‰è£…</strong>ï¼š<code>pip install chromadb</code></p>
<p><strong>åŒè¿è¡Œæ¨¡å¼</strong>ï¼š</p>
<ul>
<li><strong>å†…å­˜æ¨¡å¼</strong>ï¼šè°ƒè¯•/åŸå‹éšæ„é‡å¯ï¼›</li>
<li><strong>æŒä¹…åŒ–æ¨¡å¼</strong>ï¼šæŒ‡å®š <code>persist_directory</code> å³å¯è½ç›˜ï¼Œç”Ÿäº§ä¹Ÿä¸æ€•ä¸¢æ•°æ®ã€‚</li>
</ul>
<p><strong>HNSW ç´¢å¼•</strong>ï¼šç™¾ä¸‡çº§å‘é‡ä¹Ÿèƒ½ <strong>æ¯«ç§’çº§</strong> å“åº”ã€‚</p>
<h3 id="ä½¿ç”¨chromaå­˜å‚¨"><a href="#ä½¿ç”¨chromaå­˜å‚¨" class="headerlink" title="ä½¿ç”¨chromaå­˜å‚¨"></a>ä½¿ç”¨chromaå­˜å‚¨</h3><h4 id="æ–‡æ¡£åˆ†å—"><a href="#æ–‡æ¡£åˆ†å—" class="headerlink" title="æ–‡æ¡£åˆ†å—"></a>æ–‡æ¡£åˆ†å—</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain.document_loaders import PyPDFLoader</span><br><span class="line">from langchain.text_splitter import RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line">loader = PyPDFLoader(&quot;input/å¥åº·æ¡£æ¡ˆ.pdf&quot;)</span><br><span class="line">docs = loader.load()</span><br><span class="line">#é€’å½’åˆ†å—</span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(chunk_siz</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰embeddingæ¨¡å‹ä¸chroma"><a href="#å®šä¹‰embeddingæ¨¡å‹ä¸chroma" class="headerlink" title="å®šä¹‰embeddingæ¨¡å‹ä¸chroma"></a>å®šä¹‰embeddingæ¨¡å‹ä¸chroma</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from langchain.vectorstores import Chroma</span><br><span class="line">from langchain_openai import OpenAIEmbeddings</span><br><span class="line">embedding = OpenAIEmbeddings(</span><br><span class="line">api_key=&quot;sk-&quot;, </span><br><span class="line">base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">model=&quot;text-embedding-v4&quot;,</span><br><span class="line">check_embedding_ctx_length = False,</span><br><span class="line">dimensions=1536</span><br><span class="line">)</span><br><span class="line"># ä½¿ç”¨ Chroma å‘é‡æ•°æ®åº“å­˜å‚¨æ–‡æ¡£ chunks</span><br><span class="line">vectorstore = Chroma.from_documents(</span><br><span class="line">    documents=chunks,           # è¦å­˜å‚¨çš„æ–‡æ¡£chunksåˆ—è¡¨ï¼ˆå·²å¤„ç†å¥½çš„æ–‡æœ¬ç‰‡æ®µï¼‰</span><br><span class="line">    embedding=embedding,        </span><br><span class="line">    persist_directory=&quot;chromaDB&quot;,  # å‘é‡æ•°æ®åº“çš„æŒä¹…åŒ–å­˜å‚¨ç›®å½•è·¯å¾„</span><br><span class="line">    collection_name=&quot;demo001&quot;   # é›†åˆåç§°ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æ–‡æ¡£é›†åˆ</span><br><span class="line">)</span><br><span class="line">vectorstore.persist()</span><br></pre></td></tr></table></figure>
<h4 id="æ£€ç´¢"><a href="#æ£€ç´¢" class="headerlink" title="æ£€ç´¢"></a>æ£€ç´¢</h4><p>è¿™é‡Œé‡‡å–ç›´æ¥æ£€ç´¢è¿›è¡Œæµ‹è¯•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">results = vectorstore.similarity_search(</span><br><span class="line">    &quot;å¼ ä¸‰ä¹çš„åŸºæœ¬ä¿¡æ¯æ˜¯ä»€ä¹ˆ&quot;,</span><br><span class="line">    k=2,</span><br><span class="line">    collection_name=&quot;demo001&quot;  # æŒ‡å®šæ£€ç´¢çš„é›†åˆ</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://python.langchain.com/docs/integrations/vectorstores/chroma/#add-items-to-vector-store">Chroma | ğŸ¦œï¸ğŸ”— LangChain â€”- Chroma | ğŸ¦œï¸ğŸ”— LangChain</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/28/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Plan-and-Execute%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/28/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Plan-and-Execute%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Plan-and-Executeæ¨¡å¼</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-28 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-28T00:00:00+08:00">2025-07-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-02 11:03:31" itemprop="dateModified" datetime="2025-08-02T11:03:31+08:00">2025-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/agent%E5%AE%9E%E6%88%98/" itemprop="url" rel="index"><span itemprop="name">agentå®æˆ˜</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ä»€ä¹ˆæ˜¯Plan-and-Executeæ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯Plan-and-Executeæ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯Plan-and-Executeæ¨¡å¼"></a>ä»€ä¹ˆæ˜¯Plan-and-Executeæ¨¡å¼</h3><p>ä¸ReActæ¨¡å¼ä¸åŒçš„æ˜¯ï¼ŒReActåªåšä¸€æ¬¡è§„åˆ’ï¼Œè€ŒPlan-and-Executeæ¨¡å¼æ ¸å¿ƒæ€æƒ³æ˜¯é¦–å…ˆåˆ¶å®šä¸€ä¸ªå¤šæ­¥éª¤è®¡åˆ’ï¼Œç„¶åé€é¡¹æ‰§è¡Œè¯¥è®¡åˆ’ã€‚å®Œæˆç‰¹å®šä»»åŠ¡åï¼Œå¯ä»¥é‡æ–°å®¡è§†è®¡åˆ’å¹¶è¿›è¡Œé€‚å½“ä¿®æ”¹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œç”¨æˆ·åœ¨é—®ä¸€ä¸ªé—®é¢˜åï¼Œagentäº§ç”Ÿä¸€ä»½ä»»åŠ¡æ¸…å•ï¼Œé€‰å–ç¬¬ä¸€ä»½ä»»åŠ¡å¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œåçš„ç»“æœç»“åˆä»»åŠ¡æ¸…å•ï¼Œæ‰§è¡Œreplanï¼Œç»“åˆæ–°çš„ä¿¡æ¯ï¼Œæ›´æ”¹ä»»åŠ¡æ¸…å•çš„å†…å®¹ï¼Œè®©åç»­å¤§æ¨¡å‹æ›´å¥½åœ°æ‰§è¡Œï¼Œå¹¶å»é™¤å·²ç»å®Œæˆçš„ä»»åŠ¡</p>
<p>å®é™…ç”Ÿäº§ä¸­ï¼Œåº”è¯¥åœ¨plannerä¹‹å‰å†è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœé—®é¢˜è¿‡äºç®€å•ï¼Œä¸éœ€è¦è¿›è¡ŒPlan-and-Executeæ¨¡å¼</p>
<h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><h4 id="å®‰è£…åŒ…"><a href="#å®‰è£…åŒ…" class="headerlink" title="å®‰è£…åŒ…"></a>å®‰è£…åŒ…</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --quiet -U langgraph langchain-community langchain-openai tavily-python</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰ç½‘ç»œæœç´¢å·¥å…·ä¸æ‰§è¡Œagent"><a href="#å®šä¹‰ç½‘ç»œæœç´¢å·¥å…·ä¸æ‰§è¡Œagent" class="headerlink" title="å®šä¹‰ç½‘ç»œæœç´¢å·¥å…·ä¸æ‰§è¡Œagent"></a>å®šä¹‰ç½‘ç»œæœç´¢å·¥å…·ä¸æ‰§è¡Œagent</h4><p>åœ¨äº§ç”Ÿplanåï¼Œè¦æœ‰ä¸€ä¸ªagentå¯¹ä»»åŠ¡æ¸…å•è¿›è¡Œæ‰§è¡Œï¼Œè¿™é‡Œä»¥ä¸€ä¸ªReActçš„ç½‘ç»œæœç´¢agentä¸ºä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰å·¥å…·</span><br><span class="line">from langchain_tavily import TavilySearch</span><br><span class="line">tools = [TavilySearch(max_results=3)]</span><br><span class="line"></span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line"></span><br><span class="line">from langgraph.prebuilt import create_react_agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model=&quot;qwen3-235b-a22b-thinking-2507&quot;,</span><br><span class="line">    api_key=&quot;sk-&quot;,</span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">)</span><br><span class="line">prompt = &quot;You are a helpful assistant.&quot;</span><br><span class="line">agent_executor = create_react_agent(llm, tools, prompt=prompt)</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•åŠŸèƒ½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">agent_executor.invoke(&#123;&quot;messages&quot;: [(&quot;user&quot;, &quot;ä»Šå¤©æ˜¯å‡ æœˆå‡ æ—¥&quot;)]&#125;)</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰æ‰§è¡ŒèŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from typing import Literal</span><br><span class="line">from langgraph.graph import END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">async def execute_step(state: PlanExecute):</span><br><span class="line">    &quot;&quot;&quot;æ‰§è¡Œè®¡åˆ’ä¸­çš„æ­¥éª¤&quot;&quot;&quot;</span><br><span class="line">    plan = state[&quot;plan&quot;]</span><br><span class="line">    # å°†è®¡åˆ’æ ¼å¼åŒ–ä¸ºå¸¦ç¼–å·çš„å­—ç¬¦ä¸²</span><br><span class="line">    plan_str = &quot;\n&quot;.join(f&quot;&#123;i + 1&#125;. &#123;step&#125;&quot; for i, step in enumerate(plan))</span><br><span class="line">    task = plan[0]  # è·å–ç¬¬ä¸€ä¸ªå¾…æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="line">    task_formatted = f&quot;&quot;&quot;å¯¹äºä»¥ä¸‹è®¡åˆ’:</span><br><span class="line">&#123;plan_str&#125;\n\nä½ è¢«åˆ†é…æ‰§è¡Œç¬¬ &#123;1&#125; æ­¥, &#123;task&#125;ã€‚&quot;&quot;&quot;</span><br><span class="line">    # è°ƒç”¨ä»£ç†æ‰§è¡Œå™¨æ¥æ‰§è¡Œä»»åŠ¡</span><br><span class="line">    agent_response = await agent_executor.ainvoke(</span><br><span class="line">        &#123;&quot;messages&quot;: [(&quot;user&quot;, task_formatted)]&#125;</span><br><span class="line">    )</span><br><span class="line">    # è¿”å›æ‰§è¡Œç»“æœï¼Œæ·»åŠ åˆ°å†å²æ­¥éª¤ä¸­</span><br><span class="line">    return &#123;</span><br><span class="line">        &quot;past_steps&quot;: [(task, agent_response[&quot;messages&quot;][-1].content)],</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>create_react_agent æ˜¯ LangGraph æä¾›çš„ä¸€ä¸ªé¢„æ„å»ºå‡½æ•°ï¼Œä½äº langgraph.prebuilt æ¨¡å—ä¸­ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºä¸€ä¸ªåŸºäº ReActï¼ˆReasoning + Actingï¼‰æ¶æ„çš„æ™ºèƒ½ä»£ç†ã€‚</p>
<p>langgraphé¢„è®¾çš„å…¶ä»–å¸¸ç”¨ç»„ä»¶å¦‚ä¸‹</p>
<p><strong>ToolNode</strong></p>
<p>åŠŸèƒ½ï¼šæŠŠ LangChain å·¥å…·ï¼ˆBaseToolï¼‰å°è£…æˆä¸€ä¸ªå›¾èŠ‚ç‚¹ï¼Œè´Ÿè´£ï¼š</p>
<ul>
<li><p>æ¥æ”¶ LLM ç”Ÿæˆçš„å·¥å…·è°ƒç”¨è¯·æ±‚</p>
</li>
<li><p>çœŸæ­£æ‰§è¡Œå·¥å…·</p>
</li>
<li><p>æŠŠç»“æœè¿”å›ç»™å›¾</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.prebuilt import ToolNode</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[search, calculator])</span><br></pre></td></tr></table></figure>
<p><strong>tools_condition</strong></p>
<p>åŠŸèƒ½ï¼šåˆ¤æ–­ LLM æ˜¯å¦è¦ç»§ç»­è°ƒç”¨å·¥å…·çš„â€œè·¯ç”±å‡½æ•°â€ã€‚</p>
<p>åœ¨ ReAct å›¾é‡Œé€šå¸¸æ”¾åœ¨èŠ‚ç‚¹ä¹‹é—´çš„ æ¡ä»¶è¾¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.prebuilt import tools_condition</span><br><span class="line"></span><br><span class="line">graph.add_conditional_edges(&quot;agent&quot;, tools_condition, &#123;</span><br><span class="line"></span><br><span class="line">  &quot;tools&quot;: &quot;tool_node&quot;,    # éœ€è¦å·¥å…· â†’ å» ToolNode</span><br><span class="line"></span><br><span class="line">  &quot;**__end__**&quot;: END       # ä¸éœ€è¦ â†’ ç»“æŸ</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="å®šä¹‰çŠ¶æ€"><a href="#å®šä¹‰çŠ¶æ€" class="headerlink" title="å®šä¹‰çŠ¶æ€"></a>å®šä¹‰çŠ¶æ€</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import operator</span><br><span class="line">from typing import Annotated, List, Tuple</span><br><span class="line">from typing_extensions import TypedDict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PlanExecute(TypedDict):</span><br><span class="line">    input: str</span><br><span class="line">    plan: List[str]</span><br><span class="line">    past_steps: Annotated[List[Tuple], operator.add]</span><br><span class="line">    response: str</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pydantic import BaseModel, Field</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Plan(BaseModel):</span><br><span class="line">    &quot;&quot;&quot;æœªæ¥è¦éµå¾ªçš„è®¡åˆ’&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    steps: List[str] = Field(</span><br><span class="line">        description=&quot;éœ€è¦éµå¾ªçš„ä¸åŒæ­¥éª¤ï¼Œåº”è¯¥æŒ‰æ’åºé¡ºåºæ’åˆ—&quot;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from langchain_community.chat_models import ChatTongyi</span><br><span class="line">model=ChatTongyi(</span><br><span class="line"> model=&quot;qwen-plus-2025-07-14&quot;,</span><br><span class="line"> api_key=&quot;sk-&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰åˆå§‹è®¡åˆ’èŠ‚ç‚¹"><a href="#å®šä¹‰åˆå§‹è®¡åˆ’èŠ‚ç‚¹" class="headerlink" title="å®šä¹‰åˆå§‹è®¡åˆ’èŠ‚ç‚¹"></a>å®šä¹‰åˆå§‹è®¡åˆ’èŠ‚ç‚¹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.prompts import ChatPromptTemplate</span><br><span class="line"></span><br><span class="line">planner_prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            &quot;system&quot;,</span><br><span class="line">            &quot;&quot;&quot;å¯¹äºç»™å®šçš„ç›®æ ‡ï¼Œåˆ¶å®šä¸€ä¸ªç®€å•çš„é€æ­¥è®¡åˆ’ã€‚\</span><br><span class="line">è¿™ä¸ªè®¡åˆ’åº”è¯¥åŒ…å«ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œå¦‚æœæ­£ç¡®æ‰§è¡Œè¿™äº›ä»»åŠ¡å°†å¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆã€‚ä¸è¦æ·»åŠ ä»»ä½•å¤šä½™çš„æ­¥éª¤ã€‚\</span><br><span class="line">æœ€åä¸€æ­¥çš„ç»“æœåº”è¯¥æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚ç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½åŒ…å«æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯â€”â€”ä¸è¦è·³è¿‡ä»»ä½•æ­¥éª¤ã€‚&quot;&quot;&quot;,</span><br><span class="line">        ),</span><br><span class="line">        (&quot;placeholder&quot;, &quot;&#123;messages&#125;&quot;),</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">planner = planner_prompt | model.with_structured_output(Plan)</span><br><span class="line"></span><br><span class="line">async def plan_step(state: PlanExecute):</span><br><span class="line">    &quot;&quot;&quot;åˆ¶å®šåˆå§‹è®¡åˆ’æ­¥éª¤&quot;&quot;&quot;</span><br><span class="line">    # ä½¿ç”¨è§„åˆ’å™¨ä¸ºç”¨æˆ·è¾“å…¥åˆ¶å®šè®¡åˆ’</span><br><span class="line">    plan = await planner.ainvoke(&#123;&quot;messages&quot;: [(&quot;user&quot;, state[&quot;input&quot;])]&#125;)</span><br><span class="line">    </span><br><span class="line">    return &#123;&quot;plan&quot;: plan.steps&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰å†è®¡åˆ’èŠ‚ç‚¹"><a href="#å®šä¹‰å†è®¡åˆ’èŠ‚ç‚¹" class="headerlink" title="å®šä¹‰å†è®¡åˆ’èŠ‚ç‚¹"></a>å®šä¹‰å†è®¡åˆ’èŠ‚ç‚¹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from typing import Union</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Response(BaseModel):</span><br><span class="line">    &quot;&quot;&quot;å¯¹ç”¨æˆ·çš„å“åº”&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    response: str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Act(BaseModel):</span><br><span class="line">    &quot;&quot;&quot;è¦æ‰§è¡Œçš„åŠ¨ä½œ&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    action: Union[Response, Plan] = Field(</span><br><span class="line">        description=&quot;è¦æ‰§è¡Œçš„åŠ¨ä½œã€‚å¦‚æœä½ æƒ³å“åº”ç”¨æˆ·ï¼Œä½¿ç”¨ Responseã€‚&quot;</span><br><span class="line">        &quot;å¦‚æœä½ éœ€è¦è¿›ä¸€æ­¥ä½¿ç”¨å·¥å…·æ¥è·å–ç­”æ¡ˆï¼Œä½¿ç”¨ Planã€‚&quot;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replanner_prompt = ChatPromptTemplate.from_template(</span><br><span class="line">    &quot;&quot;&quot;å¯¹äºç»™å®šçš„ç›®æ ‡ï¼Œåˆ¶å®šä¸€ä¸ªç®€å•çš„é€æ­¥è®¡åˆ’ã€‚\</span><br><span class="line">è¿™ä¸ª    è®¡åˆ’åº”è¯¥åŒ…å«ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œå¦‚æœæ­£ç¡®æ‰§è¡Œè¿™äº›ä»»åŠ¡å°†å¾—åˆ°æ­£ç¡®çš„ç­”æ¡ˆã€‚ä¸è¦æ·»åŠ ä»»ä½•å¤šä½™çš„æ­¥éª¤ã€‚\</span><br><span class="line">æœ€åä¸€æ­¥çš„ç»“æœåº”è¯¥æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚ç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½åŒ…å«æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯â€”â€”ä¸è¦è·³è¿‡ä»»ä½•æ­¥éª¤ã€‚</span><br><span class="line"></span><br><span class="line">ä½ çš„ç›®æ ‡æ˜¯ï¼š</span><br><span class="line">&#123;input&#125;</span><br><span class="line"></span><br><span class="line">ä½ çš„åŸå§‹è®¡åˆ’æ˜¯ï¼š</span><br><span class="line">&#123;plan&#125;</span><br><span class="line"></span><br><span class="line">ä½ ç›®å‰å·²ç»å®Œæˆäº†ä»¥ä¸‹æ­¥éª¤ï¼š</span><br><span class="line">&#123;past_steps&#125;</span><br><span class="line"></span><br><span class="line">ç›¸åº”åœ°æ›´æ–°ä½ çš„è®¡åˆ’ã€‚å¦‚æœä¸éœ€è¦æ›´å¤šæ­¥éª¤å¹¶ä¸”å¯ä»¥è¿”å›ç»™ç”¨æˆ·ï¼Œåˆ™ç›´æ¥å“åº”ã€‚å¦åˆ™ï¼Œå¡«å†™è®¡åˆ’ã€‚åªæ·»åŠ ä»éœ€è¦å®Œæˆçš„æ­¥éª¤åˆ°è®¡åˆ’ä¸­ã€‚ä¸è¦å°†å·²ç»å®Œæˆçš„æ­¥éª¤ä½œä¸ºè®¡åˆ’çš„ä¸€éƒ¨åˆ†è¿”å›ã€‚&quot;&quot;&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replanner = replanner_prompt | model.with_structured_output(Act)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">async def replan_step(state: PlanExecute):</span><br><span class="line">    &quot;&quot;&quot;é‡æ–°è§„åˆ’æ­¥éª¤&quot;&quot;&quot;</span><br><span class="line">    # ä½¿ç”¨é‡æ–°è§„åˆ’å™¨æ ¹æ®å½“å‰çŠ¶æ€æ›´æ–°è®¡åˆ’</span><br><span class="line">    output = await replanner.ainvoke(state)</span><br><span class="line">    if isinstance(output.action, Response):</span><br><span class="line">        # å¦‚æœåŠ¨ä½œæ˜¯å“åº”ï¼Œè¿”å›æœ€ç»ˆå“åº”</span><br><span class="line">        return &#123;&quot;response&quot;: output.action.response&#125;</span><br><span class="line">    else:</span><br><span class="line">        # å¦‚æœåŠ¨ä½œæ˜¯è®¡åˆ’ï¼Œè¿”å›æ–°çš„è®¡åˆ’æ­¥éª¤</span><br><span class="line">        return &#123;&quot;plan&quot;: output.action.steps&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰è·¯ç”±"><a href="#å®šä¹‰è·¯ç”±" class="headerlink" title="å®šä¹‰è·¯ç”±"></a>å®šä¹‰è·¯ç”±</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def should_end(state: PlanExecute):</span><br><span class="line">    &quot;&quot;&quot;åˆ¤æ–­æ˜¯å¦ç»“æŸæ‰§è¡Œæµç¨‹&quot;&quot;&quot;</span><br><span class="line">    if &quot;response&quot; in state and state[&quot;response&quot;]:</span><br><span class="line">        # å¦‚æœå­˜åœ¨å“åº”å†…å®¹ï¼Œç»“æŸæµç¨‹</span><br><span class="line">        return END</span><br><span class="line">    else:</span><br><span class="line">        # å¦åˆ™ç»§ç»­æ‰§è¡Œä»£ç†æ­¥éª¤</span><br><span class="line">        return &quot;agent&quot;</span><br></pre></td></tr></table></figure>
<h4 id="ç¼–è¯‘å›¾"><a href="#ç¼–è¯‘å›¾" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import StateGraph, START</span><br><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå†…å­˜æ£€æŸ¥ç‚¹ä¿å­˜å™¨</span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºå·¥ä½œæµå›¾ï¼Œä½¿ç”¨ PlanExecute çŠ¶æ€ç±»å‹</span><br><span class="line">workflow = StateGraph(PlanExecute)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ è®¡åˆ’èŠ‚ç‚¹</span><br><span class="line">workflow.add_node(&quot;planner&quot;, plan_step)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ æ‰§è¡Œæ­¥éª¤èŠ‚ç‚¹</span><br><span class="line">workflow.add_node(&quot;agent&quot;, execute_step)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ é‡æ–°è§„åˆ’èŠ‚ç‚¹</span><br><span class="line">workflow.add_node(&quot;replan&quot;, replan_step)</span><br><span class="line"></span><br><span class="line"># ä»å¼€å§‹èŠ‚ç‚¹è¿æ¥åˆ°è®¡åˆ’èŠ‚ç‚¹</span><br><span class="line">workflow.add_edge(START, &quot;planner&quot;)</span><br><span class="line"></span><br><span class="line"># ä»è®¡åˆ’èŠ‚ç‚¹è¿æ¥åˆ°ä»£ç†æ‰§è¡ŒèŠ‚ç‚¹</span><br><span class="line">workflow.add_edge(&quot;planner&quot;, &quot;agent&quot;)</span><br><span class="line"></span><br><span class="line"># ä»ä»£ç†æ‰§è¡ŒèŠ‚ç‚¹è¿æ¥åˆ°é‡æ–°è§„åˆ’èŠ‚ç‚¹</span><br><span class="line">workflow.add_edge(&quot;agent&quot;, &quot;replan&quot;)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ æ¡ä»¶è¾¹ - ä»é‡æ–°è§„åˆ’èŠ‚ç‚¹æ ¹æ®æ¡ä»¶å†³å®šä¸‹ä¸€æ­¥</span><br><span class="line">workflow.add_conditional_edges(</span><br><span class="line">    &quot;replan&quot;,</span><br><span class="line">    # ä¼ å…¥å†³å®šä¸‹ä¸€ä¸ªè°ƒç”¨èŠ‚ç‚¹çš„å‡½æ•°</span><br><span class="line">    should_end,</span><br><span class="line">    [&quot;agent&quot;, END],  # å¯èƒ½çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼šä»£ç†èŠ‚ç‚¹æˆ–ç»“æŸ</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># æœ€åï¼Œç¼–è¯‘å·¥ä½œæµå¹¶æ·»åŠ æ£€æŸ¥ç‚¹åŠŸèƒ½ï¼</span><br><span class="line"># è¿™å°†å…¶ç¼–è¯‘ä¸º LangChain Runnableï¼Œ</span><br><span class="line"># æ„å‘³ç€ä½ å¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• runnable ä¸€æ ·ä½¿ç”¨å®ƒ</span><br><span class="line">app = workflow.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/28/%E5%AD%A6%E4%B9%A0/agent%E5%AE%9E%E6%88%98/Plan-and-Execute%E6%A8%A1%E5%BC%8F/image-20250729092408872.png" alt="image-20250729092408872"></p>
<h4 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># é…ç½®é€’å½’é™åˆ¶ï¼Œé˜²æ­¢æ— é™å¾ªç¯</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;</span><br><span class="line">        &quot;thread_id&quot;: &quot;1&quot;,  # å¿…éœ€ï¼šçº¿ç¨‹ID</span><br><span class="line">    &#125;,&quot;recursion_limit&quot;: 50&#125;</span><br><span class="line"></span><br><span class="line"># è¾“å…¥é—®é¢˜ï¼š2024å¹´æ¾³å¤§åˆ©äºšç½‘çƒå…¬å¼€èµ›ç”·å•å† å†›çš„å®¶ä¹¡æ˜¯å“ªé‡Œï¼Ÿ</span><br><span class="line">inputs = &#123;&quot;input&quot;: &quot;2024å¹´æ¾³å¤§åˆ©äºšç½‘çƒå…¬å¼€èµ›ç”·å•å† å†›çš„å®¶ä¹¡æ˜¯å“ªé‡Œï¼Ÿ&quot;&#125;</span><br><span class="line"></span><br><span class="line"># å¼‚æ­¥æµå¼æ‰§è¡Œåº”ç”¨</span><br><span class="line">async for event in app.astream(inputs, config=config):</span><br><span class="line">    # éå†æ¯ä¸ªäº‹ä»¶</span><br><span class="line">    for k, v in event.items():</span><br><span class="line">        # æ’é™¤ç»“æŸæ ‡è®°ï¼Œæ‰“å°å…¶ä»–æ‰€æœ‰äº‹ä»¶å†…å®¹</span><br><span class="line">        if k != &quot;__end__&quot;:</span><br><span class="line">            print(v)</span><br></pre></td></tr></table></figure>
<h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/tutorials/plan-and-execute/plan-and-execute/">è®¡åˆ’ä¸æ‰§è¡Œ â€”- Plan-and-Execute</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å¼ ç†™æµš</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™è®¿é—®æ•° fa fa-user æ¬¡"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™æ€»è®¿é—®é‡ fa fa-eye æ¬¡"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="400" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
