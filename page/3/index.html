<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="zxj Blogs">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhang XiJun">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Zhang XiJun">
<meta property="og:description" content="zxj Blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="å¼ ç†™æµš">
<meta property="article:tag" content="zxj">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/3/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/3/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhang XiJun</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhang XiJun</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">BLOGS</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å¼ ç†™æµš"
      src="/images/zxjavatar.gif">
  <p class="site-author-name" itemprop="name">å¼ ç†™æµš</p>
  <div class="site-description" itemprop="description">zxj Blogs</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zxj-2023" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zxj-2023" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=2902065320&site=qq&menu=yes" title="QQ â†’ http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;2902065320&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener me" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          é“¾æ¥
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://zxj-2023.github.io/" title="https:&#x2F;&#x2F;zxj-2023.github.io" rel="noopener" target="_blank">Zhang XiJun</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://theme-next.js.org/" title="https:&#x2F;&#x2F;theme-next.js.org" rel="noopener" target="_blank">NexT</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">LangGraphå­¦ä¹ â€”â€”å¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-05 17:31:03" itemprop="dateModified" datetime="2025-08-05T17:31:03+08:00">2025-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹"><a href="#æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹" class="headerlink" title="æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹"></a>æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹</h3><h4 id="åˆ›å»ºä¸€ä¸ª-StateGraph"><a href="#åˆ›å»ºä¸€ä¸ª-StateGraph" class="headerlink" title="åˆ›å»ºä¸€ä¸ª StateGraph"></a>åˆ›å»ºä¸€ä¸ª <code>StateGraph</code></h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>StateGraph</code>ã€‚ä¸€ä¸ª <code>StateGraph</code> å¯¹è±¡å°†æˆ‘ä»¬çš„èŠå¤©æœºå™¨äººç»“æ„å®šä¹‰ä¸ºâ€œçŠ¶æ€æœºâ€ã€‚æˆ‘ä»¬å°†æ·»åŠ  <code>èŠ‚ç‚¹</code> æ¥è¡¨ç¤º LLM å’ŒèŠå¤©æœºå™¨äººå¯ä»¥è°ƒç”¨çš„å‡½æ•°ï¼Œå¹¶æ·»åŠ  <code>è¾¹</code> æ¥æŒ‡å®šæœºå™¨äººåº”å¦‚ä½•åœ¨è¿™äº›å‡½æ•°ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰çŠ¶æ€</span></span><br><span class="line">graph_builder = StateGraph(State)</span><br></pre></td></tr></table></figure>
<p>åœ¨ langgraph ä¸­ï¼ŒçŠ¶æ€ä¼šåœ¨å›¾çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼ é€’ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹äº§ç”Ÿæ–°çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ›´æ–° State ä¸­çš„ messages å­—æ®µã€‚</p>
<p>æˆ‘ä»¬çš„å›¾ç°åœ¨å¯ä»¥å¤„ç†ä¸¤ä¸ªå…³é”®ä»»åŠ¡</p>
<ol>
<li>æ¯ä¸ª <code>èŠ‚ç‚¹</code> éƒ½å¯ä»¥æ¥æ”¶å½“å‰ <code>çŠ¶æ€</code> ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºçŠ¶æ€çš„æ›´æ–°ã€‚</li>
<li>å¯¹ <code>æ¶ˆæ¯</code> çš„æ›´æ–°å°†è¿½åŠ åˆ°ç°æœ‰åˆ—è¡¨è€Œä¸æ˜¯è¦†ç›–å®ƒï¼Œè¿™å¾—ç›Šäºä¸ <code>Annotated</code> è¯­æ³•ä¸€èµ·ä½¿ç”¨çš„é¢„æ„å»º <a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/reference/graphs/?h=add+messages#add_messages"><code>add_messages</code></a> å‡½æ•°ã€‚</li>
</ol>
<blockquote>
<p>langgraphä¸­æ¯ä¸ªæ¶ˆæ¯å¯¹è±¡é€šå¸¸åŒ…å«ä»¥ä¸‹å…³é”®å±æ€§ï¼š</p>
<ul>
<li>role : ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ‡è¯†æ¶ˆæ¯çš„å‘é€è€…ï¼ˆä¾‹å¦‚ â€˜humanâ€™ , â€˜aiâ€™ , â€˜systemâ€™ ï¼‰ã€‚</li>
<li>content : æ¶ˆæ¯çš„å…·ä½“å†…å®¹ï¼Œé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯æ›´å¤æ‚çš„ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œç”¨äºå¤šæ¨¡æ€è¾“å…¥ï¼‰ã€‚</li>
<li>id : ä¸€ä¸ªå¯é€‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li>
</ul>
<p>Annotated çš„ä½œç”¨ : é€šè¿‡ä½¿ç”¨ Annotated[list, add_messages] ï¼Œä½ æ”¹å˜äº†è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚ add_messages å‡½æ•°ï¼ˆç”± langgraph æä¾›æˆ–ç”±ä½ è‡ªå®šä¹‰ï¼‰çš„é€»è¾‘æ˜¯ è¿½åŠ  è€Œä¸æ˜¯è¦†ç›–ã€‚æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ–°èŠ‚ç‚¹è¿”å›æ¶ˆæ¯æ—¶ï¼Œ langgraph ä¼šè°ƒç”¨ add_messages å‡½æ•°ï¼Œå°†æ–°æ¶ˆæ¯ è¿½åŠ  åˆ°ç°æœ‰ messages åˆ—è¡¨çš„æœ«å°¾ã€‚</p>
</blockquote>
<h4 id="å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹"><a href="#å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹" class="headerlink" title="å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹"></a>å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹</h4><p>ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>1.ä½¿ç”¨ <code>init_chat_model</code>(é€šç”¨é«˜å±‚å°è£…)<br>è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„è¾…åŠ©å‡½æ•°ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥åˆå§‹åŒ–æ¥è‡ª ä¸åŒæä¾›å•† çš„èŠå¤©æ¨¡å‹ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/api_reference/langchain/chat_models/langchain.chat_models.base.init_chat_model.html">init_chat_model â€” ğŸ¦œğŸ”— LangChain æ–‡æ¡£ â€”- init_chat_model â€” ğŸ¦œğŸ”— LangChain documentation</a></p>
<p>2.ä½¿ç”¨å¦‚ChatOpenAI (ç‰¹å®šäºæä¾›å•†çš„ç±»)<br>è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º OpenAI API è®¾è®¡çš„ç±»ï¼Œæä¾›äº†å¯¹ OpenAI æ¨¡å‹æ‰€æœ‰åŠŸèƒ½çš„å®Œå…¨è®¿é—®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain.chat_models import init_chat_model</span><br><span class="line"></span><br><span class="line">os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;sk-&quot;</span><br><span class="line">#ä½¿ç”¨â€˜&#123;model_provider&#125;:&#123;model&#125;â€™æ ¼å¼åœ¨å•ä¸ªå‚æ•°ä¸­æŒ‡å®šæ¨¡å‹å’Œæ¨¡å‹æä¾›è€…ï¼Œä¾‹å¦‚â€œopenai:o1â€</span><br><span class="line">llm = init_chat_model(&quot;openai:qwen-plus-2025-04-28&quot;,</span><br><span class="line">                      base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">                      )</span><br></pre></td></tr></table></figure>
<h4 id="æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹"><a href="#æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹"></a>æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹</h4><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†èŠå¤©æ¨¡å‹é›†æˆåˆ°ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰èŠ‚ç‚¹chatbot</span><br><span class="line">def chatbot(state: State):</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(state[&quot;messages&quot;])]&#125;</span><br><span class="line"></span><br><span class="line">graph_builder.add_node(&quot;chatbot&quot;, chatbot)</span><br></pre></td></tr></table></figure>
<p> <code>chatbot</code> èŠ‚ç‚¹å‡½æ•°å¦‚ä½•å°†å½“å‰ <code>çŠ¶æ€</code> ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æ›´æ–°çš„ <code>æ¶ˆæ¯</code> åˆ—è¡¨çš„å­—å…¸ï¼Œé”®ä¸ºâ€œmessagesâ€ã€‚è¿™æ˜¯æ‰€æœ‰ LangGraph èŠ‚ç‚¹å‡½æ•°çš„åŸºæœ¬æ¨¡å¼ã€‚</p>
<p>æˆ‘ä»¬ <code>çŠ¶æ€</code> ä¸­çš„ <code>add_messages</code> å‡½æ•°ä¼šå°† LLM çš„å“åº”æ¶ˆæ¯è¿½åŠ åˆ°çŠ¶æ€ä¸­å·²æœ‰çš„æ¶ˆæ¯ä¹‹åã€‚</p>
<h4 id="æ·»åŠ ä¸€ä¸ª-å…¥å£-ç‚¹"><a href="#æ·»åŠ ä¸€ä¸ª-å…¥å£-ç‚¹" class="headerlink" title="æ·»åŠ ä¸€ä¸ª å…¥å£ ç‚¹"></a>æ·»åŠ ä¸€ä¸ª <code>å…¥å£</code> ç‚¹</h4><p>æ·»åŠ ä¸€ä¸ª <code>å…¥å£</code> ç‚¹ï¼Œä»¥å‘Šè¯‰å›¾æ¯æ¬¡è¿è¡Œæ—¶<strong>ä»ä½•å¤„å¼€å§‹å·¥ä½œ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph_builder.add_edge(START, &quot;chatbot&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="ç¼–è¯‘å›¾"><a href="#ç¼–è¯‘å›¾" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><p>åœ¨è¿è¡Œå›¾ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å›¾æ„å»ºå™¨ä¸Šè°ƒç”¨ <code>compile()</code> æ¥å®Œæˆã€‚è¿™å°†åˆ›å»ºä¸€ä¸ª <code>CompiledGraph</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„çŠ¶æ€ä¸Šè°ƒç”¨å®ƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.compile()</span><br></pre></td></tr></table></figure>
<h4 id="å¯è§†åŒ–å›¾"><a href="#å¯è§†åŒ–å›¾" class="headerlink" title="å¯è§†åŒ–å›¾"></a>å¯è§†åŒ–å›¾</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>get_graph</code> æ–¹æ³•å’Œå…¶ä¸­ä¸€ä¸ªâ€œç»˜å›¾â€æ–¹æ³•ï¼ˆä¾‹å¦‚ <code>draw_ascii</code> æˆ– <code>draw_png</code>ï¼‰æ¥å¯è§†åŒ–å›¾ã€‚è¿™äº› <code>draw</code> æ–¹æ³•éƒ½éœ€è¦é¢å¤–çš„ä¾èµ–é¡¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Image, display</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line">except Exception:</span><br><span class="line">    # This requires some extra dependencies and is optional</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<h4 id="è¿è¡ŒèŠå¤©æœºå™¨äºº"><a href="#è¿è¡ŒèŠå¤©æœºå™¨äºº" class="headerlink" title="è¿è¡ŒèŠå¤©æœºå™¨äºº"></a>è¿è¡ŒèŠå¤©æœºå™¨äºº</h4><p>è¿è¡ŒèŠå¤©æœºå™¨äºº</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_input&#125;]&#125;):</span><br><span class="line">        <span class="built_in">print</span>(event)</span><br><span class="line">        <span class="comment">#stream è¿”å›çš„æ¯ä¸ª event é€šå¸¸æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®æ˜¯å›¾ä¸­èŠ‚ç‚¹çš„åç§°ï¼Œå€¼æ˜¯è¯¥èŠ‚ç‚¹å®Œæˆåçš„çŠ¶æ€æ›´æ–°ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">            <span class="comment">#æ¶ˆæ¯åˆ—è¡¨ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯çš„æ–‡æœ¬å†…å®¹</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Assistant:&quot;</span>, value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="comment">#é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#è°ƒç”¨</span></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>graph.stream() æ˜¯ LangGraph çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒä¼šæ‰§è¡Œæ•´ä¸ªå›¾ï¼ˆGraphï¼‰ï¼Œä½†ä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›æœ€ç»ˆç»“æœï¼Œè€Œæ˜¯åƒè§†é¢‘æµä¸€æ ·ï¼Œä¸€æ­¥ä¸€æ­¥åœ°è¿”å›ä¸­é—´è¿‡ç¨‹çš„æ›´æ–°ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥å®æ—¶çœ‹åˆ°æ¨¡å‹ç”Ÿæˆå†…å®¹çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ã€‚</p>
</blockquote>
<h3 id="æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·"><a href="#æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·" class="headerlink" title="æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·"></a>æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·</h3><h4 id="è·å–Tavily-api"><a href="#è·å–Tavily-api" class="headerlink" title="è·å–Tavily api"></a>è·å–Tavily api</h4><p><a target="_blank" rel="noopener" href="https://tavily.com/">Tavily çš„æœç´¢ API</a> æ˜¯ä¸€æ¬¾ä¸“ä¸º AI ä»£ç† (LLM) æ„å»ºçš„æœç´¢å¼•æ“ï¼Œèƒ½å¤Ÿå¿«é€Ÿæä¾›å®æ—¶ã€å‡†ç¡®å’ŒåŸºäºäº‹å®çš„ç»“æœã€‚</p>
<p>æ¯æœˆ 1,000 æ¬¡å…è´¹æœç´¢</p>
<p><a target="_blank" rel="noopener" href="https://python.langchain.ac.cn/docs/integrations/tools/tavily_search/">Tavily Search | ğŸ¦œï¸ğŸ”— LangChain æ¡†æ¶</a></p>
<p>è·å–api<a target="_blank" rel="noopener" href="https://app.tavily.com/home">Tavily AI â€”- Tavily AI</a></p>
<h4 id="æ·»åŠ å·¥å…·"><a href="#æ·»åŠ å·¥å…·" class="headerlink" title="æ·»åŠ å·¥å…·"></a>æ·»åŠ å·¥å…·</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain_tavily import TavilySearch</span><br><span class="line"></span><br><span class="line">tool = TavilySearch(</span><br><span class="line">    tavily_api_key=&quot;tvly-dev-&quot;,</span><br><span class="line">    max_results=2)</span><br><span class="line">tools = [tool]</span><br><span class="line">tool.invoke(&quot;æè¶…æ˜¯è°?&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰å›¾"><a href="#å®šä¹‰å›¾" class="headerlink" title="å®šä¹‰å›¾"></a>å®šä¹‰å›¾</h4><p>åœ¨LLMä¸Šæ·»åŠ <code>bind_tools</code>ã€‚è¿™è®©LLMçŸ¥é“å¦‚æœå®ƒæƒ³ä½¿ç”¨æœç´¢å¼•æ“ï¼Œåº”ä½¿ç”¨æ­£ç¡®çš„JSONæ ¼å¼ã€‚</p>
<p>å®šä¹‰èŠå¤©æ¨¡å‹llmï¼ˆä»£ç åŒä¸Šï¼‰</p>
<p>å°†toolsæ•´åˆåˆ°<code>StateGraph</code>ä¸­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¸€ä¸ªæˆ–å¤šä¸ª**å·¥å…·ï¼ˆtoolsï¼‰ ç»‘å®šåˆ°ä¸€ä¸ª å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰**ä¸Šï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ã€å…·å¤‡å·¥å…·è°ƒç”¨èƒ½åŠ›çš„ LLM å®ä¾‹</span></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°"><a href="#åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°" class="headerlink" title="åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°"></a>åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°</h4><p>ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥è¿è¡Œè¢«è°ƒç”¨çš„å·¥å…·ã€‚é€šè¿‡å°†å·¥å…·æ·»åŠ åˆ°ä¸€ä¸ªåä¸º<code>BasicToolNode</code>çš„æ–°èŠ‚ç‚¹æ¥å®Œæˆï¼Œè¯¥èŠ‚ç‚¹æ£€æŸ¥çŠ¶æ€ä¸­çš„æœ€æ–°æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯åŒ…å«<code>tool_calls</code>ï¼Œåˆ™è°ƒç”¨å·¥å…·ã€‚å®ƒä¾èµ–äºLLMçš„<code>tool_calling</code>æ”¯æŒï¼Œè¯¥æ”¯æŒåœ¨Anthropicã€OpenAIã€Google Geminiä»¥åŠè®¸å¤šå…¶ä»–LLMæä¾›å•†ä¸­å¯ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ __call__ æ–¹æ³•ï¼Œè®©è¿™ä¸ªç±»çš„å®ä¾‹å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment"># inputs æ˜¯ langgraph ä¼ è¿›æ¥çš„å½“å‰çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, inputs: <span class="built_in">dict</span></span>):</span><br><span class="line">    <span class="comment"># 1. ä»çŠ¶æ€ä¸­è·å–æœ€æ–°çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨äº†â€œæµ·è±¡æ“ä½œç¬¦â€ :=ï¼Œå…ˆä» inputs ä¸­è·å– &#x27;messages&#x27; åˆ—è¡¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›ç©ºåˆ—è¡¨ []</span></span><br><span class="line">    <span class="comment"># ç„¶åæ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å–å‡ºæœ€åä¸€æ¡æ¶ˆæ¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> messages := inputs.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">        message = messages[-<span class="number">1</span>]  <span class="comment"># é€šå¸¸ï¼Œæœ€åä¸€æ¡æ¶ˆæ¯æ˜¯ AI å‘å‡ºçš„ï¼Œå…¶ä¸­åŒ…å«å·¥å…·è°ƒç”¨è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œå°±æŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸ªèŠ‚ç‚¹ä¸çŸ¥é“è¯¥åšä»€ä¹ˆ</span></span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;No message found in input&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. å‡†å¤‡ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨æ¥å­˜æ”¾æ‰€æœ‰å·¥å…·çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">    outputs = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. éå† AI æ¶ˆæ¯ä¸­è¯·æ±‚çš„æ‰€æœ‰å·¥å…·è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">for</span> tool_call <span class="keyword">in</span> message.tool_calls:</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. æ‰§è¡Œå·¥å…·</span></span><br><span class="line">        <span class="comment"># a. tool_call[&quot;name&quot;] è·å–å·¥å…·åç§° (ä¾‹å¦‚ &#x27;tavily_search_results_json&#x27;)</span></span><br><span class="line">        <span class="comment"># b. self.tools_by_name[...] ä»é¢„å­˜çš„å·¥å…·å­—å…¸ä¸­æ‰¾åˆ°å¯¹åº”çš„å·¥å…·å¯¹è±¡</span></span><br><span class="line">        <span class="comment"># c. .invoke(tool_call[&quot;args&quot;]) ä½¿ç”¨ LLM æä¾›çš„å‚æ•°æ¥è°ƒç”¨è¯¥å·¥å…·</span></span><br><span class="line">        tool_result = <span class="variable language_">self</span>.tools_by_name[tool_call[<span class="string">&quot;name&quot;</span>]].invoke(</span><br><span class="line">            tool_call[<span class="string">&quot;args&quot;</span>]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 5. å°†å·¥å…·æ‰§è¡Œç»“æœæ‰“åŒ…æˆ ToolMessage</span></span><br><span class="line">        <span class="comment"># è¿™æ˜¯ langgraph/langchain çš„æ ‡å‡†æ ¼å¼ï¼Œç”¨äºå‘Šè¯‰ LLM å·¥å…·æ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆ</span></span><br><span class="line">        outputs.append(</span><br><span class="line">            ToolMessage(</span><br><span class="line">                content=json.dumps(tool_result),  <span class="comment"># å·¥å…·ç»“æœå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç”¨ json.dumps åºåˆ—åŒ–</span></span><br><span class="line">                name=tool_call[<span class="string">&quot;name&quot;</span>],  <span class="comment"># å‘Šè¯‰ LLM è¿™æ˜¯å“ªä¸ªå·¥å…·çš„ç»“æœ</span></span><br><span class="line">                tool_call_id=tool_call[<span class="string">&quot;id&quot;</span>],  <span class="comment"># å¿…é¡»æä¾›åŸå§‹è¯·æ±‚çš„ IDï¼Œä»¥ä¾¿ LLM çŸ¥é“è¿™ä¸ªç»“æœå¯¹åº”å“ªä¸ªè¯·æ±‚</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. è¿”å›ç»“æœï¼Œæ›´æ–°å›¾çš„çŠ¶æ€</span></span><br><span class="line">    <span class="comment"># è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­ &#x27;messages&#x27; é”®å¯¹åº”ç€åŒ…å«æ‰€æœ‰ ToolMessage çš„åˆ—è¡¨</span></span><br><span class="line">    <span class="comment"># langgraph ä¼šå°†è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ¶ˆæ¯è¿½åŠ åˆ°ä¸»çŠ¶æ€çš„ &#x27;messages&#x27; åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: outputs&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>call</strong> æ˜¯ Python ä¸­ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„â€œé­”æœ¯æ–¹æ³•â€ï¼ˆmagic methodï¼‰ã€‚å®ƒçš„ä½œç”¨æ˜¯ è®©ä¸€ä¸ªç±»çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰èƒ½å¤Ÿåƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ ã€‚</p>
<p>è¿™åœ¨ langgraph ä¸­æ˜¯ä¸€ç§å¸¸è§ä¸”æ ¸å¿ƒçš„è®¾è®¡æ¨¡å¼ã€‚å®ƒçš„å«ä¹‰æ˜¯ï¼š</p>
<ol>
<li>èŠ‚ç‚¹å³å‡½æ•° ï¼š BasicToolNode çš„å®ä¾‹ï¼ˆæ¯”å¦‚ tool_node ï¼‰æœ¬èº«å°±ä»£è¡¨äº†å›¾ä¸­çš„ä¸€ä¸ªå¯æ‰§è¡ŒèŠ‚ç‚¹ã€‚</li>
<li>æ‰§è¡Œé€»è¾‘ ï¼šå½“ langgraph çš„çŠ¶æ€æœºè¿è¡Œåˆ°è¿™ä¸ª tool_node èŠ‚ç‚¹æ—¶ï¼Œå®ƒä¼šç›´æ¥â€œè°ƒç”¨â€è¿™ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œå¹¶æŠŠå½“å‰çš„çŠ¶æ€ï¼ˆ inputs å­—å…¸ï¼‰ä¼ é€’ç»™å®ƒ</li>
</ol>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨LangGraphé¢„æ„å»ºçš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/reference/agents/#langgraph.prebuilt.tool_node.ToolNode">ToolNode</a>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰conditional-edges"><a href="#å®šä¹‰conditional-edges" class="headerlink" title="å®šä¹‰conditional_edges"></a>å®šä¹‰<code>conditional_edges</code></h4><p>æ·»åŠ äº†å·¥å…·èŠ‚ç‚¹åï¼Œç°åœ¨æ‚¨å¯ä»¥å®šä¹‰<code>conditional_edges</code>ã€‚</p>
<p><strong>è¾¹ï¼ˆEdgesï¼‰</strong>å°†æ§åˆ¶æµä»ä¸€ä¸ªèŠ‚ç‚¹è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚<strong>æ¡ä»¶è¾¹ï¼ˆConditional edgesï¼‰</strong>ä»å•ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œé€šå¸¸åŒ…å«â€œifâ€è¯­å¥ï¼Œæ ¹æ®å½“å‰å›¾çŠ¶æ€è·¯ç”±åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚è¿™äº›å‡½æ•°æ¥æ”¶å½“å‰çš„å›¾<code>state</code>å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‡ç¤ºæ¥ä¸‹æ¥è¦è°ƒç”¨å“ªä¸ªï¼ˆæˆ–å“ªäº›ï¼‰èŠ‚ç‚¹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º<code>route_tools</code>çš„è·¯ç”±å‡½æ•°ï¼Œå®ƒæ£€æŸ¥èŠå¤©æœºå™¨äººè¾“å‡ºä¸­çš„<code>tool_calls</code>ã€‚é€šè¿‡è°ƒç”¨<code>add_conditional_edges</code>å°†æ­¤å‡½æ•°æä¾›ç»™å›¾ï¼Œè¿™ä¼šå‘Šè¯‰å›¾ï¼Œæ— è®ºä½•æ—¶<code>chatbot</code>èŠ‚ç‚¹å®Œæˆï¼Œéƒ½è¦æ£€æŸ¥æ­¤å‡½æ•°ä»¥ç¡®å®šä¸‹ä¸€æ­¥å»å“ªé‡Œã€‚</p>
<p>å¦‚æœå­˜åœ¨å·¥å…·è°ƒç”¨ï¼Œæ¡ä»¶å°†è·¯ç”±åˆ°<code>tools</code>ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è·¯ç”±åˆ°<code>END</code>ã€‚ç”±äºæ¡ä»¶å¯ä»¥è¿”å›<code>END</code>ï¼Œå› æ­¤è¿™æ¬¡æ‚¨ä¸éœ€è¦æ˜ç¡®è®¾ç½®<code>finish_point</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">route_tools</span>(<span class="params"></span></span><br><span class="line"><span class="params">     state: State,</span></span><br><span class="line"><span class="params"> </span>):</span><br><span class="line">     <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">     ç”¨äº conditional_edge çš„è·¯ç”±å‡½æ•°ï¼š</span></span><br><span class="line"><span class="string">     - å¦‚æœæœ€åä¸€æ¡æ¶ˆæ¯åŒ…å«å·¥å…·è°ƒç”¨ï¼Œåˆ™è·¯ç”±åˆ° ToolNode</span></span><br><span class="line"><span class="string">     - å¦åˆ™è·¯ç”±åˆ°ç»“æŸèŠ‚ç‚¹</span></span><br><span class="line"><span class="string">     &quot;&quot;&quot;</span></span><br><span class="line">     <span class="comment"># å¤„ç† state ä¸ºåˆ—è¡¨çš„æƒ…å†µï¼ˆå¯èƒ½æ˜¯æ¶ˆæ¯åˆ—è¡¨ï¼‰</span></span><br><span class="line">     <span class="keyword">if</span> <span class="built_in">isinstance</span>(state, <span class="built_in">list</span>):</span><br><span class="line">         ai_message = state[-<span class="number">1</span>]  <span class="comment"># è·å–æœ€åä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">     <span class="comment"># å¤„ç† state ä¸ºå­—å…¸çš„æƒ…å†µï¼ˆåŒ…å« messages å­—æ®µï¼‰</span></span><br><span class="line">     <span class="keyword">elif</span> messages := state.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">         ai_message = messages[-<span class="number">1</span>]  <span class="comment"># è·å–æœ€åä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         <span class="keyword">raise</span> ValueError(<span class="string">f&quot;è¾“å…¥çŠ¶æ€ä¸­æ²¡æœ‰æ‰¾åˆ°æ¶ˆæ¯: <span class="subst">&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">     </span><br><span class="line">     <span class="comment"># æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦æœ‰å·¥å…·è°ƒç”¨</span></span><br><span class="line">     <span class="keyword">if</span> <span class="built_in">hasattr</span>(ai_message, <span class="string">&quot;tool_calls&quot;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(ai_message.tool_calls) &gt; <span class="number">0</span>:</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;tools&quot;</span>  <span class="comment"># æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å› &quot;tools&quot; è·¯ç”±åˆ°å·¥å…·èŠ‚ç‚¹</span></span><br><span class="line">     <span class="keyword">return</span> END  <span class="comment"># æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å› END ç»“æŸæµç¨‹</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨é¢„æ„å»ºçš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/reference/prebuilt/#tools_condition">tools_condition</a>ä»£æ›¿route_toolsä»¥ä½¿å…¶æ›´ç®€æ´ã€‚</p>
<blockquote>
<p><code>tools_condition</code> å‡½æ•°åœ¨èŠå¤©æœºå™¨äººéœ€è¦ä½¿ç”¨å·¥å…·æ—¶è¿”å› â€œtoolsâ€ï¼Œå¦‚æœå¯ä»¥ä¸ä½¿ç”¨å“åº”åˆ™è¿”å› â€œENDâ€ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> tools_condition</span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">    &#123;<span class="string">&quot;tools&quot;</span>: <span class="string">&quot;tools&quot;</span>, END: END&#125;,</span><br><span class="line">)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br></pre></td></tr></table></figure>
<h4 id="å¯è§†åŒ–å›¾-1"><a href="#å¯è§†åŒ–å›¾-1" class="headerlink" title="å¯è§†åŒ–å›¾"></a>å¯è§†åŒ–å›¾</h4><p>å¦‚ä¸Š</p>
<h4 id="å‘æœºå™¨äººæé—®"><a href="#å‘æœºå™¨äººæé—®" class="headerlink" title="å‘æœºå™¨äººæé—®"></a>å‘æœºå™¨äººæé—®</h4><p>ç°åœ¨æ‚¨å¯ä»¥å‘èŠå¤©æœºå™¨äººæå‡ºè¶…å‡ºå…¶è®­ç»ƒæ•°æ®èŒƒå›´çš„é—®é¢˜ã€‚</p>
<p>å¦‚ä¸Š</p>
<h3 id="æ·»åŠ è®°å¿†åŠŸèƒ½"><a href="#æ·»åŠ è®°å¿†åŠŸèƒ½" class="headerlink" title="æ·»åŠ è®°å¿†åŠŸèƒ½"></a>æ·»åŠ è®°å¿†åŠŸèƒ½</h3><p>LangGraph é€šè¿‡<strong>æŒä¹…æ€§æ£€æŸ¥ç‚¹</strong>è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæ‚¨åœ¨ç¼–è¯‘å›¾æ—¶æä¾›ä¸€ä¸ª<code>checkpointer</code>ï¼Œå¹¶åœ¨è°ƒç”¨å›¾æ—¶æä¾›ä¸€ä¸ª<code>thread_id</code>ï¼ŒLangGraph ä¼šåœ¨æ¯ä¸€æ­¥ä¹‹åè‡ªåŠ¨ä¿å­˜çŠ¶æ€ã€‚å½“æ‚¨ä½¿ç”¨ç›¸åŒçš„<code>thread_id</code>å†æ¬¡è°ƒç”¨å›¾æ—¶ï¼Œå›¾ä¼šåŠ è½½å…¶ä¿å­˜çš„çŠ¶æ€ï¼Œå…è®¸èŠå¤©æœºå™¨äººä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­ã€‚</p>
<p>æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ï¼Œ<strong>æ£€æŸ¥ç‚¹</strong>æ¯”ç®€å•çš„èŠå¤©è®°å¿†åŠŸèƒ½<em>å¼ºå¤§å¾—å¤š</em>â€”â€”å®ƒå…è®¸æ‚¨éšæ—¶ä¿å­˜å’Œæ¢å¤å¤æ‚çŠ¶æ€ï¼Œç”¨äºé”™è¯¯æ¢å¤ã€äººå·¥å¹²é¢„å·¥ä½œæµã€æ—¶é—´æ—…è¡Œäº¤äº’ç­‰ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ æ£€æŸ¥ç‚¹ä»¥å®ç°å¤šè½®å¯¹è¯ã€‚</p>
<h4 id="åˆ›å»º-MemorySaver-æ£€æŸ¥ç‚¹"><a href="#åˆ›å»º-MemorySaver-æ£€æŸ¥ç‚¹" class="headerlink" title="åˆ›å»º MemorySaver æ£€æŸ¥ç‚¹"></a>åˆ›å»º <code>MemorySaver</code> æ£€æŸ¥ç‚¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„æ£€æŸ¥ç‚¹ï¼Œæ–¹ä¾¿æœ¬æ•™ç¨‹ä½¿ç”¨ã€‚ç„¶è€Œï¼Œåœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯èƒ½ä¼šå°†å…¶æ›´æ”¹ä¸ºä½¿ç”¨ <code>SqliteSaver</code> æˆ– <code>PostgresSaver</code> å¹¶è¿æ¥æ•°æ®åº“ã€‚</p>
<h4 id="ç¼–è¯‘å›¾-1"><a href="#ç¼–è¯‘å›¾-1" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><p>ä½¿ç”¨æä¾›çš„æ£€æŸ¥ç‚¹ç¼–è¯‘å›¾ï¼Œå›¾åœ¨éå†æ¯ä¸ªèŠ‚ç‚¹æ—¶å°†å¯¹ <code>State</code> è¿›è¡Œæ£€æŸ¥ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<h4 id="ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨"><a href="#ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨" class="headerlink" title="ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨"></a>ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨</h4><ol>
<li><p>é€‰æ‹©ä¸€ä¸ªçº¿ç¨‹ä½œä¸ºæ­¤å¯¹è¯çš„é”®ã€‚</p>
<p>thread_idå†³å®šå¯¹è¯çª—å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨æ‚¨çš„èŠå¤©æœºå™¨äºº</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user_input = &quot;æˆ‘æ˜¯è°&quot;</span><br><span class="line"></span><br><span class="line"># The config is the **second positional argument** to stream() or invoke()!</span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input&#125;]&#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=&quot;values&quot;,</span><br><span class="line">)</span><br><span class="line">for event in events:</span><br><span class="line">    event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="æ·»åŠ äººå·¥å¹²é¢„"><a href="#æ·»åŠ äººå·¥å¹²é¢„" class="headerlink" title="æ·»åŠ äººå·¥å¹²é¢„"></a>æ·»åŠ äººå·¥å¹²é¢„</h3><p>ä»£ç†å¯èƒ½ä¸å¯é ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦äººå·¥è¾“å…¥æ‰èƒ½æˆåŠŸå®Œæˆä»»åŠ¡ã€‚åŒæ ·ï¼Œå¯¹äºæŸäº›æ“ä½œï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨è¿è¡Œå‰è¦æ±‚äººå·¥æ‰¹å‡†ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡æŒ‰é¢„æœŸè¿è¡Œã€‚</p>
<p>LangGraph çš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/persistence/">æŒä¹…åŒ–</a>å±‚æ”¯æŒ<strong>äººå·¥å¹²é¢„</strong>å·¥ä½œæµï¼Œå…è®¸æ ¹æ®ç”¨æˆ·åé¦ˆæš‚åœå’Œæ¢å¤æ‰§è¡Œã€‚æ­¤åŠŸèƒ½çš„ä¸»è¦æ¥å£æ˜¯<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/how-tos/human_in_the_loop/add-human-in-the-loop/"><code>interrupt</code></a>å‡½æ•°ã€‚åœ¨èŠ‚ç‚¹å†…è°ƒç”¨<code>interrupt</code>å°†æš‚åœæ‰§è¡Œã€‚é€šè¿‡ä¼ å…¥<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/low_level/#command">Command</a>ï¼Œå¯ä»¥æ¢å¤æ‰§è¡Œå¹¶æ¥æ”¶æ¥è‡ªäººå·¥çš„æ–°è¾“å…¥ã€‚<code>interrupt</code>åœ¨åŠŸèƒ½ä¸Šç±»ä¼¼äº Python çš„å†…ç½®<code>input()</code>ï¼Œ<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/how-tos/human_in_the_loop/add-human-in-the-loop/">ä½†æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹</a>ã€‚</p>
<h4 id="æ·»åŠ human-assistanceå·¥å…·"><a href="#æ·»åŠ human-assistanceå·¥å…·" class="headerlink" title="æ·»åŠ human_assistanceå·¥å…·"></a>æ·»åŠ <code>human_assistance</code>å·¥å…·</h4><p>å°†<code>human_assistance</code>å·¥å…·æ·»åŠ åˆ°èŠå¤©æœºå™¨äººã€‚æ­¤å·¥å…·ä½¿ç”¨<code>interrupt</code>ä»äººå·¥æ¥æ”¶ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ äººå·¥å¹²é¢„åŠŸèƒ½</span><br><span class="line"># å¯¼å…¥LangGraphçš„ä¸­æ–­æœºåˆ¶å’Œå‘½ä»¤ç±»å‹</span><br><span class="line">from langgraph.types import Command, interrupt</span><br><span class="line"># å¯¼å…¥LangChainçš„å·¥å…·è£…é¥°å™¨</span><br><span class="line">from langchain_core.tools import tool</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨@toolè£…é¥°å™¨å°†å‡½æ•°æ ‡è®°ä¸ºå¯è¢«LLMè°ƒç”¨çš„å·¥å…·</span><br><span class="line">@tool</span><br><span class="line">def human_assistance(query: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;è¯·æ±‚äººå·¥ååŠ©çš„å·¥å…·å‡½æ•°ã€‚</span><br><span class="line">    å½“LLMé‡åˆ°éœ€è¦äººå·¥åˆ¤æ–­æˆ–å¸®åŠ©çš„æƒ…å†µæ—¶ï¼Œä¼šè°ƒç”¨æ­¤å·¥å…·ã€‚</span><br><span class="line">    è¯¥å‡½æ•°ä¼šæš‚åœå›¾çš„æ‰§è¡Œï¼Œç­‰å¾…äººå·¥æ“ä½œå‘˜æä¾›å“åº”ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # interrupt()å‡½æ•°ä¼šæš‚åœå›¾çš„æ‰§è¡Œï¼Œç­‰å¾…äººå·¥è¾“å…¥</span><br><span class="line">    # ä¼ å…¥çš„å­—å…¸åŒ…å«æŸ¥è¯¢ä¿¡æ¯ï¼Œäººå·¥æ“ä½œå‘˜ä¼šçœ‹åˆ°è¿™ä¸ªæŸ¥è¯¢</span><br><span class="line">    human_response = interrupt(&#123;&quot;query&quot;: query&#125;)</span><br><span class="line">    </span><br><span class="line">    # ä»äººå·¥å“åº”ä¸­æå–æ•°æ®å¹¶è¿”å›ç»™LLM</span><br><span class="line">    # human_responseæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œ&quot;data&quot;å­—æ®µåŒ…å«äººå·¥æä¾›çš„å®é™…å“åº”</span><br><span class="line">    return human_response[&quot;data&quot;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ <strong>è°ƒç”¨å“ªä¸ªå·¥å…·ï¼Œä»¥åŠä½•æ—¶è°ƒç”¨ï¼Œå®Œå…¨æ˜¯ç”±å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ ¹æ®ä½ ç»™å®ƒçš„æŒ‡ä»¤ï¼ˆPromptï¼‰æ¥å†³å®šçš„ã€‚</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tool = TavilySearch(max_results=2)</span><br><span class="line">tools = [tool, human_assistance]</span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰chatbot"><a href="#å®šä¹‰chatbot" class="headerlink" title="å®šä¹‰chatbot"></a>å®šä¹‰chatbot</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def chatbot(state: State):</span><br><span class="line">    # è°ƒç”¨ç»‘å®šäº†å·¥å…·çš„LLMï¼ˆllm_with_toolsï¼‰ï¼Œä¼ å…¥å½“å‰çš„æ¶ˆæ¯å†å²</span><br><span class="line">    # LLMä¼šæ ¹æ®æœ€æ–°çš„æ¶ˆæ¯å†³å®šæ˜¯ç”Ÿæˆæ–‡æœ¬å›å¤ï¼Œè¿˜æ˜¯è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·</span><br><span class="line">    message = llm_with_tools.invoke(state[&quot;messages&quot;])</span><br><span class="line">    </span><br><span class="line">    # --- å…³é”®æ–­è¨€é€»è¾‘ ---</span><br><span class="line">    assert len(message.tool_calls) &lt;= 1</span><br><span class="line">    </span><br><span class="line">    # å°†LLMç”Ÿæˆçš„æ–°æ¶ˆæ¯ï¼ˆå¯èƒ½æ˜¯æ–‡æœ¬å›å¤ï¼Œä¹Ÿå¯èƒ½æ˜¯å·¥å…·è°ƒç”¨è¯·æ±‚ï¼‰è¿”å›</span><br><span class="line">    # è¿™ä¸ªè¿”å›å€¼ä¼šä»¥å­—å…¸çš„å½¢å¼æ›´æ–°åˆ°çŠ¶æ€ï¼ˆStateï¼‰å¯¹è±¡ä¸­</span><br><span class="line">    return &#123;&quot;messages&quot;: [message]&#125;</span><br><span class="line"></span><br><span class="line"># å°† chatbot å‡½æ•°ä½œä¸ºåä¸º &quot;chatbot&quot; çš„èŠ‚ç‚¹æ·»åŠ åˆ°å›¾æ„å»ºå™¨ä¸­</span><br><span class="line">graph_builder.add_node(&quot;chatbot&quot;, chatbot)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸­æ–­å®‰å…¨æ€§çš„æ–­è¨€ ( assert ) : assert len(message.tool_calls) &lt;= 1 æ˜¯åœ¨å®ç°äººå·¥å¹²é¢„æ—¶ä¸€ä¸ªéå¸¸é‡è¦çš„ å®‰å…¨æªæ–½ ã€‚</p>
<ul>
<li>é—®é¢˜ : ç°ä»£ LLM æ”¯æŒå¹¶è¡Œå·¥å…·è°ƒç”¨ï¼ˆä¸€æ¬¡è¯·æ±‚æ‰§è¡Œå¤šä¸ªå·¥å…·ï¼‰ã€‚ä½†å¦‚æœå…¶ä¸­ä¸€ä¸ªå·¥å…·æ˜¯ human_assistance å¹¶è§¦å‘äº†ä¸­æ–­ï¼Œæ•´ä¸ªå›¾ä¼šæš‚åœã€‚å½“äººå·¥æ“ä½œå®Œæˆåï¼Œå›¾ä¼šä»ä¸­æ–­ç‚¹æ¢å¤ã€‚æ­¤æ—¶ï¼Œå¦‚æœä¸å¯¹å·¥å…·è°ƒç”¨æ•°é‡åšé™åˆ¶ï¼ŒLangGraph å¯èƒ½ä¼šé‡æ–°å°è¯•æ‰§è¡Œæ‰€æœ‰åœ¨ä¸­æ–­å‰è¯·æ±‚çš„å·¥å…·ï¼Œå¯¼è‡´å·²ç»æ‰§è¡Œè¿‡çš„å·¥å…·è¢«å†æ¬¡è°ƒç”¨ã€‚</li>
<li>è§£å†³æ–¹æ¡ˆ : è¿™ä¸ªæ–­è¨€å¼ºåˆ¶è¦æ±‚ LLM åœ¨æ¯ä¸€æ­¥æœ€å¤šåªèƒ½è¯·æ±‚è°ƒç”¨ä¸€ä¸ªå·¥å…·ã€‚è¿™æ ·å°±ä¿è¯äº†å½“ä¸­æ–­å‘ç”Ÿå¹¶æ¢å¤åï¼Œä¸ä¼šæœ‰é‡å¤æ‰§è¡Œå·¥å…·çš„é£é™©ï¼Œç¡®ä¿äº†æµç¨‹çš„ç¨³å®šæ€§å’Œå¯é¢„æµ‹æ€§ã€‚</li>
</ul>
</blockquote>
<h4 id="ç¼–è¯‘å›¾-2"><a href="#ç¼–è¯‘å›¾-2" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line">graph = graph_builder.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<h4 id="è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­"><a href="#è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­" class="headerlink" title="è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­"></a>è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user_input = &quot;æˆ‘éœ€è¦ä¸€äº›å…³äºæ„å»º AI ä»£ç†çš„ä¸“å®¶æŒ‡å¯¼ã€‚ä½ èƒ½å¸®æˆ‘è¯·æ±‚ååŠ©å—ï¼Ÿ&quot;</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input&#125;]&#125;,</span><br><span class="line">    config,</span><br><span class="line">    #å®ƒçš„ä½œç”¨æ˜¯æŒ‡å®šåœ¨è¿›è¡Œæµå¼å¤„ç†æ—¶ï¼Œä½ å¸Œæœ›æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯ä»¥ å®Œæ•´çš„ã€ç´¯ç§¯çš„å€¼ çš„å½¢å¼è¿”å›ï¼Œè€Œä¸æ˜¯ä»¥å¢é‡çš„ã€ç‰‡æ®µçš„å½¢å¼è¿”å›ã€‚</span><br><span class="line">    stream_mode=&quot;values&quot;,</span><br><span class="line">)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<p>èŠå¤©æœºå™¨äººç”Ÿæˆäº†ä¸€ä¸ªå·¥å…·è°ƒç”¨ï¼Œä½†éšåæ‰§è¡Œè¢«ä¸­æ–­ã€‚å¦‚æœæ‚¨æ£€æŸ¥å›¾çŠ¶æ€ï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒåœæ­¢åœ¨å·¥å…·èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line">snapshot.next</span><br></pre></td></tr></table></figure>
<h4 id="æ¢å¤æ‰§è¡Œ"><a href="#æ¢å¤æ‰§è¡Œ" class="headerlink" title="æ¢å¤æ‰§è¡Œ"></a>æ¢å¤æ‰§è¡Œ</h4><p>è¦æ¢å¤æ‰§è¡Œï¼Œè¯·ä¼ å…¥ä¸€ä¸ªåŒ…å«å·¥å…·æ‰€éœ€æ•°æ®çš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/low_level/#command"><code>Command</code></a>å¯¹è±¡ã€‚æ­¤æ•°æ®çš„æ ¼å¼å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ã€‚å¯¹äºæœ¬ç¤ºä¾‹ï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰é”®<code>&quot;data&quot;</code>çš„å­—å…¸ï¼ˆç”±human_assistanceå†³å®šï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">human_response = (</span><br><span class="line">&quot;æˆ‘ä»¬ä¸“å®¶åœ¨æ­¤ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼æˆ‘ä»¬å»ºè®®æ‚¨æŸ¥çœ‹ LangGraph æ¥æ„å»ºæ‚¨çš„ä»£ç†ã€‚å®ƒæ¯”ç®€å•çš„è‡ªä¸»ä»£ç†æ›´å¯é ã€æ›´å…·å¯æ‰©å±•æ€§ã€‚&quot;</span><br><span class="line">)   </span><br><span class="line">#ä»æš‚åœçŠ¶æ€æ¢å¤æ‰§è¡Œ</span><br><span class="line">human_command = Command(resume=&#123;&quot;data&quot;: human_response&#125;)</span><br><span class="line"></span><br><span class="line">events = graph.stream(human_command, config, stream_mode=&quot;values&quot;)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.å·¥å…·çš„å®šä¹‰ ( human_assistance function):</p>
<ul>
<li>å½“ LLM è°ƒç”¨ human_assistance å·¥å…·æ—¶ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ‰§è¡Œã€‚</li>
<li>å‡½æ•°å†…éƒ¨ï¼Œ interrupt() è¢«è°ƒç”¨ï¼Œå¯¼è‡´å›¾æš‚åœï¼Œå¹¶ç­‰å¾…äººå·¥è¾“å…¥ã€‚</li>
<li>åœ¨å›¾æ¢å¤åï¼Œ interrupt() å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯æ‚¨é€šè¿‡ Command(resume=â€¦) æ³¨å…¥çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ {â€œdataâ€: human_response} ã€‚</li>
<li>å› æ­¤ï¼Œ human_assistance å‡½æ•°ä¸­çš„ human_response å˜é‡å®é™…ä¸Šå°±ç­‰äº {â€œdataâ€: human_response} ã€‚</li>
<li>æœ€åï¼Œ return human_response[â€œdataâ€] ä»è¿™ä¸ªå­—å…¸ä¸­æå–å‡º â€œdataâ€ é”®å¯¹åº”çš„å€¼ ï¼Œå¹¶å°†å…¶ä½œä¸º human_assistance å·¥å…·çš„æœ€ç»ˆè¿”å›ç»“æœã€‚</li>
</ul>
<p>2.æ¢å¤æŒ‡ä»¤ ( Command(resume=â€¦) ):</p>
<ul>
<li>å½“æ‚¨æ„å»º Command(resume={â€œdataâ€: human_response}) æ—¶ï¼Œæ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªç¬¦åˆ human_assistance å‡½æ•°æœŸæœ›çš„ç»“æ„ã€‚</li>
<li>æ‚¨å°†äººå·¥å›å¤åŒ…è£…åœ¨ä¸€ä¸ªå­—å…¸é‡Œï¼Œå¹¶ä½¿ç”¨ â€œdataâ€ ä½œä¸ºé”®ã€‚</li>
<li>è¿™ä¸ªç»“æ„è¢«ä¼ é€’å› interrupt() ï¼Œç„¶åè¢« human_assistance å‡½æ•°æ¥æ”¶å’Œè§£æã€‚</li>
</ul>
<p>å› ä¸º human_assistance å‡½æ•°çš„ return è¯­å¥æœŸæœ›ä»è¿”å›çš„å­—å…¸ä¸­è®¿é—® â€œdataâ€ é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ¢å¤æ‰§è¡Œæ—¶å¿…é¡»æä¾›ä¸€ä¸ªå…·æœ‰ç›¸åŒç»“æ„çš„å­—å…¸ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ•°æ®èƒ½å¤Ÿæ­£ç¡®åœ°åœ¨ä¸­æ–­å’Œæ¢å¤çš„è¿‡ç¨‹ä¸­ä¼ é€’ã€‚</p>
</blockquote>
<p>åœ¨ LangGraph ä¸­ï¼Œ<code>Command</code> æ˜¯ä¸€ä¸ªç”¨äº<strong>æ§åˆ¶å›¾æ‰§è¡Œæµç¨‹ã€æ›´æ–°çŠ¶æ€ã€å®ç°äººæœºäº¤äº’</strong>çš„æ ¸å¿ƒç±»ã€‚å®ƒæ”¯æŒä»¥ä¸‹å››ä¸ªå‚æ•°ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">å‚æ•°å</th>
<th style="text-align:left">ç±»å‹</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>update</code></td>
<td style="text-align:left"><code>dict</code></td>
<td style="text-align:left">ç”¨äºæ›´æ–°å›¾çš„çŠ¶æ€ï¼ˆstateï¼‰ã€‚ä¾‹å¦‚ï¼š<code>Command(update=&#123;&quot;foo&quot;: &quot;bar&quot;&#125;)</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>resume</code></td>
<td style="text-align:left"><code>Any</code></td>
<td style="text-align:left">ä¸ <code>interrupt()</code> é…åˆä½¿ç”¨ï¼Œç”¨äºæ¢å¤è¢«ä¸­æ–­çš„å›¾æ‰§è¡Œï¼Œå¹¶ä¼ é€’ç”¨æˆ·è¾“å…¥ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>goto</code></td>
<td style="text-align:left"><code>str</code> æˆ– <code>Send</code> æˆ– `List[str</td>
<td style="text-align:left">Send]`</td>
<td>æ§åˆ¶ä¸‹ä¸€æ­¥è¦æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œæ”¯æŒè·³è½¬åˆ°æŒ‡å®šèŠ‚ç‚¹ã€å¤šä¸ªèŠ‚ç‚¹åºåˆ—ï¼Œæˆ–ä½¿ç”¨ <code>Send</code> å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>graph</code></td>
<td style="text-align:left"><code>str</code></td>
<td style="text-align:left">å¯é€‰ï¼ŒæŒ‡å®šå‘½ä»¤ä½œç”¨çš„å›¾ã€‚é»˜è®¤æ˜¯å½“å‰å›¾ï¼Œä¹Ÿå¯ä»¥è®¾ä¸º <code>Command.PARENT</code> è¡¨ç¤ºçˆ¶å›¾ã€‚</td>
</tr>
</tbody>
</table>
</div>
<h3 id="è‡ªå®šä¹‰çŠ¶æ€"><a href="#è‡ªå®šä¹‰çŠ¶æ€" class="headerlink" title="è‡ªå®šä¹‰çŠ¶æ€"></a>è‡ªå®šä¹‰çŠ¶æ€</h3><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å‘çŠ¶æ€æ·»åŠ é¢å¤–å­—æ®µï¼Œä»¥å®šä¹‰å¤æ‚è¡Œä¸ºï¼Œè€Œæ— éœ€ä¾èµ–æ¶ˆæ¯åˆ—è¡¨ã€‚èŠå¤©æœºå™¨äººå°†ä½¿ç”¨å…¶æœç´¢å·¥å…·æŸ¥æ‰¾ç‰¹å®šä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬å‘ç»™äººå·¥è¿›è¡Œå®¡æŸ¥ã€‚</p>
<h4 id="å‘çŠ¶æ€æ·»åŠ é”®"><a href="#å‘çŠ¶æ€æ·»åŠ é”®" class="headerlink" title="å‘çŠ¶æ€æ·»åŠ é”®"></a>å‘çŠ¶æ€æ·»åŠ é”®</h4><p>é€šè¿‡å‘çŠ¶æ€æ·»åŠ  <code>name</code> å’Œ <code>birthday</code> é”®ï¼Œæ›´æ–°èŠå¤©æœºå™¨äººä»¥ç ”ç©¶å®ä½“çš„ç”Ÿæ—¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class State(TypedDict):</span><br><span class="line">    messages: Annotated[list, add_messages]</span><br><span class="line">    name: str</span><br><span class="line">    birthday: str</span><br></pre></td></tr></table></figure>
<p>å°†æ­¤ä¿¡æ¯æ·»åŠ åˆ°çŠ¶æ€ä¸­ï¼Œå¯ä»¥ä½¿å…¶è½»æ¾è¢«å…¶ä»–å›¾èŠ‚ç‚¹ï¼ˆä¾‹å¦‚å­˜å‚¨æˆ–å¤„ç†ä¿¡æ¯çš„ä¸‹æ¸¸èŠ‚ç‚¹ï¼‰ä»¥åŠå›¾çš„æŒä¹…å±‚è®¿é—®ã€‚</p>
<h4 id="åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€"><a href="#åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€" class="headerlink" title="åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€"></a>åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€</h4><p>ç°åœ¨ï¼Œåœ¨ <code>human_assistance</code> å·¥å…·å†…éƒ¨å¡«å……çŠ¶æ€é”®ã€‚è¿™å…è®¸äººå·¥åœ¨ä¿¡æ¯å­˜å‚¨åˆ°çŠ¶æ€ä¹‹å‰å¯¹å…¶è¿›è¡Œå®¡æŸ¥ã€‚ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/low_level/#using-inside-tools"><code>Command</code></a> ä»<strong>å·¥å…·å†…éƒ¨</strong>å‘å‡ºçŠ¶æ€æ›´æ–°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># ä» langchain_core.messages å¯¼å…¥ ToolMessageï¼Œç”¨äºåˆ›å»ºå·¥å…·è°ƒç”¨çš„å“åº”æ¶ˆæ¯</span><br><span class="line">from langchain_core.messages import ToolMessage </span><br><span class="line"># ä» langchain_core.tools å¯¼å…¥ InjectedToolCallIdï¼ˆç”¨äºè‡ªåŠ¨æ³¨å…¥å·¥å…·è°ƒç”¨IDï¼‰å’Œ toolï¼ˆå·¥å…·è£…é¥°å™¨ï¼‰</span><br><span class="line">from langchain_core.tools import InjectedToolCallId, tool </span><br><span class="line"></span><br><span class="line"># ä» langgraph.types å¯¼å…¥ Commandï¼ˆç”¨äºå‘å›¾å‘é€æŒ‡ä»¤ï¼‰å’Œ interruptï¼ˆç”¨äºä¸­æ–­å›¾çš„æ‰§è¡Œï¼‰</span><br><span class="line">from langgraph.types import Command, interrupt </span><br><span class="line">from typing import Annotated</span><br><span class="line"># @tool è£…é¥°å™¨å°†è¿™ä¸ªå‡½æ•°å£°æ˜ä¸ºä¸€ä¸ªå¯ä¾› LLM è°ƒç”¨çš„å·¥å…·</span><br><span class="line">@tool </span><br><span class="line">def human_assistance(</span><br><span class="line">    name: str, </span><br><span class="line">    birthday: str, </span><br><span class="line">    # tool_call_id è¿™ä¸ªå‚æ•°éå¸¸ç‰¹æ®Šã€‚Annotated[...] å’Œ InjectedToolCallId å‘Šè¯‰ LangGraphï¼š</span><br><span class="line">    # 1. è¿™ä¸ªå‚æ•°ä¸åº”æš´éœ²ç»™ LLMï¼ŒLLM åœ¨è°ƒç”¨æ­¤å·¥å…·æ—¶ä¸éœ€è¦æä¾›å®ƒã€‚</span><br><span class="line">    # 2. LangGraph åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å°†è§¦å‘æ­¤å·¥å…·çš„é‚£ä¸ªå·¥å…·è°ƒç”¨çš„ ID æ³¨å…¥åˆ°è¿™ä¸ªå‚æ•°ä¸­ã€‚</span><br><span class="line">    # è¿™ä¸ª ID å¯¹äºåˆ›å»ºä¸åŸå§‹è¯·æ±‚ç›¸å…³è”çš„ ToolMessage è‡³å…³é‡è¦ã€‚</span><br><span class="line">    tool_call_id: Annotated[str, InjectedToolCallId]</span><br><span class="line">) -&gt; str: </span><br><span class="line">    &quot;&quot;&quot;å½“éœ€è¦äººå·¥ç¡®è®¤æˆ–æ›´æ­£ä¿¡æ¯æ—¶ï¼Œè¯·æ±‚äººç±»ååŠ©ã€‚&quot;&quot;&quot; </span><br><span class="line">    # è°ƒç”¨ interrupt() æ¥æš‚åœå›¾çš„æ‰§è¡Œï¼Œå¹¶å‘äººç±»å®¡æ ¸è€…å‘ˆç°ä¸€ä¸ªåŒ…å«é—®é¢˜å’Œå¾…ç¡®è®¤æ•°æ®çš„å­—å…¸ã€‚</span><br><span class="line">    # å›¾ä¼šåœ¨æ­¤å¤„æš‚åœï¼Œç›´åˆ°äººç±»é€šè¿‡ resume æŒ‡ä»¤æä¾›äº†å“åº”ã€‚</span><br><span class="line">    human_response = interrupt( </span><br><span class="line">        &#123; </span><br><span class="line">            &quot;question&quot;: &quot;Is this correct?&quot;, </span><br><span class="line">            &quot;name&quot;: name, </span><br><span class="line">            &quot;birthday&quot;: birthday, </span><br><span class="line">        &#125;,</span><br><span class="line">    ) </span><br><span class="line">    # æ£€æŸ¥äººç±»çš„å“åº”ã€‚å¦‚æœå“åº”ä¸­ &#x27;correct&#x27; é”®çš„å€¼æ˜¯ &#x27;yes&#x27; æˆ– &#x27;y&#x27; å¼€å¤´ï¼Œ</span><br><span class="line">    # åˆ™è®¤ä¸ºä¿¡æ¯æ˜¯æ­£ç¡®çš„ã€‚</span><br><span class="line">    if human_response.get(&quot;correct&quot;, &quot;&quot;).lower().startswith(&quot;y&quot;): </span><br><span class="line">        # å¦‚æœä¿¡æ¯æ­£ç¡®ï¼Œç›´æ¥ä½¿ç”¨ä» LLM è·å–çš„åŸå§‹ä¿¡æ¯ã€‚</span><br><span class="line">        verified_name = name </span><br><span class="line">        verified_birthday = birthday </span><br><span class="line">        response = &quot;Correct&quot; </span><br><span class="line">    # å¦åˆ™ï¼Œè®¤ä¸ºäººç±»å®¡æ ¸è€…æä¾›äº†æ›´æ­£åçš„ä¿¡æ¯ã€‚</span><br><span class="line">    else: </span><br><span class="line">        # ä»äººç±»çš„å“åº”ä¸­è·å–æ›´æ­£åçš„å§“åå’Œç”Ÿæ—¥ã€‚</span><br><span class="line">        # å¦‚æœäººç±»æ²¡æœ‰æä¾›æ–°çš„å€¼ï¼Œåˆ™ä½¿ç”¨ .get() çš„é»˜è®¤å€¼ï¼Œå³åŸå§‹å€¼ã€‚</span><br><span class="line">        verified_name = human_response.get(&quot;name&quot;, name) </span><br><span class="line">        verified_birthday = human_response.get(&quot;birthday&quot;, birthday) </span><br><span class="line">        response = f&quot;Made a correction: &#123;human_response&#125;&quot; </span><br><span class="line"></span><br><span class="line">    # åœ¨å·¥å…·å†…éƒ¨ç›´æ¥æ„é€ ä¸€ä¸ªç”¨äºæ›´æ–°å›¾çŠ¶æ€çš„å­—å…¸ã€‚</span><br><span class="line">    state_update = &#123; </span><br><span class="line">        &quot;name&quot;: verified_name, # æ›´æ–°çŠ¶æ€ä¸­çš„ &#x27;name&#x27; å­—æ®µ</span><br><span class="line">        &quot;birthday&quot;: verified_birthday, # æ›´æ–°çŠ¶æ€ä¸­çš„ &#x27;birthday&#x27; å­—æ®µ</span><br><span class="line">        # åˆ›å»ºä¸€ä¸ª ToolMessageï¼Œå°†å…¶æ·»åŠ åˆ°çŠ¶æ€çš„ &#x27;messages&#x27; åˆ—è¡¨ä¸­ã€‚</span><br><span class="line">        # è¿™ä¸ªæ¶ˆæ¯å°†ä½œä¸ºæ­¤å·¥å…·è°ƒç”¨çš„æ­£å¼â€œç­”å¤â€å‡ºç°åœ¨å¯¹è¯å†å²ä¸­ã€‚</span><br><span class="line">        # tool_call_id æ˜¯å¿…éœ€çš„ï¼Œç”¨äºå°†æ­¤ç­”å¤ä¸ LLM çš„åŸå§‹å·¥å…·è°ƒç”¨è¯·æ±‚å…³è”èµ·æ¥ã€‚</span><br><span class="line">        &quot;messages&quot;: [ToolMessage(response, tool_call_id=tool_call_id)], </span><br><span class="line">    &#125; </span><br><span class="line">    # è¿™ä¸ªå·¥å…·ä¸è¿”å›ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª Command å¯¹è±¡ã€‚</span><br><span class="line">    # Command(update=...) æ˜¯ä¸€ä¸ªæ˜ç¡®çš„æŒ‡ä»¤ï¼Œå‘Šè¯‰ LangGraph æ‰§è¡Œå™¨ï¼š</span><br><span class="line">    # â€œè¯·ä¸è¦å°†æˆ‘çš„è¿”å›å€¼å½“ä½œæ™®é€šå·¥å…·è¾“å‡ºï¼Œè€Œæ˜¯ç”¨ state_update å­—å…¸é‡Œçš„å†…å®¹æ¥ç›´æ¥æ›´æ–°å½“å‰çš„å›¾çŠ¶æ€ã€‚â€</span><br><span class="line">    return Command(update=state_update) </span><br></pre></td></tr></table></figure>
<p>å›¾çš„å…¶ä½™éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</p>
<h4 id="æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥"><a href="#æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥" class="headerlink" title="æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥"></a>æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥</h4><p>æç¤ºèŠå¤©æœºå™¨äººæŸ¥æ‰¾ LangGraph åº“çš„â€œç”Ÿæ—¥â€ï¼Œå¹¶åœ¨å…¶è·å–æ‰€éœ€ä¿¡æ¯åï¼ŒæŒ‡ç¤ºèŠå¤©æœºå™¨äººä½¿ç”¨ <code>human_assistance</code> å·¥å…·ã€‚é€šè¿‡åœ¨å·¥å…·å‚æ•°ä¸­è®¾ç½® <code>name</code> å’Œ <code>birthday</code>ï¼Œæ‚¨å°†å¼ºåˆ¶èŠå¤©æœºå™¨äººä¸ºè¿™äº›å­—æ®µç”Ÿæˆæè®®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">user_input = (</span><br><span class="line">    &quot;ä½ èƒ½æŸ¥ä¸€ä¸‹ LangGraph æ˜¯ä»€ä¹ˆæ—¶å€™å‘å¸ƒçš„å—ï¼Ÿ &quot;</span><br><span class="line">    &quot;å½“ä½ æœ‰äº†ç­”æ¡ˆåï¼Œä½¿ç”¨ human_assistance å·¥å…·è¿›è¡Œå®¡æŸ¥ã€‚&quot;</span><br><span class="line">)</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input&#125;]&#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=&quot;values&quot;,</span><br><span class="line">)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†æ¬¡åœ¨ <code>human_assistance</code> å·¥å…·ä¸­è§¦å‘äº† <code>interrupt</code>ã€‚</p>
<h4 id="æ·»åŠ äººå·¥ååŠ©"><a href="#æ·»åŠ äººå·¥ååŠ©" class="headerlink" title="æ·»åŠ äººå·¥ååŠ©"></a>æ·»åŠ äººå·¥ååŠ©</h4><p>èŠå¤©æœºå™¨äººæœªèƒ½è¯†åˆ«æ­£ç¡®çš„æ—¥æœŸï¼Œå› æ­¤ä¸ºå…¶æä¾›ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">human_command = Command(</span><br><span class="line">    resume=&#123;</span><br><span class="line">        &quot;name&quot;: &quot;LangGraph&quot;,</span><br><span class="line">        &quot;birthday&quot;: &quot;Jan 17, 2024&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">events = graph.stream(human_command, config, stream_mode=&quot;values&quot;)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œè¿™äº›å­—æ®µç°åœ¨å·²åæ˜ åœ¨çŠ¶æ€ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line"></span><br><span class="line">&#123;k: v for k, v in snapshot.values.items() if k in (&quot;name&quot;, &quot;birthday&quot;)&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä½¿å¾—ä¸‹æ¸¸èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼Œè¿›ä¸€æ­¥å¤„ç†æˆ–å­˜å‚¨ä¿¡æ¯çš„èŠ‚ç‚¹ï¼‰å¯ä»¥è½»æ¾è®¿é—®å®ƒä»¬ã€‚</p>
<h3 id="æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰"><a href="#æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰" class="headerlink" title="æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰"></a>æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰</h3><p>åœ¨å…¸å‹çš„èŠå¤©æœºå™¨äººå·¥ä½œæµç¨‹ä¸­ï¼Œç”¨æˆ·ä¸æœºå™¨äººè¿›è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡äº¤äº’ä»¥å®Œæˆä»»åŠ¡ã€‚<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/tutorials/get-started/3-add-memory/">è®°å¿†</a>å’Œ<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/tutorials/get-started/4-human-in-the-loop/">äººå·¥å¹²é¢„</a>åŠŸèƒ½å¯ä»¥ä¸ºå›¾çŠ¶æ€å¯ç”¨æ£€æŸ¥ç‚¹å¹¶æ§åˆ¶æœªæ¥çš„å“åº”ã€‚</p>
<p>å¦‚æœæ‚¨å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿä»ä¹‹å‰çš„å“åº”å¼€å§‹å¹¶æ¢ç´¢ä¸åŒçš„ç»“æœï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿæˆ–è€…ï¼Œå¦‚æœæ‚¨å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿå›æº¯èŠå¤©æœºå™¨äººçš„å·¥ä½œä»¥çº æ­£é”™è¯¯æˆ–å°è¯•ä¸åŒçš„ç­–ç•¥ï¼Œè¿™åœ¨è‡ªä¸»è½¯ä»¶å·¥ç¨‹å¸ˆç­‰åº”ç”¨ç¨‹åºä¸­å¾ˆå¸¸è§ï¼Œé‚£åˆè¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ LangGraph å†…ç½®çš„<strong>æ—¶å…‰æ—…è¡Œ</strong>åŠŸèƒ½åˆ›å»ºè¿™äº›ç±»å‹çš„ä½“éªŒã€‚</p>
<h4 id="å›æº¯æ‚¨çš„å›¾"><a href="#å›æº¯æ‚¨çš„å›¾" class="headerlink" title="å›æº¯æ‚¨çš„å›¾"></a>å›æº¯æ‚¨çš„å›¾</h4><p>é€šè¿‡ä½¿ç”¨å›¾çš„<code>get_state_history</code>æ–¹æ³•è·å–æ£€æŸ¥ç‚¹æ¥å›æº¯æ‚¨çš„å›¾ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä»ä¹‹å‰çš„è¿™ä¸ªæ—¶é—´ç‚¹æ¢å¤æ‰§è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ to_replay ä¸º Noneï¼Œå®ƒå°†ç”¨äºå­˜å‚¨æˆ‘ä»¬æƒ³è¦â€œæ—¶é—´æ—…è¡Œâ€å›å»çš„ç‰¹å®šçŠ¶æ€ã€‚</span><br><span class="line"># to_replay å°†åœ¨å¾ªç¯ä¸­è¢«èµ‹å€¼ä¸ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„é‚£ä¸ªå†å²çŠ¶æ€å¿«ç…§ã€‚</span><br><span class="line">to_replay = None</span><br><span class="line"></span><br><span class="line"># éå† `graph` åœ¨ç»™å®š `config` ä¸‹çš„æ‰€æœ‰å†å²çŠ¶æ€ã€‚</span><br><span class="line"># `graph.get_state_history(config)` ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå…¶ä¸­åŒ…å«äº†ä»å¼€å§‹åˆ°å½“å‰çš„æ‰€æœ‰çŠ¶æ€å¿«ç…§ã€‚</span><br><span class="line">for state in graph.get_state_history(config):</span><br><span class="line">    # æ‰“å°å½“å‰çŠ¶æ€å¿«ç…§ä¸­çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘ä»¬è§‚å¯Ÿå’Œé€‰æ‹©ã€‚</span><br><span class="line">    # `len(state.values[&quot;messages&quot;])` æ˜¾ç¤ºäº†åˆ°è¯¥çŠ¶æ€ä¸ºæ­¢ï¼Œå¯¹è¯å†å²ä¸­çš„æ¶ˆæ¯æ€»æ•°ã€‚</span><br><span class="line">    # `state.next` æ˜¾ç¤ºäº†åœ¨è¯¥çŠ¶æ€ä¹‹åï¼Œå›¾å°†è¦æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æˆ–æ­¥éª¤çš„åç§°ã€‚</span><br><span class="line">    print(&quot;Num Messages: &quot;, len(state.values[&quot;messages&quot;]), &quot;Next: &quot;, state.next)</span><br><span class="line">    </span><br><span class="line">    # æ‰“å°ä¸€æ¡åˆ†éš”çº¿ï¼Œä½¿è¾“å‡ºæ›´æ˜“è¯»ã€‚</span><br><span class="line">    print(&quot;-&quot; * 80)</span><br><span class="line">    </span><br><span class="line">    # è¿™é‡Œæ˜¯é€‰æ‹©â€œæ—¶é—´æ—…è¡Œâ€ç›®æ ‡ç‚¹çš„å…³é”®é€»è¾‘ã€‚</span><br><span class="line">    # æˆ‘ä»¬è®¾å®šä¸€ä¸ªæ¡ä»¶ï¼šå½“å¯¹è¯å†å²ä¸­çš„æ¶ˆæ¯æ•°é‡æ­£å¥½ç­‰äº4æ—¶ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†æƒ³è¦å›åˆ°çš„é‚£ä¸ªç‚¹ã€‚</span><br><span class="line">    # è¿™æ˜¯ä¸€ä¸ªä¸ºäº†æ¼”ç¤ºè€Œè®¾å®šçš„ä»»æ„æ¡ä»¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®æ›´å¤æ‚çš„é€‰æ‹©é€»è¾‘ã€‚</span><br><span class="line">    if len(state.values[&quot;messages&quot;]) == 4:</span><br><span class="line">        # We are somewhat arbitrarily selecting a specific state based on the number of chat messages in the state.</span><br><span class="line">        # å°†å½“å‰è¿™ä¸ªç¬¦åˆæ¡ä»¶çš„çŠ¶æ€ï¼ˆstateï¼‰ä¿å­˜åˆ° to_replay å˜é‡ä¸­ã€‚</span><br><span class="line">        # å¾ªç¯ç»“æŸåï¼Œto_replay å˜é‡å°†æŒæœ‰æˆ‘ä»¬é€‰ä¸­çš„é‚£ä¸ªå†å²æ—¶åˆ»çš„å®Œæ•´çŠ¶æ€ï¼Œ</span><br><span class="line">        # ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥æ¢å¤æˆ–ä¿®æ”¹æ‰§è¡Œæµç¨‹ã€‚</span><br><span class="line">        to_replay = state</span><br></pre></td></tr></table></figure>
<p>å›¾çš„æ¯ä¸€æ­¥éƒ½ä¼šä¿å­˜æ£€æŸ¥ç‚¹ã€‚è¿™<strong>è·¨è¶Šäº†è°ƒç”¨</strong>ï¼Œå› æ­¤æ‚¨å¯ä»¥å›æº¯æ•´ä¸ªçº¿ç¨‹çš„å†å²ã€‚</p>
<h4 id="ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€"><a href="#ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€" class="headerlink" title="ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€"></a>ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€</h4><p>ä»<code>to_replay</code>çŠ¶æ€æ¢å¤ã€‚ä»è¿™ä¸€ç‚¹æ¢å¤å°†æ¥ä¸‹æ¥è°ƒç”¨<strong>action</strong>èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(to_replay.next)</span><br><span class="line">print(to_replay.config)</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ç‚¹çš„<code>to_replay.config</code>åŒ…å«ä¸€ä¸ª<code>checkpoint_id</code>æ—¶é—´æˆ³ã€‚æä¾›æ­¤<code>checkpoint_id</code>å€¼ä¼šå‘Šè¯‰ LangGraph çš„æ£€æŸ¥ç‚¹å™¨ä»è¯¥æ—¶é—´ç‚¹<strong>åŠ è½½</strong>çŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, to_replay.config, stream_mode=&quot;values&quot;):</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h3 id="è¿è¡Œæœ¬åœ°æœåŠ¡å™¨"><a href="#è¿è¡Œæœ¬åœ°æœåŠ¡å™¨" class="headerlink" title="è¿è¡Œæœ¬åœ°æœåŠ¡å™¨"></a>è¿è¡Œæœ¬åœ°æœåŠ¡å™¨</h3><h4 id="å®‰è£…-LangGraph-CLI"><a href="#å®‰è£…-LangGraph-CLI" class="headerlink" title="å®‰è£… LangGraph CLI"></a>å®‰è£… LangGraph CLI</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Python &gt;= 3.11 is required.</span><br><span class="line"></span><br><span class="line">pip install --upgrade &quot;langgraph-cli[inmem]&quot;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»º-LangGraph-åº”ç”¨-ğŸŒ±"><a href="#åˆ›å»º-LangGraph-åº”ç”¨-ğŸŒ±" class="headerlink" title="åˆ›å»º LangGraph åº”ç”¨ ğŸŒ±"></a>åˆ›å»º LangGraph åº”ç”¨ ğŸŒ±</h4><p>ä» <a target="_blank" rel="noopener" href="https://github.com/langchain-ai/new-langgraph-project"><code>new-langgraph-project-python</code> æ¨¡æ¿</a> æˆ– <a target="_blank" rel="noopener" href="https://github.com/langchain-ai/new-langgraphjs-project"><code>new-langgraph-project-js</code> æ¨¡æ¿</a> åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚æ­¤æ¨¡æ¿å±•ç¤ºäº†ä¸€ä¸ªå•èŠ‚ç‚¹åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„é€»è¾‘è¿›è¡Œæ‰©å±•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">langgraph new . --template new-langgraph-project-python</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨ <code>langgraph new</code> è€Œä¸æŒ‡å®šæ¨¡æ¿ï¼Œç³»ç»Ÿå°†æ˜¾ç¤ºä¸€ä¸ªäº¤äº’å¼èœå•ï¼Œæ‚¨å¯ä»¥ä»ä¸­é€‰æ‹©å¯ç”¨çš„æ¨¡æ¿åˆ—è¡¨ã€‚</p>
</blockquote>
<h4 id="ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹"><a href="#ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹" class="headerlink" title="ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹"></a>ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹</h4><p>uv æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„æé€Ÿ Python åŒ…å’Œé¡¹ç›®ç®¡ç†å™¨ ã€‚å®ƒæ—¨åœ¨è§£å†³ä¼ ç»Ÿ Python åŒ…ç®¡ç†å·¥å…·ï¼ˆå¦‚ pip ã€ poetry ç­‰ï¼‰åœ¨é€Ÿåº¦å’Œæ•ˆç‡æ–¹é¢çš„ç—›ç‚¹ï¼Œæä¾›æ›´å¿«çš„å®‰è£…ã€ä¾èµ–è§£æå’Œç¯å¢ƒç®¡ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install uv#å®‰è£…uv</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ<code>uv sync</code>ä¼šæ ¹æ® <code>pyproject.toml</code>çš„ä¾èµ–åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–</p>
<blockquote>
<p><code>pyproject.toml</code> æ–‡ä»¶æ˜¯ Python é¡¹ç›®ä¸­ç”¨äºç»Ÿä¸€é…ç½®é¡¹ç›®å…ƒæ•°æ®ã€æ„å»ºç³»ç»Ÿã€ä¾èµ–ç®¡ç†å’Œå„ç§å·¥å…·è®¾ç½®çš„æ ‡å‡†åŒ–æ–‡ä»¶ã€‚å®ƒé€šå¸¸ç”¨äºæ›¿ä»£æ—§çš„ requirements.txt æ–‡ä»¶ï¼Œæä¾›æ›´ç°ä»£å’Œé›†ä¸­çš„é¡¹ç›®é…ç½®æ–¹å¼ã€‚</p>
</blockquote>
<h4 id="åˆ›å»ºä¸€ä¸ª-env-æ–‡ä»¶"><a href="#åˆ›å»ºä¸€ä¸ª-env-æ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶"></a>åˆ›å»ºä¸€ä¸ª <code>.env</code> æ–‡ä»¶</h4><p>æ‚¨å°†åœ¨æ–° LangGraph åº”ç”¨çš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ª <code>.env.example</code> æ–‡ä»¶ã€‚åœ¨æ–° LangGraph åº”ç”¨çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.env</code> æ–‡ä»¶ï¼Œå¹¶å°† <code>.env.example</code> æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å…¶ä¸­ï¼Œå¡«å…¥æ‰€éœ€çš„ API å¯†é’¥ã€‚</p>
<p>æ·»åŠ ç¯å¢ƒå˜é‡å¦‚LANGSMITH_API_KEYï¼ŒOPENAI_API_KEYç­‰</p>
<h4 id="å¯åŠ¨-LangGraph-æœåŠ¡å™¨"><a href="#å¯åŠ¨-LangGraph-æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨ LangGraph æœåŠ¡å™¨"></a>å¯åŠ¨ LangGraph æœåŠ¡å™¨</h4><p>åœ¨æœ¬åœ°å¯åŠ¨ LangGraph API æœåŠ¡å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">langgraph dev</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;    Ready!</span><br><span class="line">&gt;</span><br><span class="line">&gt;    - API: [https://:2024](https://:2024/)</span><br><span class="line">&gt;</span><br><span class="line">&gt;    - Docs: https://:2024/docs</span><br><span class="line">&gt;</span><br><span class="line">&gt;    - LangGraph Studio Web UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024</span><br></pre></td></tr></table></figure>
<p>LangGraph æœåŠ¡å™¨ï¼ˆå¦‚æ‚¨é€šè¿‡ langgraph dev å‘½ä»¤å¯åŠ¨çš„æœåŠ¡å™¨ï¼‰çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªè¿è¡Œç¯å¢ƒå’Œæ¥å£ï¼Œç”¨äºå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œç®¡ç†åŸºäº LangGraph æ„å»ºçš„ AI ä»£ç†å’Œåº”ç”¨ç¨‹åºã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç”¨é€”ï¼š</p>
<ol>
<li>API æ¥å£æš´éœ² ï¼šå®ƒå°†æ‚¨ç”¨ LangGraph å®šä¹‰çš„å¤æ‚ä»£ç†é€»è¾‘ï¼ˆå³å›¾ç»“æ„ï¼‰é€šè¿‡æ ‡å‡†çš„ RESTful API æ¥å£æš´éœ²å‡ºæ¥ã€‚è¿™æ„å‘³ç€å…¶ä»–åº”ç”¨ç¨‹åºã€å‰ç«¯ç•Œé¢æˆ–è€…å…¶ä»–æœåŠ¡å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚ä¸æ‚¨çš„ LangGraph ä»£ç†è¿›è¡Œäº¤äº’ï¼Œè€Œæ— éœ€ç›´æ¥é›†æˆ LangGraph çš„ Python ä»£ç ã€‚</li>
<li>ç®€åŒ–éƒ¨ç½² ï¼šé€šè¿‡å°† LangGraph åº”ç”¨ç¨‹åºæ‰“åŒ…æˆä¸€ä¸ªå¯è¿è¡Œçš„æœåŠ¡ï¼Œæ‚¨å¯ä»¥æ›´å®¹æ˜“åœ°å°†å…¶éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ã€å®¹å™¨ï¼ˆå¦‚ Dockerï¼‰æˆ–å…¶ä»–ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™ä½¿å¾— LangGraph ä»£ç†å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡è¿è¡Œï¼Œæ–¹ä¾¿æ‰©å±•å’Œç®¡ç†ã€‚</li>
<li><p>å¼€å‘å’Œè°ƒè¯•ä¾¿åˆ© ï¼š</p>
<ul>
<li>å®æ—¶é¢„è§ˆå’Œè°ƒè¯• ï¼šæœåŠ¡å™¨é€šå¸¸ä¼šæä¾›ä¸€ä¸ª Studio UIï¼ˆå¦‚æ‚¨åœ¨ <a target="_blank" rel="noopener" href="http://127.0.0.1:2024/studio">http://127.0.0.1:2024/studio</a> çœ‹åˆ°çš„ï¼‰ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå¯è§†åŒ–åœ°æŸ¥çœ‹ä»£ç†çš„å›¾ç»“æ„ã€æ‰§è¡Œæµç¨‹ã€çŠ¶æ€å˜åŒ–å’Œä¸­é—´æ­¥éª¤ï¼Œè¿™å¯¹äºç†è§£å’Œè°ƒè¯•å¤æ‚çš„ä»£ç†è¡Œä¸ºè‡³å…³é‡è¦ã€‚</li>
<li>API æ–‡æ¡£ ï¼šè‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£ï¼ˆå¦‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:2024/docs">http://127.0.0.1:2024/docs</a> ï¼‰æä¾›äº†æ‰€æœ‰å¯ç”¨æ¥å£çš„è¯¦ç»†è¯´æ˜å’Œäº¤äº’å¼æµ‹è¯•åŠŸèƒ½ï¼Œæå¤§åœ°åŠ é€Ÿäº†å¼€å‘å’Œé›†æˆè¿‡ç¨‹ã€‚</li>
</ul>
</li>
<li>çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ– ï¼šLangGraph ä»£ç†é€šå¸¸æ¶‰åŠå¤æ‚çš„çŠ¶æ€ç®¡ç†ã€‚æœåŠ¡å™¨å¯ä»¥è´Ÿè´£å¤„ç†è¿™äº›çŠ¶æ€çš„æŒä¹…åŒ–ï¼Œç¡®ä¿ä»£ç†åœ¨å¤šæ¬¡äº¤äº’ä¹‹é—´èƒ½å¤Ÿè®°ä½ä¸Šä¸‹æ–‡å’Œå†å²ä¿¡æ¯ã€‚</li>
</ol>
<h4 id="åœ¨-LangGraph-Studio-ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº"><a href="#åœ¨-LangGraph-Studio-ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº" class="headerlink" title="åœ¨ LangGraph Studio ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº"></a>åœ¨ LangGraph Studio ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº</h4><p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/langgraph_studio/">LangGraph Studio</a> æ˜¯ä¸€ä¸ªä¸“é—¨çš„ UIï¼Œæ‚¨å¯ä»¥è¿æ¥åˆ° LangGraph API æœåŠ¡å™¨ï¼Œä»¥ä¾¿åœ¨æœ¬åœ°å¯è§†åŒ–ã€äº¤äº’å’Œè°ƒè¯•æ‚¨çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡è®¿é—® <code>langgraph dev</code> å‘½ä»¤è¾“å‡ºä¸­æä¾›çš„ URLï¼Œåœ¨ LangGraph Studio ä¸­æµ‹è¯•æ‚¨çš„å›¾ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;    - LangGraph Studio Web UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/tutorials/get-started/1-build-basic-chatbot/#1-install-packages">æ„å»ºä¸€ä¸ªåŸºæœ¬èŠå¤©æœºå™¨äºº - LangChain æ¡†æ¶</a></p>
<p>å®˜æ–¹æ•™ç¨‹ï¼Œä½†æ˜¯è‹±æ–‡<a target="_blank" rel="noopener" href="https://academy.langchain.com/collections">https://academy.langchain.com/collections</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1AY4aeRETY/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">3.5 å°æ—¶å‡ºè¯ï¼LangGraph å®˜æ–¹è¯¾ç¨‹ ğŸ†“ é‡ç£…ä¸Šçº¿ğŸ”¥ğŸ”¥ğŸ”¥_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/" class="post-title-link" itemprop="url">langgraphæŸ¥æ¼è¡¥ç¼º</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-04 17:13:58" itemprop="dateModified" datetime="2025-08-04T17:13:58+08:00">2025-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ³¨å…¥ä¸Šä¸‹æ–‡"><a href="#æ³¨å…¥ä¸Šä¸‹æ–‡" class="headerlink" title="æ³¨å…¥ä¸Šä¸‹æ–‡"></a>æ³¨å…¥ä¸Šä¸‹æ–‡</h3><p>â€œæ³¨å…¥ä¸Šä¸‹æ–‡â€å°±æ˜¯<strong>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­èŠ‚ç‚¹/å¤§æ¨¡å‹</strong> å¯èƒ½éœ€è¦ã€ä½†<strong>ä¸ä¼š</strong>ï¼ˆä¹Ÿä¸åº”è¯¥ï¼‰å»æ”¹å˜çš„<strong>åªè¯»ä¿¡æ¯</strong>çš„é›†åˆã€‚</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ³¨å…¥ä¸Šä¸‹æ–‡é‡Œå¯èƒ½æ”¾ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æƒé™æ§åˆ¶</strong></td>
<td><code>user_id</code>, <code>tenant_id</code>ï¼ˆå†³å®šèƒ½è®¿é—®å“ªäº›æ•°æ®ï¼‰</td>
</tr>
<tr>
<td><strong>å¤–éƒ¨ä¾èµ–</strong></td>
<td><code>db_connection</code>, <code>api_key</code>, <code>s3_bucket</code>ï¼ˆèŠ‚ç‚¹é‡Œè¦ç”¨ï¼‰</td>
</tr>
<tr>
<td><strong>ä¸ªæ€§åŒ–å‚æ•°</strong></td>
<td><code>language</code>, <code>timezone</code>, <code>model_temperature</code></td>
</tr>
<tr>
<td><strong>ä¼šè¯å…ƒä¿¡æ¯</strong></td>
<td><code>session_id</code>, <code>channel</code>ï¼ˆSlack / å¾®ä¿¡ / Webï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from dataclasses import dataclass</span><br><span class="line"></span><br><span class="line">from langgraph.graph import StateGraph</span><br><span class="line">from langgraph.runtime import Runtime</span><br><span class="line"></span><br><span class="line">@dataclass</span><br><span class="line">class Context:</span><br><span class="line">    &quot;&quot;&quot;Context schema defined by the developer.&quot;&quot;&quot;    </span><br><span class="line">    user_id: str    </span><br><span class="line">    db_connection: str</span><br><span class="line">    </span><br><span class="line">def node(state: State, runtime: Runtime[Context]):</span><br><span class="line">    # type safe access to context attributes    </span><br><span class="line">    user_id = runtime.context.user_id</span><br><span class="line">    db_conn = runtime.context.db_connection</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">builder = StateGraph(state_schema=State, context_schema=Context)</span><br><span class="line"></span><br><span class="line"># add nodes, edges, compile the graph...</span><br><span class="line"></span><br><span class="line"># top level context arg is typed as Context for autocomplete and type checking</span><br><span class="line">result = graph.invoke(</span><br><span class="line">    &#123;&#x27;input&#x27;: &#x27;abc&#x27;&#125;,</span><br><span class="line">    context=Context(user_id=&#x27;123&#x27;, db_conn=&#x27;conn_mock&#x27;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/reference/runtime/#runtime"><code>Runtime</code></a> ç±»æä¾›äº†ä¸€ä¸ªå•ä¸€æ¥å£ï¼Œç”¨äºè®¿é—®ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ä¸Šä¸‹æ–‡ï¼šåœ¨è¿è¡Œå¼€å§‹æ—¶ä¼ é€’çš„é™æ€æ•°æ®</li>
<li>å­˜å‚¨ï¼šé•¿æœŸè®°å¿†çš„å­˜å‚¨æœºåˆ¶</li>
<li>æµå†™å…¥å™¨ï¼šç”¨äºå‘å›¾è¾“å‡ºæµå†™å…¥çš„è‡ªå®šä¹‰å‡½æ•°</li>
<li>å¯¹äºåŠŸèƒ½ API ç”¨æˆ·ï¼Œ<code>previous</code> ä¹Ÿå¯ç”¨ï¼šç»™å®šçº¿ç¨‹çš„å‰ä¸€ä¸ªè¿”å›å€¼</li>
</ul>
<p>ç°åœ¨ï¼Œå¼€å‘è€…ä¸å†éœ€è¦å°†ä¸Šè¿°æ‰€æœ‰å†…å®¹ä½œä¸ºå•ç‹¬çš„å‚æ•°æ³¨å…¥åˆ°èŠ‚ç‚¹å‡½æ•°ä¸­ï¼Œ<br>è€Œæ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ª <code>runtime</code> å‚æ•°æ¥è®¿é—®å®ƒä»¬ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/LangGraphChatBot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/LangGraphChatBot/" class="post-title-link" itemprop="url">LangGraphChatBot</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-14 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-14T00:00:00+08:00">2025-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-15 17:54:48" itemprop="dateModified" datetime="2025-07-15T17:54:48+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h3>
<p>pythonè™šæ‹Ÿç¯å¢ƒæ„å»º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m venv .venv</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install langgraph==0.2.74                  </span><br><span class="line">pip install langchain-openai==0.3.6            </span><br><span class="line">pip install fastapi==0.115.8                         </span><br><span class="line">pip install uvicorn==0.34.0                          </span><br><span class="line">pip install gradio==5.18.0</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹åŒ…<code>pip list</code></p>
<h3 id="æ„å»ºä¸€ä¸ªåŸºæœ¬çš„fastapilanggraphåº”ç”¨">æ„å»ºä¸€ä¸ªåŸºæœ¬çš„fastapi+langgraphåº”ç”¨</h3>
<h4 id="llmç¤ºä¾‹çš„æ„å»ºåˆ©ç”¨chatopenai">llmç¤ºä¾‹çš„æ„å»ºï¼ˆåˆ©ç”¨ChatOpenAIï¼‰</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºLLMå®ä¾‹</span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    base_url=config[&quot;base_url&quot;],</span><br><span class="line">    api_key=config[&quot;api_key&quot;],</span><br><span class="line">    model=config[&quot;model&quot;],</span><br><span class="line">    temperature=DEFAULT_TEMPERATURE,</span><br><span class="line">    timeout=30,  # æ·»åŠ è¶…æ—¶é…ç½®ï¼ˆç§’ï¼‰</span><br><span class="line">    max_retries=2  # æ·»åŠ é‡è¯•æ¬¡æ•°</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®ç±»å‹çš„æ„å»º">æ•°æ®ç±»å‹çš„æ„å»º</h4>
<p>ç»§æ‰¿äºpydantic</p>
<p>è§„èŒƒåŒ– API è¯·æ±‚å’Œå“åº”çš„æ•°æ®ç»“æ„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ¶ˆæ¯ç±»ï¼Œç”¨äºå°è£…APIæ¥å£è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment">#åŸºäº Pydantic çš„æ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="comment"># å®šä¹‰Messageç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    role (è§’è‰²): è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„å‘é€è€…ã€‚å¸¸è§çš„è§’è‰²åŒ…æ‹¬ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- user (ç”¨æˆ·): è¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="string">- assistant (åŠ©æ‰‹): è¡¨ç¤ºèŠå¤©æœºå™¨äººæˆ–æ¨¡å‹ç”Ÿæˆçš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="string">- system (ç³»ç»Ÿ): è¡¨ç¤ºä¸ºæ¨¡å‹æä¾›ä¸Šä¸‹æ–‡æˆ–æŒ‡ä»¤çš„ç³»ç»Ÿæ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    role: <span class="built_in">str</span></span><br><span class="line">    content: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ChatCompletionRequestç±»</span></span><br><span class="line"><span class="comment">#èŠå¤© API è¯·æ±‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatCompletionRequest</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    messages: <span class="type">List</span>[Message]</span><br><span class="line">    stream: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">False</span><span class="comment">#æ˜¯å¦æµå¼æ–¹å¼å“åº”</span></span><br><span class="line">    userId: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span><span class="comment">#ç”¨äºæ ‡è¯†å‘èµ·è¯·æ±‚çš„ç”¨æˆ·</span></span><br><span class="line">    conversationId: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span><span class="comment">#ç”¨äºæ ‡è¯†ç‰¹å®šçš„å¯¹è¯ä¼šè¯ï¼Œè¿™å¯¹äºç®¡ç†å¯¹è¯ä¸Šä¸‹æ–‡æˆ–å†å²è®°å½•éå¸¸æœ‰ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ChatCompletionResponseChoiceç±»</span></span><br><span class="line"><span class="comment">#èŠå¤©å®Œæˆå“åº”ä¸­çš„ä¸€ä¸ªâ€œé€‰æ‹©â€æˆ–ä¸€ä¸ªç”Ÿæˆçš„å›å¤</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatCompletionResponseChoice</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    index: <span class="built_in">int</span></span><br><span class="line">    message: Message</span><br><span class="line">    finish_reason: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ChatCompletionResponseç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatCompletionResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">str</span> = Field(default_factory=<span class="keyword">lambda</span>: <span class="string">f&quot;chatcmpl-<span class="subst">&#123;uuid.uuid4().<span class="built_in">hex</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">object</span>: <span class="built_in">str</span> = <span class="string">&quot;chat.completion&quot;</span></span><br><span class="line">    created: <span class="built_in">int</span> = Field(default_factory=<span class="keyword">lambda</span>: <span class="built_in">int</span>(time.time()))</span><br><span class="line">    choices: <span class="type">List</span>[ChatCompletionResponseChoice]<span class="comment">#æ¨¡å‹ç”Ÿæˆçš„æ‰€æœ‰å¯èƒ½çš„å›å¤é€‰é¡¹</span></span><br><span class="line">    system_fingerprint: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰fastapiåº”ç”¨å¹¶ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ">å®šä¹‰fastapiåº”ç”¨å¹¶ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°lifespanï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªFastAPIåº”ç”¨å®ä¾‹appä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å¯åŠ¨å’Œå…³é—­æ—¶çš„æ“ä½œ</span></span><br><span class="line"><span class="comment"># å‡½æ•°åœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¦‚åŠ è½½ä¸Šä¸‹æ–‡æ•°æ®ã€ä»¥åŠåˆå§‹åŒ–é—®é¢˜ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment"># å‡½æ•°åœ¨åº”ç”¨å…³é—­æ—¶æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œ</span></span><br><span class="line"><span class="comment"># @asynccontextmanager è£…é¥°å™¨ç”¨äºåˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒå…è®¸ä½ åœ¨ yield ä¹‹å‰å’Œä¹‹åæ‰§è¡Œç‰¹å®šçš„ä»£ç å—ï¼Œåˆ†åˆ«è¡¨ç¤ºå¯åŠ¨å’Œå…³é—­æ—¶çš„æ“ä½œ</span></span><br><span class="line"><span class="meta">@asynccontextmanager</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">lifespan</span>(<span class="params">app: FastAPI</span>):</span><br><span class="line">    <span class="comment"># å¯åŠ¨æ—¶æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment"># ç”³æ˜å¼•ç”¨å…¨å±€å˜é‡ï¼Œåœ¨å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">global</span> graph</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        logger.info(<span class="string">&quot;æ­£åœ¨åˆå§‹åŒ–æ¨¡å‹ã€å®šä¹‰Graph...&quot;</span>)</span><br><span class="line">        <span class="comment">#ï¼ˆ1ï¼‰åˆå§‹åŒ–LLM</span></span><br><span class="line">        llm = get_llm(llm_type)</span><br><span class="line">        <span class="comment">#ï¼ˆ2ï¼‰å®šä¹‰Graph</span></span><br><span class="line">        graph = create_graph(llm)</span><br><span class="line">        <span class="comment">#ï¼ˆ3ï¼‰å°†Graphå¯è§†åŒ–å›¾ä¿å­˜</span></span><br><span class="line">        save_graph_visualization(graph)</span><br><span class="line">        logger.info(<span class="string">&quot;åˆå§‹åŒ–å®Œæˆ&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºé”™: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># raise å…³é”®å­—é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œä»¥ç¡®ä¿ç¨‹åºä¸ä¼šåœ¨é”™è¯¯çŠ¶æ€ä¸‹ç»§ç»­è¿è¡Œ</span></span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># yield å…³é”®å­—å°†æ§åˆ¶æƒäº¤è¿˜ç»™FastAPIæ¡†æ¶ï¼Œä½¿åº”ç”¨å¼€å§‹è¿è¡Œ</span></span><br><span class="line">    <span class="comment"># åˆ†éš”äº†å¯åŠ¨å’Œå…³é—­çš„é€»è¾‘ã€‚åœ¨yield ä¹‹å‰çš„ä»£ç åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿è¡Œï¼Œyield ä¹‹åçš„ä»£ç åœ¨åº”ç”¨å…³é—­æ—¶è¿è¡Œ</span></span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="comment"># å…³é—­æ—¶æ‰§è¡Œ</span></span><br><span class="line">    logger.info(<span class="string">&quot;æ­£åœ¨å…³é—­...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># lifespanå‚æ•°ç”¨äºåœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„å¼€å§‹å’Œç»“æŸæ—¶æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æˆ–æ¸…ç†å·¥ä½œ</span></span><br><span class="line">app = FastAPI(lifespan=lifespan)</span><br></pre></td></tr></table></figure>
<h4 id="langgraphæ ¸å¿ƒé€»è¾‘">langgraphæ ¸å¿ƒé€»è¾‘</h4>
<p>åˆ›å»ºlanggraph</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰chatbotçš„çŠ¶æ€</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå’Œé…ç½®chatbotçš„çŠ¶æ€å›¾</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_graph</span>(<span class="params">llm</span>) -&gt; StateGraph:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æ„å»ºgraph</span></span><br><span class="line">        <span class="comment">#åˆ›å»ºä¸€ä¸ª StateGraph çš„å®ä¾‹ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºä½¿ç”¨ State ç±»ä½œä¸ºå…¶çŠ¶æ€ç®¡ç†çš„æ•°æ®æ¨¡å‹</span></span><br><span class="line">        graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å®šä¹‰chatbotçš„node</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">            <span class="comment"># å¤„ç†å½“å‰çŠ¶æ€å¹¶è¿”å› LLM å“åº”</span></span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é…ç½®graph</span></span><br><span class="line">        <span class="comment">#ç¬¬äºŒä¸ªå‚æ•° chatbot ï¼šè¿™æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ï¼‰ï¼Œå®ƒå®šä¹‰äº†å½“æ‰§è¡Œæµç¨‹åˆ°è¾¾è¿™ä¸ªåä¸º &quot;chatbot&quot; çš„èŠ‚ç‚¹æ—¶ï¼Œåº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚</span></span><br><span class="line">        graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line">        graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">        graph_builder.add_edge(<span class="string">&quot;chatbot&quot;</span>, END)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ ä¹Ÿå¯ä»¥æŒä¹…åŒ–åˆ°æ•°æ®åº“</span></span><br><span class="line">        memory = MemorySaver()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¼–è¯‘ç”Ÿæˆgraphå¹¶è¿”å›</span></span><br><span class="line">        <span class="comment">#checkpointer å‚æ•°å°† memory å®ä¾‹ä¼ é€’ç»™ç¼–è¯‘è¿‡ç¨‹ï¼Œä½¿å¾—å›¾èƒ½å¤Ÿç®¡ç†å…¶çŠ¶æ€çš„ä¿å­˜å’ŒåŠ è½½ã€‚ç¼–è¯‘åçš„å›¾å¯¹è±¡è¢«è¿”å›ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«è°ƒç”¨æ¥è¿è¡ŒèŠå¤©æœºå™¨äººã€‚</span></span><br><span class="line">        <span class="keyword">return</span> graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Failed to create graph: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¯è§†åŒ–langgraphèŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å°†æ„å»ºçš„graphå¯è§†åŒ–ä¿å­˜ä¸º PNG æ–‡ä»¶</span><br><span class="line">def save_graph_visualization(graph: StateGraph, filename: str = &quot;graph.png&quot;) -&gt; None:</span><br><span class="line">    try:</span><br><span class="line">        with open(filename, &quot;wb&quot;) as f:</span><br><span class="line">            f.write(graph.get_graph().draw_mermaid_png())</span><br><span class="line">        logger.info(f&quot;Graph visualization saved as &#123;filename&#125;&quot;)</span><br><span class="line">    except IOError as e:</span><br><span class="line">        logger.info(f&quot;Warning: Failed to save graph visualization: &#123;str(e)&#125;&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="å°è£…æ¥å£">å°è£…æ¥å£</h4>
<p>åŒ…å«æµå¼è¾“å‡ºä¸éæµå¼è¾“å‡ºçš„å¤„ç†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°è£…POSTè¯·æ±‚æ¥å£ï¼Œä¸å¤§æ¨¡å‹è¿›è¡Œé—®ç­”</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/v1/chat/completions&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">chat_completions</span>(<span class="params">request: ChatCompletionRequest</span>):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­åˆå§‹åŒ–æ˜¯å¦å®Œæˆ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> graph:</span><br><span class="line">        logger.error(<span class="string">&quot;æœåŠ¡æœªåˆå§‹åŒ–&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="string">&quot;æœåŠ¡æœªåˆå§‹åŒ–&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        logger.info(<span class="string">f&quot;æ”¶åˆ°èŠå¤©å®Œæˆè¯·æ±‚: <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        query_prompt = request.messages[-<span class="number">1</span>].content</span><br><span class="line">        logger.info(<span class="string">f&quot;ç”¨æˆ·é—®é¢˜æ˜¯: <span class="subst">&#123;query_prompt&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: request.userId+<span class="string">&quot;@@&quot;</span>+request.conversationId&#125;&#125;</span><br><span class="line">        logger.info(<span class="string">f&quot;ç”¨æˆ·å½“å‰ä¼šè¯ä¿¡æ¯: <span class="subst">&#123;config&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        prompt_template_system = PromptTemplate.from_file(PROMPT_TEMPLATE_TXT_SYS)</span><br><span class="line">        prompt_template_user = PromptTemplate.from_file(PROMPT_TEMPLATE_TXT_USER)</span><br><span class="line">        prompt = [</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt_template_system.template&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt_template_user.template.<span class="built_in">format</span>(query=query_prompt)&#125;</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¤„ç†æµå¼å“åº”</span></span><br><span class="line">        <span class="keyword">if</span> request.stream:</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_stream</span>():</span><br><span class="line">                chunk_id = <span class="string">f&quot;chatcmpl-<span class="subst">&#123;uuid.uuid4().<span class="built_in">hex</span>&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">for</span> message_chunk, metadata <span class="keyword">in</span> graph.astream(&#123;<span class="string">&quot;messages&quot;</span>: prompt&#125;, config, stream_mode=<span class="string">&quot;messages&quot;</span>):</span><br><span class="line">                    chunk = message_chunk.content</span><br><span class="line">                    logger.info(<span class="string">f&quot;chunk: <span class="subst">&#123;chunk&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="comment"># åœ¨å¤„ç†è¿‡ç¨‹ä¸­äº§ç”Ÿæ¯ä¸ªå—</span></span><br><span class="line">                    <span class="keyword">yield</span> <span class="string">f&quot;data: <span class="subst">&#123;json.dumps(&#123;<span class="string">&#x27;id&#x27;</span>: chunk_id,<span class="string">&#x27;object&#x27;</span>: <span class="string">&#x27;chat.completion.chunk&#x27;</span>,<span class="string">&#x27;created&#x27;</span>: <span class="built_in">int</span>(time.time()),<span class="string">&#x27;choices&#x27;</span>: [&#123;<span class="string">&#x27;index&#x27;</span>: <span class="number">0</span>,<span class="string">&#x27;delta&#x27;</span>: &#123;<span class="string">&#x27;content&#x27;</span>: chunk&#125;</span>,&#x27;finish_reason&#x27;: None&#125;]&#125;)&#125;\n\n&quot;</span></span><br><span class="line">                <span class="comment"># æµç»“æŸçš„æœ€åä¸€å—</span></span><br><span class="line">                <span class="keyword">yield</span> <span class="string">f&quot;data: <span class="subst">&#123;json.dumps(&#123;<span class="string">&#x27;id&#x27;</span>: chunk_id,<span class="string">&#x27;object&#x27;</span>: <span class="string">&#x27;chat.completion.chunk&#x27;</span>,<span class="string">&#x27;created&#x27;</span>: <span class="built_in">int</span>(time.time()),<span class="string">&#x27;choices&#x27;</span>: [&#123;<span class="string">&#x27;index&#x27;</span>: <span class="number">0</span>,<span class="string">&#x27;delta&#x27;</span>: &#123;&#125;</span>,&#x27;finish_reason&#x27;: &#x27;stop&#x27;&#125;]&#125;)&#125;\n\n&quot;</span></span><br><span class="line">            <span class="comment"># è¿”å›fastapi.responsesä¸­StreamingResponseå¯¹è±¡</span></span><br><span class="line">            <span class="keyword">return</span> StreamingResponse(generate_stream(), media_type=<span class="string">&quot;text/event-stream&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¤„ç†éæµå¼å“åº”å¤„ç†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                events = graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: prompt&#125;, config)</span><br><span class="line">                <span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">                    <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">                        result = value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logger.info(<span class="string">f&quot;Error processing response: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            formatted_response = <span class="built_in">str</span>(format_response(result))</span><br><span class="line">            logger.info(<span class="string">f&quot;æ ¼å¼åŒ–çš„æœç´¢ç»“æœ: <span class="subst">&#123;formatted_response&#125;</span>&quot;</span>)</span><br><span class="line">			<span class="comment">#å°è£…å“åº”</span></span><br><span class="line">            response = ChatCompletionResponse(</span><br><span class="line">                choices=[</span><br><span class="line">                    ChatCompletionResponseChoice(</span><br><span class="line">                        index=<span class="number">0</span>,</span><br><span class="line">                        message=Message(role=<span class="string">&quot;assistant&quot;</span>, content=formatted_response),</span><br><span class="line">                        finish_reason=<span class="string">&quot;stop&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            logger.info(<span class="string">f&quot;å‘é€å“åº”å†…å®¹: \n<span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># è¿”å›fastapi.responsesä¸­JSONResponseå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># model_dump()æ–¹æ³•é€šå¸¸ç”¨äºå°†Pydanticæ¨¡å‹å®ä¾‹çš„å†…å®¹è½¬æ¢ä¸ºä¸€ä¸ªæ ‡å‡†çš„Pythonå­—å…¸ï¼Œä»¥ä¾¿è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">return</span> JSONResponse(content=response.model_dump())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;å¤„ç†èŠå¤©å®Œæˆæ—¶å‡ºé”™:\n\n <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="built_in">str</span>(e))</span><br></pre></td></tr></table></figure>
<h3 id="langgraphçš„çŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†">langgraphçš„çŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†</h3>
<p>LangGraphæ”¯æŒä¸¤ç§å¯¹äºæ„å»ºå¯¹è¯ä»£ç†è‡³å…³é‡è¦çš„å†…å­˜ç±»å‹ï¼š</p>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/agents/memory/#short-term-memory">çŸ­æœŸå†…å­˜</a></strong>ï¼šé€šè¿‡åœ¨ä¼šè¯ä¸­ç»´æŠ¤æ¶ˆæ¯å†å²æ¥è·Ÿè¸ªæ­£åœ¨è¿›è¡Œçš„å¯¹è¯ã€‚</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/agents/memory/#long-term-memory">é•¿æœŸå†…å­˜</a></strong>ï¼šåœ¨ä¸åŒä¼šè¯ä¹‹é—´å­˜å‚¨ç”¨æˆ·ç‰¹å®šæˆ–åº”ç”¨ç¨‹åºçº§åˆ«çš„æ•°æ®ã€‚</li>
</ul>
<figure>
<img src="/2025/07/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/LangGraphChatBot/image-20250715094855646.png" alt="image-20250715094855646">
<figcaption aria-hidden="true">image-20250715094855646</figcaption>
</figure>
<p>åœ¨LangGraphä¸­</p>
<ul>
<li><em>çŸ­æœŸå†…å­˜</em>ä¹Ÿç§°ä¸º<strong>çº¿ç¨‹çº§å†…å­˜</strong>ã€‚</li>
<li><em>é•¿æœŸå†…å­˜</em>ä¹Ÿç§°ä¸º<strong>è·¨çº¿ç¨‹å†…å­˜</strong>ã€‚</li>
</ul>
<h3 id="æ•™ç¨‹åœ°å€">æ•™ç¨‹åœ°å€</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/NanGePlus/LangGraphChatBot">NanGePlus/LangGraphChatBot:
ä½¿ç”¨LangGraph+DeepSeek-R1+FastAPI+Gradioå®ç°ä¸€ä¸ªå¸¦æœ‰è®°å¿†åŠŸèƒ½çš„æµé‡åŒ…æ¨èæ™ºèƒ½å®¢æœwebç«¯ç”¨ä¾‹,åŒæ—¶ä¹Ÿæ”¯æŒgptå¤§æ¨¡å‹ã€å›½äº§å¤§æ¨¡å‹(OneApiæ–¹å¼)ã€Ollamaæœ¬åœ°å¼€æºå¤§æ¨¡å‹ã€é˜¿é‡Œé€šä¹‰åƒé—®å¤§æ¨¡å‹</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1m89NYKE2J/?vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">LangGraph+deepseek-r1+FastAPI+Gradioå®ç°æ‹¥æœ‰è®°å¿†çš„æµé‡åŒ…æ¨èæ™ºèƒ½å®¢æœwebç«¯ç”¨ä¾‹,åŒæ—¶ä¹Ÿæ”¯æŒgptã€å›½äº§å¤§æ¨¡å‹ã€Ollama_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/13/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/prompt%20Engineering%E4%B8%8Econtext%20Engineering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/13/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/prompt%20Engineering%E4%B8%8Econtext%20Engineering/" class="post-title-link" itemprop="url">prompt Engineeringä¸context Engineering</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-13 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š13:36:33" itemprop="dateCreated datePublished" datetime="2025-07-13T00:00:00+08:00">2025-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="prompt-engineering">prompt Engineering</h3>
<p>Prompt
Engineeringæ˜¯ä¸å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’çš„åŸºç¡€ï¼Œå…¶æ ¸å¿ƒåœ¨äºç²¾å¿ƒè®¾è®¡è¾“å…¥å†…å®¹ï¼Œä»¥å¼•å¯¼æ¨¡å‹ç”ŸæˆæœŸæœ›çš„è¾“å‡ºã€‚</p>
<p>å°½ç®¡ Prompt Engineering
è‡³å…³é‡è¦ï¼Œä½†å¯¹äºæ„å»ºç¨³å¥ã€å¯ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ç³»ç»Ÿè€Œè¨€ï¼Œå®ƒå­˜åœ¨å›ºæœ‰çš„å±€é™æ€§ï¼š</p>
<ul>
<li><p><strong>è„†å¼±æ€§&amp;ä¸å¯å¤ç°æ€§ï¼š</strong>
æç¤ºä¸­å¾®å°çš„æªè¾å˜åŒ–å¯èƒ½å¯¼è‡´è¾“å‡ºç»“æœçš„å·¨å¤§å·®å¼‚ï¼Œä½¿å¾—è¿™ä¸€è¿‡ç¨‹æ›´åƒæ˜¯ä¸€ç§ä¾èµ–åå¤è¯•é”™çš„â€œè‰ºæœ¯â€ï¼Œè€Œéå¯å¤ç°çš„â€œç§‘å­¦â€
ã€‚</p></li>
<li><p><strong>æ‰©å±•æ€§å·®ï¼š</strong>
æ‰‹åŠ¨ã€è¿­ä»£åœ°ä¼˜åŒ–æç¤ºçš„è¿‡ç¨‹ï¼Œåœ¨é¢å¯¹å¤§é‡ç”¨æˆ·ã€å¤šæ ·åŒ–ç”¨ä¾‹å’Œä¸æ–­å‡ºç°çš„è¾¹ç¼˜æƒ…å†µæ—¶ï¼Œéš¾ä»¥æœ‰æ•ˆæ‰©å±•
ã€‚</p></li>
<li><p><strong>ç”¨æˆ·è´Ÿæ‹…ï¼š</strong>
è¿™ç§æ–¹æ³•å°†ç²¾å¿ƒæ„å»ºä¸€å¥—è¯¦å°½æŒ‡ä»¤çš„è´Ÿæ‹…å®Œå…¨å‹åœ¨äº†ç”¨æˆ·èº«ä¸Šï¼Œå¯¹äºéœ€è¦è‡ªä¸»è¿è¡Œã€æˆ–å¤„ç†é«˜å¹¶å‘è¯·æ±‚çš„ç³»ç»Ÿè€Œè¨€æ˜¯ä¸åˆ‡å®é™…çš„
ã€‚</p></li>
<li><p><strong>æ— çŠ¶æ€æ€§ï¼š</strong> Prompt Engineering
æœ¬è´¨ä¸Šæ˜¯ä¸ºå•è½®ã€â€œä¸€æ¬¡æ€§â€çš„äº¤äº’è€Œè®¾è®¡çš„ï¼Œéš¾ä»¥å¤„ç†éœ€è¦è®°å¿†å’ŒçŠ¶æ€ç®¡ç†çš„é•¿å¯¹è¯æˆ–å¤šæ­¥éª¤ä»»åŠ¡
ã€‚</p></li>
</ul>
<h3 id="context-engineering">Context Engineering</h3>
<p><strong>Context
Engineeringæ˜¯ä¸€é—¨è®¾è®¡ã€æ„å»ºå¹¶ä¼˜åŒ–åŠ¨æ€è‡ªåŠ¨åŒ–ç³»ç»Ÿçš„å­¦ç§‘ï¼Œæ—¨åœ¨ä¸ºå¤§å‹è¯­è¨€æ¨¡å‹åœ¨æ­£ç¡®çš„æ—¶é—´ã€ä»¥æ­£ç¡®çš„æ ¼å¼ï¼Œæä¾›æ­£ç¡®çš„ä¿¡æ¯å’Œå·¥å…·ï¼Œä»è€Œå¯é ã€å¯æ‰©å±•åœ°å®Œæˆå¤æ‚ä»»åŠ¡</strong>
ã€‚</p>
<p><strong>prompt å‘Šè¯‰æ¨¡å‹å¦‚ä½•æ€è€ƒï¼Œè€Œ Context
åˆ™èµ‹äºˆæ¨¡å‹å®Œæˆå·¥ä½œæ‰€éœ€çš„çŸ¥è¯†å’Œå·¥å…·ã€‚</strong></p>
<ul>
<li><p>Context Engineering å†³å®š<strong>ç”¨ä»€ä¹ˆå†…å®¹å¡«å…… Context
Window</strong> ï¼Œ</p></li>
<li><p>Prompt Engineering åˆ™è´Ÿè´£ä¼˜åŒ–<strong>çª—å£å†…çš„å…·ä½“æŒ‡ä»¤</strong>
ã€‚</p></li>
</ul>
<h3 id="context-engineering-çš„åŸºçŸ³ragretrieval-augmented-generation">Context
Engineering çš„åŸºçŸ³ï¼šRAGï¼ˆRetrieval-Augmented Generationï¼‰</h3>
<p>æœ¬éƒ¨åˆ†å°†é˜è¿°æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ä½œä¸ºå®ç° Context Engineering
çš„ä¸»è¦æ¶æ„æ¨¡å¼ã€‚</p>
<h4 id="è§£å†³llmçš„æ ¸å¿ƒå¼±ç‚¹">è§£å†³LLMçš„æ ¸å¿ƒå¼±ç‚¹</h4>
<p>RAGç›´æ¥è§£å†³äº†æ ‡å‡†LLMåœ¨ä¼ä¸šåº”ç”¨ä¸­å­˜åœ¨çš„å›ºæœ‰å±€é™æ€§ï¼š</p>
<ul>
<li><p><strong>çŸ¥è¯†å†»ç»“ï¼š</strong>
LLMçš„çŸ¥è¯†è¢«å†»ç»“åœ¨<strong>å…¶è®­ç»ƒæ•°æ®çš„æ—¶é—´ç‚¹</strong>ã€‚RAGé€šè¿‡åœ¨æ¨ç†æ—¶æ³¨å…¥å®æ—¶çš„ã€æœ€æ–°çš„ä¿¡æ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜
ã€‚</p></li>
<li><p><strong>ç¼ºä¹é¢†åŸŸä¸“æœ‰çŸ¥è¯†ï¼š</strong>
æ ‡å‡†LLMæ— æ³•è®¿é—®ç»„ç»‡çš„å†…éƒ¨ç§æœ‰æ•°æ®ã€‚RAGåˆ™èƒ½å¤Ÿå°†LLMè¿æ¥åˆ°è¿™äº›å†…éƒ¨çŸ¥è¯†åº“ï¼Œå¦‚æŠ€æœ¯æ‰‹å†Œã€æ”¿ç­–æ–‡ä»¶ç­‰
ã€‚</p></li>
<li><p><strong>å¹»è§‰ï¼ˆHallucinationï¼‰ï¼š</strong> LLM
ä¼šä¸åŒç¨‹åº¦ä¸Šåœ°ç¼–é€ äº‹å®ã€‚RAGé€šè¿‡å°†æ¨¡å‹çš„å›ç­”â€œé”šå®šâ€åœ¨å¯éªŒè¯çš„ã€æ£€ç´¢åˆ°çš„è¯æ®ä¸Šï¼Œæé«˜äº‹å®çš„å‡†ç¡®æ€§å’Œå¯ä¿¡åº¦
ã€‚</p></li>
</ul>
<h4 id="ragå·¥ä½œæµ">RAGå·¥ä½œæµ</h4>
<ol type="1">
<li><p><strong>ç´¢å¼•ï¼ˆç¦»çº¿é˜¶æ®µï¼‰ï¼š</strong>
åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç³»ç»Ÿä¼šå¤„ç†å¤–éƒ¨çŸ¥è¯†æºã€‚æ–‡æ¡£è¢«åŠ è½½ã€åˆ†å‰²æˆæ›´å°çš„
chunksï¼Œç„¶åé€šè¿‡Embedding Model
è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œå¹¶æœ€ç»ˆå­˜å‚¨åœ¨ä¸“é—¨çš„å‘é‡æ•°æ®åº“ä¸­ä»¥å¤‡æ£€ç´¢ ã€‚</p></li>
<li><p><strong>æ¨ç†ï¼ˆåœ¨çº¿é˜¶æ®µï¼‰ï¼š</strong>
å½“ç”¨æˆ·æå‡ºè¯·æ±‚æ—¶ï¼Œç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol type="1">
<li><strong>æ£€ç´¢ï¼ˆRetrieveï¼‰ï¼š</strong>
å°†ç”¨æˆ·çš„æŸ¥è¯¢åŒæ ·è½¬æ¢ä¸ºå‘é‡ï¼Œç„¶ååœ¨å‘é‡æ•°æ®åº“ä¸­è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œæ‰¾å‡ºä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£å—ã€‚</li>
<li><strong>å¢å¼ºï¼ˆAugmentï¼‰ï¼š</strong>
å°†æ£€ç´¢åˆ°çš„è¿™äº›æ–‡æ¡£å—ä¸åŸå§‹çš„ç”¨æˆ·æŸ¥è¯¢ã€ç³»ç»ŸæŒ‡ä»¤ç­‰ç»“åˆèµ·æ¥ï¼Œæ„å»ºä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„ã€å¢å¼ºçš„æœ€ç»ˆæç¤ºã€‚</li>
<li><strong>ç”Ÿæˆï¼ˆGenerateï¼‰ï¼š</strong>
å°†è¿™ä¸ªå¢å¼ºåçš„æç¤ºè¾“å…¥ç»™LLMï¼ŒLLMä¼šåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ç”Ÿæˆä¸€ä¸ªæœ‰ç†æœ‰æ®çš„å›ç­”
ã€‚</li>
</ol></li>
</ol>
<h3 id="context-å·¥ç¨‹åŒ–å¦‚ä½•åˆ¤æ–­å’Œæå–å“ªäº›å†…å®¹åº”è¯¥è¿›å…¥ä¸Šä¸‹æ–‡">Context
å·¥ç¨‹åŒ–ï¼šå¦‚ä½•åˆ¤æ–­å’Œæå–å“ªäº›å†…å®¹åº”è¯¥è¿›å…¥ä¸Šä¸‹æ–‡ï¼Ÿ</h3>
<h4 id="chunking">1.chunking</h4>
<p>æ–‡æœ¬åˆ†å—ï¼ˆChunkingï¼‰æ˜¯RAGæµç¨‹ä¸­æœ€å…³é”®ä¹Ÿæœ€å®¹æ˜“è¢«å¿½è§†çš„ä¸€æ­¥ã€‚å…¶ç›®æ ‡æ˜¯åˆ›å»ºåœ¨è¯­ä¹‰ä¸Šè‡ªæˆä¸€ä½“çš„æ–‡æœ¬å—ã€‚</p>
<h4 id="reranking">2.Reranking</h4>
<p>ä¸ºäº†å¹³è¡¡æ£€ç´¢çš„é€Ÿåº¦å’Œå‡†ç¡®æ€§ï¼Œä¸šç•Œæ™®éé‡‡ç”¨ä¸¤é˜¶æ®µæ£€ç´¢æµç¨‹ã€‚</p>
<ul>
<li><p><strong>ä¸¤é˜¶æ®µæµç¨‹ï¼š</strong></p>
<ul>
<li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆå¬å›ï¼‰ï¼š</strong>
ä½¿ç”¨ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆçš„æ£€ç´¢å™¨ï¼ˆå¦‚åŸºäº bi-encoder
çš„å‘é‡æœç´¢æˆ–BM25ç­‰è¯æ³•æœç´¢ï¼‰è¿›è¡Œå¹¿æ³›æ’’ç½‘ï¼Œå¬å›ä¸€ä¸ªè¾ƒå¤§çš„å€™é€‰æ–‡æ¡£é›†ï¼ˆä¾‹å¦‚ï¼Œå‰100ä¸ªï¼‰
ã€‚</li>
<li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆç²¾æ’/é‡æ’åºï¼‰ï¼š</strong>
ä½¿ç”¨ä¸€ä¸ªæ›´å¼ºå¤§ä½†è®¡ç®—æˆæœ¬æ›´é«˜çš„æ¨¡å‹ï¼Œå¯¹è¿™ä¸ªè¾ƒå°çš„å€™é€‰é›†è¿›è¡Œé‡æ–°è¯„ä¼°ï¼Œä»¥è¯†åˆ«å‡ºæœ€ç›¸å…³çš„å°‘æ•°å‡ ä¸ªæ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼Œå‰5ä¸ªï¼‰
ã€‚</li>
</ul></li>
<li><p><strong>Cross-Encoderï¼š</strong>
äº¤å‰ç¼–ç å™¨ä¹‹æ‰€ä»¥åœ¨é‡æ’åºé˜¶æ®µè¡¨ç°ä¼˜è¶Šï¼Œæ˜¯å› ä¸ºå®ƒä¸åŒç¼–ç å™¨çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚åŒç¼–ç å™¨ç‹¬ç«‹åœ°ä¸ºæŸ¥è¯¢å’Œæ–‡æ¡£ç”ŸæˆåµŒå…¥å‘é‡ï¼Œç„¶åè®¡ç®—å®ƒä»¬çš„ç›¸ä¼¼åº¦ã€‚è€Œäº¤å‰ç¼–ç å™¨åˆ™æ˜¯å°†æŸ¥è¯¢å’Œæ–‡æ¡£<strong>åŒæ—¶</strong>ä½œä¸ºè¾“å…¥ï¼Œè®©æ¨¡å‹åœ¨å†…éƒ¨é€šè¿‡
Attention Mechanism
å¯¹äºŒè€…è¿›è¡Œæ·±åº¦äº¤äº’ã€‚è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ•æ‰åˆ°æ›´ç»†å¾®çš„è¯­ä¹‰å…³ç³»ï¼Œä»è€Œç»™å‡ºæ›´å‡†ç¡®çš„ç›¸å…³æ€§è¯„åˆ†
ã€‚</p></li>
<li><p><strong>å®é™…å½±å“ï¼š</strong>
é‡æ’åºæ˜¾è‘—æé«˜äº†æœ€ç»ˆé€å…¥LLMçš„ä¸Šä¸‹æ–‡è´¨é‡ï¼Œä»è€Œäº§å‡ºæ›´å‡†ç¡®ã€å¹»è§‰æ›´å°‘çš„ç­”æ¡ˆã€‚åœ¨é‡‘èã€æ³•å¾‹ç­‰é«˜é£é™©é¢†åŸŸï¼Œé‡æ’åºè¢«è®¤ä¸ºæ˜¯å¿…ä¸å¯å°‘è€Œéå¯é€‰çš„æ­¥éª¤
ã€‚</p></li>
</ul>
<h4 id="ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£å‹ç¼©ä¸æ‘˜è¦">3.ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ï¼šå‹ç¼©ä¸æ‘˜è¦</h4>
<p>æœ¬èŠ‚è¯¦ç»†ä»‹ç»ç”¨äºä¸»åŠ¨ç®¡ç†ä¸Šä¸‹æ–‡çš„æŠ€æœ¯ï¼Œç¡®ä¿æœ€æœ‰ä»·å€¼çš„ä¿¡æ¯è¢«ä¼˜å…ˆå‘ˆç°ã€‚</p>
<ul>
<li><p><strong>ä¸Šä¸‹æ–‡å‹ç¼©çš„ç›®æ ‡ï¼š</strong>
ç¼©çŸ­æ£€ç´¢åˆ°çš„æ–‡æ¡£åˆ—è¡¨å’Œ/æˆ–ç²¾ç®€å•ä¸ªæ–‡æ¡£çš„å†…å®¹ï¼Œåªå°†<strong>æœ€ç›¸å…³çš„ä¿¡æ¯ä¼ é€’ç»™LLM</strong>ã€‚è¿™èƒ½æœ‰æ•ˆé™ä½APIè°ƒç”¨æˆæœ¬ã€å‡å°‘å»¶è¿Ÿï¼Œå¹¶ç¼“è§£
Lost in the Middle çš„é—®é¢˜ ã€‚</p></li>
<li><p><strong>å‹ç¼©æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>è¿‡æ»¤å¼å‹ç¼©ï¼š</strong>
è¿™ç±»æ–¹æ³•å†³å®šæ˜¯ä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒæ•´ä¸ªæ£€ç´¢åˆ°çš„æ–‡æ¡£ã€‚
<ul>
<li><strong>LLMChainFilterï¼š</strong>
åˆ©ç”¨ä¸€ä¸ªLLMå¯¹æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§åšå‡ºç®€å•çš„â€œæ˜¯/å¦â€åˆ¤æ–­ ã€‚</li>
<li><strong>EmbeddingsFilterï¼š</strong>
æ›´ç»æµå¿«é€Ÿçš„æ–¹æ³•ï¼Œæ ¹æ®æ–‡æ¡£åµŒå…¥ä¸æŸ¥è¯¢åµŒå…¥çš„ä½™å¼¦ç›¸ä¼¼åº¦æ¥è¿‡æ»¤æ–‡æ¡£ ã€‚</li>
</ul></li>
<li><strong>å†…å®¹æå–å¼å‹ç¼©ï¼š</strong> è¿™ç±»æ–¹æ³•ä¼šç›´æ¥ä¿®æ”¹æ–‡æ¡£å†…å®¹ã€‚
<ul>
<li><strong>LLMChainExtractorï¼š</strong>
éå†æ¯ä¸ªæ–‡æ¡£ï¼Œå¹¶ä½¿ç”¨LLMä»ä¸­æå–ä»…ä¸æŸ¥è¯¢ç›¸å…³çš„å¥å­æˆ–é™ˆè¿° ã€‚</li>
</ul></li>
<li><strong>ç”¨ top N ä»£æ›¿å‹ç¼©ï¼š</strong>
åƒLLMListwiseRerankè¿™æ ·çš„æŠ€æœ¯ï¼Œä½¿ç”¨LLMå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œé‡æ’åºï¼Œå¹¶åªè¿”å›æ’åæœ€é«˜çš„Nä¸ªï¼Œä»è€Œèµ·åˆ°é«˜è´¨é‡è¿‡æ»¤å™¨çš„ä½œç”¨
ã€‚</li>
</ul></li>
<li><p><strong>ä½œä¸ºå‹ç¼©ç­–ç•¥çš„æ‘˜è¦ï¼š</strong>
å¯¹äºéå¸¸é•¿çš„æ–‡æ¡£æˆ–å†—é•¿çš„å¯¹è¯å†å²ï¼Œå¯ä»¥åˆ©ç”¨LLMç”Ÿæˆæ‘˜è¦ã€‚è¿™äº›æ‘˜è¦éšåè¢«æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œæ—¢ä¿ç•™äº†å…³é”®ä¿¡æ¯ï¼Œåˆå¤§å¹…å‡å°‘äº†
Token æ•°é‡ã€‚è¿™æ˜¯åœ¨é•¿æ—¶ç¨‹è¿è¡Œçš„æ™ºèƒ½ä½“ä¸­ç®¡ç†ä¸Šä¸‹æ–‡çš„å…³é”®æŠ€æœ¯ ã€‚</p></li>
</ul>
<h3 id="æ™ºèƒ½ä½“æ¶æ„ä¸­çš„æ•°æ®æµä¸å·¥ä½œæµç¼–æ’">æ™ºèƒ½ä½“æ¶æ„ä¸­çš„æ•°æ®æµä¸å·¥ä½œæµç¼–æ’</h3>
<h4 id="å·¥ä½œæµworkflow-vs.-æ™ºèƒ½ä½“agent">å·¥ä½œæµï¼ˆWorkflowï¼‰
vs.Â æ™ºèƒ½ä½“ï¼ˆAgentï¼‰</h4>
<ul>
<li><strong>å·¥ä½œæµï¼ˆWorkflowsï¼‰</strong>
<ul>
<li>æŒ‡çš„æ˜¯LLMå’Œå·¥å…·é€šè¿‡<strong>é¢„å®šä¹‰çš„ä»£ç è·¯å¾„</strong>è¿›è¡Œç¼–æ’çš„ç³»ç»Ÿã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®æµåŠ¨çš„è·¯å¾„æ˜¯å›ºå®šçš„ã€ç”±å¼€å‘è€…æ˜ç¡®è®¾è®¡çš„ï¼Œç±»ä¼¼äºä¸Šä¸–çºªæµè¡Œçš„â€œä¸“å®¶ç³»ç»Ÿâ€ã€‚ä¾‹å¦‚ï¼Œâ€œç¬¬ä¸€æ­¥ï¼šåˆ†æç”¨æˆ·é‚®ä»¶ï¼›ç¬¬äºŒæ­¥ï¼šæ ¹æ®åˆ†æç»“æœåœ¨æ—¥å†ä¸­æŸ¥æ‰¾ç©ºé—²æ—¶æ®µï¼›ç¬¬ä¸‰æ­¥ï¼šèµ·è‰ä¼šè®®é‚€è¯·é‚®ä»¶â€ã€‚è¿™ç§æ¨¡å¼ç¡®å®šæ€§é«˜ï¼Œæ˜“äºè°ƒè¯•å’Œæ§åˆ¶ï¼Œéå¸¸é€‚åˆæœ‰æ˜ç¡®ä¸šåŠ¡æµç¨‹çš„åœºæ™¯ï¼ˆå¦‚é£æ§éœ€æ±‚é«˜ã€æ•°æ®æ•æ„Ÿã€å®‰å…¨ç­‰çº§è¦æ±‚ï¼‰ã€‚</li>
</ul></li>
<li><strong>æ™ºèƒ½ä½“ï¼ˆAgentsï¼‰</strong>
<ul>
<li>æŒ‡çš„æ˜¯LLM<strong>åŠ¨æ€åœ°æŒ‡å¯¼</strong>è‡ªå·±çš„æµç¨‹å’Œå·¥å…·ä½¿ç”¨ï¼Œè‡ªä¸»æ§åˆ¶å¦‚ä½•å®Œæˆä»»åŠ¡çš„ç³»ç»Ÿã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®æµåŠ¨çš„è·¯å¾„ä¸æ˜¯é¢„å…ˆå›ºå®šçš„ï¼Œè€Œæ˜¯ç”±LLMåœ¨æ¯ä¸€æ­¥æ ¹æ®å½“å‰æƒ…å†µå’Œç›®æ ‡åŠ¨æ€å†³å®šçš„ã€‚è¿™ç§æ¨¡å¼çµæ´»æ€§é«˜ï¼Œèƒ½å¤„ç†å¼€æ”¾å¼é—®é¢˜ï¼Œä½†å¯æ§æ€§å’Œå¯é¢„æµ‹æ€§è¾ƒä½
ã€‚</li>
</ul></li>
</ul>
<p>å¤æ‚çš„æ™ºèƒ½ä½“é€šå¸¸æ˜¯è¿™ä¸¤ç§æ¨¡å¼çš„æ··åˆä½“ï¼Œåœ¨å®è§‚å±‚é¢éµå¾ªä¸€ä¸ªé¢„å®šä¹‰çš„å·¥ä½œæµï¼Œä½†åœ¨æŸäº›èŠ‚ç‚¹å†…éƒ¨ï¼Œåˆèµ‹äºˆLLMä¸€å®šçš„è‡ªä¸»å†³ç­–æƒã€‚ç®¡ç†è¿™ä¸€åˆ‡çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>ç¼–æ’å±‚ï¼ˆOrchestration
Layerï¼‰</strong> ã€‚</p>
<h4 id="æ ¸å¿ƒæ¶æ„é¢„å®šä¹‰æ•°æ®æµçš„å®ç°"><strong>æ ¸å¿ƒæ¶æ„ï¼šé¢„å®šä¹‰æ•°æ®æµçš„å®ç°</strong></h4>
<ol type="1">
<li><p><strong>é“¾å¼å·¥ä½œæµï¼ˆPrompt Chainingï¼‰</strong></p></li>
<li><p><strong>è·¯ç”±å·¥ä½œæµï¼ˆRouting)</strong></p></li>
<li><p><strong>ç¼–æ’å™¨-å·¥ä½œè€…æ¨¡å¼ï¼ˆOrchestrator-Workersï¼‰</strong></p></li>
</ol>
<h4 id="æ¡†æ¶ä¸å·¥å…·">æ¡†æ¶ä¸å·¥å…·</h4>
<p>ä¸Šè¿°çš„æ¶æ„å’Œæœºåˆ¶å¹¶éå‡­ç©ºå­˜åœ¨ï¼Œè€Œæ˜¯é€šè¿‡å…·ä½“çš„å¼€å‘æ¡†æ¶å®ç°çš„ã€‚å…¶ä¸­ï¼ŒLangGraphä½œä¸ºLangChainçš„æ‰©å±•ï¼Œä¸ºæ„å»ºå…·æœ‰æ˜¾å¼æ•°æ®æµçš„æ™ºèƒ½ä½“ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„å·¥å…·é›†ã€‚</p>
<p><strong>LangGraphï¼šç”¨å›¾ï¼ˆGraphï¼‰å®šä¹‰å·¥ä½œæµï¼ˆWorkflowï¼‰</strong></p>
<p>LangGraphçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ™ºèƒ½ä½“åº”ç”¨æ„å»ºæˆä¸€ä¸ª<strong>çŠ¶æ€å›¾ï¼ˆState
Graphï¼‰</strong>
ã€‚è¿™ä¸ªå›¾ç”±èŠ‚ç‚¹å’Œè¾¹ç»„æˆï¼Œæ¸…æ™°åœ°å®šä¹‰äº†æ•°æ®å¦‚ä½•åœ¨ä¸åŒæ¨¡å—é—´æµåŠ¨</p>
<ul>
<li><strong>çŠ¶æ€ï¼ˆStateï¼‰ï¼š</strong>
è¿™æ˜¯æ•´ä¸ªå›¾çš„æ ¸å¿ƒï¼Œä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹å…±äº«çš„ä¸­å¤®æ•°æ®å¯¹è±¡ã€‚
<ul>
<li>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªâ€œæ•°æ®æ€»çº¿â€æˆ–å…±äº«å†…å­˜ã€‚å¼€å‘è€…éœ€è¦é¢„å…ˆå®šä¹‰Stateçš„ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨æ‰§è¡Œæ—¶éƒ½å¯ä»¥è¯»å–å’Œæ›´æ–°è¿™ä¸ªStateå¯¹è±¡
ã€‚</li>
</ul></li>
<li><strong>èŠ‚ç‚¹ï¼ˆNodesï¼‰ï¼š</strong>
ä»£è¡¨å·¥ä½œæµä¸­çš„ä¸€ä¸ªè®¡ç®—å•å…ƒæˆ–ä¸€ä¸ªæ­¥éª¤ã€‚
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹é€šå¸¸æ˜¯ä¸€ä¸ªPythonå‡½æ•°ï¼Œå®ƒæ¥æ”¶å½“å‰çš„Stateä½œä¸ºè¾“å…¥ï¼Œæ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼ˆå¦‚è°ƒç”¨LLMã€æ‰§è¡Œå·¥å…·ã€å¤„ç†æ•°æ®ï¼‰ï¼Œç„¶åè¿”å›å¯¹Stateçš„æ›´æ–°
ã€‚</li>
</ul></li>
<li><strong>è¾¹ï¼ˆEdgesï¼‰</strong>ï¼š
è¿æ¥èŠ‚ç‚¹ï¼Œå®šä¹‰äº†å·¥ä½œæµçš„è·¯å¾„ï¼Œå³æ•°æ®åœ¨Stateæ›´æ–°ååº”è¯¥æµå‘å“ªä¸ªèŠ‚ç‚¹ã€‚
<ul>
<li><strong>ç®€å•è¾¹ï¼ˆSimple Edgesï¼‰ï¼š</strong>
å®šä¹‰äº†å›ºå®šçš„ã€æ— æ¡ä»¶çš„æµå‘ï¼Œç”¨äºå®ç°é“¾å¼å·¥ä½œæµ ã€‚</li>
<li><strong>æ¡ä»¶è¾¹ï¼ˆConditional Edgesï¼‰ï¼š</strong>
ç”¨äºå®ç°è·¯ç”±é€»è¾‘ã€‚å®ƒä¼šæ ¹æ®ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ¥å†³å®šæ¥ä¸‹æ¥åº”è¯¥èµ°å‘å“ªä¸ªèŠ‚ç‚¹ï¼Œä»è€Œå®ç°æµç¨‹çš„åˆ†æ”¯
ã€‚</li>
</ul></li>
<li><strong>æ£€æŸ¥ç‚¹ï¼ˆCheckpointerï¼‰ï¼š</strong>
LangGraphæä¾›äº†æŒä¹…åŒ–æœºåˆ¶ï¼Œå¯ä»¥åœ¨æ¯ä¸€æ­¥æ‰§è¡Œåè‡ªåŠ¨ä¿å­˜Stateçš„çŠ¶æ€ã€‚è¿™å¯¹äºæ„å»ºéœ€è¦é•¿æœŸè®°å¿†ã€å¯ä¸­æ–­å’Œæ¢å¤ã€æˆ–éœ€è¦
Human-in-the-Loop çš„å¤æ‚ä¸šåŠ¡æµç¨‹è‡³å…³é‡è¦ ã€‚</li>
</ul>
<p>å¤æ‚ä¸šåŠ¡æµç¨‹çš„AIæ™ºèƒ½ä½“ï¼Œå…¶æ ¸å¿ƒæŒ‘æˆ˜å·²ä»å•çº¯ä¼˜åŒ–ä¿¡æ¯æ£€ç´¢ï¼ˆå¦‚RAGï¼‰æˆ–æç¤ºè¯ï¼Œè½¬å‘äº†å¯¹å†…éƒ¨<strong>å·¥ä½œæµå’Œæ•°æ®æµçš„ç²¾å¿ƒè®¾è®¡ä¸ç¼–æ’</strong>ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/" class="post-title-link" itemprop="url">ragè¯„ä¼°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-11 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-11T00:00:00+08:00">2025-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-13 17:07:20" itemprop="dateModified" datetime="2025-07-13T17:07:20+08:00">2025-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ragè¯„ä¼°çš„æŒ‡æ ‡">ragè¯„ä¼°çš„æŒ‡æ ‡</h3>
<h4 id="å¿ è¯šåº¦faithfulness">å¿ è¯šåº¦Faithfulness</h4>
<p>Faithfulnessï¼šè¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸ç»™å®šä¸Šä¸‹æ–‡ä¹‹é—´çš„äº‹å®ä¸€è‡´æ€§ã€‚å¿ å®åº¦å¾—åˆ†æ˜¯åŸºäºç­”æ¡ˆå’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡
è®¡ç®—å‡ºæ¥çš„ï¼Œç­”æ¡ˆçš„è¯„åˆ†èŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œåˆ†æ•°è¶Šé«˜è¶Šå¥½ã€‚</p>
<figure>
<img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711154457878.png" alt="image-20250711154457878">
<figcaption aria-hidden="true">image-20250711154457878</figcaption>
</figure>
<p>è®¡ç®—æ–¹å¼ï¼šå°†å¤§æ¨¡å‹ç»™å‡ºçš„ç­”æ¡ˆè¿›è¡Œåˆ‡ç‰‡ï¼Œæ£€ç´¢ç»™å‡ºçš„ä¸Šä¸‹æ–‡ï¼Œè®¡ç®—è¿™äº›åˆ‡ç‰‡æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­</p>
<figure>
<img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711155257239.png" alt="image-20250711155257239">
<figcaption aria-hidden="true">image-20250711155257239</figcaption>
</figure>
<h4 id="ç­”æ¡ˆç›¸å…³æ€§answerrelevance">ç­”æ¡ˆç›¸å…³æ€§Answerrelevance</h4>
<p>Answerrelevanceï¼šç­”æ¡ˆç›¸å…³æ€§çš„è¯„ä¼°æŒ‡æ ‡æ—¨åœ¨è¯„ä¼°ç”Ÿæˆçš„ç­”æ¡ˆä¸ç»™å®šæç¤ºçš„ç›¸å…³ç¨‹åº¦ã€‚å¦‚æœç­”æ¡ˆä¸å®Œ
æ•´æˆ–åŒ…å«å†—ä½™ä¿¡æ¯ï¼Œåˆ™ä¼šè¢«èµ‹äºˆè¾ƒä½çš„åˆ†æ•°ã€‚è¿™ä¸ªæŒ‡æ ‡ä½¿ç”¨é—®é¢˜å’Œç­”æ¡ˆæ¥è®¡ç®—ï¼Œå…¶å€¼ä»‹äº0åˆ°1ä¹‹é—´ï¼Œå¾—
åˆ†è¶Šé«˜è¡¨æ˜ç­”æ¡ˆçš„ç›¸å…³æ€§è¶Šå¥½</p>
<figure>
<img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711155128553.png" alt="image-20250711155128553">
<figcaption aria-hidden="true">image-20250711155128553</figcaption>
</figure>
<p>è®¡ç®—æ–¹å¼ï¼šæ ¹æ®ç­”æ¡ˆç”Ÿæˆå¤šä¸ªé—®é¢˜ï¼Œç„¶åè®¡ç®—ç”Ÿæˆçš„ç­”æ¡ˆä¸åŸç­”æ¡ˆçš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå†å–å¹³å‡</p>
<figure>
<img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711155407518.png" alt="image-20250711155407518">
<figcaption aria-hidden="true">image-20250711155407518</figcaption>
</figure>
<h4 id="ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦contextprecision">ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ContextPrecision</h4>
<p>ContextPrecisionï¼šä¸Šä¸‹æ–‡ç²¾ç¡®åº¦è¡¡é‡ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ç›¸å…³çš„çœŸå®ä¿¡æ¯æ˜¯å¦è¢«æ’åœ¨äº†è¾ƒé«˜çš„ä½ç½®ã€‚ç†æƒ³æƒ…
å†µä¸‹ï¼Œæ‰€æœ‰ç›¸å…³çš„ä¿¡æ¯å—éƒ½åº”è¯¥å‡ºç°åœ¨æ’åçš„æœ€å‰é¢ã€‚è¿™ä¸ªæŒ‡æ ‡æ˜¯æ ¹æ®é—®é¢˜å’Œä¸Šä¸‹æ–‡æ¥è®¡ç®—çš„ï¼Œæ•°å€¼èŒƒ
å›´åœ¨0åˆ°1ä¹‹é—´ï¼Œåˆ†æ•°è¶Šé«˜è¡¨ç¤ºç²¾ç¡®åº¦è¶Šå¥½ã€‚ <span class="math display">$$
\text{Context Precision} = \frac{\sum_{k=1}^{K} (\text{rel}(k) \times
\frac{\text{Precision@k}}{\text{Ideal Precision@k}})}{\text{Total
Relevant Documents}}
$$</span></p>
<ul>
<li><code>K</code>ï¼šæ£€ç´¢è¿”å›çš„æ–‡æ¡£æ€»æ•°ï¼ˆå¦‚ top-5ï¼‰</li>
<li><code>rel(k)</code>ï¼šç¬¬ <code>k</code>
ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸å…³ï¼ˆç›¸å…³=1ï¼Œæ— å…³=0ï¼‰</li>
<li><code>Precision@k</code>ï¼šå‰ <code>k</code>
ä¸ªæ–‡æ¡£çš„ç²¾ç¡®ç‡ï¼ˆç›¸å…³æ–‡æ¡£æ•° / kï¼‰</li>
<li><code>Ideal Precision@k</code>ï¼šç†æƒ³æƒ…å†µä¸‹å‰ <code>k</code>
ä¸ªæ–‡æ¡£çš„ç²¾ç¡®ç‡ï¼ˆå‡è®¾æ‰€æœ‰ç›¸å…³æ–‡æ¡£éƒ½æ’åœ¨æœ€å‰é¢ï¼‰</li>
</ul>
<h4 id="ä¸Šä¸‹æ–‡å¬å›ç‡contextrecall">ä¸Šä¸‹æ–‡å¬å›ç‡ContextRecall</h4>
<p>ContextRecallï¼šç”¨æ¥è¡¡é‡æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸è¢«è§†ä¸ºäº‹å®çœŸç›¸çš„æ ‡æ³¨ç­”æ¡ˆçš„ä¸€è‡´æ€§ç¨‹åº¦ã€‚å®ƒæ ¹æ®äº‹å®çœŸç›¸
å’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ¥è®¡ç®—ï¼Œæ•°å€¼èŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºæ€§èƒ½è¶Šå¥½ã€‚
ä¸ºäº†ä»äº‹å®çœŸç›¸çš„ç­”æ¡ˆä¸­ä¼°è®¡ä¸Šä¸‹æ–‡å¬å›ç‡ï¼Œéœ€è¦åˆ†æç­”æ¡ˆä¸­çš„æ¯ä¸ªå¥å­æ˜¯å¦å¯ä»¥å½’å› äºæ£€ç´¢åˆ°çš„
ä¸Šä¸‹æ–‡ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œäº‹å®çœŸç›¸ç­”æ¡ˆä¸­çš„æ‰€æœ‰å¥å­éƒ½åº”è¯¥èƒ½å¤Ÿå¯¹åº”åˆ°æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸­ã€‚
<span class="math display">$$
\text{Context Recall} = \frac{|\{\text{è¿”å›çš„ç›¸å…³æ–‡æ¡£}\} \cap
\{\text{æ ‡å‡†ç›¸å…³æ–‡æ¡£}\}|}{|\{\text{æ ‡å‡†ç›¸å…³æ–‡æ¡£}\}|}
$$</span> è®¡ç®—æ–¹å¼ï¼šä¸Šä¸‹æ–‡æ˜¯å¦åŒ…æ‹¬äº†æ ‡å‡†ç­”æ¡ˆçš„å†…å®¹</p>
<h3 id="åˆ©ç”¨ragasè¯„ä¼°ragæ€§èƒ½">åˆ©ç”¨RAGASè¯„ä¼°ragæ€§èƒ½</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain/blob/main/RAGAS-langchian.ipynb">learn-rag-langchain/RAGAS-langchian.ipynb
at main Â· zxj-2023/learn-rag-langchain</a></p>
<p>æ£€ç´¢å™¨ 1.Contextprecision(ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦)ï¼šè¯„ä¼°æ£€ç´¢è´¨é‡ã€‚ 2.Context
Recall(ä¸Šä¸‹æ–‡å¬å›ç‡)ï¼šè¡¡é‡æ£€ç´¢çš„å®Œæ•´æ€§ã€‚ ç”Ÿæˆå™¨
1.Faithfulness(å¿ å®åº¦)ï¼šè¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸­çš„å¹»è§‰æƒ…å†µã€‚
2.AnswerRelevance(ç­”æ¡ˆç›¸å…³æ€§):è¡¡é‡ç­”æ¡ˆå¯¹é—®é¢˜çš„ç›´æ¥æ€§(ç´§æ‰£é—®é¢˜çš„æ ¸å¿ƒ)ã€‚</p>
<p>æœ€ç»ˆçš„RAGASå¾—åˆ†æ˜¯ä»¥ä¸Šå„ä¸ªæŒ‡æ ‡å¾—åˆ†çš„è°ƒå’Œå¹³å‡å€¼ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™äº›æŒ‡æ ‡ç”¨æ¥ç»¼åˆè¯„ä¼°
-ä¸ªç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚</p>
<h4 id="ragçš„æ„å»º">RAGçš„æ„å»º</h4>
<p>åˆ›å»ºRAGæ–‡æœ¬åˆ†å‰²ã€Embedding model ã€ å‘é‡åº“å­˜å‚¨Chroma</p>
<p>æˆ‘ä»¬ä¸»è¦ä½¿ç”¨ <code>RecursiveCharacterTextSplitter</code>
åˆ‡å‰²æ–‡æœ¬ï¼Œé€šè¿‡<code>OpenAIEmbeddings()</code>è¿›è¡Œæ–‡æœ¬ç¼–ç ï¼Œå­˜å‚¨åˆ°
<code>VectorStore</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from langchain.vectorstores import Chroma</span><br><span class="line">from langchain.embeddings import OpenAIEmbeddings</span><br><span class="line">from langchain.text_splitter import RecursiveCharacterTextSplitter</span><br><span class="line">from langchain_community.embeddings import DashScopeEmbeddings</span><br><span class="line">embeddings_model = DashScopeEmbeddings(</span><br><span class="line">        model=&quot;text-embedding-v2&quot;,</span><br><span class="line">        dashscope_api_key=openai.api_key,</span><br><span class="line">    )</span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(chunk_size=500)</span><br><span class="line">#è¿›è¡Œæ–‡æœ¬åˆ†å‰²ï¼Œç”Ÿæˆæ›´å°ã€æ›´æ˜“äºå¤„ç†çš„æ–‡æ¡£å—</span><br><span class="line">docs = text_splitter.split_documents(paper_docs)</span><br><span class="line"></span><br><span class="line">vectorstore = Chroma.from_documents(docs, embeddings_model)</span><br></pre></td></tr></table></figure>
<p>Chroma
å‘é‡æ•°æ®åº“é»˜è®¤æƒ…å†µä¸‹æ˜¯å†…å­˜å­˜å‚¨ï¼Œè¿™æ„å‘³ç€æ•°æ®åœ¨ç¨‹åºè¿è¡Œç»“æŸåä¸ä¼šä¿ç•™ã€‚
ä½†æ˜¯ï¼ŒChroma
ä¹Ÿæ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªè·¯å¾„å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·ï¼Œå³ä½¿ç¨‹åºå…³é—­ï¼Œæ•°æ®ä¹Ÿä¼šè¢«ä¿ç•™ï¼Œå¹¶åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ã€‚</p>
<h4 id="æ£€ç´¢å™¨çš„æ„å»º">æ£€ç´¢å™¨çš„æ„å»º</h4>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>Chroma</code> å‘é‡åº“çš„
<code>.as_retriever()</code> æ–¹å¼è¿›è¡Œæ£€ç´¢ï¼Œéœ€è¦æ§åˆ¶çš„ä¸»è¦å‚æ•°ä¸º
<code>k</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base_retriever = vectorstore.as_retriever(search_kwargs=&#123;&quot;k&quot; : 3&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ectorstore.as_retriever() : è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªå‘é‡æ•°æ®åº“å®ä¾‹ï¼ˆ
vectorstore ï¼‰è½¬æ¢ä¸º LangChain ä¸­çš„ä¸€ä¸ªæ£€ç´¢å™¨ï¼ˆ Retriever
ï¼‰å¯¹è±¡ã€‚æ£€ç´¢å™¨æ˜¯ LangChain
ä¸­è´Ÿè´£æ ¹æ®ç”¨æˆ·æŸ¥è¯¢ä»æ•°æ®æºä¸­è·å–ç›¸å…³æ–‡æ¡£çš„æ ¸å¿ƒç»„ä»¶ã€‚</li>
<li>â€œkâ€ : è¿™ä¸ªé”®è¡¨ç¤ºè¦æ£€ç´¢çš„â€œæœ€ç›¸ä¼¼â€æ–‡æ¡£çš„æ•°é‡ã€‚åœ¨è¿™é‡Œï¼Œ â€œkâ€ : 3
æ„å‘³ç€å½“æ£€ç´¢å™¨æ¥æ”¶åˆ°ä¸€ä¸ªæŸ¥è¯¢æ—¶ï¼Œå®ƒå°†ä»å‘é‡å­˜å‚¨ä¸­è¿”å›ä¸è¯¥æŸ¥è¯¢æœ€ç›¸ä¼¼çš„ 3
ä¸ªæ–‡æ¡£ã€‚è¿™åœ¨
RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿä¸­éå¸¸å¸¸è§ï¼Œç”¨äºé™åˆ¶ä¼ é€’ç»™å¤§å‹è¯­è¨€æ¨¡å‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯é‡ï¼Œä»¥æé«˜æ•ˆç‡å’Œç›¸å…³æ€§ã€‚</li>
</ul>
<p>æ£€ç´¢å™¨çš„ä½œç”¨
æ£€ç´¢å™¨ï¼ˆRetrieverï¼‰æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ä»ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚å‘é‡æ•°æ®åº“ã€æ–‡æ¡£åŠ è½½å™¨ç­‰ï¼‰ä¸­æ ¹æ®ç»™å®šçš„æŸ¥è¯¢ï¼ˆqueryï¼‰æ£€ç´¢å‡ºç›¸å…³çš„æ–‡æ¡£æˆ–ä¿¡æ¯ã€‚</p>
<h4 id="promptçš„æ„å»º">promptçš„æ„å»º</h4>
<p>æˆ‘ä»¬éœ€è¦åˆ©ç”¨<code>LLM</code>å¯¹<code>Context</code>
ç”Ÿæˆä¸€ç³»åˆ—çš„é—®é¢˜çš„<code>answer</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from langchain import PromptTemplate</span><br><span class="line"></span><br><span class="line">template = &quot;&quot;&quot;You are an assistant for question-answering tasks. </span><br><span class="line">Use the following pieces of retrieved context to answer the question. </span><br><span class="line">If you don&#x27;t know the answer, just say that you don&#x27;t know. </span><br><span class="line"></span><br><span class="line">Question: &#123;question&#125; </span><br><span class="line"></span><br><span class="line">Context: &#123;context&#125; </span><br><span class="line"></span><br><span class="line">Answer:</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">prompt = PromptTemplate(</span><br><span class="line">    template=template, </span><br><span class="line">    input_variables=[&quot;context&quot;,&quot;question&quot;]</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">print(prompt)</span><br></pre></td></tr></table></figure>
<h4 id="ç”Ÿæˆansweråˆ©ç”¨llm">ç”Ÿæˆ<code>answer</code>,åˆ©ç”¨LLM</h4>
<p>åˆ©ç”¨ <code>Runnable</code> å®šä¹‰ä¸€ä¸ª <code>chain</code>
å®ç°ragå…¨æµç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from langchain.schema.runnable import RunnablePassthrough</span><br><span class="line">from langchain.schema.output_parser import StrOutputParser</span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model_name=&quot;qwen-plus-2025-04-28&quot;, </span><br><span class="line">    temperature=0,</span><br><span class="line">    api_key=&quot;&quot;,</span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">    )</span><br><span class="line">#RunnablePassthroughå°†è¾“å…¥æ•°æ®åŸå°ä¸åŠ¨åœ°ä¼ é€’åˆ°è¾“å‡º</span><br><span class="line">#StrOutputParser() å®ƒè¢«ç”¨ä½œ RAG é“¾çš„æœ€åä¸€æ­¥ï¼Œç¡®ä¿æœ€ç»ˆçš„ç­”æ¡ˆä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºã€‚</span><br><span class="line">rag_chain = (</span><br><span class="line">    &#123;&quot;context&quot;: base_retriever,  &quot;question&quot;: RunnablePassthrough()&#125; </span><br><span class="line">    | prompt </span><br><span class="line">    | llm</span><br><span class="line">    | StrOutputParser() </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»º-ragas-æ‰€éœ€çš„æ•°æ®">åˆ›å»º RAGAs æ‰€éœ€çš„æ•°æ®</h4>
<p>question Answer contexts ground_truths</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># Ragas æ•°æ®é›†æ ¼å¼è¦æ±‚  [&#x27;question&#x27;, &#x27;answer&#x27;, &#x27;contexts&#x27;, &#x27;ground_truths&#x27;]</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;question&quot;: [], &lt;-- é—®é¢˜åŸºäºContextçš„</span><br><span class="line">    &quot;answer&quot;: [], &lt;-- ç­”æ¡ˆåŸºäºLLMç”Ÿæˆçš„</span><br><span class="line">    &quot;contexts&quot;: [], &lt;-- context</span><br><span class="line">    &quot;ground_truths&quot;: [] &lt;-- æ ‡å‡†ç­”æ¡ˆ</span><br><span class="line">&#125;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">from datasets import Dataset</span><br><span class="line">#æ„å»ºé—®é¢˜ä¸æ ‡å‡†ç­”æ¡ˆï¼ˆé»„é‡‘æ•°æ®é›†ï¼‰</span><br><span class="line">questions = [&quot;What is faithfulness ?&quot;, </span><br><span class="line">             &quot;How many pages are included in the WikiEval dataset, and which years do they cover information from?&quot;,</span><br><span class="line">             &quot;Why is evaluating Retrieval Augmented Generation (RAG) systems challenging?&quot;,</span><br><span class="line">            ]</span><br><span class="line">ground_truths = [&quot;Faithfulness refers to the idea that the answer should be grounded in the given context.&quot;,</span><br><span class="line">                  &quot; To construct the dataset, we first selected 50 Wikipedia pages covering events that have happened since the start of 2022.&quot;,</span><br><span class="line">                &quot;Evaluating RAG architectures is, however, challenging because there are several dimensions to consider: the ability of the retrieval system to identify relevant and focused context passages, the ability of the LLM to exploit such passages in a faithful way, or the quality of the generation itself.&quot;]              </span><br><span class="line">answers = []</span><br><span class="line">contexts = []</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆç­”æ¡ˆ</span><br><span class="line">for query in questions:</span><br><span class="line">    answers.append(rag_chain.invoke(query))</span><br><span class="line">    contexts.append([docs.page_content for docs in base_retriever.get_relevant_documents(query)])</span><br><span class="line"></span><br><span class="line"># æ„å»ºæ•°æ®</span><br><span class="line">data = &#123;</span><br><span class="line">    &quot;user_input&quot;: questions,</span><br><span class="line">    &quot;response&quot;: answers,</span><br><span class="line">    &quot;retrieved_contexts&quot;: contexts,</span><br><span class="line">    &quot;reference&quot;: ground_truths</span><br><span class="line">&#125;</span><br><span class="line">dataset = Dataset.from_dict(data)</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨ragas-è¿›è¡Œè¯„ä¼°">ä½¿ç”¨RAGAs è¿›è¡Œè¯„ä¼°</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#å°†è¯„ä¼°æ•°æ®è½¬æ¢æˆ Ragas æ¡†æ¶ä¸“ç”¨çš„æ ¼å¼ ã€‚</span><br><span class="line">from ragas import EvaluationDataset</span><br><span class="line">evaluation_dataset = EvaluationDataset.from_list(dataset)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç»„å¸¸ç”¨çš„RAGè¯„ä¼°æŒ‡æ ‡ï¼Œåœ¨æ”¶é›†çš„æ•°æ®é›†ä¸Šè¯„ä¼°æˆ‘ä»¬çš„RAGç³»ç»Ÿã€‚æ‚¨å¯ä»¥é€‰æ‹©ä»»ä½•æ¨¡å‹ä½œä¸ºè¯„ä¼°ç”¨LLMæ¥è¿›è¡Œè¯„ä¼°ã€‚
ragasé»˜è®¤ä½¿ç”¨openaiçš„api</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from ragas.llms import LangchainLLMWrapper</span><br><span class="line">evaluator_llm = LangchainLLMWrapper(llm)</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from ragas.metrics import LLMContextRecall, Faithfulness, FactualCorrectness</span><br><span class="line">from ragas import evaluate</span><br><span class="line">result = evaluate(dataset=evaluation_dataset,metrics=[LLMContextRecall(), Faithfulness(), FactualCorrectness()],llm=evaluator_llm)</span><br><span class="line">result</span><br></pre></td></tr></table></figure>
<figure>
<img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250713164037571.png" alt="image-20250713164037571">
<figcaption aria-hidden="true">image-20250713164037571</figcaption>
</figure>
<h4 id="æŸ¥çœ‹ç»“æœ">æŸ¥çœ‹ç»“æœ</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">pd.set_option(&quot;display.max_colwidth&quot;, None)</span><br><span class="line"></span><br><span class="line">df = result.to_pandas()</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1892529470419736435">RAGç³»ç»Ÿæ•ˆæœéš¾è¯„ï¼Ÿ2025å¹´å¿…å¤‡çš„RAGè¯„ä¼°æ¡†æ¶ä¸å·¥å…·è¯¦è§£
- çŸ¥ä¹</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Jz421Q7Lw?spm_id_from=333.788.videopod.sections&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">å¦‚ä½•åˆ©ç”¨RAGAsè¯„ä¼°RAGç³»ç»Ÿçš„å¥½å_å“”å“©å“”å“©_bilibili</a></p>
<p>ragasä¸­æ–‡æ–‡æ¡£<a target="_blank" rel="noopener" href="https://www.aidoczh.com/ragas/getstarted/rag_eval/index.html#want-help-in-improving-your-ai-application-using-evals">Evaluate
a simple RAG - Ragas</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">chunkåˆ†å—ç­–ç•¥</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-09 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-09T00:00:00+08:00">2025-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-04 15:13:04" itemprop="dateModified" datetime="2025-08-04T15:13:04+08:00">2025-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="åˆ†å—ç­–ç•¥"><a href="#åˆ†å—ç­–ç•¥" class="headerlink" title="åˆ†å—ç­–ç•¥"></a>åˆ†å—ç­–ç•¥</h3><p>ä»¥ä¸‹æ˜¯ RAG åº”ç”¨ç¨‹åºçš„å…¸å‹å·¥ä½œæµç¨‹ï¼š</p>
<p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/6878b8fa-5e74-45a1-9a89-5aab92889126_2366x990.gif" alt="6878b8fa-5e74-45a1-9a89-5aab92889126_2366x990"></p>
<p>ä¸»æµä¸»è¦æœ‰äº”ç§åˆ†å—ç­–ç•¥ï¼š</p>
<p><img src="https___substack-post-media.s3.amazonaws.com_public_images_92c70184-ba0f-4877-9a55-e4add0e311ad_870x1116.gif" alt="https___substack-post-media.s3.amazonaws.com_public_images_92c70184-ba0f-4877-9a55-e4add0e311ad_870x1116"></p>
<h4 id="Fixed-size-chunking-å›ºå®šå¤§å°çš„åˆ†å—"><a href="#Fixed-size-chunking-å›ºå®šå¤§å°çš„åˆ†å—" class="headerlink" title="Fixed-size chunking å›ºå®šå¤§å°çš„åˆ†å—"></a>Fixed-size chunking å›ºå®šå¤§å°çš„åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/98c422a0-f0e2-457c-a256-4476a56a601f_943x232.png" alt="98c422a0-f0e2-457c-a256-4476a56a601f_943x232"></p>
<p>å°†æ–‡æœ¬ä»¥å›ºå®šé•¿åº¦åˆ†å—ï¼Œoverlapä¸ºæ¯ä¸ªå—çš„é‡åˆç¨‹åº¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æœç²’å¥¶ä¼˜æœ‰æœç²’ï¼Œæ¬¢è¿å…³æ³¨æˆ‘ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢AIã€‚&quot;</span></span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> CharacterTextSplitter</span><br><span class="line"></span><br><span class="line">text_splitter = CharacterTextSplitter(</span><br><span class="line">    separator=<span class="string">&quot;&quot;</span>,<span class="comment">#æŒ‰å­—åˆ‡åˆ†</span></span><br><span class="line">    chunk_size=<span class="number">5</span>,</span><br><span class="line">    chunk_overlap=<span class="number">1</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span>,<span class="comment">#ä»¥é•¿åº¦è®¡ç®—</span></span><br><span class="line">    is_separator_regex=<span class="literal">False</span>,<span class="comment">#ä¸è§†ä¸ºæ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">)</span><br><span class="line">text_splitter.split_text(text)</span><br></pre></td></tr></table></figure>
<h4 id="Semantic-chunking-è¯­ä¹‰åˆ†å—"><a href="#Semantic-chunking-è¯­ä¹‰åˆ†å—" class="headerlink" title="Semantic chunking è¯­ä¹‰åˆ†å—"></a>Semantic chunking è¯­ä¹‰åˆ†å—</h4><p><img src="https___substack-post-media.s3.amazonaws.com_public_images_a6ad83a6-2879-4c77-9e49-393f16577aef_1066x288.gif" alt="https___substack-post-media.s3.amazonaws.com_public_images_a6ad83a6-2879-4c77-9e49-393f16577aef_1066x288"></p>
<p>å…ˆå°†æ–‡æœ¬åˆ†æ®µï¼Œç„¶åä¸ºæ¯ä¸ªæ®µè¿›è¡ŒåµŒå…¥ï¼Œè‹¥ä¸¤ä¸ªæ®µæœ‰è¾ƒé«˜çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œåˆ™åˆå¹¶æˆä¸€ä¸ªå—ï¼Œä¸€ç›´åˆå¹¶åˆ°ä½™å¼¦ç›¸ä¼¼åº¦æ˜¾è‘—ä¸‹é™ï¼Œå†ä»æ–°çš„å—å¼€å§‹</p>
<p>éœ€è¦è®¾å®šé˜ˆå€¼æ¥ç¡®å®šä½™å¼¦ç›¸ä¼¼åº¦æ˜¯å¦æ˜¾è‘—ä¸‹é™ï¼Œè¿™å› æ–‡æ¡£è€Œå¼‚ã€‚</p>
<p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/image-20250710150106274.png" alt="image-20250710150106274"></p>
<p>å…·ä½“å®ç°æ€è·¯ï¼šåˆ©ç”¨æ»‘åŠ¨çª—å£ï¼Œä»ç¬¬ä¸€å¥å¾€åç§»åŠ¨æ»‘åŠ¨çª—å£ï¼Œå¦‚å›¾ï¼Œemed1ä¸emed2ç›¸å·®sen3ï¼Œè®¡ç®—å‡ºæ¥çš„distanceå†³å®šsen3æ˜¯å¦åŠ å…¥chunk1ï¼Œä»¥æ­¤ç±»æ¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ©ç”¨langchainè°ƒç”¨</span></span><br><span class="line"><span class="keyword">from</span> langchain_experimental.text_splitter <span class="keyword">import</span> SemanticChunker</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line">embeddings_model = DashScopeEmbeddings(</span><br><span class="line">        model=<span class="string">&quot;text-embedding-v2&quot;</span>,</span><br><span class="line">        dashscope_api_key=<span class="string">&quot;&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">semantic_chunk=SemanticChunker(</span><br><span class="line">    embeddings=embeddings_model,<span class="comment">#åµŒå…¥æ¨¡å‹</span></span><br><span class="line">    breakpoint_threshold_type=<span class="string">&quot;percentile&quot;</span>,<span class="comment">#å®šä¹‰å¦‚ä½•è®¡ç®—è¯­ä¹‰æ–­ç‚¹é˜ˆå€¼</span></span><br><span class="line">    breakpoint_threshold_amount=<span class="number">95</span>,<span class="comment">#è®¾å®šé˜ˆå€¼</span></span><br><span class="line">    <span class="comment">#min_chunk_size=500#é™åˆ¶ç”Ÿæˆå—æœ€å°çš„å­—ç¬¦æ•°ï¼Œé¿å…ç”Ÿæˆæ— æ„ä¹‰çš„å—</span></span><br><span class="line">    sentence_split_regex=<span class="string">r&#x27;[ã€‚ï¼ï¼Ÿ.\n]&#x27;</span>,<span class="comment">#è¯­å¥åˆ‡åˆ†</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1664186">LangChain æ­é… QWen è¸©å‘-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº</a></p>
<p>ä½¿ç”¨OpenAIEmbeddingsé…ç½®embeddingæ¨¡å‹ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªå…³é”®å‚æ•°</p>
<p><code>check_embedding_ctx_length = False</code> çš„ä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>å…³é—­ langchain_openai åœ¨è°ƒç”¨åµŒå…¥æ¨¡å‹å‰å¯¹è¾“å…¥æ–‡æœ¬é•¿åº¦çš„æ£€æŸ¥ä¸è‡ªåŠ¨æˆªæ–­/åˆ†æ®µé€»è¾‘ã€‚</strong></p>
</blockquote>
<p>ä½† DashScope çš„ <code>text-embedding-v4</code> æ¥å£ï¼š</p>
<ul>
<li>å¯¹è¾“å…¥æ ¼å¼è¦æ±‚æ›´ä¸¥æ ¼ï¼ˆå¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œä¸èƒ½æ˜¯åˆ†æ®µåçš„å¤æ‚ç»“æ„ï¼‰ã€‚</li>
<li>ä¸æ¥å— <code>langchain_openai</code> é»˜è®¤ç”Ÿæˆçš„<strong>åˆ†æ®µåçš„åˆ—è¡¨åµŒå¥—ç»“æ„</strong>ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from langchain_openai import OpenAIEmbeddings,  OpenAI</span><br><span class="line">embeddings = OpenAIEmbeddings(</span><br><span class="line">api_key=&quot;sk-&quot;, </span><br><span class="line">base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">model=&quot;text-embedding-v4&quot;,</span><br><span class="line">check_embedding_ctx_length = False,</span><br><span class="line">dimensions=1536</span><br><span class="line">)</span><br><span class="line">result=embeddings.embed_query(&quot;Hello, world!&quot;)</span><br><span class="line">print(len(result))</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æºä»£ç ç†è§£è§æœ€å</p>
<h4 id="Recursive-chunking-é€’å½’åˆ†å—"><a href="#Recursive-chunking-é€’å½’åˆ†å—" class="headerlink" title="Recursive chunking é€’å½’åˆ†å—"></a>Recursive chunking é€’å½’åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/f4009caa-34fc-48d6-8102-3d0f6f2c1386_1066x316.gif" alt="f4009caa-34fc-48d6-8102-3d0f6f2c1386_1066x316"></p>
<p>å…ˆä¾æ®å¤§çš„æ®µè½è¿›è¡Œåˆ†å—ï¼Œå†å¯¹æ¯ä¸ªå—è¿›è¡Œå¤„ç†ï¼Œè‹¥ç¬¦åˆchunk-sizeçš„é™åˆ¶ï¼Œåˆ™ä¸ä¼šå†åˆ†</p>
<p>ç»“æœå¯èƒ½å¦‚ä¸‹</p>
<p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/b0e40cc1-996f-48f4-9306-781b112536e4_984x428.png" alt="b0e40cc1-996f-48f4-9306-781b112536e4_984x428"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå—ï¼ˆç´«è‰²çš„ä¸¤ä¸ªæ®µè½ã€‚æ¥ä¸‹æ¥ï¼Œç¬¬1æ®µè¿›ä¸€æ­¥æ‹†åˆ†ä¸ºæ›´å°çš„å—ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line">recursive_splitter_chinese = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">50</span>,</span><br><span class="line">    chunk_overlap=<span class="number">10</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span>,</span><br><span class="line">    separators=[<span class="string">&quot;\n\n&quot;</span>, <span class="string">&quot;ã€‚&quot;</span>, <span class="string">&quot;ï¼Œ&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>]<span class="comment">#ä¸­æ–‡çš„åˆ†éš”ç¬¦ï¼Œå¯ä»¥ç”¨é€—å·å¥å·</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="Document-structure-based-chunking-åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—"><a href="#Document-structure-based-chunking-åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—" class="headerlink" title="Document structure-based chunking åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—"></a>Document structure-based chunking åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/e8febecd-ee68-42ff-ab06-41a0a3a43cd3_1102x306.gif" alt="e8febecd-ee68-42ff-ab06-41a0a3a43cd3_1102x306"></p>
<p>æ ¹æ®æ–‡æ¡£çš„å›ºæœ‰ç»“æ„è¿›è¡Œåˆ†å—ï¼Œå¦‚markdownçš„ä¸€çº§æ ‡é¢˜äºŒçº§æ ‡é¢˜ç­‰</p>
<p><code>langchain.text_splitter</code>ä¸­æœ‰ä¸¤ä¸ªç”¨äºmdæ–‡æ¡£åˆ†å—çš„ç±»ï¼Œ<code>MarkdownTextSplitter</code>ä¸<code>MarkdownHeaderTextSplitter</code></p>
<p>äºŒè€…åŒºåˆ«ä¸»è¦åœ¨ï¼šå‰è€…ç»§æ‰¿äº<code>RecursiveCharacterTextSplitter</code>é€’å½’åˆ†å—ï¼Œå®ƒä¼šå°è¯•æ²¿ç€ Markdown æ ¼å¼çš„æ ‡é¢˜è¿›è¡Œåˆ†å‰²ï¼Œä½†å…¶æ ¸å¿ƒä»ç„¶æ˜¯åŸºäºå­—ç¬¦çš„é€’å½’åˆ†å‰²ï¼›åè€…ä¸“æ³¨äº åŸºäº Markdown æ ‡é¢˜çš„ç»“æ„åŒ–åˆ†å‰² ï¼Œå¹¶èƒ½å°†æ ‡é¢˜ä¿¡æ¯ä½œä¸ºå…ƒæ•°æ®ä¿ç•™ï¼Œæ›´é€‚åˆéœ€è¦ä¿æŒ Markdown æ–‡æ¡£å±‚çº§ç»“æ„çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>MarkdownHeaderTextSplitter</code> æœ¬èº«ä¸ç›´æ¥æä¾›é™åˆ¶å—å†…å®¹é•¿åº¦çš„å‚æ•°ï¼Œä½†å¯ä»¥é€šè¿‡ä¸ <code>RecursiveCharacterTextSplitter</code> ç­‰å…¶ä»–æ–‡æœ¬åˆ†å‰²å™¨ç»“åˆä½¿ç”¨æ¥æœ‰æ•ˆæ§åˆ¶å—çš„å¤§å°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> MarkdownHeaderTextSplitter</span><br><span class="line">headers_to_split_on = [</span><br><span class="line">    (<span class="string">&quot;#&quot;</span>, <span class="string">&quot;Header 1&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;##&quot;</span>, <span class="string">&quot;Header 2&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;###&quot;</span>, <span class="string">&quot;Header 3&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">markdown_splitter = MarkdownHeaderTextSplitter(headers_to_split_on)</span><br><span class="line">md_header_splits = markdown_splitter.split_text(markdown_document)</span><br></pre></td></tr></table></figure>
<p>å­˜å‚¨ç»“æ„ç±»ä¼¼å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Document(metadata=&#123;&#x27;Header 1&#x27;: &#x27;Foo&#x27;, &#x27;Header 2&#x27;: &#x27;Bar&#x27;&#125;, page_content=&#x27;Hi this is Jim  \nHi this is Joe&#x27;),</span><br><span class="line"> Document(metadata=&#123;&#x27;Header 1&#x27;: &#x27;Foo&#x27;, &#x27;Header 2&#x27;: &#x27;Bar&#x27;, &#x27;Header 3&#x27;: &#x27;Boo&#x27;&#125;, page_content=&#x27;Hi this is Lance&#x27;),</span><br><span class="line"> Document(metadata=&#123;&#x27;Header 1&#x27;: &#x27;Foo&#x27;, &#x27;Header 2&#x27;: &#x27;Baz&#x27;&#125;, page_content=&#x27;Hi this is Molly&#x27;)]</span><br></pre></td></tr></table></figure>
<h4 id="LLM-based-chunking-åŸºäº-LLM-çš„åˆ†å—"><a href="#LLM-based-chunking-åŸºäº-LLM-çš„åˆ†å—" class="headerlink" title="LLM-based chunking åŸºäº LLM çš„åˆ†å—"></a>LLM-based chunking åŸºäº LLM çš„åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/4d1b6d60-8956-4030-8525-d899ee61a9d5_1140x198.gif" alt="4d1b6d60-8956-4030-8525-d899ee61a9d5_1140x198"></p>
<p>åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œåˆ†å—</p>
<p>langchainæ²¡æœ‰æä¾›å®˜æ–¹çš„ç±»å®ç°LLM-based chunking</p>
<p>ä½†æ˜¯æˆ‘åœ¨æ‰¾åˆ°äº†åˆ«äººå®ç°çš„agentic_chunker<a target="_blank" rel="noopener" href="https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/agentic_chunker.py">RetrievalTutorials/tutorials/LevelsOfTextSplitting/agentic_chunker.py at main Â· FullStackRetrieval-com/RetrievalTutorials</a>ï¼Œå¯ä¾›å‚è€ƒ</p>
<p>åè®°ï¼šagentic chunkå¤§æ¦‚çš„æ€è·¯ä¸ºå…ˆè¿›è¡Œåˆæ­¥åˆ†æ®µï¼ŒæŒ‰ç…§é•¿åº¦æˆ–é€’å½’ï¼Œç„¶åè®©å¤§æ¨¡å‹ç”Ÿæˆè¿™ä¸€æ®µçš„æ¦‚è¦ï¼Œå°†æ®µä¸æ®µåˆå¹¶ç”Ÿæˆå—ï¼Œä½†æ˜¯æµ‹è¯•ä¸‹æ¥ï¼Œä¸€ä¸ªæ–‡æ¡£çš„å†…å®¹åŒè´¨åŒ–å¾ˆä¸¥é‡ï¼ŒåŸºæœ¬ä¸Šéƒ½åˆ†åˆ°ä¸€å—é‡Œäº†ï¼Œè€Œä¸”è¿™ä¸ªä¸»è¦è¿˜æ˜¯æç¤ºè¯å·¥ç¨‹ï¼Œåˆ†å—å¹¶ä¸ç³»ç»Ÿï¼Œçœ‹ä¸ªä¹å§</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zxj-2023/chunks-strategy-/blob/main/agentic_chunker.py">chunks-strategy-/agentic_chunker.py at main Â· zxj-2023/chunks-strategy-</a>ä»£ç ç¨ä½œæ›´æ–°ï¼Œå¼ƒç”¨äº†éƒ¨åˆ†åº“</p>
<h3 id="embedding"><a href="#embedding" class="headerlink" title="embedding"></a>embedding</h3><p>ä¹‹å‰å¯¹chunkingå’Œembeddingçš„ç†è§£ä¸å¤Ÿæ¸…æ™°ï¼Œchunkingæ˜¯å¯¹æ–‡æœ¬è¿›è¡Œåˆ†å—ï¼Œç”±äºå¤§å¤šæ•°æ–‡æœ¬åµŒå…¥æ¨¡å‹å¯¹è¾“å…¥æ–‡æœ¬é•¿åº¦æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œå¦‚æœä¸åˆ†å—åˆ™æ— æ³•embeddingï¼Œä»è€Œæ— æ³•æ›´å¥½çš„è¿›è¡Œå‘é‡åŒ–æˆ–è€…æ›´å¥½åœ°å‚¨å­˜åœ¨çŸ¥è¯†åº“ä¸­ï¼Œæå‡retrieveræ€§èƒ½ï¼›embeddingåˆ™æ˜¯å°†æ–‡æœ¬æ˜ å°„åˆ°å‘é‡ç©ºé—´ï¼Œä¸ºäº†æ›´å¥½çš„ç›¸ä¼¼åº¦è®¡ç®—</p>
<h3 id="è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜"><a href="#è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜" class="headerlink" title="è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜"></a>è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å°†æ–‡æœ¬åˆ’åˆ†æˆå•å¥ï¼Œå¯ä»¥æŒ‰ç…§æ ‡ç‚¹ç¬¦å·åˆ’åˆ†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">single_sentences_list = re.split(<span class="string">r&#x27;(?&lt;=[ã€‚ï¼ï¼Ÿ])&#x27;</span>, essay)</span><br><span class="line"><span class="comment"># ç§»é™¤å¯èƒ½å­˜åœ¨çš„ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">single_sentences_list = [s.strip() <span class="keyword">for</span> s <span class="keyword">in</span> single_sentences_list <span class="keyword">if</span> s.strip()]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æˆ‘ä»¬éœ€è¦ä¸ºå•ä¸ªå¥å­æ‹¼æ¥æ›´å¤šçš„å¥å­ï¼Œä½†æ˜¯ `list` æ·»åŠ æ¯”è¾ƒå›°éš¾ã€‚å› æ­¤å°†å…¶è½¬æ¢ä¸ºå­—å…¸åˆ—ï¼ˆ`List[dict]`ï¼‰</span></span><br><span class="line"><span class="string">&#123; &#x27;sentence&#x27; : XXX  , &#x27;index&#x27; : 0&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">sentences = [&#123;<span class="string">&#x27;sentence&#x27;</span>: x, <span class="string">&#x27;index&#x27;</span> : i&#125; <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(single_sentences_list)]</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ©ç”¨æ»‘åŠ¨çª—å£åˆ†æ®µ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">combine_sentences</span>(<span class="params">sentences, buffer_size=<span class="number">1</span></span>):</span><br><span class="line">    combined_sentences = [</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>.join(sentences[j][<span class="string">&#x27;sentence&#x27;</span>] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(i - buffer_size, <span class="number">0</span>), <span class="built_in">min</span>(i + buffer_size + <span class="number">1</span>, <span class="built_in">len</span>(sentences))))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sentences))</span><br><span class="line">    ]   </span><br><span class="line">    <span class="comment"># æ›´æ–°åŸå§‹å­—å…¸åˆ—è¡¨ï¼Œæ·»åŠ ç»„åˆåçš„å¥å­</span></span><br><span class="line">    <span class="keyword">for</span> i, combined_sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(combined_sentences):</span><br><span class="line">        sentences[i][<span class="string">&#x27;combined_sentence&#x27;</span>] = combined_sentence</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sentences</span><br><span class="line"></span><br><span class="line">sentences = combine_sentences(sentences)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¥ä¸‹æ¥ä½¿ç”¨**embedding model**å¯¹**sentences** è¿›è¡Œç¼–ç </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line">embeddings_model = DashScopeEmbeddings(</span><br><span class="line">        model=<span class="string">&quot;text-embedding-v2&quot;</span>,</span><br><span class="line">        dashscope_api_key=<span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line"><span class="comment"># æå–æ‰€æœ‰ç»„åˆåçš„å¥å­ç”¨äº embedding</span></span><br><span class="line">combined_sentences_to_embed = [x[<span class="string">&#x27;combined_sentence&#x27;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> sentences]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹å¥å­è¿›è¡Œ embedding</span></span><br><span class="line">embeddings = embeddings_model.embed_documents(combined_sentences_to_embed)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆåŠŸå¯¹ <span class="subst">&#123;<span class="built_in">len</span>(embeddings)&#125;</span> ä¸ªå¥å­è¿›è¡Œäº† embeddingã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†embeddingæ·»åŠ åˆ°sentenceä¸­</span></span><br><span class="line"><span class="keyword">for</span> i, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(sentences):</span><br><span class="line">    sentence[<span class="string">&#x27;combined_sentence_embedding&#x27;</span>] = embeddings[i]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¥ä¸‹æ¥éœ€è¦æ ¹æ®ä½™å¼¦ç›¸ä¼¼åº¦è¿›è¡Œåˆ‡åˆ†</span></span><br><span class="line"><span class="string">é€šè¿‡è®¡ç®—ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ä½™å¼¦å€¼æ¥è¡¡é‡ç›¸ä¼¼æ€§</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cosine_similarity</span>(<span class="params">vec1, vec2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Calculate the cosine similarity between two vectors.&quot;&quot;&quot;</span></span><br><span class="line">    dot_product = np.dot(vec1, vec2)</span><br><span class="line">    norm_vec1 = np.linalg.norm(vec1)</span><br><span class="line">    norm_vec2 = np.linalg.norm(vec2)</span><br><span class="line">    <span class="keyword">return</span> dot_product / (norm_vec1 * norm_vec2)</span><br><span class="line"><span class="comment">#éå†ï¼Œè®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_cosine_distances</span>(<span class="params">sentences</span>):</span><br><span class="line">    distances = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sentences) - <span class="number">1</span>):</span><br><span class="line">        embedding_current = sentences[i][<span class="string">&#x27;combined_sentence_embedding&#x27;</span>]</span><br><span class="line">        embedding_next = sentences[i + <span class="number">1</span>][<span class="string">&#x27;combined_sentence_embedding&#x27;</span>]</span><br><span class="line">        <span class="comment"># Calculate cosine similarity</span></span><br><span class="line">        similarity = cosine_similarity(embedding_current, embedding_next)</span><br><span class="line">        <span class="comment"># Convert to cosine distance</span></span><br><span class="line">        distance = <span class="number">1</span> - similarity</span><br><span class="line">        distances.append(distance)</span><br><span class="line">        <span class="comment"># Store distance in the dictionary</span></span><br><span class="line">        sentences[i][<span class="string">&#x27;distance_to_next&#x27;</span>] = distance</span><br><span class="line">    <span class="keyword">return</span> distances, sentences</span><br><span class="line"></span><br><span class="line">distances, sentences = calculate_cosine_distances(sentences)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®é˜ˆå€¼åˆ’åˆ†</span></span><br><span class="line">breakpoint_percentile_threshold = <span class="number">95</span></span><br><span class="line">breakpoint_distance_threshold = np.percentile(distances, breakpoint_percentile_threshold)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è·ç¦»çš„ç¬¬95ä¸ªç™¾åˆ†ä½é˜ˆå€¼æ˜¯:&quot;</span>, breakpoint_distance_threshold)</span><br><span class="line"><span class="comment"># æ‰¾åˆ°æ‰€æœ‰è·ç¦»å¤§äºé˜ˆå€¼çš„ç‚¹çš„ç´¢å¼•ï¼Œè¿™äº›ç´¢å¼•å°±æ˜¯æˆ‘ä»¬çš„åˆ‡åˆ†ç‚¹</span></span><br><span class="line">indices_above_thresh = [i <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(distances) <span class="keyword">if</span> x &gt; breakpoint_distance_threshold]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å—çš„èµ·å§‹å¥å­ç´¢å¼•ã€‚æˆ‘ä»¬å°†æ ¹æ®ä¹‹å‰è®¡ç®—å‡ºçš„è¯­ä¹‰åˆ†å‰²ç‚¹ï¼ˆ`indices_above_thresh`ï¼‰æ¥åˆ‡åˆ†å¥å­åˆ—è¡¨ã€‚</span></span><br><span class="line">start_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æœ€ç»ˆç»„åˆæˆçš„ã€å…·æœ‰è¯­ä¹‰è¿è´¯æ€§çš„æ–‡æœ¬å—ã€‚</span></span><br><span class="line">chunks = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰è¯†åˆ«å‡ºçš„è¯­ä¹‰åˆ†å‰²ç‚¹ï¼ˆè¿™äº›æ˜¯å¥å­åˆ—è¡¨ `sentences` ä¸­çš„ç´¢å¼•ï¼‰ã€‚</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> indices_above_thresh:</span><br><span class="line">    <span class="comment"># ç¡®å®šå½“å‰æ–‡æœ¬å—çš„ç»“æŸç‚¹ï¼Œå³å½“å‰çš„åˆ†å‰²ç‚¹ç´¢å¼•ã€‚</span></span><br><span class="line">    end_index = index</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»åŸå§‹å¥å­åˆ—è¡¨ï¼ˆ`sentences`ï¼‰ä¸­åˆ‡ç‰‡ï¼Œæå–ä»ä¸Šä¸€ä¸ªåˆ†å‰²ç‚¹åˆ°å½“å‰åˆ†å‰²ç‚¹ä¹‹é—´çš„æ‰€æœ‰å¥å­ã€‚</span></span><br><span class="line">    <span class="comment"># `end_index + 1` æ˜¯ä¸ºäº†åœ¨åˆ‡ç‰‡æ—¶åŒ…å«ç»“æŸç´¢å¼•æŒ‡å‘çš„é‚£ä¸ªå¥å­ã€‚</span></span><br><span class="line">    group = sentences[start_index:end_index + <span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†åˆ‡åˆ†å‡ºçš„å¥å­ç»„ï¼ˆ`group`ï¼‰ä¸­çš„æ‰€æœ‰ &#x27;sentence&#x27; å­—æ®µçš„å€¼åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä¸²ï¼Œå¥å­ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚</span></span><br><span class="line">    combined_text = <span class="string">&#x27; &#x27;</span>.join([d[<span class="string">&#x27;sentence&#x27;</span>] <span class="keyword">for</span> d <span class="keyword">in</span> group])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†åˆå¹¶åçš„æ–‡æœ¬å—æ·»åŠ åˆ° `chunks` åˆ—è¡¨ä¸­ã€‚</span></span><br><span class="line">    chunks.append(combined_text)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ›´æ–°ä¸‹ä¸€ä¸ªæ–‡æœ¬å—çš„èµ·å§‹ç´¢å¼•ï¼Œè®¾ç½®ä¸ºå½“å‰åˆ†å‰²ç‚¹çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œä¸ºå¤„ç†ä¸‹ä¸€ä¸ªå—åšå‡†å¤‡ã€‚</span></span><br><span class="line">    start_index = index + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç†æœ€åä¸€ä¸ªæ–‡æœ¬å—ã€‚</span></span><br><span class="line"><span class="comment"># å¾ªç¯ç»“æŸåï¼Œå¦‚æœ `start_index` ä»ç„¶å°äºå¥å­æ€»æ•°ï¼Œè¯´æ˜ä»æœ€åä¸€ä¸ªåˆ†å‰²ç‚¹åˆ°æ–‡æœ¬æœ«å°¾è¿˜æœ‰å‰©ä½™çš„å¥å­ã€‚</span></span><br><span class="line"><span class="keyword">if</span> start_index &lt; <span class="built_in">len</span>(sentences):</span><br><span class="line">    <span class="comment"># å°†è¿™äº›å‰©ä½™çš„å¥å­åˆå¹¶æˆæœ€åä¸€ä¸ªæ–‡æœ¬å—ã€‚</span></span><br><span class="line">    combined_text = <span class="string">&#x27; &#x27;</span>.join([d[<span class="string">&#x27;sentence&#x27;</span>] <span class="keyword">for</span> d <span class="keyword">in</span> sentences[start_index:]])</span><br><span class="line">    chunks.append(combined_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ï¼Œ`chunks` åˆ—è¡¨åŒ…å«äº†æ‰€æœ‰æ ¹æ®è¯­ä¹‰è·ç¦»åˆ‡åˆ†å’Œé‡ç»„åçš„æ–‡æœ¬å—ã€‚</span></span><br><span class="line"><span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks):</span><br><span class="line">    buffer = <span class="number">200</span></span><br><span class="line">    <span class="built_in">print</span> (<span class="string">f&quot;Chunk #<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (chunk[:buffer].strip())</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (chunk[-buffer:].strip())</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://www.dailydoseofds.com/p/5-chunking-strategies-for-rag/">RAG çš„ 5 ç§åˆ†å—ç­–ç•¥ â€”- 5 Chunking Strategies For RAG</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wjinjie/article/details/148660229">ä¸€æ–‡è¯»æ‡‚ Qwen3 æœ€æ–°å¼€æºçš„ Embedding å’Œ Rerank æ¨¡å‹ä¼˜åŠ¿ï¼_qwen-rerank-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1dr421x7Su/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">ä¸€ç«™å¸®ä½ é€‰æ‹©RAGä¸­çš„æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/The_Thieves/article/details/148747334">LangChain è¯­ä¹‰æ–‡æœ¬æ‹†åˆ†æŒ‡å—ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„æ™ºèƒ½åˆ†å—æŠ€æœ¯å®æˆ˜_langchain è¯­ä¹‰åˆ†å‰²-CSDNåšå®¢</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/" class="post-title-link" itemprop="url">docker</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-08 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-08T00:00:00+08:00">2025-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-24 16:00:56" itemprop="dateModified" datetime="2025-07-24T16:00:56+08:00">2025-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="é•œåƒï¼ˆImageï¼‰"><a href="#é•œåƒï¼ˆImageï¼‰" class="headerlink" title="é•œåƒï¼ˆImageï¼‰"></a>é•œåƒï¼ˆImageï¼‰</h2><p>é•œåƒå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªè½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼ŒåŒ…å«äº†è¿è¡ŒæŸä¸ªåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰ä»£ç ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚å®ƒæ˜¯å®¹å™¨çš„<strong>é™æ€æ¨¡æ¿</strong>ï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶ç”¨ä½œåŸºç¡€ã€‚</p>
<p><strong>åªè¯»</strong>ï¼šé•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œæ— æ³•ä¿®æ”¹ã€‚</p>
<p><strong>å¯é‡ç”¨</strong>ï¼šé•œåƒæ˜¯å¯ä»¥å¤šæ¬¡é‡ç”¨çš„ï¼Œä½ å¯ä»¥åŸºäºç›¸åŒçš„é•œåƒåˆ›å»ºå¤šä¸ªå®¹å™¨ã€‚</p>
<h2 id="å®¹å™¨ï¼ˆContainerï¼‰"><a href="#å®¹å™¨ï¼ˆContainerï¼‰" class="headerlink" title="å®¹å™¨ï¼ˆContainerï¼‰"></a>å®¹å™¨ï¼ˆContainerï¼‰</h2><p>ä¸è™šæ‹Ÿæœºé€šè¿‡æ“ä½œç³»ç»Ÿå®ç°éš”ç¦»ä¸åŒï¼Œå®¹å™¨æŠ€æœ¯<strong>åªéš”ç¦»åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶ç¯å¢ƒä½†å®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿ</strong>ï¼Œè¿™é‡Œçš„è¿è¡Œæ—¶ç¯å¢ƒæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œä¾èµ–çš„å„ç§åº“ä»¥åŠé…ç½®ã€‚</p>
<p>å®¹å™¨æ›´åŠ çš„<strong>è½»é‡çº§ä¸”å ç”¨çš„èµ„æºæ›´å°‘</strong>ï¼Œä¸æ“ä½œç³»ç»ŸåŠ¨è¾„å‡ Gçš„å†…å­˜å ç”¨ç›¸æ¯”ï¼Œå®¹å™¨æŠ€æœ¯åªéœ€æ•°Mç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨åŒæ ·è§„æ ¼çš„ç¡¬ä»¶ä¸Š<strong>å¤§é‡éƒ¨ç½²å®¹å™¨</strong>ï¼Œè¿™æ˜¯è™šæ‹Ÿæœºæ‰€ä¸èƒ½æ¯”æ‹Ÿçš„ï¼Œè€Œä¸”ä¸åŒäºæ“ä½œç³»ç»Ÿæ•°åˆ†é’Ÿçš„å¯åŠ¨æ—¶é—´å®¹å™¨å‡ ä¹ç¬æ—¶å¯åŠ¨ï¼Œå®¹å™¨æŠ€æœ¯ä¸º<strong>æ‰“åŒ…æœåŠ¡æ ˆ</strong>æä¾›äº†ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ–¹å¼</p>
<h2 id="é•œåƒä¸å®¹å™¨çš„å…³ç³»"><a href="#é•œåƒä¸å®¹å™¨çš„å…³ç³»" class="headerlink" title="é•œåƒä¸å®¹å™¨çš„å…³ç³»"></a>é•œåƒä¸å®¹å™¨çš„å…³ç³»</h2><p><strong>é•œåƒæ˜¯é™æ€çš„</strong>ï¼šå®ƒåªåŒ…å«åº”ç”¨å’Œè¿è¡Œç¯å¢ƒï¼Œä¸èƒ½è¿›è¡Œä»»ä½•è¿è¡Œæ—¶çš„æ“ä½œã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯è½¯ä»¶çš„<strong>å®‰è£…åŒ…</strong>ã€‚</p>
<p><strong>å®¹å™¨æ˜¯åŠ¨æ€çš„</strong>ï¼šå®ƒæ˜¯åœ¨é•œåƒçš„åŸºç¡€ä¸Šåˆ›å»ºçš„ï¼Œå¯ä»¥è¿è¡Œã€æ‰§è¡Œä»£ç ã€ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯é•œåƒçš„<strong>è¿è¡Œå®ä¾‹</strong>ã€‚</p>
<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><p>dockerå°†ç¨‹åºä»¥åŠç¨‹åºæ‰€æœ‰çš„ä¾èµ–éƒ½æ‰“åŒ…åˆ°<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=129800958&amp;content_type=Article&amp;match_order=1&amp;q=docker+container&amp;zhida_source=entity">docker container</a>ï¼Œè¿™æ ·ä½ çš„ç¨‹åºå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒéƒ½ä¼šæœ‰ä¸€è‡´çš„è¡¨ç°</p>
<p>æ­¤å¤–dockerçš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯<strong>å¿«é€Ÿéƒ¨ç½²</strong>ï¼Œè¿™æ˜¯å½“å‰äº’è”ç½‘å…¬å¸æœ€å¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªåŸå› åœ¨äºå®¹å™¨å¯åŠ¨é€Ÿåº¦éå¸¸å¿«ï¼Œå¦ä¸€ä¸ªåŸå› åœ¨äºåªè¦ç¡®ä¿ä¸€ä¸ªå®¹å™¨ä¸­çš„ç¨‹åºæ­£ç¡®è¿è¡Œï¼Œé‚£ä¹ˆä½ å°±èƒ½ç¡®ä¿¡æ— è®ºåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤šå°‘éƒ½èƒ½æ­£ç¡®è¿è¡Œã€‚</p>
<p>æ¯ä¸€ç§å®¹å™¨éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿è¡Œç¯å¢ƒï¼Œå®¹å™¨ä¹‹é—´äº’ç›¸éš”ç¦»ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œdockerå°†ç¨‹åºæ‰“åŒ…éƒ¨ç½²ï¼Œæ–¹ä¾¿äº†è½¯ä»¶çš„éƒ¨ç½²ï¼Œé¿å…äº†ç¯å¢ƒå†²çªç­‰é—®é¢˜</p>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><p>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„å®¹å™¨ï¼‰ï¼š<code>docker ps -a</code></p>
<p>åœ¨Dockerä¸­è¿è¡Œå®¹å™¨ï¼š<code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p>
<ul>
<li>â€¢ <code>[OPTIONS]</code>ï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºé…ç½®å®¹å™¨çš„å„ç§é€‰é¡¹ï¼Œå¦‚ç«¯å£æ˜ å°„ã€å®¹å™¨åç§°ç­‰ã€‚</li>
<li>â€¢ <code>IMAGE</code>ï¼šè¦è¿è¡Œçš„é•œåƒåç§°æˆ–IDã€‚</li>
<li>â€¢ <code>[COMMAND] [ARG...]</code>ï¼šå¯é€‰çš„å‘½ä»¤å’Œå‚æ•°ï¼Œç”¨äºåœ¨å®¹å™¨å†…æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤ã€‚</li>
</ul>
<p>åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š<code>docker stop [OPTIONS] CONTAINER [CONTAINER...]</code></p>
<p>å¯åŠ¨å·²åœæ­¢çš„å®¹å™¨ï¼š<code>docker start [OPTIONS] CONTAINER [CONTAINER...]</code></p>
<p>åˆ é™¤å·²åœæ­¢çš„å®¹å™¨æˆ–é•œåƒï¼š<code>docker rm [OPTIONS] CONTAINER [CONTAINER...]   docker rmi [OPTIONS] IMAGE [IMAGE...]</code></p>
<ul>
<li>â€¢ <code>docker rm</code>ï¼šåˆ é™¤å®¹å™¨çš„å‘½ä»¤ã€‚</li>
<li>â€¢ <code>docker rmi</code>ï¼šåˆ é™¤é•œåƒçš„å‘½ä»¤ã€‚</li>
</ul>
<p>ä»Dockerä»“åº“ä¸­æ‹‰å–ç°æœ‰çš„é•œåƒï¼š<code>docker pull [OPTIONS] NAME[:TAG|@DIGEST]</code></p>
<ul>
<li>â€¢ <code>docker pull</code>ï¼šæ‹‰å–é•œåƒçš„å‘½ä»¤ã€‚</li>
<li>â€¢ <code>[OPTIONS]</code>ï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºé…ç½®æ‹‰å–è¿‡ç¨‹ï¼Œå¦‚è®¤è¯ä¿¡æ¯ç­‰ã€‚</li>
<li>â€¢ <code>NAME[:TAG|@DIGEST]</code>ï¼šè¦æ‹‰å–çš„é•œåƒåç§°ã€æ ‡ç­¾æˆ–æ‘˜è¦ã€‚</li>
</ul>
<h2 id="dockeréƒ¨åˆ†æŒ‡ä»¤"><a href="#dockeréƒ¨åˆ†æŒ‡ä»¤" class="headerlink" title="dockeréƒ¨åˆ†æŒ‡ä»¤"></a>dockeréƒ¨åˆ†æŒ‡ä»¤</h2><p><strong>linuxå®‰è£…docker</strong>ï¼š<code>sudo apt-get update &amp;&amp; sudo apt-get install docker.io</code></p>
<p><strong>æŸ¥çœ‹ Docker ç‰ˆæœ¬ä¿¡æ¯</strong>ï¼š<code>docker version</code></p>
<p><strong>æŸ¥çœ‹é•œåƒ</strong>ï¼š<code>docker images</code></p>
<p><strong>æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</strong>ï¼š<code>docker ps -a</code> </p>
<blockquote>
<p><code>systemctl</code> æ˜¯ <strong>systemd</strong> ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨çš„æ ¸å¿ƒå·¥å…·ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿå’ŒæœåŠ¡çš„çŠ¶æ€åŠé…ç½®ã€‚</p>
</blockquote>
<p><code>mysql-client</code> æ˜¯ MySQL æ•°æ®åº“çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·ã€‚å®ƒå…è®¸ä½ é€šè¿‡å‘½ä»¤è¡Œè¿æ¥å’Œæ“ä½œ MySQL æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ¯”å¦‚æ‰§è¡Œ SQL æŸ¥è¯¢ã€ç®¡ç†æ•°æ®åº“å’Œç”¨æˆ·ç­‰ã€‚</p>
<p>å¸¸ç”¨å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š<code>mysql -h ä¸»æœºåœ°å€ -P ç«¯å£å· -u ç”¨æˆ·å -p</code></p>
<p>ä½ å¯ä»¥åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥æ˜¯å¦å·²å®‰è£… <code>mysql-client</code>ï¼š<code>mysql --version</code></p>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š<code>sudo apt-get update  sudo apt-get install mysql-client</code></p>
<blockquote>
<p><code>sudo apt-get update</code> è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯<strong>æ›´æ–°æœ¬åœ°è½¯ä»¶åŒ…åˆ—è¡¨</strong>ã€‚</p>
</blockquote>
<p><strong>åœæ­¢å¹¶åˆ é™¤å®¹å™¨</strong>ï¼š<code>docker stop fastapi  docker rm fastapi</code></p>
<p><strong>Linuxä¿®æ”¹é•œåƒæº</strong>ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/couragehope/article/details/137777158">å¦‚ä½•æŸ¥çœ‹dockeré…ç½®çš„é•œåƒä»“åº“_æŸ¥çœ‹dockeré•œåƒåœ°å€-CSDNåšå®¢</a></p>
<h2 id="å¸¸è§å‚æ•°"><a href="#å¸¸è§å‚æ•°" class="headerlink" title="å¸¸è§å‚æ•°"></a>å¸¸è§å‚æ•°</h2><p>åŸºç¡€å‚æ•°ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>-d</code>æˆ–<code>--detach</code></th>
<th>åå°è¿è¡Œå®¹å™¨ï¼ˆdetached modeï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--name &lt;name&gt;</code></td>
<td>ä¸ºå®¹å™¨æŒ‡å®šåç§°ï¼ˆå¦‚<code>--name my_container</code>ï¼‰</td>
</tr>
<tr>
<td><code>--rm</code></td>
<td>å®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤ï¼ˆé€‚ç”¨äºä¸´æ—¶å®¹å™¨ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>ç«¯å£æ˜ å°„ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>-p &lt;ä¸»æœºç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt;</code></th>
<th>æ˜ å°„ä¸»æœºç«¯å£åˆ°å®¹å™¨ç«¯å£ï¼ˆå¦‚<code>-p 80:80</code>ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-p &lt;ä¸»æœºIP&gt;:&lt;ä¸»æœºç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt;</code></td>
<td>æŒ‡å®šä¸»æœºIPç»‘å®šï¼ˆå¦‚<code>-p 127.0.0.1:8080:80</code>ï¼‰</td>
</tr>
<tr>
<td><code>-P</code>æˆ–<code>--publish-all</code></td>
<td>è‡ªåŠ¨æ˜ å°„æ‰€æœ‰æš´éœ²çš„ç«¯å£ï¼ˆéšæœºåˆ†é…ä¸»æœºç«¯å£ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>å·æŒ‚è½½ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>-v &lt;ä¸»æœºè·¯å¾„&gt;:&lt;å®¹å™¨è·¯å¾„&gt;</code></th>
<th>æŒ‚è½½ä¸»æœºç›®å½•åˆ°å®¹å™¨ï¼ˆå¦‚<code>-v //app</code>ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-v &lt;å·å&gt;:&lt;å®¹å™¨è·¯å¾„&gt;</code></td>
<td>ä½¿ç”¨å‘½åå·ï¼ˆå¦‚<code>-v my_volume:/data</code>ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>ç¯å¢ƒå˜é‡ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>-e &lt;KEY=VALUE&gt;</code></th>
<th>è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚<code>-e DEBUG=true</code>ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--env-file &lt;æ–‡ä»¶å&gt;</code></td>
<td>ä»æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆæ¯è¡Œ<code>KEY=VALUE</code>ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<p>ç½‘ç»œé…ç½®ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><code>--network &lt;ç½‘ç»œå&gt;</code></th>
<th>æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œï¼ˆå¦‚<code>--network bridge</code>æˆ–è‡ªå®šä¹‰ç½‘ç»œï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--network host</code></td>
<td>ä½¿ç”¨ä¸»æœºç½‘ç»œï¼ˆå…±äº«ä¸»æœºç½‘ç»œå‘½åç©ºé—´ï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h2 id="æ‹¯æ•‘è¢«wslå ç”¨çš„å†…å­˜"><a href="#æ‹¯æ•‘è¢«wslå ç”¨çš„å†…å­˜" class="headerlink" title="æ‹¯æ•‘è¢«wslå ç”¨çš„å†…å­˜"></a>æ‹¯æ•‘è¢«wslå ç”¨çš„å†…å­˜</h2><p>ä»¥ç¬”è€…çš„æƒ…å†µæ¥è¯´ï¼Œæˆ‘çš„wslä¸­åªæœ‰ä¸€äº›å¿…å¤‡çš„å¼€å‘ç¯å¢ƒï¼Œé¡¹ç›®æºä»£ç  å’Œ dockerã€‚å‰ä¸¤è€…æ˜¾ç„¶æ²¡å•¥å¯æ“ä½œçš„ç©ºé—´ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªé¶å­ â€”â€” dockerã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥wslï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œçœ‹çœ‹ Docker çš„ç£ç›˜ä½¿ç”¨æƒ…å†µå’Œèµ„æºæ€»é‡ã€‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system df </span><br></pre></td></tr></table></figure>
<p>å¤§å®¶éƒ½çŸ¥é“ï¼Œdockerè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€äº›æ— ç”¨çš„é•œåƒæ–‡ä»¶ã€‚è¦æ¸…ç†æ— ç”¨çš„ Docker é•œåƒï¼Œåˆ™å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image prune </span><br></pre></td></tr></table></figure>
<p>è¯¥å‘½ä»¤å¯ä»¥åˆ é™¤æ‰€æœ‰æœªè¢«ä»»ä½•å®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚å¦‚æœæƒ³æ¸…ç†æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨å’Œæœªä½¿ç”¨çš„é•œåƒï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune -a</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œå®Œåå’±ä»¬å¯ä»¥å†è¿è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œå¤§æ¦‚ç‡èƒ½çœ‹åˆ°é‡Šæ”¾äº†ä¸€éƒ¨åˆ†ç£ç›˜ç©ºé—´ã€‚å¦‚æœç¡®å®é•¿æ—¶é—´ä¸ºæ¸…ç†è¿‡ï¼Œå¾ˆå¤§å¯èƒ½å¯é‡Šæ”¾å‡ åGã€‚</p>
<p>ç„¶è€Œè¿™æ—¶å€™æˆ‘ä»¬é€€å‡ºwslå›åˆ°win10, ä½ å¯èƒ½ä¼šçœ‹åˆ°ç£ç›˜ç©ºé—´å‡ ä¹æ²¡å•¥å˜åŒ–ã€‚è¿™æ˜¯å› ä¸ºwslè¿˜éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é‡Šæ”¾è¿™éƒ¨åˆ†ç©ºé—´ï¼Œå³å‹ç¼©ç£ç›˜ã€‚</p>
<h2 id="ä¿®æ”¹dockerå­˜å‚¨é•œåƒä½ç½®"><a href="#ä¿®æ”¹dockerå­˜å‚¨é•œåƒä½ç½®" class="headerlink" title="ä¿®æ”¹dockerå­˜å‚¨é•œåƒä½ç½®"></a>ä¿®æ”¹dockerå­˜å‚¨é•œåƒä½ç½®</h2><p>windows</p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/image-20250709095041821.png" alt="image-20250709095041821"></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/image-20250709092539404.png" alt="image-20250709092539404"></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/image-20250709092605183.png" alt="image-20250709092605183"></p>
<p>Linux</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43412762/article/details/134571411">ä¿®æ”¹Dockeré»˜è®¤é•œåƒå’Œå®¹å™¨å­˜å‚¨ä½ç½®ï¼ˆè¶…è¯¦ç»†ï¼ï¼ï¼ï¼‰_dockeræ›´æ”¹å­˜å‚¨ä½ç½®-CSDNåšå®¢</a></p>
<h2 id="ä¿®æ”¹é•œåƒæº"><a href="#ä¿®æ”¹é•œåƒæº" class="headerlink" title="ä¿®æ”¹é•œåƒæº"></a>ä¿®æ”¹é•œåƒæº</h2><p>æŸ¥çœ‹å¯ç”¨çš„é•œåƒæº<a target="_blank" rel="noopener" href="https://tools.opsnote.top/registry-mirrors/">DockerHubåŠ é€Ÿå™¨å¯ç”¨æ€§ç›‘æ§</a></p>
<h3 id="å¦‚ä½•ä½¿ç”¨vscodeè¿›å…¥è¿œç¨‹æœåŠ¡å™¨çš„dockerå®¹å™¨å†…éƒ¨è°ƒè¯•ä»£ç "><a href="#å¦‚ä½•ä½¿ç”¨vscodeè¿›å…¥è¿œç¨‹æœåŠ¡å™¨çš„dockerå®¹å™¨å†…éƒ¨è°ƒè¯•ä»£ç " class="headerlink" title="å¦‚ä½•ä½¿ç”¨vscodeè¿›å…¥è¿œç¨‹æœåŠ¡å™¨çš„dockerå®¹å™¨å†…éƒ¨è°ƒè¯•ä»£ç "></a>å¦‚ä½•ä½¿ç”¨vscodeè¿›å…¥è¿œç¨‹æœåŠ¡å™¨çš„dockerå®¹å™¨å†…éƒ¨è°ƒè¯•ä»£ç </h3><p>å®‰è£…ä¸€ä¸‹æ’ä»¶</p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/9a3be11a07b5a0866d09d1bcbbaae4dc.png" alt="9a3be11a07b5a0866d09d1bcbbaae4dc"></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/docker/image-20250716165555700.png" alt="image-20250716165555700"></p>
<h2 id="buildï¼Œpullä¸run"><a href="#buildï¼Œpullä¸run" class="headerlink" title="buildï¼Œpullä¸run"></a>buildï¼Œpullä¸run</h2><p><strong><code>docker build</code>ï¼šä»æºä»£ç æ„å»ºé•œåƒ</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ ¹æ®ä½ æä¾›çš„ <code>Dockerfile</code>ï¼ˆä¸€ä¸ªåŒ…å«æ„å»ºé•œåƒæ‰€éœ€æŒ‡ä»¤çš„æ–‡æœ¬æ–‡ä»¶ï¼‰ä»¥åŠä¸Šä¸‹æ–‡ï¼ˆé€šå¸¸æ˜¯åŒ…å« <code>Dockerfile</code> çš„ç›®å½•åŠå…¶å­ç›®å½•ï¼‰ï¼Œ<strong>åˆ›å»º</strong>ä¸€ä¸ªæ–°çš„ Docker é•œåƒã€‚</li>
</ul>
<p><strong><code>docker pull</code>ï¼šä»æ³¨å†Œä¸­å¿ƒä¸‹è½½é•œåƒ</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä» Docker æ³¨å†Œä¸­å¿ƒï¼ˆé»˜è®¤æ˜¯ Docker Hubï¼Œä¹Ÿå¯ä»¥æ˜¯ç§æœ‰æ³¨å†Œä¸­å¿ƒå¦‚ Harbor, GitLab Registry, AWS ECR ç­‰ï¼‰<strong>ä¸‹è½½</strong>ä¸€ä¸ªå·²ç»æ„å»ºå¥½çš„ Docker é•œåƒåˆ°ä½ çš„æœ¬åœ°æœºå™¨ã€‚</li>
</ul>
<p><strong><code>docker run</code>ï¼šåˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šåŸºäºä¸€ä¸ª<strong>æœ¬åœ°å·²æœ‰çš„é•œåƒ</strong>ï¼ˆæ— è®ºè¿™ä¸ªé•œåƒæ˜¯ä½ åˆš <code>build</code> å‡ºæ¥çš„ï¼Œè¿˜æ˜¯ <code>pull</code> ä¸‹æ¥çš„ï¼Œæˆ–æ˜¯ä¹‹å‰å°±å­˜åœ¨çš„ï¼‰ï¼Œ<strong>åˆ›å»º</strong>ä¸€ä¸ªæ–°çš„å®¹å™¨å®ä¾‹ï¼Œå¹¶æŒ‰ç…§æŒ‡å®šçš„å‘½ä»¤ï¼ˆæˆ–é•œåƒé»˜è®¤çš„å‘½ä»¤ï¼‰<strong>å¯åŠ¨</strong>å®ƒã€‚</li>
</ul>
<h2 id="dockerçš„è‡ªå®šä¹‰ç½‘ç»œ"><a href="#dockerçš„è‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="dockerçš„è‡ªå®šä¹‰ç½‘ç»œ"></a>dockerçš„è‡ªå®šä¹‰ç½‘ç»œ</h2><p>åˆ›å»ºè‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create mynet</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨æœåŠ¡å®¹å™¨ï¼ˆä¸æ˜ å°„å®¿ä¸»æœºç«¯å£ä¹Ÿèƒ½è¢«åŒç½‘ç»œå®¹å™¨è®¿é—®ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name api --network demo-net fastapi-svc</span><br></pre></td></tr></table></figure>
<p>åˆ—å‡ºæ‰€æœ‰ç½‘ç»œï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç½‘ç»œï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line"></span><br><span class="line">#åªåˆ—å‡ºè‡ªå®šä¹‰ç½‘ç»œï¼ˆè¿‡æ»¤æ‰é»˜è®¤ç½‘ç»œï¼‰</span><br><span class="line">docker network ls --filter type=custom</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æŸä¸ªè‡ªå®šä¹‰ç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect network_test </span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ai421S7zj/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">æ”¹å˜è½¯ä»¶è¡Œä¸šçš„æŠ€æœ¯ï¼ç¨‹åºå‘˜ã€è½¯ä»¶çˆ±å¥½è€…å¿…é¡»æŒæ¡çš„Dockerï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/187505981">ä»€ä¹ˆæ˜¯Dockerï¼Ÿçœ‹è¿™ä¸€ç¯‡å¹²è´§æ–‡ç« å°±å¤Ÿäº†ï¼ - çŸ¥ä¹</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Python_0011/article/details/140313812">Dockerå¸¸ç”¨å‘½ä»¤å¤§å…¨ï¼ˆéå¸¸è¯¦ç»†ï¼‰é›¶åŸºç¡€å…¥é—¨åˆ°ç²¾é€šï¼Œæ”¶è—è¿™ä¸€ç¯‡å°±å¤Ÿäº†-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1THKyzBER6/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">40åˆ†é’Ÿçš„Dockerå®æˆ˜æ”»ç•¥ï¼Œä¸€æœŸè§†é¢‘ç²¾é€šDocker_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/" class="post-title-link" itemprop="url">MinerU</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-08 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-08T00:00:00+08:00">2025-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-06 11:04:39" itemprop="dateModified" datetime="2025-08-06T11:04:39+08:00">2025-08-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="dockeréƒ¨ç½²"><a href="#dockeréƒ¨ç½²" class="headerlink" title="dockeréƒ¨ç½²"></a>dockeréƒ¨ç½²</h3><p>ä½¿ç”¨dockerfileæ„å»ºé•œåƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://gcore.jsdelivr.net/gh/opendatalab/MinerU@master/docker/china/Dockerfile</span><br><span class="line">docker build -t mineru-sglang:latest -f Dockerfile .</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>wget https://gcore.jsdelivr.net/gh/opendatalab/MinerU @master/docker/china/Dockerfile -O Dockerfile</code>å°†æŒ‡å®šçš„ Dockerfile ä¸‹è½½åˆ°æœ¬åœ°</p>
<p>Dockerfileï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># ä½¿ç”¨å®˜æ–¹çš„ sglang é•œåƒä½œä¸ºåŸºç¡€é•œåƒ</span><br><span class="line">FROM lmsysorg/sglang:v0.4.9-cu126</span><br><span class="line"></span><br><span class="line"># å®‰è£… OpenCV ä¾èµ–åº“</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y libgl1 &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line"># å®‰è£… mineru Python åŒ…</span><br><span class="line">RUN python3 -m pip install -U &#x27;mineru[core]&#x27; -i https://mirrors.aliyun.com/pypi/simple --break-system-packages</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½æ¨¡å‹å¹¶é…ç½®</span><br><span class="line">RUN /bin/bash -c &quot;mineru-models-download -s modelscope -m all&quot;</span><br><span class="line"></span><br><span class="line"># è®¾ç½®å®¹å™¨å…¥å£å‘½ä»¤</span><br><span class="line">ENTRYPOINT [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;export MINERU_MODEL_SOURCE=local &amp;&amp; exec \&quot;$@\&quot;&quot;, &quot;--&quot;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SGLangï¼ˆå…¨ç§°å¯èƒ½ä¸º <strong>Serving Large Language Models with Golang</strong> ï¼‰æ˜¯ç”±æ–¯å¦ç¦å¤§å­¦ç ”ç©¶å›¢é˜Ÿå¼€å‘çš„ä¸€ä¸ª<strong>é«˜æ•ˆçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ¨ç†æœåŠ¡æ¡†æ¶</strong> ï¼Œæ—¨åœ¨é€šè¿‡ä¼˜åŒ–æ¨¡å‹æ¨ç†è¿‡ç¨‹ï¼Œæ˜¾è‘—æå‡ç”Ÿæˆå¼AIæœåŠ¡çš„ååé‡å’Œå“åº”é€Ÿåº¦ã€‚</p>
<ul>
<li><strong>SGlang ç‰ˆæœ¬</strong> ï¼š<code>v0.4.8.post1</code>ï¼ˆSGlang æ˜¯ä¸€ä¸ªç”¨äºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ¨ç†å’ŒæœåŠ¡çš„é«˜æ€§èƒ½æ¡†æ¶ï¼‰ã€‚</li>
<li><strong>CUDA ç‰ˆæœ¬</strong> ï¼š<code>cu126</code> è¡¨ç¤ºä½¿ç”¨ <strong>CUDA 12.6</strong> ï¼Œé€‚ç”¨äº <strong>Turing/Ampere/Ada Lovelace/Hopper æ¶æ„çš„ GPU</strong> ï¼ˆå¦‚ RTX 30/40 ç³»åˆ—ã€A100ã€H100ï¼‰ã€‚</li>
</ul>
</blockquote>
<h4 id="æŠ¥é”™æ’æŸ¥"><a href="#æŠ¥é”™æ’æŸ¥" class="headerlink" title="æŠ¥é”™æ’æŸ¥"></a>æŠ¥é”™æ’æŸ¥</h4><p>ä¹‹å‰ç”±äºé»˜è®¤dockerfileå†…å®¹ä¸º<code>FROM lmsysorg/sglang:v0.4.8.post1-cu126</code>æŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lmsysorg/sglang:v0.4.8.post1-cu126: failed to resolve source metadata for docker.io/lmsysorg/sglang:v0.4.8.post1-cu126: unexpected status from HEAD request to https://yaj2teeh.mirror.aliyuncs.com/v2/lmsysorg/sglang/manifests/v0.4.8.post1-cu126?ns=docker.io: 403 Forbidden</span><br></pre></td></tr></table></figure>
<p>ä¹‹å‰ä»¥ä¸ºæ˜¯sglangç‰ˆæœ¬é—®é¢˜ï¼Œç„¶åå»dockerhubä¸ŠæŸ¥æ‰¾ï¼Œå¹¶é€šè¿‡<code>docker pull sglang:v0.4.8.post1-cu126</code>æµ‹è¯•ï¼Œæ˜¯å¯ä»¥æ‹‰å–çš„ï¼Œæœ€åè®¤ä¸ºåŸå› è¿˜æ˜¯ç½‘ç»œé—®é¢˜</p>
<p>è§£å†³æ–¹æ³•ï¼Œæ›´æ¢äº†é•œåƒæº</p>
<h4 id="é•œåƒæºé…ç½®"><a href="#é•œåƒæºé…ç½®" class="headerlink" title="é•œåƒæºé…ç½®"></a>é•œåƒæºé…ç½®</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;registry-mirrors&quot;: [</span><br><span class="line">  &quot;https://registry.docker-cn.com&quot;,</span><br><span class="line">  &quot;http://hub-mirror.c.163.com&quot;,</span><br><span class="line">  &quot;https://dockerhub.azk8s.cn&quot;,</span><br><span class="line">  &quot;https://mirror.ccs.tencentyun.com&quot;,</span><br><span class="line">  &quot;https://registry.cn-hangzhou.aliyuncs.com&quot;,</span><br><span class="line">  &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="line">  &quot;https://docker.m.daocloud.io&quot;,  </span><br><span class="line">  &quot;https://noohub.ru&quot;, </span><br><span class="line">  &quot;https://huecker.io&quot;,</span><br><span class="line">  &quot;https://dockerhub.timeweb.cloud&quot; </span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1xHA3euEcn/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">ä¿å§†çº§Dockerå®‰è£…+é•œåƒåŠ é€Ÿ è®¡ç®—æœºç³»å¿…å¤‡æŠ€èƒ½_å“”å“©å“”å“©_bilibili</a></p>
<h4 id="ä¸ºä»€ä¹ˆè¦æŒ‡å®šåŸºç¡€é•œåƒ"><a href="#ä¸ºä»€ä¹ˆè¦æŒ‡å®šåŸºç¡€é•œåƒ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æŒ‡å®šåŸºç¡€é•œåƒ"></a>ä¸ºä»€ä¹ˆè¦æŒ‡å®šåŸºç¡€é•œåƒ</h4><ul>
<li><strong>æä¾›æ“ä½œç³»ç»Ÿå’Œä¾èµ–</strong><br>åŸºç¡€é•œåƒåŒ…å«æ“ä½œç³»ç»Ÿï¼ˆå¦‚ Ubuntuã€Alpineï¼‰ã€è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå¦‚ Pythonã€Node.jsï¼‰æˆ–æ¡†æ¶ï¼ˆå¦‚ TensorFlowã€PyTorchï¼‰ç­‰æ ¸å¿ƒç»„ä»¶ï¼Œåç»­æ‰€æœ‰æ“ä½œï¼ˆå¦‚å®‰è£…ä¾èµ–ã€æ‹·è´æ–‡ä»¶ï¼‰éƒ½åŸºäºæ­¤ç¯å¢ƒã€‚<ul>
<li>ä¾‹å¦‚ï¼š<code>FROM python:3.9</code> æä¾›äº† Python 3.9 çš„è¿è¡Œç¯å¢ƒï¼Œåç»­å¯ä»¥ç›´æ¥ç”¨ <code>pip install</code> å®‰è£… Python åŒ…ã€‚</li>
</ul>
</li>
<li><strong>é¿å…é‡å¤é€ è½®å­</strong><br>å¦‚æœç›´æ¥ä»ç©ºé•œåƒï¼ˆ<code>scratch</code>ï¼‰å¼€å§‹ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œæ•ˆç‡ä½ä¸‹ä¸”å®¹æ˜“å‡ºé”™ã€‚ä½¿ç”¨ç°æœ‰åŸºç¡€é•œåƒå¯ä»¥å¤ç”¨å·²éªŒè¯çš„ç¯å¢ƒé…ç½®ã€‚</li>
</ul>
<h4 id="ç¡®è®¤æ”¯æŒçš„cudaç‰ˆæœ¬"><a href="#ç¡®è®¤æ”¯æŒçš„cudaç‰ˆæœ¬" class="headerlink" title="ç¡®è®¤æ”¯æŒçš„cudaç‰ˆæœ¬"></a>ç¡®è®¤æ”¯æŒçš„cudaç‰ˆæœ¬</h4><p>å‘½ä»¤<code>nvidia-smi</code></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250708160948192.png" alt="image-20250708160948192"></p>
<p><strong>CUDA Version</strong> æ˜¾ç¤ºå½“å‰é©±åŠ¨æ”¯æŒçš„æœ€é«˜ CUDA ç‰ˆæœ¬</p>
<h4 id="é—®é¢˜ï¼šä½¿ç”¨dockerfileç›´æ¥éƒ¨ç½²ï¼Œå§‹ç»ˆå‡ºç°ç½‘ç»œé—®é¢˜"><a href="#é—®é¢˜ï¼šä½¿ç”¨dockerfileç›´æ¥éƒ¨ç½²ï¼Œå§‹ç»ˆå‡ºç°ç½‘ç»œé—®é¢˜" class="headerlink" title="é—®é¢˜ï¼šä½¿ç”¨dockerfileç›´æ¥éƒ¨ç½²ï¼Œå§‹ç»ˆå‡ºç°ç½‘ç»œé—®é¢˜"></a>é—®é¢˜ï¼šä½¿ç”¨dockerfileç›´æ¥éƒ¨ç½²ï¼Œå§‹ç»ˆå‡ºç°ç½‘ç»œé—®é¢˜</h4><p>è§£å†³æ–¹æ¡ˆ</p>
<p>å…ˆä¿®æ”¹äº†ä¸€ä¸‹dockerå‚¨å­˜é•œåƒçš„ä½ç½®ï¼Œå¤ªå¤§äº†</p>
<p>å…ˆæ‹‰å–åŸºç¡€é•œåƒ<code>docker pull lmsysorg/sglang:v0.4.8.post1-cu126</code></p>
<p>å†ä½¿ç”¨<code>docker build -t mineru-sglang:latest -f Dockerfile .</code>ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡åŸºç¡€é•œåƒçš„æ‹‰å–</p>
<h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>å®˜æ–¹å¯åŠ¨å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name sglang-server \          # å®¹å™¨å‘½åï¼ˆä¾¿äºç®¡ç†ï¼‰</span><br><span class="line">  --gpus all \                   # å¯ç”¨æ‰€æœ‰GPU</span><br><span class="line">  --shm-size 32g \               # å…±äº«å†…å­˜å¤§å°</span><br><span class="line">  -p 30000:30000 \               # ç«¯å£æ˜ å°„ï¼ˆä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ï¼‰</span><br><span class="line">  --ipc=host \                   # å…±äº«ä¸»æœºIPCå‘½åç©ºé—´</span><br><span class="line">  mineru-sglang:latest \</span><br><span class="line">  mineru-sglang-server --host 0.0.0.0 --port 30000</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name sglang-server --gpus all --shm-size 32g -p 30000:30000 --ipc=host mineru-sglang:latest mineru-sglang-server --host 0.0.0.0 --port 30000</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å°†mineru-sglang-serveræš´éœ²åˆ°30000ç«¯å£çš„ä½œç”¨</p>
<p>ä¸ºäº†æ”¯æŒ vlm-sglang-client åç«¯æ¨¡å¼ï¼Œä½¿å¾—MinerUå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ç½‘ç»œè¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ï¼Œå®ç°å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶è¿æ¥åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨</p>
</blockquote>
<p>ä½¿ç”¨<code>docker exec -it sglang-server bash</code>å‘½ä»¤è¿›å…¥å®¹å™¨</p>
<p>æˆ–</p>
<p>ä½¿ç”¨docker desk</p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250709152627120.png" alt="image-20250709152627120"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mineru-server --gpus all --shm-size 32g -p 30000:30000 -p 7860:7860 -p 8000:8000 --ipc=host \</span><br><span class="line">-v &quot;F:/project python/å®ä¹ /mineru/demo/pdfs:/pdfs&quot; \</span><br><span class="line">-v &quot;F:/project python/å®ä¹ /mineru/output:/output&quot; \</span><br><span class="line">mineru-sglang:latest \</span><br><span class="line">mineru-sglang-server --host 0.0.0.0 --port 30000</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æŒ‚è½½å·å¯åŠ¨</p>
<ul>
<li>å°†æœ¬åœ°çš„PDFæ–‡ä»¶ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /pdfs ç›®å½•</li>
<li>å°†æœ¬åœ°çš„è¾“å‡ºç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /output ç›®å½•</li>
<li>æŠŠ8000ï¼Œå’Œ7860ç«¯å£æš´éœ²ï¼Œæ–¹ä¾¿è°ƒç”¨fastapiä¸gradio webui å¯è§†åŒ–</li>
</ul>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250710100047464.png" alt="image-20250710100047464"></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250710103505453.png" alt="image-20250710103505453"></p>
<h3 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h3><h4 id="å‘½ä»¤è¡Œè°ƒç”¨sglang-server-client-æ¨¡å¼"><a href="#å‘½ä»¤è¡Œè°ƒç”¨sglang-server-client-æ¨¡å¼" class="headerlink" title="å‘½ä»¤è¡Œè°ƒç”¨sglang-server/client æ¨¡å¼"></a>å‘½ä»¤è¡Œè°ƒç”¨sglang-server/client æ¨¡å¼</h4><p><code>docker exec mineru-server mineru -p /pdfs/demo1.pdf -o /output -b vlm-sglang-client -u http://localhost:30000</code></p>
<p>è¿™æ¡å‘½ä»¤åœ¨åä¸º mineru-server çš„å®¹å™¨å†…æ‰§è¡Œ mineru å·¥å…·ï¼Œå¤„ç† /pdfs ç›®å½•ä¸‹çš„ demo1.pdf æ–‡ä»¶ï¼Œè¾“å‡ºç»“æœåˆ° /output ç›®å½•ï¼Œä½¿ç”¨ vlm-sglang-client åç«¯ï¼Œå¹¶è¿æ¥åˆ° <a target="_blank" rel="noopener" href="http://localhost:30000">http://localhost:30000</a> çš„SGLangæœåŠ¡å™¨ã€‚</p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250710103615272.png" alt="image-20250710103615272"></p>
<h4 id="fastapiè°ƒç”¨ä¸gradio-webui-å¯è§†åŒ–"><a href="#fastapiè°ƒç”¨ä¸gradio-webui-å¯è§†åŒ–" class="headerlink" title="fastapiè°ƒç”¨ä¸gradio webui å¯è§†åŒ–"></a>fastapiè°ƒç”¨ä¸gradio webui å¯è§†åŒ–</h4><p>åœ¨å®Œæˆdockerçš„ç«¯å£æ˜ å°„ä¹‹åï¼Œè¿è¡Œ<code>mineru-api --host 0.0.0.0 --port 8080</code>å¯åŠ¨fastapiæœåŠ¡ï¼Œ</p>
<blockquote>
<p>FastAPIæœåŠ¡çš„ä½¿ç”¨åœºæ™¯</p>
<p>FastAPIæœåŠ¡æä¾›äº†ä¸€ä¸ª<code>/file_parse</code>ç«¯ç‚¹ï¼Œç”¨äºå¤„ç†PDFå’Œå›¾åƒæ–‡ä»¶çš„è§£æè¯·æ±‚</p>
<p>å¾®æœåŠ¡æ¶æ„éƒ¨ç½²ï¼ŒFastAPIæœåŠ¡å¯ä»¥ç‹¬ç«‹éƒ¨ç½²</p>
<p>æœåŠ¡æä¾›äº†æ ‡å‡†çš„HTTP APIæ¥å£ï¼Œå…è®¸å®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œè¯·æ±‚è¿›è¡Œæ–‡æ¡£è§£æ</p>
</blockquote>
<p>è¿è¡Œ<code>mineru-gradio --server-name 0.0.0.0 --server-port 7860</code>å¯åŠ¨gradio webuiæœåŠ¡</p>
<p>æˆ–<code>mineru-gradio --server-name 0.0.0.0 --server-port 7860 --enable-sglang-engine true</code></p>
<blockquote>
<p>æ³¨æ„ï¼Œæ¨¡å‹ä¸‹è½½éœ€è¦é…ç½®ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨å®¹å™¨å†…è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">export MINERU_MODEL_SOURCE=local</span><br><span class="line"># éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®æˆåŠŸ</span><br><span class="line">echo $MINERU_MODEL_SOURCE</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/115678648318f55f1fe3a5baaeac2aaf.png" alt="115678648318f55f1fe3a5baaeac2aaf"></p>
<p><strong>åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å…³äºç«¯å£çš„é—®é¢˜ä¸æ€è€ƒ</strong></p>
<p>è°ƒç”¨è¿‡ç¨‹ä¸­å‘ç°ï¼Œåœ¨å®¹å™¨ä¸­ä½¿ç”¨<code>mineru-api --host 127.0.0.1 --port 8000</code>ï¼Œå®¿ä¸»æœºæ— æ³•è®¿é—®<code>http://127.0.0.1:8000/docs/</code>ï¼Œç»è¿‡æŸ¥è¯¢aiï¼Œå‘½ä»¤æ”¹ä¸º<code>mineru-api --host 0.0.0.0 --port 8000</code>å°±å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œé‚£ä¹ˆå…³é”®åœ¨äºå¯¹è¿™ä¸¤ä¸ªåœ°å€çš„ç†è§£</p>
<blockquote>
<p>æŸ¥çœ‹ç«¯å£<code>netstat -ano | findstr LISTENING</code></p>
</blockquote>
<p>127.0.0.1ä¸0.0.0.0</p>
<ul>
<li>127.0.0.1 (localhost) ï¼šä»…è¡¨ç¤ºæœ¬æœºå›ç¯åœ°å€ï¼Œåªèƒ½åœ¨ åŒä¸€è®¾å¤‡å†… è®¿é—®</li>
<li>0.0.0.0 ï¼šè¡¨ç¤ºç›‘å¬æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œå…è®¸ æ¥è‡ªä»»ä½•åœ°å€ çš„è¿æ¥</li>
</ul>
<p>å½“æ‚¨åœ¨Dockerå®¹å™¨å†…è¿è¡ŒæœåŠ¡æ—¶ï¼š</p>
<ol>
<li><p>ä½¿ç”¨127.0.0.1ä½œä¸ºç»‘å®šåœ°å€ ï¼š</p>
<ul>
<li>æœåŠ¡åªæ¥å—æ¥è‡ªå®¹å™¨å†…éƒ¨çš„è¿æ¥</li>
<li>å³ä½¿æ‚¨æ˜ å°„äº†ç«¯å£ï¼Œå®¿ä¸»æœºä¹Ÿæ— æ³•è®¿é—®è¯¥æœåŠ¡</li>
<li>åªæœ‰å®¹å™¨å†…çš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ 127.0.0.1:ç«¯å£ è®¿é—®</li>
</ul>
</li>
<li><p>ä½¿ç”¨0.0.0.0ä½œä¸ºç»‘å®šåœ°å€ ï¼š</p>
<ul>
<li>æœåŠ¡æ¥å—æ¥è‡ªä»»ä½•ç½‘ç»œæ¥å£çš„è¿æ¥è¯·æ±‚</li>
<li>å…è®¸ä»å®¹å™¨å¤–éƒ¨ï¼ˆåŒ…æ‹¬å®¿ä¸»æœºï¼‰è®¿é—®è¯¥æœåŠ¡</li>
<li>å½“æ‚¨æ˜ å°„ç«¯å£æ—¶ï¼ˆå¦‚ -p 8000:8000 ï¼‰ï¼Œå®¿ä¸»æœºå¯ä»¥é€šè¿‡ localhost:8000 æˆ– 127.0.0.1:8000 è®¿é—®</li>
</ul>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åœ¨å®¹å™¨å†…ä½¿ç”¨0.0.0.0</strong></p>
<p>åœ¨Dockerç¯å¢ƒä¸­ï¼Œå®¹å™¨æœ‰è‡ªå·±ç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œè¿™æ„å‘³ç€å®¹å™¨å†…çš„ 127.0.0.1 ä¸å®¿ä¸»æœºçš„ 127.0.0.1 æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªç¯å¢ƒã€‚å› æ­¤ï¼š</p>
<ul>
<li>å½“æ‚¨åœ¨å®¹å™¨å†…ä½¿ç”¨ â€”host 0.0.0.0 å¯åŠ¨æœåŠ¡æ—¶ï¼Œè¯¥æœåŠ¡ä¼šç›‘å¬å®¹å™¨çš„æ‰€æœ‰ç½‘ç»œæ¥å£</li>
<li>å½“æ‚¨åœ¨å®¿ä¸»æœºä¸Šè®¿é—® 127.0.0.1:æ˜ å°„ç«¯å£ æ—¶ï¼ŒDockerä¼šå°†è¯·æ±‚è½¬å‘åˆ°å®¹å™¨å†…ç›‘å¬åœ¨ 0.0.0.0:å®¹å™¨ç«¯å£ çš„æœåŠ¡</li>
</ul>
<h3 id="mineruç›¸å…³çŸ¥è¯†"><a href="#mineruç›¸å…³çŸ¥è¯†" class="headerlink" title="mineruç›¸å…³çŸ¥è¯†"></a>mineruç›¸å…³çŸ¥è¯†</h3><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Usage: mineru [OPTIONS]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -v, --version                   æ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡º</span><br><span class="line">  -p, --path PATH                 è¾“å…¥æ–‡ä»¶è·¯å¾„æˆ–ç›®å½•ï¼ˆå¿…å¡«ï¼‰</span><br><span class="line">  -o, --output PATH               è¾“å‡ºç›®å½•ï¼ˆå¿…å¡«ï¼‰</span><br><span class="line">  -m, --method [auto|txt|ocr]     è§£ææ–¹æ³•ï¼šautoï¼ˆé»˜è®¤ï¼‰ã€txtã€ocrï¼ˆä»…ç”¨äº pipeline åç«¯ï¼‰</span><br><span class="line">  -b, --backend [pipeline|vlm-transformers|vlm-sglang-engine|vlm-sglang-client]</span><br><span class="line">                                  è§£æåç«¯ï¼ˆé»˜è®¤ä¸º pipelineï¼‰</span><br><span class="line">  -l, --lang [ch|ch_server|ch_lite|en|korean|japan|chinese_cht|ta|te|ka|latin|arabic|east_slavic|cyrillic|devanagari]</span><br><span class="line">                                  æŒ‡å®šæ–‡æ¡£è¯­è¨€ï¼ˆå¯æå‡ OCR å‡†ç¡®ç‡ï¼Œä»…ç”¨äº pipeline åç«¯ï¼‰</span><br><span class="line">  -u, --url TEXT                  å½“ä½¿ç”¨ sglang-client æ—¶ï¼Œéœ€æŒ‡å®šæœåŠ¡åœ°å€</span><br><span class="line">  -s, --start INTEGER             å¼€å§‹è§£æçš„é¡µç ï¼ˆä» 0 å¼€å§‹ï¼‰</span><br><span class="line">  -e, --end INTEGER               ç»“æŸè§£æçš„é¡µç ï¼ˆä» 0 å¼€å§‹ï¼‰</span><br><span class="line">  -f, --formula BOOLEAN           æ˜¯å¦å¯ç”¨å…¬å¼è§£æï¼ˆé»˜è®¤å¼€å¯ï¼‰</span><br><span class="line">  -t, --table BOOLEAN             æ˜¯å¦å¯ç”¨è¡¨æ ¼è§£æï¼ˆé»˜è®¤å¼€å¯ï¼‰</span><br><span class="line">  -d, --device TEXT               æ¨ç†è®¾å¤‡ï¼ˆå¦‚ cpu/cuda/cuda:0/npu/mpsï¼Œä»… pipeline åç«¯ï¼‰</span><br><span class="line">  --vram INTEGER                  å•è¿›ç¨‹æœ€å¤§ GPU æ˜¾å­˜å ç”¨(GB)ï¼ˆä»… pipeline åç«¯ï¼‰</span><br><span class="line">  --source [huggingface|modelscope|local]</span><br><span class="line">                                  æ¨¡å‹æ¥æºï¼Œé»˜è®¤ huggingface</span><br><span class="line">  --help                          æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<h4 id="åç«¯çš„åŒºåˆ«"><a href="#åç«¯çš„åŒºåˆ«" class="headerlink" title="åç«¯çš„åŒºåˆ«"></a>åç«¯çš„åŒºåˆ«</h4><p>pipeline (é»˜è®¤åç«¯) :</p>
<ul>
<li>å«ä¹‰ : è¿™æ˜¯ MinerU çš„é»˜è®¤åç«¯ï¼Œå®ƒä½¿ç”¨æœ¬åœ°å®‰è£…çš„ mineru åº“æ¥æ‰§è¡Œæ–‡æ¡£è§£æä»»åŠ¡ã€‚å®ƒé€šå¸¸ä¸ä¾èµ–äºå¤–éƒ¨çš„ VLMï¼ˆè§†è§‰è¯­è¨€æ¨¡å‹ï¼‰æœåŠ¡ï¼Œè€Œæ˜¯ç›´æ¥åœ¨æœ¬åœ°å¤„ç† PDF æ–‡ä»¶ã€‚</li>
</ul>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/10d6d1a7f702c5806e29ee7b1c51283.png" alt="10d6d1a7f702c5806e29ee7b1c51283"></p>
<p>vlm-transformers :</p>
<ul>
<li>å«ä¹‰ : è¿™ä¸ªåç«¯åˆ©ç”¨ Hugging Face transformers åº“ä¸­æä¾›çš„ VLM æ¨¡å‹è¿›è¡Œæ–‡æ¡£åˆ†æã€‚å®ƒä¼šåœ¨æœ¬åœ°åŠ è½½å¹¶è¿è¡Œä¸€ä¸ªåŸºäº transformers çš„ VLM æ¨¡å‹æ¥å¤„ç† PDF ä¸­çš„è§†è§‰ä¿¡æ¯å’Œæ–‡æœ¬å†…å®¹ã€‚</li>
</ul>
<blockquote>
<p>VLMï¼ˆVision-Language Modelï¼Œè§†è§‰è¯­è¨€æ¨¡å‹ï¼‰æ˜¯ä¸€ç§ç»“åˆè®¡ç®—æœºè§†è§‰å’Œè‡ªç„¶è¯­è¨€å¤„ç†èƒ½åŠ›çš„å¤šæ¨¡æ€äººå·¥æ™ºèƒ½æ¨¡å‹ã€‚</p>
<p>OCR æ˜¯ Optical Character Recognitionï¼ˆå…‰å­¦å­—ç¬¦è¯†åˆ«ï¼‰çš„ç¼©å†™ã€‚å®ƒæ˜¯ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºå°†å›¾åƒä¸­çš„æ‰‹å†™ã€æ‰“å°æˆ–æ‰“å­—æ–‡æœ¬è½¬æ¢ä¸ºæœºå™¨ç¼–ç çš„æ–‡æœ¬ï¼Œä½¿å…¶å¯ä»¥è¢«è®¡ç®—æœºç¼–è¾‘ã€æœç´¢ã€å­˜å‚¨å’Œå¤„ç†ã€‚</p>
</blockquote>
<p>vlm-sglang-engine :</p>
<ul>
<li>å«ä¹‰ : è¿™ä¸ªåç«¯è¡¨ç¤º MinerU å°†ç›´æ¥é›†æˆå¹¶ä½¿ç”¨ SGLang å¼•æ“è¿›è¡Œ VLM æ¨ç†ã€‚SGLang æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æ¨ç†å¼•æ“ï¼Œæ—¨åœ¨ä¼˜åŒ–å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œ VLM çš„æ¨ç†é€Ÿåº¦å’Œæ•ˆç‡ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒSGLang å¼•æ“ä½œä¸º MinerU è¿›ç¨‹çš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚</li>
</ul>
<p>vlm-sglang-client :</p>
<ul>
<li>å«ä¹‰ : è¿™ä¸ªåç«¯è¡¨ç¤º MinerU ä½œä¸º SGLang æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒMinerU ä¸ä¼šç›´æ¥è¿è¡Œ VLM æ¨¡å‹ï¼Œè€Œæ˜¯å°† PDF å¤„ç†è¯·æ±‚å‘é€åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ SGLang æœåŠ¡å™¨ï¼ˆé€šè¿‡ -u å‚æ•°æŒ‡å®šçš„ URLï¼Œä¾‹å¦‚ <a target="_blank" rel="noopener" href="http://localhost:30000">http://localhost:30000</a> ï¼‰ã€‚SGLang æœåŠ¡å™¨è´Ÿè´£æ‰§è¡Œå®é™…çš„ VLM æ¨ç†ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ MinerU å®¢æˆ·ç«¯ã€‚</li>
</ul>
<blockquote>
<p>ç”¨åœºæ™¯ : è¿™æ˜¯æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ Docker å®¹å™¨éƒ¨ç½²åœºæ™¯ä¸­æ¨èçš„æ¨¡å¼ã€‚å®ƒéå¸¸é€‚åˆä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>èµ„æºéš”ç¦» : å°† VLM æ¨ç†çš„è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä» MinerU ä¸»è¿›ç¨‹ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå…è®¸ç‹¬ç«‹æ‰©å±•å’Œç®¡ç† SGLang æœåŠ¡å™¨ã€‚</li>
<li>é›†ä¸­ç®¡ç† : å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ª SGLang æœåŠ¡å™¨ä¸Šé›†ä¸­ç®¡ç† VLM æ¨¡å‹ï¼Œä¾›å¤šä¸ª MinerU å®¢æˆ·ç«¯å…±äº«ä½¿ç”¨ã€‚</li>
<li>æ€§èƒ½ä¼˜åŒ– : SGLang æœåŠ¡å™¨å¯ä»¥é’ˆå¯¹ VLM æ¨ç†è¿›è¡Œä¸“é—¨ä¼˜åŒ–ï¼Œæä¾›æ›´å¥½çš„ååé‡å’Œå»¶è¿Ÿã€‚</li>
<li>çµæ´»éƒ¨ç½² : SGLang æœåŠ¡å™¨å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œç”šè‡³ä½œä¸ºå¾®æœåŠ¡è¿è¡Œï¼Œæä¾›æ›´å¤§çš„éƒ¨ç½²çµæ´»æ€§ã€‚</li>
</ul>
</blockquote>
<h4 id="å…³äºååé‡çš„ç›¸å…³çŸ¥è¯†"><a href="#å…³äºååé‡çš„ç›¸å…³çŸ¥è¯†" class="headerlink" title="å…³äºååé‡çš„ç›¸å…³çŸ¥è¯†"></a>å…³äºååé‡çš„ç›¸å…³çŸ¥è¯†</h4><p><strong>â€œååé‡â€ï¼ˆthroughputï¼‰\</strong>æŒ‡çš„æ˜¯ç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…èƒ½å¤„ç†çš„ **Token æ•°é‡**ï¼Œå•ä½é€šå¸¸æ˜¯ **tokens/ç§’**ã€‚è¿™ä¸ªæŒ‡æ ‡è¡¡é‡çš„æ˜¯æ•´ä½“ç³»ç»Ÿ*<em>å¤„ç†å¹¶å‘è¯·æ±‚çš„èƒ½åŠ›*</em>ï¼Œè€Œä¸ä»…ä»…æ˜¯å•ä¸ªè¯·æ±‚çš„é€Ÿåº¦ã€‚</p>
<p>SGLang æ”¯æŒä¸¤ç§ä¸»è¦å¹¶è¡Œæ–¹å¼æ¥æå‡ååé‡ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>å¹¶è¡Œç±»å‹</th>
<th>ä½œç”¨</th>
<th>å¯¹ååé‡çš„å½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¼ é‡å¹¶è¡Œï¼ˆTPï¼‰</strong></td>
<td>æŠŠæ¨¡å‹æƒé‡åˆ‡åˆ†åˆ°å¤šå¼ å¡ä¸Šï¼Œ<strong>å‡å°‘å•å¡è´Ÿè½½</strong></td>
<td>æå‡å•è¯·æ±‚å¤„ç†èƒ½åŠ›ï¼Œ<strong>ä½†é€šä¿¡å¼€é”€å¤§</strong></td>
</tr>
<tr>
<td><strong>æ•°æ®å¹¶è¡Œï¼ˆDPï¼‰</strong></td>
<td>æŠŠä¸åŒè¯·æ±‚åˆ†å‘åˆ°ä¸åŒå¡ä¸Šï¼Œ<strong>å¹¶è¡Œå¤„ç†å¤šä¸ªè¯·æ±‚</strong></td>
<td>ç›´æ¥æå‡å¹¶å‘ååé‡ï¼Œ<strong>å°¤å…¶é€‚åˆé«˜å¹¶å‘åœºæ™¯</strong></td>
</tr>
</tbody>
</table>
</div>
<h3 id="mineruçš„å¹¶å‘æµ‹è¯•å’Œååé‡æµ‹è¯•"><a href="#mineruçš„å¹¶å‘æµ‹è¯•å’Œååé‡æµ‹è¯•" class="headerlink" title="mineruçš„å¹¶å‘æµ‹è¯•å’Œååé‡æµ‹è¯•"></a>mineruçš„å¹¶å‘æµ‹è¯•å’Œååé‡æµ‹è¯•</h3><p>å¹¶å‘èƒ½åŠ›æ˜¯æµ‹è¯•mineruåŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚çš„èƒ½åŠ›ï¼Œååé‡æ˜¯æµ‹è¯•mineruå¤„ç†æ–‡ä»¶æ—¶çš„tokens</p>
<p>æ˜ç¡®è¦çš„æ˜¯å“ªä¸ªååé‡ï¼šä¸€ä¸ªæ˜¯<strong>MinerU å†…éƒ¨æ¨ç†å¼•æ“ï¼ˆå¦‚ vLLM/SGLangï¼‰çš„ token/s è¾“å‡º</strong>ï¼Œå³ <strong>ç”Ÿæˆé˜¶æ®µï¼ˆdecodeï¼‰çš„ååé‡</strong>ï¼Œä¸€ä¸ªæ˜¯ä½ å‹æµ‹ <code>/file_parse</code> æ¥å£æ—¶çš„ <strong>ç«¯åˆ°ç«¯ tokens/s</strong>ã€‚</p>
<p>æ˜¯å¦æœ‰ç¼“å­˜ï¼ˆkvcacheï¼‰</p>
<p><strong>æµ‹è¯•åœºæ™¯</strong>ï¼š10é¡µçš„pdfï¼Œ50ç”¨æˆ·å¹¶å‘</p>
<p><strong>å·¥å…·</strong>ï¼šlocust</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">locust \</span><br><span class="line">  -f locustfile.py \</span><br><span class="line">  --headless \</span><br><span class="line">  -u 50 \               # å¹¶å‘ç”¨æˆ·æ•°</span><br><span class="line">  -r 5 \                # æ¯ç§’å¯åŠ¨ç”¨æˆ·æ•°</span><br><span class="line">  --host=http://mineru-server:30000 \</span><br><span class="line">  --html=report.html \  # è‡ªåŠ¨ç”Ÿæˆ HTML æŠ¥å‘Š</span><br><span class="line">  --csv=result          # åŒæ—¶ä¿å­˜ csvï¼ˆresult_stats.csv / result_failures.csvï¼‰</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">locust -f locustfile.py --headless -u 100 -r 5 --host=http://mineru-server:30000 --html=report.html --csv=result</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250805152017255.png" alt="image-20250805152017255"></p>
<p>å¯¹äºæ¨ç†æ¨¡å‹çš„ååé‡ï¼Œåœ¨3ä¸ªgpuå¼€å¯æ•°æ®å¹¶è¡Œçš„æƒ…å†µä¸‹ï¼Œå¹³å‡æ¯ç§’å•ä¸ªgpuå¤„ç†tokensä¸º1500å·¦å³</p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250805152149822.png" alt="image-20250805152149822"></p>
<p>gpuçŠ¶æ€å¦‚ä¸Š:<strong>æ˜¾å­˜å‡ ä¹æ‰“æ»¡ 85â€“87 %</strong>,<strong>GPU åˆ©ç”¨ç‡ 59â€“63 %</strong>,<strong>åŠŸè€— 170â€“188 W / 350 W</strong></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250805153516235.png" alt="image-20250805153516235"></p>
<p>å®Œæ•´å‹æµ‹ç»“æœå¦‚ä¸Š</p>
<p>é‡è¦æŒ‡æ ‡ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th>æ•°å€¼</th>
<th>é€šä¿—è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¹³å‡å“åº”æ—¶é—´</strong></td>
<td><strong>241 ç§’</strong> â‰ˆ <strong>4 åˆ†é’Ÿ</strong></td>
<td>ä¸Šä¼ ä¸€ä¸ª PDF â†’ æ‹¿åˆ°è§£æç»“æœï¼Œå¹³å‡è¦ç­‰ 4 åˆ†é’Ÿã€‚</td>
</tr>
<tr>
<td><strong>ä¸­ä½æ•°</strong></td>
<td><strong>215 ç§’</strong> â‰ˆ <strong>3.6 åˆ†é’Ÿ</strong></td>
<td>ä¸€åŠè¯·æ±‚åœ¨ 3.6 åˆ†é’Ÿå†…å®Œæˆã€‚</td>
</tr>
<tr>
<td><strong>95% ç”¨æˆ·</strong></td>
<td><strong>361 ç§’</strong> â‰ˆ <strong>6 åˆ†é’Ÿ</strong></td>
<td>æœ€æ…¢çš„ 5% è¦ç­‰ 6 åˆ†é’Ÿä»¥ä¸Šã€‚</td>
</tr>
<tr>
<td><strong>ååé‡</strong></td>
<td><strong>0.18 req/s</strong></td>
<td>è¿™å° MinerU <strong>æ¯åˆ†é’Ÿåªèƒ½å¤„ç†çº¦11 ä¸ª PDF</strong>ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250806104340935.png" alt="image-20250806104340935"></p>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250806110438932.png" alt="image-20250806110438932"></p>
<p>å‚è€ƒèµ„æ–™</p>
<p><a target="_blank" rel="noopener" href="https://github.com/opendatalab/MinerU/blob/be4f3de32b58ccf81c6a6dcb9d3e4998424cee6a/projects/multi_gpu_v2/README_zh.md">MinerU/projects/multi_gpu_v2/README_zh.md at be4f3de32b58ccf81c6a6dcb9d3e4998424cee6a Â· opendatalab/MinerU</a></p>
<h3 id="éƒ¨ç½²æœåŠ¡å™¨å¹¶è¿è¡Œ"><a href="#éƒ¨ç½²æœåŠ¡å™¨å¹¶è¿è¡Œ" class="headerlink" title="éƒ¨ç½²æœåŠ¡å™¨å¹¶è¿è¡Œ"></a>éƒ¨ç½²æœåŠ¡å™¨å¹¶è¿è¡Œ</h3><p>loadé•œåƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i mineru-sglang-latest.tar</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/mineru/image-20250716092152823.png" alt="image-20250716092152823"></p>
<p>æ¯ç§’åˆ·æ–°<code>watch -n1 nvidia-smi          # æ¯ç§’åˆ·æ–°</code></p>
<p>æŸ¥çœ‹Linuxè·¯å¾„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd </span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨å®¹å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mineru-server --gpus all --shm-size 32g -p 30000:30000 -p 7860:7860 -p 8000:8000 --ipc=host \</span><br><span class="line">-v &quot;/aisys/repo_dev/xizhang/pdfs:/pdfs&quot; \</span><br><span class="line">-v &quot;/aisys/repo_dev/xizhang/outputs:/output&quot; \</span><br><span class="line">mineru-sglang:latest \</span><br><span class="line">mineru-sglang-server --host 0.0.0.0 --port 30000</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mineru-server --gpus all --shm-size 32g -p 30000:30000 --ipc=host -v &quot;/aisys/repo_dev/xizhang/pdfs:/pdfs&quot; -v &quot;/aisys/repo_dev/xizhang/outputs:/output&quot; mineru-sglang:latest mineru-sglang-server --host 0.0.0.0 --port 30000</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec mineru-server mineru -p /pdfs/demo1.pdf -o /output -b vlm-sglang-client -u http://localhost:30000`</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥å®¹å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mineru-server /bin/bash</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨piplineè§£æåç«¯æ¨¡å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mineru -p /pdfs/demo1.pdf -o /output --source local</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨sglangåŠ é€Ÿæ¨ç†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUDA_VISIBLE_DEVICES=1,2,3 mineru -p /pdfs/small_ocr.pdf -o /output -b vlm-sglang-engine --source local</span><br></pre></td></tr></table></figure>
<blockquote>
<p>vlmæ¨¡å¼åŒæ ·å¯ä»¥å¤„ç†æ‰«æä»¶</p>
</blockquote>
<p>ä½¿ç”¨ocrè§£ææ‰«æä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mineru -p /pdfs/small_ocr.pdf -o /output --source local -m ocr</span><br></pre></td></tr></table></figure>
<p>å¢åŠ æ¨ç†è®¾å¤‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mineru -p /pdfs/small_ocr.pdf -o /output --source local -m ocr -d cuda</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åœ¨å‘½ä»¤è¡Œçš„å¼€å¤´æ·»åŠ <code>CUDA_VISIBLE_DEVICES</code> ç¯å¢ƒå˜é‡æ¥æŒ‡å®šå¯è§çš„ GPU è®¾å¤‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUDA_VISIBLE_DEVICES=1,2,3 mineru -p /pdfs/small_ocr.pdf -o /output --source local -m ocr</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨sglangåŠ é€Ÿæ¨¡å¼çš„å¤šGPUå¹¶è¡Œ</p>
<p>æ•°æ®å¹¶è¡Œï¼ˆdp-sizeï¼‰å’Œå¼ é‡å¹¶è¡Œï¼ˆtp-sizeï¼‰</p>
<p>MinerUæ”¯æŒé€šè¿‡sglangçš„å¤šGPUå¹¶è¡Œæ¨¡å¼æ¥æå‡æ¨ç†é€Ÿåº¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‚æ•°ï¼š</p>
<ul>
<li><code>--dp-size</code>: æ•°æ®å¹¶è¡Œï¼Œé€šè¿‡å¤šå¡åŒæ—¶å¤„ç†å¤šä¸ªè¾“å…¥æ¥å¢åŠ ååé‡</li>
<li><code>--tp-size</code>: å¼ é‡å¹¶è¡Œï¼Œå°†æ¨¡å‹åˆ†å¸ƒåˆ°å¤šå¼ GPUä¸Šä»¥æ‰©å±•å¯ç”¨æ˜¾å­˜</li>
</ul>
<blockquote>
<p>å¦‚æœæ‚¨å·²ç»å¯ä»¥æ­£å¸¸ä½¿ç”¨sglangå¯¹vlmæ¨¡å‹è¿›è¡ŒåŠ é€Ÿæ¨ç†ï¼Œä½†ä»ç„¶å¸Œæœ›è¿›ä¸€æ­¥æå‡æ¨ç†é€Ÿåº¦ï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>å¦‚æœæ‚¨æœ‰è¶…è¿‡å¤šå¼ æ˜¾å¡ï¼Œå¯ä»¥ä½¿ç”¨sglangçš„å¤šå¡å¹¶è¡Œæ¨¡å¼æ¥å¢åŠ ååé‡ï¼š<code>--dp-size 2</code></li>
<li>åŒæ—¶æ‚¨å¯ä»¥å¯ç”¨<code>torch.compile</code>æ¥å°†æ¨ç†é€Ÿåº¦åŠ é€Ÿçº¦15%ï¼š<code>--enable-torch-compile</code></li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUDA_VISIBLE_DEVICES=1,2,3 mineru -p /pdfs -o /output -b vlm-sglang-engine --source local --dp-size 3 --enable-torch-compile</span><br></pre></td></tr></table></figure>
<p>å°†pythonæ–‡ä»¶ä¸Šä¼ dockerå¹¶è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker cp demo.py mineru-server:/demo.py</span><br><span class="line"></span><br><span class="line">docker exec mineru-server python /demo.py</span><br><span class="line"></span><br><span class="line">#åˆ é™¤</span><br><span class="line">rm -i demo.py</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œï¼Œä¿®æ”¹æŒ‚è½½å·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mineru-server --gpus all --shm-size 32g -p 30000:30000 --ipc=host -v /aisys/:/aisys/ --network network_test mineru-sglang:latest mineru-sglang-server --host 0.0.0.0 --port 30000</span><br></pre></td></tr></table></figure>
<p>åé¢æ‰çŸ¥é“ï¼Œä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨å¯åŠ¨sglang-serveræœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mineru-server --gpus all --shm-size 32g -p 30000:30000 --ipc=host -v /aisys/:/aisys/ --network network_test mineru-sglang:latest tail -f /dev/null</span><br><span class="line">docker start mineru-server</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸Šé¢è¿™ä¸ªå‘½ä»¤å¯åŠ¨å®¹å™¨ï¼Œä½†ä¸å¯åŠ¨sglang-serveræœåŠ¡ï¼Œä½¿ç”¨ä¸‹é¢æŒ‡ä»¤æ‰‹åŠ¨å¯åŠ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mineru-server /bin/bash</span><br><span class="line">MINERU_MODEL_SOURCE=local CUDA_VISIBLE_DEVICES=1,2,3 mineru-sglang-server --port 30000 --dp-size 3 --enable-torch-compile</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨æœåŠ¡ååœ¨å¦ä¸€ä¸ªå®¹å™¨å°è¯•è®¿é—®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://mineru-server:30000/get_model_info</span><br></pre></td></tr></table></figure>
<p>åœ¨å¦ä¸€ä¸ªå®¹å™¨ä½¿ç”¨æœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mineru -p /test -o / -b vlm-sglang-client -u http://mineru-server:30000</span><br></pre></td></tr></table></figure>
<hr>
<p>å¯åŠ¨fastapiæœåŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MINERU_MODEL_SOURCE=local CUDA_VISIBLE_DEVICES=1,2,3 mineru-api --host 0.0.0.0 --port 30000 --dp-size 3 --enable-torch-compile</span><br></pre></td></tr></table></figure>
<p>åœ¨å¦ä¸€ä¸ªå®¹å™¨éªŒè¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://mineru-server:30000/openapi.json</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨å®¹å™¨å†…è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">export CUDA_VISIBLE_DEVICES=1,2,3</span><br><span class="line"># éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®æˆåŠŸ</span><br><span class="line">echo $CUDA_VISIBLE_DEVICES</span><br><span class="line"></span><br><span class="line"># åœ¨å®¹å™¨å†…è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">export MINERU_MODEL_SOURCE=local</span><br><span class="line"># éªŒè¯ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®æˆåŠŸ</span><br><span class="line">echo $MINERU_MODEL_SOURCE</span><br></pre></td></tr></table></figure>
<h3 id="èµ„æ–™"><a href="#èµ„æ–™" class="headerlink" title="èµ„æ–™"></a>èµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liuzhenghua66/article/details/148980203">MinerU 2.0éƒ¨ç½²-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/opendatalab/MinerU?tab=readme-ov-file#local-deployment">https://github.com/opendatalab/MinerU?tab=readme-ov-file#local-deployment</a> </p>
<p><a target="_blank" rel="noopener" href="https://deepwiki.com/opendatalab/MinerU">https://deepwiki.com/opendatalab/MinerU</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/7.8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/7.8/" class="post-title-link" itemprop="url">å®ä¹ æ—¥å¿—</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-08 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-08T00:00:00+08:00">2025-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-30 09:11:25" itemprop="dateModified" datetime="2025-07-30T09:11:25+08:00">2025-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h3><p>7.16 10ï¼š46</p>
<p>å·²ç»å°†mineruéƒ¨ç½²è‡³æœåŠ¡å™¨ï¼Œå®Œæˆpdfå’Œæ‰«æä»¶çš„æå–æµ‹è¯•ï¼Œä½†æ˜¯mineruæ˜¯æ²¡åŠæ³•ç›´æ¥æå–docä¸docxçš„ï¼Œèƒ½ä¸èƒ½ç›´æ¥å¯¹docä¸docxè¿›è¡Œæ–‡æœ¬åˆ†å—ï¼Œæˆ–è€…å…ˆè½¬æ¢æˆpdfå†æå–ï¼ˆå®˜æ–¹ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡ç‹¬ç«‹éƒ¨ç½²çš„LibreOfficeæœåŠ¡å…ˆè¡Œè½¬æ¢ä¸ºPDFæ ¼å¼ï¼Œå†è¿›è¡Œåç»­è§£ææ“ä½œã€‚ï¼‰</p>
<p>7.17 11ï¼š04</p>
<p>å®Œæˆmineruè„šæœ¬çš„ç¼–å†™ï¼Œä»…è¾“å‡ºæå–çš„mdä¸imageï¼›å®ç°è°ƒç”¨å¤šå—gpuï¼›å®ç°æ•°æ®å¹¶è¡Œï¼Œé€šè¿‡å¤šå¡åŒæ—¶å¤„ç†å¤šä¸ªè¾“å…¥æ¥å¢åŠ ååé‡ï¼›ä½¿ç”¨sglangæ¡†æ¶</p>
<p>7.18 14ï¼š37</p>
<p>å‘ç°mineruæå–çš„markdownæ–‡æ¡£æ˜¯ä¸å¸¦å¤šçº§æ ‡é¢˜çš„ï¼Œåªæœ‰ä¸€çº§æ ‡é¢˜ï¼Œæ‰€ä»¥ä¸è€ƒè™‘æ–‡æ¡£ç»“æ„åˆ†å—ï¼›è¯­ä¹‰åˆ†å—è¦è°ƒç”¨embeddingæ¨¡å‹ï¼Œè€Œä¸”æ–‡æ¡£é‡Œæœ‰å¾ˆå¤šè¡¨æ ¼ï¼Œæˆ‘æ„Ÿè§‰æ•ˆæœä¸ä¸€å®šä¼šå¥½ï¼›åç»­æˆ‘æƒ³æ³•æ˜¯ä½¿ç”¨é€’å½’åˆ†å—ï¼Œè¡¨æ ¼åœ¨mdæ–‡æ¡£ä¸­ä»¥htmlè¡¨æ ¼æ ¼å¼å­˜å‚¨çš„ï¼Œå¤§é‡å†—ä½™ä¿¡æ¯ï¼Œæˆ‘æƒ³å…ˆå¯¹å…¶è¿›è¡Œé¢„å¤„ç†ï¼Œè½¬æ¢æˆmdè¡¨æ ¼çš„å½¢å¼å§ï¼ˆç”¨â€œ |â€å­˜å‚¨ï¼‰ï¼Œç„¶åå†åˆ†å—ï¼Œæˆ–è®¸æ•ˆæœä¼šå¥½ä¸€äº›ï¼Œæ­£åœ¨è¿›è¡Œ</p>
<p>è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯libreofficeæ˜¯éƒ¨ç½²åœ¨å“ªé‡Œï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°è¯¶</p>
<p>7.19 10ï¼š26</p>
<p>å®Œæˆè¡¨æ ¼é¢„å¤„ç†çš„è„šæœ¬ç¼–å†™ï¼Œå®Œæˆå¯¹mdæ–‡æ¡£çš„é¢„å¤„ç†ï¼›å®Œæˆé€’å½’åˆ†å—ï¼Œåç»­å®Œæˆå­˜å…¥esæ•°æ®åº“</p>
<p>7.21</p>
<p>å®Œæˆç®€å•åœ°å°†åˆ†å—ç»“æœå­˜å…¥elasticsearchï¼ˆmappingåªæœ‰contentå­—æ®µï¼Œä½¿ç”¨httpè¯·æ±‚å­˜çš„ï¼Œæ²¡æœ‰ç”¨langchain-elasticsearchï¼‰åé¢è¦è¯•è¯•langchain-elasticsearchï¼Œå»çœ‹çœ‹å­—æ®µçš„å¤„ç†</p>
<p>7.22</p>
<p>å®Œæˆlangchain-elasticsearchçš„bm25çš„æ£€ç´¢æµ‹è¯•ï¼Œæ¥ä¸‹æ¥å°è¯•ä½¿ç”¨æœåŠ¡å™¨çš„embeddingæ¨¡å‹è¿›è¡Œæµ‹è¯•ï¼Œé˜…è¯»é¡¹ç›®æ–‡ä»¶ï¼Œç†æ¸…æ€è·¯ï¼Œå…·ä½“å†…å®¹è§<a target="_blank" rel="noopener" href="https://icnrn6ghqrgx.feishu.cn/wiki/MWZ9wVYRxixABqkMhjQcQPqTnfe">å¤šæ¨¡æ€ - PDFè¡¨æ ¼å›¾ç‰‡&amp;æ‰«æä»¶</a>ï¼Œå­˜å…¥esä¸æ–‡ä»¶å¤„ç†å­—æ®µå¤„ç†éƒ¨åˆ†å·²ç»ç†æ¸…äº†ï¼ŒæˆåŠŸå­˜å…¥æœåŠ¡å™¨çš„es</p>
<p>7.23</p>
<p>ä»Šå¤©åœ¨æŠŠä¹‹å‰åšçš„æ‰€æœ‰å·¥ä½œè¿›è¡Œæ•´åˆï¼Œç¼–å†™ä¸€ä¸ªå®Œæ•´çš„ä»£ç ï¼Œå®ç°ç”Ÿäº§çš„æµç¨‹ï¼Œé‡åˆ°çš„ä¸»è¦é—®é¢˜æœ‰ä¸¤ä¸ªï¼š1.æˆ‘è¿˜æ˜¯æ²¡æœ‰å¾ˆçœ‹æ‡‚ä¹‹å‰å¯¹å­—æ®µçš„å­˜å‚¨ï¼Œå’Œå­—æ®µçš„ç»“æ„2.æˆ‘æ²¡æœ‰å¤ªç†è§£pdfåˆ†å—çš„éƒ¨åˆ†åœ¨å“ªé‡Œï¼Œæ˜¯æ²¡æœ‰å—ï¼Œæˆ‘çœ‹docçš„rewrite_wordæ˜¯æœ‰æ–‡æœ¬åˆ†å—çš„</p>
<p>æ„Ÿè§‰éœ€è¦ä½ ç»™æˆ‘è®²ä¸€ä¸‹ï¼Œä¸ç„¶æˆ‘åé¢ä¸å¤§çŸ¥é“è¯¥æ€ä¹ˆå¤„ç†ï¼Œé‚£æˆ‘æ˜å¤©å»æŠŠè¯­ä¹‰åˆ†å—å’Œå…¶ä»–çš„æ£€ç´¢æ–¹æ¡ˆè¯•ä¸€ä¸‹å§ï¼Œæ•´åˆä»£ç å…ˆç¨å¾®å»¶å</p>
<p>7.24</p>
<p>ä½¿ç”¨dockerçš„è‡ªå®šä¹‰ç½‘ç»œï¼Œå®ç°å®¹å™¨ä¹‹é—´çš„é€šä¿¡ï¼Œä»è€Œå¯ä»¥åœ¨repoå®¹å™¨ä¸­è°ƒç”¨mineruï¼Œå…¶ä»–å®¹å™¨éƒ½åœ¨network_testä¸‹ï¼Œæˆ‘æŠŠmineruä¹Ÿå¯åŠ¨åˆ°é‡Œé¢</p>
<p>æˆåŠŸåœ¨repoå®¹å™¨è®¿é—®åˆ°mineruå®¹å™¨ï¼Œå®Œæˆpdfåˆ†å—æ•°æ®çš„æ‰¹é‡å†™å…¥elasticsearchå¹¶å¯ä»¥æˆåŠŸæ£€ç´¢ï¼Œåç»­å®Œæˆè°ƒç”¨mineruçš„fastapiæ¥å£ï¼ˆè¿˜æ²¡ç¼–å®Œï¼‰ï¼Œç»§ç»­å®Œæˆä»£ç æ•´åˆï¼ˆå·²ç»å®Œæˆå¤§éƒ¨åˆ†ï¼Œä¸»è¦å·®mineruçš„éƒ¨åˆ†ï¼Œå’Œä¸€äº›è¡”æ¥çš„ä»£ç ï¼‰</p>
<p>7.25</p>
<p>å®Œæˆé€šè¿‡æ¥å£ä½¿ç”¨mineruæ‰¹é‡å¤„ç†pdfæ–‡ä»¶</p>
<p>7.28</p>
<p>å®Œæˆäº†ä»£ç æ•´åˆï¼Œå¯ä»¥å®Œæˆpdfæ•´ä¸ªæµç¨‹çš„å¤„ç†</p>
<p>7.29</p>
<p>è¡¥å……äº†libreofficeçš„ä»£ç ï¼Œå®ç°äº†å°†docï¼Œdocxè½¬æ¢æˆpdfï¼Œç»Ÿä¸€å¤„ç†æµç¨‹ï¼›å®Œæˆäº†æ•°æ®æ ‡è®°webï¼›åç»­è®¡åˆ’ï¼šæ ¹æ®é—®é¢˜æ£€ç´¢urlï¼Œå¤„ç†åå­˜å…¥zxj_test esæ•°æ®åº“ï¼Œå†è¿›è¡Œè¿›ä¸€æ­¥æ£€ç´¢äº§ç”Ÿæ•°æ®é›†</p>
<p>7.30</p>
<p>å®Œæˆæ‰«æä»¶çš„æµ‹è¯•ï¼Œæ–‡å­—å…¬å¼å›¾ç‰‡çš†å¯æ­£å¸¸è¯†åˆ«</p>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="vscodeè¿æ¥è¿œç¨‹æœåŠ¡å™¨"><a href="#vscodeè¿æ¥è¿œç¨‹æœåŠ¡å™¨" class="headerlink" title="vscodeè¿æ¥è¿œç¨‹æœåŠ¡å™¨"></a>vscodeè¿æ¥è¿œç¨‹æœåŠ¡å™¨</h4><ol>
<li>è¾“å…¥ ssh root@10.117.128.50</li>
<li>è¾“å…¥å¯†ç  think123@</li>
</ol>
<h5 id="ä½¿ç”¨æ—§ç‰ˆremotessh"><a href="#ä½¿ç”¨æ—§ç‰ˆremotessh" class="headerlink" title="ä½¿ç”¨æ—§ç‰ˆremotessh"></a>ä½¿ç”¨æ—§ç‰ˆremotessh</h5><p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/7.8/image-20250708104452761.png" alt="image-20250708104452761"></p>
<blockquote>
<p>åŸå› ï¼šå¯èƒ½å› ä¸ºå†…ç½‘ï¼ŒæœåŠ¡å™¨é‚£è¾¹æ²¡æœ‰è¿›è¡Œæ›´æ–°ï¼Œæ‰€ä»¥æ–°ç‰ˆçš„remotesshæ— æ³•è¿æ¥</p>
<p>å…¶ä»–é—®é¢˜ï¼šå¯èƒ½ç”±äºä¸Šè¿°åŸå› ï¼Œtraeä¹Ÿæ— æ³•è¿æ¥ï¼Œå¹¶ä¸”ç”±äºtraeçš„è¿œç¨‹è¿æ¥æ’ä»¶æ— æ³•æ›´æ”¹ç‰ˆæœ¬ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨</p>
</blockquote>
<h5 id="è™šæ‹Ÿç¯å¢ƒåˆ›å»º"><a href="#è™šæ‹Ÿç¯å¢ƒåˆ›å»º" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒåˆ›å»º"></a>è™šæ‹Ÿç¯å¢ƒåˆ›å»º</h5><p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/7.8/image-20250708104254347.png" alt="image-20250708104254347"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv .venv</span><br><span class="line"></span><br><span class="line">which python</span><br><span class="line"></span><br><span class="line">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line"> .venv\Scripts\activate</span><br><span class="line"> source .venv/bin/activate</span><br><span class="line"> </span><br><span class="line"> #åœæ‰è™šæ‹Ÿç¯å¢ƒ</span><br><span class="line"> deactivate</span><br></pre></td></tr></table></figure>
<h4 id="gitè¿æ¥è¿œç¨‹ä»“åº“"><a href="#gitè¿æ¥è¿œç¨‹ä»“åº“" class="headerlink" title="gitè¿æ¥è¿œç¨‹ä»“åº“"></a>gitè¿æ¥è¿œç¨‹ä»“åº“</h4><p>åˆå§‹åŒ–ä»“åº“ï¼š<code>git init</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº</span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"># æäº¤æ›´æ”¹</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line"></span><br><span class="line">#ä¸Šä¼ è¿œç¨‹åº“</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç›®æ ‡</th>
<th>å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
<td>æŸ¥çœ‹è¿œç¨‹ä»“åº“</td>
<td><code>git remote -v</code></td>
</tr>
<tr>
<td>ä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€</td>
<td><code>git remote set-url origin &lt;æ–°åœ°å€&gt;</code></td>
</tr>
<tr>
<td>æ·»åŠ æ–°è¿œç¨‹ä»“åº“ï¼ˆä¸åŒåï¼‰</td>
<td><code>git remote add upstream &lt;æ–°åœ°å€&gt;</code></td>
</tr>
<tr>
<td>åˆ é™¤è¿œç¨‹ä»“åº“</td>
<td><code>git remote remove origin</code></td>
</tr>
<tr>
<td>æ·»åŠ ç¬¬ä¸€ä¸ªè¿œç¨‹ä»“åº“</td>
<td><code>git remote add origin</code></td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/7.8/image-20250708151320868.png" alt="image-20250708151320868"></p>
<p>å½“å‰å­˜åœ¨è¿æ¥è¶…æ—¶é—®é¢˜ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨è¿æ¥çš„åŸå› </p>
</blockquote>
<h4 id="mineruéƒ¨ç½²æƒ…å†µ"><a href="#mineruéƒ¨ç½²æƒ…å†µ" class="headerlink" title="mineruéƒ¨ç½²æƒ…å†µ"></a>mineruéƒ¨ç½²æƒ…å†µ</h4><p><img src="/2025/07/08/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/%E6%97%A5%E5%BF%97/7.8/1a9954d6-31d7-404a-9419-cd9a87c9ee09.png" alt="1a9954d6-31d7-404a-9419-cd9a87c9ee09"></p>
<p>é€šè¿‡è°ƒæ•´dockeré•œåƒæºï¼Œå¯ä»¥æ‹‰å–åŸºç¡€é•œåƒäº†ï¼Œä½†æ˜¯é‡åˆ°<code>RUN apt-get update &amp;&amp; apt-get install -y libgl1 &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</code>ç¬¬äºŒéƒ¨å‘½ä»¤å†æ¬¡å‡ºç°ç½‘ç»œé—®é¢˜</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/06/24/diary/%E5%A4%A9%E4%B8%8B%E8%8B%B1%E9%9B%84%E5%A6%82%E8%BF%87%E6%B1%9F%E4%B9%8B%E9%B2%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/24/diary/%E5%A4%A9%E4%B8%8B%E8%8B%B1%E9%9B%84%E5%A6%82%E8%BF%87%E6%B1%9F%E4%B9%8B%E9%B2%AB/" class="post-title-link" itemprop="url">å¤©ä¸‹è‹±é›„å¦‚è¿‡æ±Ÿä¹‹é²«</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-06-24 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š11:37:06" itemprop="dateCreated datePublished" datetime="2025-06-24T00:00:00+08:00">2025-06-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">éšç¬”</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å½“ä½ æ¥åˆ°åŒéï¼Œä½ ä¼šè‰³ç¾¡211çš„ç‰Œå­ï¼Œå½“ä½ æ‹¼æ­»è€ƒä¸Š211ï¼Œä½ ä¼šå‘ç°985çš„å¤´è¡”ä¼šå¤„å¤„å¡æ­»ä½ ã€‚å½“ä½ ä¾¥å¹¸è€ƒä¸Šæœ«æµ
985ï¼Œä½ å°±ä¼šå‘ç°åäº”c9çš„å…‰èŠ’å‹çš„ä½ å–˜ä¸è¿‡æ°”ã€‚è‹¥ä½ çœŸé—®é¼åäº”ï¼ŒæŠ¬å¤´çœ‹ï¼Œäº¬åŸä¸­åŒæ—¥å‡Œç©ºã€‚æˆ–è®¸ä½ æ˜¯çœŸæ­£çš„å¤©æ‰ï¼Œæ¸…åŒ—ä¸­çš„ä½¼ä½¼è€…ï¼Œä»–ä»¬å‘Šè¯‰ä½ ï¼Œä¸–ç•Œä¸æ­¢ä¸­å›½ã€‚å½“ä½ æœ€ç»ˆæˆä¸ºè¿™ä¸€ä¸–æœ€ä¸æŠ˜ä¸æ‰£çš„å¤©æ‰ï¼Œä½ ä¼šå‘ç°æ¬§æ‹‰ï¼Œé»æ›¼ï¼Œè¿˜æœ‰7å²å› ä¸ºæƒ³å¿«ç‚¹æ”¾å­¦è€Œåˆ›é€ æ±‚å’Œå…¬å¼çš„é«˜æ–¯ï¼Œ
æ—©å·²åœ¨å±±é¡¶ç­‰å€™å¤šæ—¶ã€‚</p>
<p>æœ‰æ—¶å€™æƒ³æƒ³ï¼Œè¿™å­¦ä¸Šåˆ°å¤šé«˜æ‰ç®—é«˜å•Šï¼Œå¤§ä¸“ä¸Šé¢æœ‰æœ¬ç§‘ï¼Œæœ¬ç§‘ä¸Šé¢æœ‰ç¡•åšï¼Œå¥½ä¸å®¹æ˜“æ¯•ä¸šäº†å§ï¼Œå‰¯é«˜ï¼Œæ­£é«˜ï¼Œé’åŸºï¼Œåšå¯¼ï¼Œåœ¨ä¸Šé¢è¿˜æœ‰æ°é’ï¼Œé™¢å£«ã€‚å”‰ï¼Œå¤©ä¸‹è‹±é›„ï¼Œå¦‚è¿‡æ±Ÿä¹‹é²«ï¼Œæ— ç©·å°½ä¹Ÿã€‚ä¹‹å‰æ²¡æœ‰æ„Ÿè§‰ï¼Œè‡ªä»ä¸Šäº†å¤§å­¦ï¼Œè¿™ç§æ„Ÿå—å°±åƒä¸€å›¢ä¹Œäº‘ä¸€ç›´è¦ç»•åœ¨æˆ‘å¿ƒå¤´ï¼Œä¸ç¦åæ€äººè¿™ä¸€ç”Ÿç©¶ç«Ÿåœ¨è¿½æ±‚ä»€ä¹ˆã€‚</p>
<p>å¤§å¤šæ•°äººè¿½æ±‚çš„ä¸œè¥¿ï¼Œæ— éä¸‰è€…ï¼šæƒé’±å­¦ã€‚</p>
<p>æœ‰çš„äººæ¢¦æƒ³å‡å®˜ï¼Œä½†å®˜å¤–æœ‰å®˜ï¼Œæƒå¤–æœ‰æƒï¼Œç§‘çº§å¤„çº§å…çº§ï¼Œçœéƒ¨çº§å·²ç»ç®—æ˜¯äººä¸­é¾™å‡¤ï¼Œä½†ä¸Šé¢è¿˜æœ‰å‰¯å›½çº§æ­£å›½çº§ï¼Œå¤§å¤šæ•°äººå¿™å¿™ç¢Œç¢Œä¸€ç”Ÿä¹Ÿå°±å½“ä¸ªå‰¯å¤„çº§ï¼Œä»–ä»¬çœŸçš„ç”˜å¿ƒå—ï¼Œé‚£ç§æ‹¼åŠ²å…¨åŠ›ä¹Ÿæ— æ³•è·¨è¿‡çš„é¸¿æ²Ÿï¼Œæœ€ååªå‰©ä¸‹æ— å¥ˆï¼Œé—æ†¾å’Œé‡Šç„¶ã€‚</p>
<p>æœ‰äººçš„æ¸´æœ›è´¢å¯Œï¼Œèµšåˆ°äº†åä¸‡å°±æƒ³èµšç™¾ä¸‡ï¼Œèµšåˆ°äº†ç™¾ä¸‡åˆå¼€å§‹æƒ³åŠæ³•ï¼Œæƒ³èµšåƒä¸‡ï¼Œäº¿ï¼Œè§‰å¾—è‡ªå·±æœ‰èƒ½åŠ›äº†ï¼Œå¼€å§‹åˆ›ä¸šæŠ•èµ„ï¼Œæ‹¿ç€é’±å»ç‚’è‚¡ç‚’å¸æœ€åèµ”äº†ä¸ªç²¾å…‰ï¼Œæ›´æœ‰ç”šè€…æƒé’±å‹¾ç»“ï¼Œåšäº›ä¸æ³•å‹¾å½“ï¼Œä¸éƒ½æ˜¯ä¸ºäº†æ»¡è¶³è‡ªå·±çš„è´ªå©ªï¼Œä½†æ¬²æœ›æ— ç©·æ— å°½ï¼Œä½•æ—¶æ‰èƒ½å¡«æ»¡è¿™ä¸ªæ— åº•æ´ï¼Œæ›´å¯æ€•çš„æ˜¯ï¼Œå¤šå°‘äººçš„æ¬²æœ›å’Œä»–çš„èƒ½åŠ›å¹¶ä¸ç¬¦åˆï¼Œè‡ªèº«æ²¡æœ‰é‚£ä¹ˆå¤§çš„èƒ½åŠ›å´æ¸´æœ›ä¸€åˆ‡ï¼Œæœ€ååªä¼šåå™¬ï¼Œè‡ªé£Ÿå…¶æœã€‚</p>
<p>æœ‰çš„äººé’»ç ”å­¦è¯†ï¼Œä¸­å›½çš„å¤§å¤šæ•°äººéƒ½æ˜¯é€šè¿‡é«˜è€ƒè¿™ä¸€é€”å¾„è¸è¿›å­¦è¯†çš„æ®¿å ‚ï¼Œé‚£äº›åœ¨é«˜ä¸­è‡ªå‘½ä¸å‡¡çš„å¤©æ‰ä»¬ï¼Œè¿›å…¥äº†é«˜æ ¡æ‰å‘ç°ï¼Œè‡ªå·±åªæ˜¯èŠ¸èŠ¸ä¼—ç”Ÿçš„æ™®é€šä¸€å‘˜ï¼Œä»¥å‰çš„å…‰è¾‰ä¹Ÿå˜çš„æš—æ·¡æ— å…‰ï¼Œå³ä¾¿æ˜¯æ¸…åŒ—çº§åˆ«ï¼Œå·²ç»æ˜¯å¾ˆå¤šäººå¯æœ›è€Œä¸å¯å³çš„å­˜åœ¨ï¼Œåœ¨é¢å¯¹è¶Šæ¥è¶Šéš¾çš„çŸ¥è¯†ï¼Œåœ¨é¢å¯¹æ›´èªæ˜çš„èº«è¾¹äººï¼Œåœ¨å‘ç°è‡ªå·±å†åŠªåŠ›ä¹Ÿæ— æ³•è¾¾æˆç›®æ ‡æ—¶ï¼Œä¹Ÿä¼šå­¦ä¹ é‡Šç„¶è¿™ä¸€é—¨è¯¾ã€‚</p>
<p>æˆ‘æƒ³èµ·æ¥çœ‹è¿‡çš„ä¸€ä¸ªæ¸…åç‰©ç†ç³»åŒå­¦çš„é‡‡è®¿ï¼Œæœ‰ä¸€å¥è¯æˆ‘å°è±¡å¾ˆæ·±åˆ»ï¼Œå¤äººä¼šè¯´å°‘å£®ä¸åŠªåŠ›ï¼Œè€å¤§å¾’ä¼¤æ‚²ï¼Œä½†ä¸ä¼šè¯´å°‘å£®ä¸æˆåŠŸï¼Œè€å¤§å¾’ä¼¤æ‚²ï¼Œæˆ–è®¸æˆ‘ä¸Šé¢è¯´çš„è¿™äº›ï¼Œéƒ½å¤ªæ³¨é‡ç»“æœäº†ï¼Œä»¥ç»“æœçš„å¥½ååˆ¤å®šäº†è¿‡ç¨‹çš„æ„ä¹‰ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œåœ¨è¿½æ±‚è¿™äº›ç›®æ ‡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åŠªåŠ›äº†ï¼Œæ‹¼æäº†ï¼Œå¥‹æ–—äº†ï¼Œå…¶å®é‚£å°±è¶³å¤Ÿäº†ï¼Œä¸åº”è¯¥æŠŠç»“æœå¤±åˆ©çš„å‹åŠ›å¼ºåŠ åœ¨è‡ªå·±èº«ä¸Šã€‚</p>
<p>å”‰ï¼Œè¿™äº›è¯´èµ·æ¥å®¹æ˜“ï¼ŒçœŸæ­£èƒ½åšåˆ°ä¸ä¸ºç»“æœæ‰€åŠ¨å“ªé‡Œå®¹æ˜“å‘¢ï¼Œåªè·Ÿè‡ªå·±æ¯”è¾ƒï¼Œä¸ä¸ä»–äººæ”€æ¯”ï¼Œå¤„ä¹‹æ³°ç„¶åœ°é¢å¯¹ä»»ä½•å›°éš¾ä¸æŒ‘æˆ˜ã€‚è¿™å°±æ˜¯æˆ‘æ‰€è¿½æ±‚çš„å¿ƒå¢ƒå§ï¼Œæˆ‘ä»€ä¹ˆæ—¶å€™èƒ½åšåˆ°è¿™ç§åœ°æ­¥ï¼Œå¯èƒ½æ‰æ˜¯çœŸæ­£çš„é•¿å¤§äº†å§ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å¼ ç†™æµš</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™è®¿é—®æ•° fa fa-user æ¬¡"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™æ€»è®¿é—®é‡ fa fa-eye æ¬¡"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="400" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
