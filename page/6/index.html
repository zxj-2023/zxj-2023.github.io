<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="zxj Blogs">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhang XiJun">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Zhang XiJun">
<meta property="og:description" content="zxj Blogs">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="å¼ ç†™æµš">
<meta property="article:tag" content="zxj">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhang XiJun</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhang XiJun</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">BLOGS</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å¼ ç†™æµš"
      src="/images/zxjavatar.gif">
  <p class="site-author-name" itemprop="name">å¼ ç†™æµš</p>
  <div class="site-description" itemprop="description">zxj Blogs</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">155</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">60</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zxj-2023" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zxj-2023" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=2902065320&site=qq&menu=yes" title="QQ â†’ http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;2902065320&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener me" target="_blank"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          é“¾æ¥
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://zxj-2023.github.io/" title="https:&#x2F;&#x2F;zxj-2023.github.io" rel="noopener" target="_blank">Zhang XiJun</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://theme-next.js.org/" title="https:&#x2F;&#x2F;theme-next.js.org" rel="noopener" target="_blank">NexT</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/18/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/libreoffice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/18/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/libreoffice/" class="post-title-link" itemprop="url">Libreoffice</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-18T00:00:00+08:00">2025-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-20 16:31:32" itemprop="dateModified" datetime="2025-08-20T16:31:32+08:00">2025-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="libreofficeéƒ¨ç½²"><a href="#libreofficeéƒ¨ç½²" class="headerlink" title="libreofficeéƒ¨ç½²"></a>libreofficeéƒ¨ç½²</h3><h4 id="æŸ¥çœ‹Linuxå‘è¡Œç‰ˆ"><a href="#æŸ¥çœ‹Linuxå‘è¡Œç‰ˆ" class="headerlink" title="æŸ¥çœ‹Linuxå‘è¡Œç‰ˆ"></a>æŸ¥çœ‹Linuxå‘è¡Œç‰ˆ</h4><p><img src="/2025/07/18/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/libreoffice/image-20250718095931232.png" alt="image-20250718095931232"></p>
<p>ç³»ç»Ÿæ˜¯ <strong>é“¶æ²³éº’éºŸé«˜çº§æœåŠ¡å™¨æ“ä½œç³»ç»Ÿ V10ï¼ˆKylin Linux Advanced Server V10ï¼‰</strong>ï¼Œå±äº <strong>ä¸­å›½å›½äº§ã€å…¼å®¹ CentOS/RHEL ç”Ÿæ€</strong> çš„ Linux å‘è¡Œç‰ˆã€‚</p>
<p>å› æ­¤å®ƒä½¿ç”¨ <strong>RPM åŒ…ç®¡ç†</strong>ï¼ˆ<code>dnf</code>/<code>yum</code>ï¼‰ï¼Œè€Œä¸æ˜¯ <code>.deb</code>ã€‚</p>
<h4 id="æŸ¥çœ‹CPU-å¤„ç†å™¨æ¶æ„"><a href="#æŸ¥çœ‹CPU-å¤„ç†å™¨æ¶æ„" class="headerlink" title="æŸ¥çœ‹CPU å¤„ç†å™¨æ¶æ„"></a>æŸ¥çœ‹<strong>CPU å¤„ç†å™¨æ¶æ„</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -m</span><br></pre></td></tr></table></figure>
<p>æ˜¯<strong>x86_64</strong></p>
<h4 id="ä¸ç”¨éƒ¨ç½²äº†ï¼Œé•œåƒé‡Œæœ‰ï¼Œç›´æ¥ç”¨äº†"><a href="#ä¸ç”¨éƒ¨ç½²äº†ï¼Œé•œåƒé‡Œæœ‰ï¼Œç›´æ¥ç”¨äº†" class="headerlink" title="ä¸ç”¨éƒ¨ç½²äº†ï¼Œé•œåƒé‡Œæœ‰ï¼Œç›´æ¥ç”¨äº†"></a>ä¸ç”¨éƒ¨ç½²äº†ï¼Œé•œåƒé‡Œæœ‰ï¼Œç›´æ¥ç”¨äº†</h4><h4 id="ä½¿ç”¨libreofficeå¤„ç†docæ–‡ä»¶ï¼Œè½¬æˆpdf"><a href="#ä½¿ç”¨libreofficeå¤„ç†docæ–‡ä»¶ï¼Œè½¬æˆpdf" class="headerlink" title="ä½¿ç”¨libreofficeå¤„ç†docæ–‡ä»¶ï¼Œè½¬æˆpdf"></a>ä½¿ç”¨libreofficeå¤„ç†docæ–‡ä»¶ï¼Œè½¬æˆpdf</h4><p>å°†å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ <code>.doc</code> å’Œ <code>.docx</code> è½¬ä¸º PDFï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">libreoffice --headless --convert-to pdf *.doc *.docx --outdir ./pdf_output/</span><br><span class="line"></span><br><span class="line"># æ£€æŸ¥æ˜¯å¦æœ‰æ®‹ç•™è¿›ç¨‹</span><br><span class="line">ps aux | grep libreoffice</span><br><span class="line"></span><br><span class="line"># å¦‚æœæœ‰æ®‹ç•™è¿›ç¨‹ï¼Œæ€æ­»å®ƒä»¬</span><br><span class="line">killall soffice.bin 2&gt;/dev/null</span><br></pre></td></tr></table></figure>
<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import subprocess</span><br><span class="line">import argparse</span><br><span class="line">import glob</span><br><span class="line">from pathlib import Path</span><br><span class="line">def batch_convert_documents(input_path, output_dir):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ‰¹é‡è½¬æ¢æ–‡æ¡£çš„å‡½æ•°ç‰ˆæœ¬</span><br><span class="line">    </span><br><span class="line">    Args:</span><br><span class="line">        input_path (str): è¾“å…¥è·¯å¾„ï¼ˆæ–‡ä»¶ã€ç›®å½•æˆ–é€šé…ç¬¦ï¼‰</span><br><span class="line">        output_dir (str): è¾“å‡ºç›®å½•</span><br><span class="line">    </span><br><span class="line">    Returns:</span><br><span class="line">        bool: è½¬æ¢æ˜¯å¦æˆåŠŸ</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    </span><br><span class="line">    # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨</span><br><span class="line">    Path(output_dir).mkdir(parents=True, exist_ok=True)</span><br><span class="line">    </span><br><span class="line">    # æ”¶é›†æ‰€æœ‰è¦è½¬æ¢çš„æ–‡ä»¶</span><br><span class="line">    files_to_convert = []</span><br><span class="line">    </span><br><span class="line">    if os.path.isfile(input_path):</span><br><span class="line">        # å•ä¸ªæ–‡ä»¶</span><br><span class="line">        if input_path.lower().endswith((&#x27;.doc&#x27;, &#x27;.docx&#x27;)):</span><br><span class="line">            files_to_convert.append(input_path)</span><br><span class="line">    elif os.path.isdir(input_path):</span><br><span class="line">        # ç›®å½•ä¸­çš„æ‰€æœ‰doc/docxæ–‡ä»¶</span><br><span class="line">        for pattern in [&#x27;*.doc&#x27;, &#x27;*.docx&#x27;]:</span><br><span class="line">            files_to_convert.extend(glob.glob(os.path.join(input_path, pattern)))</span><br><span class="line">    else:</span><br><span class="line">        # é€šé…ç¬¦æ¨¡å¼</span><br><span class="line">        files_to_convert = glob.glob(input_path)</span><br><span class="line">        # è¿‡æ»¤å‡ºdocå’Œdocxæ–‡ä»¶</span><br><span class="line">        files_to_convert = [f for f in files_to_convert if f.lower().endswith((&#x27;.doc&#x27;, &#x27;.docx&#x27;))]</span><br><span class="line">    </span><br><span class="line">    if not files_to_convert:</span><br><span class="line">        print(&quot;æœªæ‰¾åˆ°è¦è½¬æ¢çš„æ–‡æ¡£æ–‡ä»¶&quot;)</span><br><span class="line">        return False</span><br><span class="line">    </span><br><span class="line">    print(f&quot;æ‰¾åˆ° &#123;len(files_to_convert)&#125; ä¸ªæ–‡ä»¶éœ€è¦è½¬æ¢&quot;)</span><br><span class="line">    </span><br><span class="line">    # æ„å»ºå‘½ä»¤</span><br><span class="line">    cmd = [</span><br><span class="line">        &#x27;libreoffice&#x27;,</span><br><span class="line">        &#x27;--headless&#x27;,</span><br><span class="line">        &#x27;--convert-to&#x27;, &#x27;pdf&#x27;,</span><br><span class="line">        &#x27;--outdir&#x27;, output_dir</span><br><span class="line">    ] + files_to_convert</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        print(&quot;æ­£åœ¨è½¬æ¢æ–‡ä»¶...&quot;)</span><br><span class="line">        result = subprocess.run(cmd, capture_output=True, text=True, timeout=600)</span><br><span class="line">        </span><br><span class="line">        if result.returncode == 0:</span><br><span class="line">            print(f&quot;æˆåŠŸè½¬æ¢ &#123;len(files_to_convert)&#125; ä¸ªæ–‡ä»¶&quot;)</span><br><span class="line">            return True</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;è½¬æ¢å¤±è´¥: &#123;result.stderr&#125;&quot;)</span><br><span class="line">            return False</span><br><span class="line">            </span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: &#123;e&#125;&quot;)</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    success = batch_convert_documents(&quot;./docs&quot;, &quot;./pdf_output&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="Linuxæ‰«ç›²"><a href="#Linuxæ‰«ç›²" class="headerlink" title="Linuxæ‰«ç›²"></a>Linuxæ‰«ç›²</h3><h4 id="å‘è¡Œç‰ˆ"><a href="#å‘è¡Œç‰ˆ" class="headerlink" title="å‘è¡Œç‰ˆ"></a>å‘è¡Œç‰ˆ</h4><p>åƒUbuntuï¼ŒCentOSéƒ½å±äºLinuxçš„å‘è¡Œç‰ˆï¼Œå°±åƒWindows11å±äºWindowsçš„å…³ç³»</p>
<p>å¸¸è§å‘è¡Œç‰ˆåˆ†ç±»ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>ç³»åˆ—</th>
<th>ä»£è¡¨å‘è¡Œç‰ˆ</th>
<th>åŒ…æ ¼å¼</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Debian ç³»</strong></td>
<td>Debianã€Ubuntuã€Kaliã€Linux Mint</td>
<td><code>.deb</code></td>
<td>åŒ…å¤šã€ç¤¾åŒºå¤§ã€æ•™ç¨‹å¤š</td>
</tr>
<tr>
<td><strong>Red Hat ç³»</strong></td>
<td>CentOSã€RHELã€Rockyã€Almaã€Fedora</td>
<td><code>.rpm</code></td>
<td>ä¼ä¸šçº§ç¨³å®šã€å®˜æ–¹æ”¯æŒé•¿</td>
</tr>
<tr>
<td><strong>SUSE ç³»</strong></td>
<td>openSUSE Leap / Tumbleweed</td>
<td><code>.rpm</code></td>
<td>YaST ç®¡ç†å·¥å…·ã€æ¬§æ´²æµè¡Œ</td>
</tr>
<tr>
<td><strong>Arch ç³»</strong></td>
<td>Arch Linuxã€Manjaro</td>
<td><code>.pkg.tar.zst</code></td>
<td>æ»šåŠ¨æ›´æ–°ã€æå®¢å‘</td>
</tr>
<tr>
<td><strong>è½»é‡/æœ€å°</strong></td>
<td>Alpineã€Debian netinstã€CentOS Stream Minimal</td>
<td>ä»»æ„</td>
<td>é•œåƒå°ã€èµ„æºå ç”¨ä½</td>
</tr>
</tbody>
</table>
</div>
<p>å¦‚ä½•æŸ¥çœ‹Linuxå‘è¡Œç‰ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/os-release</span><br></pre></td></tr></table></figure>
<h4 id="debå’Œrpm"><a href="#debå’Œrpm" class="headerlink" title="debå’Œrpm"></a>debå’Œrpm</h4><p> <code>.deb</code> å’Œ <code>.rpm</code> æƒ³è±¡æˆ <strong>â€œLinux ä¸–ç•Œé‡Œçš„å®‰è£…ç¨‹åºâ€</strong>ï¼Œå°±åƒ Windows çš„ <code>.exe</code> / <code>.msi</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>é€‚ç”¨ç³»ç»Ÿ</th>
<th>å®‰è£…å‘½ä»¤</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>.deb</code></strong></td>
<td>Debianã€Ubuntuã€Linux Mintã€Kali ç­‰</td>
<td><code>sudo dpkg -i xxx.deb</code> æˆ– <code>sudo apt install ./xxx.deb</code></td>
</tr>
<tr>
<td><strong><code>.rpm</code></strong></td>
<td>CentOSã€RHELã€Fedoraã€openSUSEã€Rockyã€Alma ç­‰</td>
<td><code>sudo rpm -ivh xxx.rpm</code> æˆ– <code>sudo dnf/yum install xxx.rpm</code></td>
</tr>
</tbody>
</table>
</div>
<h4 id="cpuå¤„ç†å™¨æ¶æ„"><a href="#cpuå¤„ç†å™¨æ¶æ„" class="headerlink" title="cpuå¤„ç†å™¨æ¶æ„"></a>cpuå¤„ç†å™¨æ¶æ„</h4><div class="table-container">
<table>
<thead>
<tr>
<th>ç›®å½•å</th>
<th>ä»£è¡¨æ¶æ„</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>x86_64</strong></td>
<td><strong>Intel/AMD 64 ä½</strong></td>
<td>ç»å¤§å¤šæ•°å°å¼æœºã€æœåŠ¡å™¨ï¼ˆå¦‚ Xeonã€EPYCã€Coreã€Ryzenï¼‰</td>
</tr>
<tr>
<td><strong>aarch64</strong></td>
<td><strong>ARM 64 ä½</strong></td>
<td>æ ‘è“æ´¾ 4/5ã€è‹¹æœ M ç³»åˆ—ï¼ˆAsahi Linuxï¼‰ã€é²²é¹ã€é£è…¾ã€Ampere ARM æœåŠ¡å™¨ç­‰</td>
</tr>
</tbody>
</table>
</div>
<p>æŸ¥çœ‹å¤„ç†å™¨æ¶æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -m</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/" class="post-title-link" itemprop="url">LangGraphå­¦ä¹ â€”â€”agentâ€”â€”ä¸Š</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-18T00:00:00+08:00">2025-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-13 09:25:22" itemprop="dateModified" datetime="2025-08-13T09:25:22+08:00">2025-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ¬æ•™ç¨‹ä¸ºlangchainå®˜æ–¹æ•™ç¨‹çš„å­¦ä¹ è®°å½•</p>
<p><a target="_blank" rel="noopener" href="https://academy.langchain.com/enrollments">academy.langchain.com/enrollments</a></p>
<p>ä»£ç è§<a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain"><a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain/tree/main/academy-langgraph">learn-rag-langchain/academy-langgraph at main Â· zxj-2023/learn-rag-langchain</a></a></p>
<h3 id="module-1"><a href="#module-1" class="headerlink" title="module-1"></a>module-1</h3><h4 id="routeè·¯ç”±"><a href="#routeè·¯ç”±" class="headerlink" title="routeè·¯ç”±"></a>routeè·¯ç”±</h4><p>åœ¨ LangGraph ä¸­ï¼Œ<strong>routeï¼ˆè·¯ç”±ï¼‰\</strong>çš„æ ¸å¿ƒä½œç”¨æ˜¯*<em>æ ¹æ®å½“å‰çŠ¶æ€åŠ¨æ€å†³å®šâ€œä¸‹ä¸€æ­¥åº”è¯¥æ‰§è¡Œå“ªä¸ªèŠ‚ç‚¹â€*</em></p>
<h5 id="å®šä¹‰å·¥å…·"><a href="#å®šä¹‰å·¥å…·" class="headerlink" title="å®šä¹‰å·¥å…·"></a>å®šä¹‰å·¥å…·</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def multiply(a: int, b: int) -&gt; int:</span><br><span class="line">    &quot;&quot;&quot;Multiply a and b.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        a: first int</span><br><span class="line">        b: second int</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return a * b</span><br><span class="line">    </span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line">llm_with_tools = llm.bind_tools([multiply])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸‰å¼•å·å­—ç¬¦ä¸²å« <strong>docstring</strong>ï¼Œå®ƒä¼šè¢« LangChain æ‹¿æ¥åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li><strong>ç”Ÿæˆå·¥å…·çš„ descriptionï¼ˆç»™å¤§æ¨¡å‹çœ‹çš„â€œè¯´æ˜ä¹¦â€ï¼‰</strong><br>æ²¡æœ‰å®ƒæ—¶ï¼ŒLangChain åªèƒ½é€€è€Œæ±‚å…¶æ¬¡ï¼ŒæŠŠå‡½æ•°å <code>multiply</code> æ‹¼æˆä¸€å¥ â€œmultiply toolâ€ ä¹‹ç±»çš„é»˜è®¤æè¿°ã€‚å¤§æ¨¡å‹æ‹¿åˆ°çš„å·¥å…·åˆ—è¡¨é‡Œï¼Œè¿™ä¸ªå·¥å…·å°±åªæœ‰ä¸€ä¸ªå¹²å·´å·´çš„åå­—å’Œå‚æ•°åˆ—è¡¨ï¼Œå®ƒå¯èƒ½çŒœä¸åˆ°è¿™ä¸ªå·¥å…·åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„</li>
<li><strong>ç»™äººç±»å¼€å‘è€…è‡ªå·±çœ‹</strong><br>IDEã€æ–‡æ¡£ç”Ÿæˆå™¨ã€é™æ€æ£€æŸ¥å·¥å…·éƒ½ä¼šè¯»å–è¿™æ®µæ–‡å­—ï¼Œæ–¹ä¾¿åæœŸç»´æŠ¤ã€‚</li>
</ol>
</blockquote>
<h5 id="æ„å»ºæ¡ä»¶è¾¹"><a href="#æ„å»ºæ¡ä»¶è¾¹" class="headerlink" title="æ„å»ºæ¡ä»¶è¾¹"></a>æ„å»ºæ¡ä»¶è¾¹</h5><p><code>tool_calling_llm</code> æ˜¯ä¸€ä¸ª<strong>æ™®é€šçš„è®¡ç®—èŠ‚ç‚¹</strong>ï¼ˆnodeï¼‰ï¼Œè´Ÿè´£æŠŠå½“å‰å¯¹è¯çŠ¶æ€äº¤ç»™å¤§æ¨¡å‹ï¼Œè®©å¤§æ¨¡å‹å†³å®šè¦ä¸è¦è°ƒç”¨å·¥å…·ï¼›</p>
<p>çœŸæ­£å®Œæˆâ€œè·¯ç”±â€åŠ¨ä½œçš„æ˜¯ <strong><code>tools_condition</code></strong> è¿™ä¸ªå‡½æ•°â€”â€”å®ƒæ‰æ˜¯ LangGraph é‡Œçš„ <strong>routeï¼ˆæ¡ä»¶è¾¹ï¼‰</strong>ã€‚</p>
<p><code>tools_condition</code> æ˜¯ ä½œä¸º<strong>LangGraph é¢„ç½®çš„â€œé»˜è®¤è·¯ç”±å‡½æ•°â€</strong>ï¼ŒåŠŸèƒ½å°±æ˜¯ï¼Œå¦‚æœå¤§æ¨¡å‹çš„æœ€æ–°å›å¤ä¸­åŒ…å«å·¥å…·è°ƒç”¨ï¼Œå°±è°ƒç”¨å·¥å…·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Node</span><br><span class="line">def tool_calling_llm(state: MessagesState):</span><br><span class="line">	#è°ƒç”¨å¤§æ¨¡å‹åå°†æœ€æ–°çš„æ¶ˆæ¯è¿”å›</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm_with_tools.invoke(state[&quot;messages&quot;])]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">#MessagesState æ˜¯ LangGraph å®˜æ–¹é¢„ç½® çš„ä¸€ç§ çŠ¶æ€ï¼ˆStateï¼‰å®šä¹‰</span><br><span class="line">#è¿™ä¸ªçŠ¶æ€ç»´æŠ¤äº†ä¸€ä¸ªæ¶ˆæ¯listï¼Œæœ‰æ–°çš„æ¶ˆæ¯å°±åŠ è¿›è¿™ä¸ªæ¶ˆæ¯list</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;tool_calling_llm&quot;, tool_calling_llm)</span><br><span class="line">builder.add_node(&quot;tools&quot;, ToolNode([multiply]))</span><br><span class="line">builder.add_edge(START, &quot;tool_calling_llm&quot;)</span><br><span class="line">builder.add_conditional_edges(</span><br><span class="line">    &quot;tool_calling_llm&quot;,</span><br><span class="line">    # å¦‚æœåŠ©æ‰‹ï¼ˆç»“æœï¼‰çš„æœ€æ–°æ¶ˆæ¯æ˜¯å·¥å…·è°ƒç”¨ -&gt; tools_condition è·¯ç”±åˆ°å·¥å…·</span><br><span class="line">    # å¦‚æœåŠ©æ‰‹ï¼ˆç»“æœï¼‰çš„æœ€æ–°æ¶ˆæ¯ä¸æ˜¯å·¥å…·è°ƒç”¨ -&gt; tools_condition è·¯ç”±åˆ° END</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line">builder.add_edge(&quot;tools&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719142543838.png" alt="image-20250719142543838"></p>
<h5 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import HumanMessage</span><br><span class="line">messages = [HumanMessage(content=&quot;ä½ å¥½ï¼Œ2ä¹˜2æ˜¯å¤šå°‘&quot;)]</span><br><span class="line">messages = graph.invoke(&#123;&quot;messages&quot;: messages&#125;)</span><br><span class="line">for m in messages[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼Œ2ä¹˜2æ˜¯å¤šå°‘</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_e026ceb409e247748786ad)</span><br><span class="line"> Call ID: call_e026ceb409e247748786ad</span><br><span class="line">  Args:</span><br><span class="line">    a: 2</span><br><span class="line">    b: 2</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h4 id="agentä»£ç†"><a href="#agentä»£ç†" class="headerlink" title="agentä»£ç†"></a>agentä»£ç†</h4><p>åœ¨ LangGraph ä¸­ï¼Œ<strong>ä»£ç†ï¼ˆAgentï¼‰</strong> è¢«æ˜ç¡®å®šä¹‰ä¸º<strong>â€œä¸€ä¸ªç”±å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é©±åŠ¨çš„ã€èƒ½å¤Ÿå¾ªç¯å†³ç­–å¹¶è°ƒç”¨å¤–éƒ¨å·¥å…·æ¥å®Œæˆä»»åŠ¡çš„èŠ‚ç‚¹æˆ–å­å›¾â€</strong>ã€‚</p>
<p><strong>Agent = LLM + å·¥å…·é›†åˆ + æç¤ºæ¨¡æ¿</strong>ï¼Œä¸‰è€…åœ¨ LangGraph çš„çŠ¶æ€åŒ–å›¾ç»“æ„é‡Œå¾ªç¯è¿è¡Œï¼Œç›´åˆ°æ»¡è¶³åœæ­¢æ¡ä»¶ã€‚</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2210.03629">ReAct</a> æ˜¯ä¸€ç§æµè¡Œçš„é€šç”¨æ™ºèƒ½ä½“æ¶æ„ï¼Œå®ƒç»“åˆäº†è¿™äº›æ‰©å±•ï¼Œå¹¶æ•´åˆäº†ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/agentic_concepts/#tool-calling">å·¥å…·è°ƒç”¨</a>ï¼šå…è®¸LLMæ ¹æ®éœ€è¦é€‰æ‹©å’Œä½¿ç”¨å„ç§å·¥å…·ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/agentic_concepts/#memory">è®°å¿†</a>ï¼šä½¿æ™ºèƒ½ä½“èƒ½å¤Ÿä¿ç•™å’Œä½¿ç”¨ä¹‹å‰æ­¥éª¤çš„ä¿¡æ¯ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/agentic_concepts/#planning">è§„åˆ’</a>ï¼šä½¿LLMèƒ½å¤Ÿåˆ›å»ºå¹¶éµå¾ªå¤šæ­¥è®¡åˆ’ä»¥å®ç°ç›®æ ‡ã€‚</li>
</ol>
<p>å³</p>
<p><code>act</code>- è®©æ¨¡å‹è°ƒç”¨ç‰¹å®šå·¥å…·</p>
<p><code>observe</code> - å°†å·¥å…·è¾“å‡ºä¼ é€’å›æ¨¡å‹  </p>
<p> <code>reason</code> - è®©æ¨¡å‹å¯¹å·¥å…·è¾“å‡ºè¿›è¡Œæ¨ç†ï¼Œä»¥å†³å®šä¸‹ä¸€æ­¥æ“ä½œï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨å¦ä¸€ä¸ªå·¥å…·æˆ–ç›´æ¥å“åº”ï¼‰</p>
</blockquote>
<h5 id="å®šä¹‰å·¥å…·-1"><a href="#å®šä¹‰å·¥å…·-1" class="headerlink" title="å®šä¹‰å·¥å…·"></a>å®šä¹‰å·¥å…·</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tools = [add, multiply, divide]#å·¥å…·å‡½æ•°å…·ä½“å†…å®¹çœç•¥</span><br><span class="line">llm = ChatOpenAI()</span><br><span class="line"></span><br><span class="line"># åœ¨è¿™ä¸ª ipynb æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†å¹¶è¡Œå·¥å…·è°ƒç”¨ï¼ˆparallel tool callingï¼‰è®¾ç½®ä¸º falseï¼Œå› ä¸ºæ•°å­¦è®¡ç®—é€šå¸¸æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œå¹¶ä¸”è¿™æ¬¡æˆ‘ä»¬æœ‰3ä¸ªå¯ä»¥è¿›è¡Œæ•°å­¦è®¡ç®—çš„å·¥å…·ã€‚</span><br><span class="line"># OpenAI æ¨¡å‹ä¸ºäº†æ•ˆç‡ï¼Œé»˜è®¤è¿›è¡Œå¹¶è¡Œå·¥å…·è°ƒç”¨ï¼Œè¯¦æƒ…è¯·å‚é˜… `https://python.langchain.com/docs/how_to/tool_calling_parallel/`</span><br><span class="line"># ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ¨¡å‹åœ¨å¤„ç†æ•°å­¦æ–¹ç¨‹å¼æ—¶çš„è¡¨ç°ï¼</span><br><span class="line">llm_with_tools = llm.bind_tools(tools, parallel_tool_calls=False)</span><br></pre></td></tr></table></figure>
<h5 id="åˆ›å»ºä»£ç†"><a href="#åˆ›å»ºä»£ç†" class="headerlink" title="åˆ›å»ºä»£ç†"></a>åˆ›å»ºä»£ç†</h5><p>å®šä¹‰èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import MessagesState</span><br><span class="line">from langchain_core.messages import HumanMessage, SystemMessage</span><br><span class="line"></span><br><span class="line"># System message</span><br><span class="line">sys_msg = SystemMessage(content=&quot;ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼Œè´Ÿè´£å¯¹ä¸€ç»„è¾“å…¥æ‰§è¡Œç®—æœ¯è¿ç®—ã€‚&quot;)</span><br><span class="line"></span><br><span class="line"># Node</span><br><span class="line">def assistant(state: MessagesState):</span><br><span class="line">   return &#123;&quot;messages&quot;: [llm_with_tools.invoke([sys_msg] + state[&quot;messages&quot;])]&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥ç›¸å½“äºå®šä¹‰äº†ç³»ç»Ÿæç¤ºè¯ï¼Œç„¶ååœ¨ assistant è¿™ä¸ªèŠ‚ç‚¹é‡Œï¼Œé€šè¿‡ [sys_msg] + state[â€œmessagesâ€] è¿™éƒ¨åˆ†ä»£ç ï¼Œè¿™ä¸ªç³»ç»Ÿæç¤ºè¯è¢«æ·»åŠ åˆ°äº†æ•´ä¸ªå¯¹è¯å†å²çš„æœ€å‰é¢ï¼Œç„¶åä¸€èµ·å‘é€ç»™æ¨¡å‹ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆå›å¤æ—¶å°±ä¼šéµå¾ªè¿™ä¸ªç³»ç»Ÿæç¤ºè¯çš„æŒ‡ç¤ºã€‚</p>
<p>ä¸ä¸Šä¸€ä¸ªä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å°† <code>Tools</code> èŠ‚ç‚¹ <strong>å›ç¯</strong> è¿æ¥åˆ° <code>Assistant</code>ï¼Œä»è€Œå½¢æˆä¸€ä¸ªå›è·¯ã€‚</p>
<p>åœ¨ assistantèŠ‚ç‚¹æ‰§è¡Œåï¼Œ<code>tools_condition</code>æ£€æŸ¥æ¨¡å‹çš„è¾“å‡ºæ˜¯å¦ä¸ºå·¥å…·è°ƒç”¨ã€‚</p>
<p>å¦‚æœæ˜¯å·¥å…·è°ƒç”¨ï¼Œåˆ™æµç¨‹è¢«å¯¼å‘è‡³ <code>tools</code> èŠ‚ç‚¹ã€‚  </p>
<p><code>tools</code>èŠ‚ç‚¹é‡æ–°è¿æ¥åˆ°<code>assistant</code><strong>ã€‚</strong> åªè¦æ¨¡å‹å†³å®šè°ƒç”¨å·¥å…·ï¼Œæ­¤å¾ªç¯å°±ä¼šç»§ç»­ã€‚  </p>
<p>å¦‚æœæ¨¡å‹çš„å“åº”ä¸æ˜¯å·¥å…·è°ƒç”¨ï¼Œåˆ™æµç¨‹è¢«å¯¼å‘è‡³ç»“æŸï¼Œç»ˆæ­¢è¯¥è¿‡ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line"></span><br><span class="line"># Define nodes: these do the work</span><br><span class="line">builder.add_node(&quot;assistant&quot;, assistant)</span><br><span class="line">builder.add_node(&quot;tools&quot;, ToolNode(tools))</span><br><span class="line"></span><br><span class="line"># Define edges: these determine how the control flow moves</span><br><span class="line">builder.add_edge(START, &quot;assistant&quot;)</span><br><span class="line">builder.add_conditional_edges(</span><br><span class="line">    &quot;assistant&quot;,</span><br><span class="line">    # If the latest message (result) from assistant is a tool call -&gt; tools_condition routes to tools</span><br><span class="line">    # If the latest message (result) from assistant is a not a tool call -&gt; tools_condition routes to END</span><br><span class="line">    tools_condition,</span><br><span class="line">)</span><br><span class="line">builder.add_edge(&quot;tools&quot;, &quot;assistant&quot;)</span><br><span class="line">react_graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># Show</span><br><span class="line">display(Image(react_graph.get_graph(xray=True).draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719145948088.png" alt="image-20250719145948088"></p>
<h5 id="è°ƒç”¨-1"><a href="#è°ƒç”¨-1" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">messages = [HumanMessage(content=&quot;å°†3å’Œ4ç›¸åŠ ã€‚å°†ç»“æœä¹˜ä»¥2ã€‚å†å°†ç»“æœé™¤ä»¥5ã€‚&quot;)]</span><br><span class="line">messages = react_graph.invoke(&#123;&quot;messages&quot;: messages&#125;)</span><br><span class="line"></span><br><span class="line">for m in messages[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>parallel_tool_calls=Falseçš„è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">å°†3å’Œ4ç›¸åŠ ã€‚å°†ç»“æœä¹˜ä»¥2ã€‚å†å°†ç»“æœé™¤ä»¥5ã€‚</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  add (call_6c69898dba0342bfbb889e)</span><br><span class="line"> Call ID: call_6c69898dba0342bfbb889e</span><br><span class="line">  Args:</span><br><span class="line">    a: 3</span><br><span class="line">    b: 4</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: add</span><br><span class="line"></span><br><span class="line">7</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_9940e7603ecf4a13a5f2fb)</span><br><span class="line"> Call ID: call_9940e7603ecf4a13a5f2fb</span><br><span class="line">  Args:</span><br><span class="line">    a: 7</span><br><span class="line">    b: 2</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">14</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  divide (call_d48fbbe205a14dfbaa3500)</span><br><span class="line"> Call ID: call_d48fbbe205a14dfbaa3500</span><br><span class="line">  Args:</span><br><span class="line">    a: 14</span><br><span class="line">    b: 5</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: divide</span><br><span class="line"></span><br><span class="line">2.8</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœæ˜¯2.8ã€‚</span><br></pre></td></tr></table></figure>
<p>parallel_tool_calls=Trueçš„è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">å°†3å’Œ4ç›¸åŠ ã€‚å°†ç»“æœä¹˜ä»¥2ã€‚å†å°†ç»“æœé™¤ä»¥5ã€‚</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  add (call_e0c7d8e65f2c49e8aecd3e)</span><br><span class="line"> Call ID: call_e0c7d8e65f2c49e8aecd3e</span><br><span class="line">  Args:</span><br><span class="line">    a: 3</span><br><span class="line">    b: 4</span><br><span class="line">  multiply (call_5bf824058e64489aaace91)</span><br><span class="line"> Call ID: call_5bf824058e64489aaace91</span><br><span class="line">  Args:</span><br><span class="line">    a: 7</span><br><span class="line">    b: 2</span><br><span class="line">  divide (call_36c34f69f6574028b28847)</span><br><span class="line"> Call ID: call_36c34f69f6574028b28847</span><br><span class="line">  Args:</span><br><span class="line">    a: 14</span><br><span class="line">    b: 5</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: add</span><br><span class="line"></span><br><span class="line">7</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">14</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: divide</span><br><span class="line"></span><br><span class="line">2.8</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆç»“æœæ˜¯ **2.8**ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="Agent-memoryä»£ç†è®°å¿†"><a href="#Agent-memoryä»£ç†è®°å¿†" class="headerlink" title="Agent memoryä»£ç†è®°å¿†"></a>Agent memoryä»£ç†è®°å¿†</h4><p>ä½¿ç”¨chekpointeræ£€æŸ¥ç‚¹çš„åŠŸèƒ½ï¼Œæœ€ç®€å•çš„æ£€æŸ¥ç‚¹ä¹‹ä¸€æ˜¯ <code>MemorySaver</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå›¾å½¢çŠ¶æ€çš„å†…å­˜é”®å€¼å­˜å‚¨ã€‚</p>
<p>è¿™ä¸ªæ£€æŸ¥ç‚¹å°±ç›¸å½“äºæŠŠ<strong>å›¾çš„æ¯ä¸€æ¬¡â€œçŠ¶æ€å¿«ç…§â€æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨</strong>çš„æœºåˆ¶ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">memory = MemorySaver()</span><br><span class="line">react_graph_memory = builder.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/persistence/">è®°å¿†åŠŸèƒ½</a> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼LangGraph å¯ä»¥ä½¿ç”¨æ£€æŸ¥ç‚¹å·¥å…·åœ¨æ¯ä¸€æ­¥ä¹‹åè‡ªåŠ¨ä¿å­˜å›¾çš„çŠ¶æ€ã€‚è¿™ä¸€å†…ç½®çš„æŒä¹…åŒ–å±‚ä¸ºæˆ‘ä»¬æä¾›äº†å†…å­˜åŠŸèƒ½ï¼Œä½¿ LangGraph èƒ½å¤Ÿä»æœ€åä¸€æ¬¡çŠ¶æ€æ›´æ–°å¤„ç»§ç»­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Specify a thread</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Specify an input</span><br><span class="line">messages = [HumanMessage(content=&quot;Add 3 and 4.&quot;)]</span><br><span class="line"></span><br><span class="line"># Run</span><br><span class="line">messages = react_graph_memory.invoke(&#123;&quot;messages&quot;: messages&#125;,config)</span><br><span class="line">for m in messages[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬ä½¿ç”¨å†…å­˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸€ä¸ª <code>thread_id</code>ã€‚è¿™ <code>thread_id</code> å°†å­˜å‚¨æˆ‘ä»¬çš„å›¾å½¢çŠ¶æ€é›†åˆã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œæ£€æŸ¥ç‚¹åœ¨å›¾çš„æ¯ä¸€æ­¥å†™å…¥çŠ¶æ€ï¼Œè¿™äº›æ£€æŸ¥ç‚¹ä¿å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>thread_id</code> åœ¨æœªæ¥è®¿é—®è¯¥çº¿ç¨‹</p>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66e0e9f526b41a4ed9e2d28b_agent-memory2.png" alt="state.jpg"></p>
<h3 id="module-2"><a href="#module-2" class="headerlink" title="module-2"></a>module-2</h3><h4 id="state-schemeçŠ¶æ€æ¨¡å¼"><a href="#state-schemeçŠ¶æ€æ¨¡å¼" class="headerlink" title="state-schemeçŠ¶æ€æ¨¡å¼"></a>state-schemeçŠ¶æ€æ¨¡å¼</h4><p>LangGraph çš„ <strong>state-schemeï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰</strong> å°±æ˜¯â€œä¸€å¼ <strong>è“å›¾</strong>â€ï¼Œå®ƒå‘Šè¯‰æ¡†æ¶ï¼šâ€œåœ¨æ•´ä¸ªå›¾çš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼ŒçŠ¶æ€å¯¹è±¡åº”è¯¥é•¿ä»€ä¹ˆæ ·ã€æ¯ä¸ªå­—æ®µæ€æ ·è¢«æ›´æ–°ã€ä»¥åŠèŠ‚ç‚¹ä¹‹é—´å¦‚ä½•å…±äº«æˆ–éš”ç¦»æ•°æ®ã€‚â€</p>
<p>state-scheme ç”¨ <strong>TypedDict</strong> æˆ– <strong>Pydantic BaseModel</strong> æ¥å£°æ˜ï¼Œå®šä¹‰äº†ï¼š</p>
<ul>
<li>çŠ¶æ€é‡Œæœ‰å“ªäº›å­—æ®µï¼ˆkeyï¼‰</li>
<li>æ¯ä¸ªå­—æ®µçš„ Python ç±»å‹</li>
<li><strong>å¯é€‰</strong> è¯¥å­—æ®µçš„ <strong>reducer</strong>ï¼ˆæ›´æ–°è§„åˆ™ï¼‰</li>
</ul>
<h5 id="TypedDict"><a href="#TypedDict" class="headerlink" title="TypedDict"></a><strong>TypedDict</strong></h5><p><strong>åŸºæœ¬å®šä¹‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from typing_extensions import TypedDict</span><br><span class="line"></span><br><span class="line">class TypedDictState(TypedDict):</span><br><span class="line">    foo: str</span><br><span class="line">    bar: str</span><br></pre></td></tr></table></figure>
<p><strong>å¯å¢åŠ åƒ <code>Literal</code> è¿™æ ·çš„ç±»å‹æç¤ºï¼Œä½¿å…¶æ›´æœ‰ä»·å€¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from typing import Literal</span><br><span class="line"></span><br><span class="line">class TypedDictState(TypedDict):</span><br><span class="line">    name: str</span><br><span class="line">    mood: Literal[&quot;happy&quot;,&quot;sad&quot;]</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ<code>mood</code> åªèƒ½æ˜¯ â€œhappyâ€ æˆ– â€œsadâ€ã€‚</p>
<p><strong>åŠ  reducerï¼šè®©æ›´æ–°â€œå¯è¿½åŠ â€è€Œä¸è¦†ç›–</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class MathState(TypedDict):</span><br><span class="line">    question: str</span><br><span class="line">    scratchpad: Annotated[list[str], add_message]  # æ–°å…ƒç´ è‡ªåŠ¨è¿½åŠ </span><br><span class="line">    answer: int</span><br></pre></td></tr></table></figure>
<p><code>Annotated[list[str], add]</code> å‘Šè¯‰ LangGraphï¼šå½“èŠ‚ç‚¹è¿”å› <code>&#123;&quot;scratchpad&quot;: [&quot;æ–°æ­¥éª¤&quot;]&#125;</code> æ—¶ï¼Œ<strong>è¿½åŠ </strong>åˆ°ç°æœ‰åˆ—è¡¨ï¼Œè€Œä¸æ˜¯æ›¿æ¢</p>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import random</span><br><span class="line">from IPython.display import Image, display</span><br><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line">#å®šä¹‰èŠ‚ç‚¹</span><br><span class="line">def node_1(state):</span><br><span class="line">    print(&quot;---Node 1---&quot;)</span><br><span class="line">    return &#123;&quot;name&quot;: state[&#x27;name&#x27;] + &quot; is ... &quot;&#125;</span><br><span class="line"></span><br><span class="line">def node_2(state):</span><br><span class="line">    print(&quot;---Node 2---&quot;)</span><br><span class="line">    return &#123;&quot;mood&quot;: &quot;happy&quot;&#125;</span><br><span class="line"></span><br><span class="line">def node_3(state):</span><br><span class="line">    print(&quot;---Node 3---&quot;)</span><br><span class="line">    return &#123;&quot;mood&quot;: &quot;sad&quot;&#125;</span><br><span class="line">#è·¯ç”±å‡½æ•°</span><br><span class="line">def decide_mood(state) -&gt; Literal[&quot;node_2&quot;, &quot;node_3&quot;]:</span><br><span class="line">        </span><br><span class="line">    # Here, let&#x27;s just do a 50 / 50 split between nodes 2, 3</span><br><span class="line">    if random.random() &lt; 0.5:</span><br><span class="line"></span><br><span class="line">        # 50% of the time, we return Node 2</span><br><span class="line">        return &quot;node_2&quot;</span><br><span class="line">    </span><br><span class="line">    # 50% of the time, we return Node 3</span><br><span class="line">    return &quot;node_3&quot;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(TypedDictState)</span><br><span class="line">builder.add_node(&quot;node_1&quot;, node_1)</span><br><span class="line">builder.add_node(&quot;node_2&quot;, node_2)</span><br><span class="line">builder.add_node(&quot;node_3&quot;, node_3)</span><br><span class="line"></span><br><span class="line"># Logic</span><br><span class="line">builder.add_edge(START, &quot;node_1&quot;)</span><br><span class="line">builder.add_conditional_edges(&quot;node_1&quot;, decide_mood)</span><br><span class="line">builder.add_edge(&quot;node_2&quot;, END)</span><br><span class="line">builder.add_edge(&quot;node_3&quot;, END)</span><br><span class="line"></span><br><span class="line"># Add</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719154439415.png" alt="image-20250719154439415"></p>
<p>å› ä¸ºæˆ‘ä»¬çš„çŠ¶æ€æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œæˆ‘ä»¬åªéœ€ç”¨ä¸€ä¸ªå­—å…¸è°ƒç”¨å›¾ï¼Œä»¥è®¾ç½®çŠ¶æ€ä¸­ <code>name</code> é”®çš„åˆå§‹å€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.invoke(&#123;&quot;name&quot;:&quot;Lance&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="Dataclassæ•°æ®ç±»"><a href="#Dataclassæ•°æ®ç±»" class="headerlink" title="Dataclassæ•°æ®ç±»"></a><strong>Dataclassæ•°æ®ç±»</strong></h5><p>pythonçš„dataclassesåº“æä¾›äº†ä¸€ç§ç®€æ´çš„è¯­æ³•ï¼Œç”¨äºåˆ›å»ºä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®çš„ç±»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from dataclasses import dataclass</span><br><span class="line"></span><br><span class="line">@dataclass</span><br><span class="line">class DataclassState:</span><br><span class="line">    name: str</span><br><span class="line">    mood: Literal[&quot;happy&quot;,&quot;sad&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def node_1(state):</span><br><span class="line">    print(&quot;---Node 1---&quot;)</span><br><span class="line">    return &#123;&quot;name&quot;: state.name + &quot; is ... &quot;&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(DataclassState)</span><br><span class="line">builder.add_node(&quot;node_1&quot;, node_1)</span><br><span class="line">builder.add_node(&quot;node_2&quot;, node_2)</span><br><span class="line">builder.add_node(&quot;node_3&quot;, node_3)</span><br><span class="line"></span><br><span class="line"># Logic</span><br><span class="line">builder.add_edge(START, &quot;node_1&quot;)</span><br><span class="line">builder.add_conditional_edges(&quot;node_1&quot;, decide_mood)</span><br><span class="line">builder.add_edge(&quot;node_2&quot;, END)</span><br><span class="line">builder.add_edge(&quot;node_3&quot;, END)</span><br><span class="line"></span><br><span class="line"># Add</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p>è¦è®¿é—® <code>dataclass</code> çš„é”®ï¼Œæˆ‘ä»¬åªéœ€ä¿®æ”¹åœ¨ <code>node_1</code> ä¸­ä½¿ç”¨çš„ä¸‹æ ‡å³å¯ï¼š</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>state.name</code> æ¥è¡¨ç¤º <code>dataclass</code> çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>state[&quot;name&quot;]</code> æ¥è¡¨ç¤ºä¸Šé¢çš„ <code>TypedDict</code>ã€‚</p>
<p>ä½ ä¼šæ³¨æ„åˆ°ä¸€ä¸ªæœ‰ç‚¹å¥‡æ€ªçš„åœ°æ–¹ï¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶è¿”å›ä¸€ä¸ªå­—å…¸æ¥æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚</p>
<p><strong>Dataclass åªæ˜¯â€œæè¿°â€çŠ¶æ€çš„å½¢çŠ¶ï¼Œè€ŒçœŸæ­£åœ¨ LangGraph çš„èŠ‚ç‚¹ä¹‹é—´æµåŠ¨çš„ä¾æ—§æ˜¯ã€Œå­—å…¸ã€</strong>ï¼Œè¿™æ˜¯æ¡†æ¶è®¾è®¡å±‚é¢çš„çº¦å®š</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>dataclass</code> æ‹¥æœ‰é”® <code>name</code>ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»èŠ‚ç‚¹ä¼ é€’ä¸€ä¸ªå­—å…¸æ¥æ›´æ–°å®ƒï¼Œå°±åƒåœ¨çŠ¶æ€ä¸º <code>TypedDict</code> æ—¶æ‰€åšçš„é‚£æ ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.invoke(DataclassState(name=&quot;Lance&quot;,mood=&quot;sad&quot;))</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡ <code>dataclass</code> æ¥è®¾ç½®çŠ¶æ€ä¸­æ¯ä¸ªé”®/é€šé“çš„åˆå§‹å€¼ï¼</p>
<h4 id="State-ReducersçŠ¶æ€æ›´æ–°å‡½æ•°"><a href="#State-ReducersçŠ¶æ€æ›´æ–°å‡½æ•°" class="headerlink" title="State ReducersçŠ¶æ€æ›´æ–°å‡½æ•°"></a><strong>State Reducers</strong>çŠ¶æ€æ›´æ–°å‡½æ•°</h4><p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/concepts/low_level/#reducers">Reducers</a> ä¸ºæˆ‘ä»¬æŒ‡å®šäº†å¦‚ä½•æ‰§è¡Œæ›´æ–°ã€‚å®ƒæ¥æ”¶ <strong>æ—§çŠ¶æ€</strong> ä¸ <strong>ä¸€æ¬¡å˜æ›´æŒ‡ä»¤ï¼ˆaction / å¢é‡å­—æ®µï¼‰</strong>ï¼Œ<strong>è¿”å›å…¨æ–°çš„çŠ¶æ€å¯¹è±¡</strong>ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­<strong>ä¸èƒ½ä¿®æ”¹åŸæœ‰æ•°æ®</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Annotated</code> ç±»å‹æ¥æŒ‡å®šä¸€ä¸ª reducer å‡½æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®©æˆ‘ä»¬å°†æ¯ä¸ªèŠ‚ç‚¹è¿”å›çš„å€¼é™„åŠ åˆ°ç»“æœä¸­ï¼Œè€Œä¸æ˜¯è¦†ç›–å®ƒä»¬ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from operator import add</span><br><span class="line">from typing import Annotated</span><br><span class="line"></span><br><span class="line">class State(TypedDict):</span><br><span class="line">    foo: Annotated[list[int], add]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå¯ä»¥æ‰§è¡Œæ­¤æ“ä½œçš„ç¼©å‡å™¨ï¼š<code>operator.add</code> æ˜¯ Python å†…ç½® operator æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚å½“ <code>operator.add</code> åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œå®ƒæ‰§è¡Œåˆ—è¡¨è¿æ¥ã€‚</p>
<h5 id="Custom-Reducers-è‡ªå®šä¹‰-Reducers"><a href="#Custom-Reducers-è‡ªå®šä¹‰-Reducers" class="headerlink" title="Custom Reducers è‡ªå®šä¹‰ Reducers"></a><strong>Custom Reducers è‡ªå®šä¹‰ Reducers</strong></h5><p>æˆ‘ä»¬åŒæ ·å¯ä»¥è‡ªå®šä¹‰reducerså‡½æ•°ï¼Œè§£å†³ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ï¼Œå¦‚ä¸‹å¯ä»¥è§£å†³ä¼ å…¥å‚æ•°ä¸ºnoneçš„æƒ…å†µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">def reduce_list(left: list | None, right: list | None) -&gt; list:</span><br><span class="line">    &quot;&quot;&quot;å®‰å…¨åœ°åˆå¹¶ä¸¤ä¸ªåˆ—è¡¨ï¼Œå¤„ç†å…¶ä¸­ä¸€ä¸ªæˆ–ä¸¤ä¸ªè¾“å…¥å¯èƒ½ä¸º None çš„æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">    å‚æ•°ï¼š</span><br><span class="line">        left (list | None): è¦åˆå¹¶çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ– Noneã€‚</span><br><span class="line">        right (list | None): è¦åˆå¹¶çš„ç¬¬äºŒä¸ªåˆ—è¡¨ï¼Œæˆ– Noneã€‚</span><br><span class="line"></span><br><span class="line">    è¿”å›ï¼š</span><br><span class="line">        list: ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªè¾“å…¥åˆ—è¡¨æ‰€æœ‰å…ƒç´ çš„æ–°åˆ—è¡¨ã€‚</span><br><span class="line">               å¦‚æœè¾“å…¥ä¸º Noneï¼Œåˆ™å°†å…¶è§†ä¸ºç©ºåˆ—è¡¨ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if not left:</span><br><span class="line">        left = []</span><br><span class="line">    if not right:</span><br><span class="line">        right = []</span><br><span class="line">    return left + right</span><br><span class="line"></span><br><span class="line">class DefaultState(TypedDict):</span><br><span class="line">    foo: Annotated[list[int], add]</span><br><span class="line"></span><br><span class="line">class CustomReducerState(TypedDict):</span><br><span class="line">    foo: Annotated[list[int], reduce_list]</span><br></pre></td></tr></table></figure>
<h5 id="MessagesState"><a href="#MessagesState" class="headerlink" title="MessagesState"></a>MessagesState</h5><p>æˆ‘å¯ä»¥ä½¿ç”¨å†…ç½®çš„ reducer <code>add_messages</code> æ¥å¤„ç†çŠ¶æ€ä¸­çš„æ¶ˆæ¯</p>
<p>è€Œ<em><code>MessagesState</code></em> <em>å†…ç½®äº†ä¸€ä¸ª</em> <em><code>messages</code></em> é”® å®ƒè¿˜ä¸ºè¯¥é”®å†…ç½®äº†ä¸€ä¸ª <code>add_messages</code> åˆå¹¶å™¨ï¼Œè¿™ä¸¤ä¸ªæ˜¯ç­‰ä»·çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from typing import Annotated</span><br><span class="line">from langgraph.graph import MessagesState</span><br><span class="line">from langchain_core.messages import AnyMessage</span><br><span class="line">from langgraph.graph.message import add_messages</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ TypedDictï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¸¦æœ‰ add_messages reducer çš„æ¶ˆæ¯åˆ—è¡¨ã€‚</span><br><span class="line">class CustomMessagesState(TypedDict):</span><br><span class="line">    messages: Annotated[list[AnyMessage], add_messages]</span><br><span class="line">    added_key_1: str</span><br><span class="line">    added_key_2: str</span><br><span class="line">    # etc</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ MessagesState ï¼Œå®ƒåŒ…å«å¸¦æœ‰ add_messages reducer çš„ messages é”®ã€‚</span><br><span class="line">class ExtendedMessagesState(MessagesState):</span><br><span class="line">    # æ·»åŠ é™¤ messages ä¹‹å¤–æ‰€éœ€çš„ä»»ä½•é”®ï¼Œ messages æ˜¯é¢„æ„å»ºçš„ã€‚</span><br><span class="line">    added_key_1: str</span><br><span class="line">    added_key_2: str</span><br><span class="line">    # etc</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨ <code>add_messages</code> reducer æ—¶ï¼Œè®©æˆ‘ä»¬å±•ç¤ºä¸€äº›æœ‰ç”¨çš„æŠ€å·§ã€‚</p>
<p><strong>é‡å†™ï¼ˆRe-writingï¼‰</strong></p>
<p>å¦‚æœæˆ‘ä»¬ä¼ é€’çš„æ¶ˆæ¯ä¸ <code>messages</code> åˆ—è¡¨ä¸­å·²æœ‰çš„æ¶ˆæ¯å…·æœ‰ç›¸åŒçš„ IDï¼Œåˆ™è¯¥æ¶ˆæ¯å°†è¢«è¦†ç›–ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Initial state</span><br><span class="line">initial_messages = [AIMessage(content=&quot;Hello! How can I assist you?&quot;, name=&quot;Model&quot;, id=&quot;1&quot;),</span><br><span class="line">                    HumanMessage(content=&quot;I&#x27;m looking for information on marine biology.&quot;, name=&quot;Lance&quot;, id=&quot;2&quot;)</span><br><span class="line">                   ]</span><br><span class="line"></span><br><span class="line"># New message to add</span><br><span class="line">new_message = HumanMessage(content=&quot;I&#x27;m looking for information on whales, specifically&quot;, name=&quot;Lance&quot;, id=&quot;2&quot;)</span><br><span class="line"></span><br><span class="line"># Test</span><br><span class="line">add_messages(initial_messages , new_message)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AIMessage(content=&#x27;Hello! How can I assist you?&#x27;, name=&#x27;Model&#x27;, id=&#x27;1&#x27;),</span><br><span class="line"> HumanMessage(content=&quot;I&#x27;m looking for information on whales, specifically&quot;, name=&#x27;Lance&#x27;, id=&#x27;2&#x27;)]</span><br></pre></td></tr></table></figure>
<p><strong>åˆ é™¤ï¼ˆRemovalï¼‰</strong></p>
<p><code>add_messages</code> ä¹Ÿ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/memory/delete-messages/">åŒæ ·æ”¯æŒåˆ é™¤</a>ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://api.python.langchain.com/en/latest/messages/langchain_core.messages.modifier.RemoveMessage.html">RemoveMessage</a> æ¥è‡ª <code>langchain_core</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import RemoveMessage</span><br><span class="line"></span><br><span class="line"># Message list</span><br><span class="line">messages = [AIMessage(&quot;Hi.&quot;, name=&quot;Bot&quot;, id=&quot;1&quot;)]</span><br><span class="line">messages.append(HumanMessage(&quot;Hi.&quot;, name=&quot;Lance&quot;, id=&quot;2&quot;))</span><br><span class="line">messages.append(AIMessage(&quot;So you said you were researching ocean mammals?&quot;, name=&quot;Bot&quot;, id=&quot;3&quot;))</span><br><span class="line">messages.append(HumanMessage(&quot;Yes, I know about whales. But what others should I learn about?&quot;, name=&quot;Lance&quot;, id=&quot;4&quot;))</span><br><span class="line"></span><br><span class="line"># Isolate messages to delete</span><br><span class="line">delete_messages = [RemoveMessage(id=m.id) for m in messages[:-2]]</span><br><span class="line">print(delete_messages)</span><br></pre></td></tr></table></figure>
<h4 id="Multiple-Schemas-å¤šç§çŠ¶æ€"><a href="#Multiple-Schemas-å¤šç§çŠ¶æ€" class="headerlink" title="Multiple Schemas å¤šç§çŠ¶æ€"></a><strong>Multiple Schemas</strong> å¤šç§çŠ¶æ€</h4><h5 id="Private-State-ç§æœ‰çŠ¶æ€"><a href="#Private-State-ç§æœ‰çŠ¶æ€" class="headerlink" title="Private State ç§æœ‰çŠ¶æ€"></a><strong>Private State</strong> ç§æœ‰çŠ¶æ€</h5><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºåœ¨èŠ‚ç‚¹ä¹‹é—´ä¼ é€’ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/pass_private_state/">private state</a> çš„æƒ…å†µã€‚è¿™å¯¹äºå›¾çš„ä¸­é—´è®¡ç®—é€»è¾‘ä¸­éœ€è¦çš„ä»»ä½•å†…å®¹éƒ½å¾ˆæœ‰ç”¨ï¼Œä½†ä¸å›¾çš„æ•´ä½“è¾“å…¥æˆ–è¾“å‡ºæ— å…³ã€‚</p>
<p>ç¤ºä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">from typing_extensions import TypedDict</span><br><span class="line">from IPython.display import Image, display</span><br><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line"></span><br><span class="line">class OverallState(TypedDict):</span><br><span class="line">    foo: int</span><br><span class="line"></span><br><span class="line">class PrivateState(TypedDict):</span><br><span class="line">    baz: int</span><br><span class="line"></span><br><span class="line">def node_1(state: OverallState) -&gt; PrivateState:</span><br><span class="line">    print(&quot;---Node 1---&quot;)</span><br><span class="line">    return &#123;&quot;baz&quot;: state[&#x27;foo&#x27;] + 1&#125;</span><br><span class="line"></span><br><span class="line">def node_2(state: PrivateState) -&gt; OverallState:</span><br><span class="line">    print(&quot;---Node 2---&quot;)</span><br><span class="line">    return &#123;&quot;foo&quot;: state[&#x27;baz&#x27;] + 1&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(OverallState)</span><br><span class="line">builder.add_node(&quot;node_1&quot;, node_1)</span><br><span class="line">builder.add_node(&quot;node_2&quot;, node_2)</span><br><span class="line"></span><br><span class="line"># Logic</span><br><span class="line">builder.add_edge(START, &quot;node_1&quot;)</span><br><span class="line">builder.add_edge(&quot;node_1&quot;, &quot;node_2&quot;)</span><br><span class="line">builder.add_edge(&quot;node_2&quot;, END)</span><br><span class="line"></span><br><span class="line"># Add</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719171509917.png" alt="image-20250719171509917"></p>
<p>æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ª <code>OverallState</code> å’Œä¸€ä¸ª <code>PrivateState</code>ã€‚<code>node_2</code> ä½¿ç”¨ <code>PrivateState</code> ä½œä¸ºè¾“å…¥ï¼Œä½†è¾“å‡ºå†™å…¥åˆ° <code>OverallState</code>ã€‚</p>
<p><code>baz</code> ä»…åŒ…å«åœ¨ <code>PrivateState</code> ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>baz</code> è¢«æ’é™¤åœ¨å›¾å½¢è¾“å‡ºä¹‹å¤–ï¼Œå› ä¸ºå®ƒä¸åœ¨ <code>OverallState</code> ä¸­ã€‚</p>
<h5 id="Input-Output-Schema-è¾“å…¥-è¾“å‡ºæ¨¡å¼"><a href="#Input-Output-Schema-è¾“å…¥-è¾“å‡ºæ¨¡å¼" class="headerlink" title="Input / Output Schema è¾“å…¥/è¾“å‡ºæ¨¡å¼"></a><strong>Input / Output Schema </strong>è¾“å…¥/è¾“å‡ºæ¨¡å¼</h5><p>åœ¨ LangGraph ä¸­ï¼Œ<strong>Input / Output Schema</strong> å°±æ˜¯â€œ<strong>å›¾çš„å¯¹å¤–æ¥å£åè®®</strong>â€ï¼š<strong>è°ƒç”¨è€…åªèƒ½æŒ‰ Input Schema ä¼ å‚ï¼›å›¾è¿è¡Œå®Œåï¼Œåªåå‡º Output Schema è§„å®šçš„å­—æ®µã€‚</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import StateGraph, START, END</span><br><span class="line">from typing_extensions import TypedDict</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è¾“å…¥çš„æ¨¡å¼</span><br><span class="line">class InputState(TypedDict):</span><br><span class="line">    question: str</span><br><span class="line"></span><br><span class="line"># å®šä¹‰è¾“å‡ºçš„æ¨¡å¼</span><br><span class="line">class OutputState(TypedDict):</span><br><span class="line">    answer: str</span><br><span class="line"></span><br><span class="line"># å®šä¹‰æ•´ä½“æ¨¡å¼ï¼Œç»“åˆè¾“å…¥å’Œè¾“å‡º</span><br><span class="line">class OverallState(InputState, OutputState):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¤„ç†è¾“å…¥å¹¶ç”Ÿæˆç­”æ¡ˆçš„èŠ‚ç‚¹</span><br><span class="line">def answer_node(state: InputState):</span><br><span class="line">    # ç¤ºä¾‹ç­”æ¡ˆå’Œé¢å¤–é”®</span><br><span class="line">    return &#123;&quot;answer&quot;: &quot;bye&quot;, &quot;question&quot;: state[&quot;question&quot;]&#125;</span><br><span class="line"></span><br><span class="line"># æ„å»ºå›¾ï¼Œå¹¶æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºæ¨¡å¼</span><br><span class="line">builder = StateGraph(OverallState, input_schema=InputState, output_schema=OutputState)</span><br><span class="line">builder.add_node(answer_node)  # æ·»åŠ ç­”æ¡ˆèŠ‚ç‚¹</span><br><span class="line">builder.add_edge(START, &quot;answer_node&quot;)  # å®šä¹‰èµ·å§‹è¾¹</span><br><span class="line">builder.add_edge(&quot;answer_node&quot;, END)  # å®šä¹‰ç»“æŸè¾¹</span><br><span class="line">graph = builder.compile()  # ç¼–è¯‘å›¾</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨è¾“å…¥è°ƒç”¨å›¾å¹¶æ‰“å°ç»“æœ</span><br><span class="line">print(graph.invoke(&#123;&quot;question&quot;: &quot;hi&quot;&#125;))</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;answer&#x27;: &#x27;bye Lance&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ<code>input</code> / <code>output</code> æ¨¡å¼å¯¹å›¾çš„è¾“å…¥å’Œè¾“å‡ºä¸Šå…è®¸çš„é”®è¿›è¡Œ <strong>è¿‡æ»¤</strong>ã€‚å¯ä»¥çœ‹åˆ° <code>output</code> æ¨¡å¼å°†è¾“å‡ºé™åˆ¶ä¸ºä»…åŒ…å« <code>answer</code> é”®ã€‚</p>
<h4 id="Filtering-and-trimming-messagesç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯"><a href="#Filtering-and-trimming-messagesç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯" class="headerlink" title="Filtering and trimming messagesç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯"></a><strong>Filtering and trimming messages</strong>ç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯</h4><p>å¦‚æœæˆ‘ä»¬åœ¨å¤„ç†é•¿æ—¶é—´å¯¹è¯æ—¶ä¸å¤Ÿå°å¿ƒï¼Œä¼šå¯¼è‡´é«˜ä»¤ç‰Œä½¿ç”¨é‡å’Œå»¶è¿Ÿï¼Œå› ä¸ºæˆ‘ä»¬ä¼ é€’ç»™æ¨¡å‹çš„æ˜¯ä¸€ç³»åˆ—ä¸æ–­å¢åŠ çš„æ¶ˆæ¯ã€‚æ‰€ä»¥è¦è¿›è¡Œç­›é€‰å’Œç²¾ç®€æ¶ˆæ¯ã€‚</p>
<h5 id="ç®€åŒ–å™¨ï¼ˆReducerï¼‰"><a href="#ç®€åŒ–å™¨ï¼ˆReducerï¼‰" class="headerlink" title="ç®€åŒ–å™¨ï¼ˆReducerï¼‰"></a><strong>ç®€åŒ–å™¨ï¼ˆReducerï¼‰</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import RemoveMessage</span><br><span class="line"></span><br><span class="line"># Nodes</span><br><span class="line">def filter_messages(state: MessagesState):</span><br><span class="line">    # åˆ é™¤é™¤æœ€è¿‘ä¸¤æ¡æ¶ˆæ¯å¤–çš„æ‰€æœ‰æ¶ˆæ¯</span><br><span class="line">    delete_messages = [RemoveMessage(id=m.id) for m in state[&quot;messages&quot;][:-2]]</span><br><span class="line">    return &#123;&quot;messages&quot;: delete_messages&#125;</span><br><span class="line"></span><br><span class="line">def chat_model_node(state: MessagesState):    </span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(state[&quot;messages&quot;])]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;filter&quot;, filter_messages)</span><br><span class="line">builder.add_node(&quot;chat_model&quot;, chat_model_node)</span><br><span class="line">builder.add_edge(START, &quot;filter&quot;)</span><br><span class="line">builder.add_edge(&quot;filter&quot;, &quot;chat_model&quot;)</span><br><span class="line">builder.add_edge(&quot;chat_model&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250719203204234.png" alt="image-20250719203204234"></p>
<h5 id="ç­›é€‰æ¶ˆæ¯ï¼ˆFiltering-messagesï¼‰"><a href="#ç­›é€‰æ¶ˆæ¯ï¼ˆFiltering-messagesï¼‰" class="headerlink" title="ç­›é€‰æ¶ˆæ¯ï¼ˆFiltering messagesï¼‰"></a><strong>ç­›é€‰æ¶ˆæ¯ï¼ˆFiltering messagesï¼‰</strong></h5><p>å¦‚æœä½ ä¸éœ€è¦æˆ–ä¸å¸Œæœ›ä¿®æ”¹å›¾çŠ¶æ€ï¼Œå¯ä»¥ç›´æ¥è¿‡æ»¤ä¼ é€’ç»™èŠå¤©æ¨¡å‹çš„æ¶ˆæ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Node</span><br><span class="line">def chat_model_node(state: MessagesState):</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(state[&quot;messages&quot;][-1:])]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;chat_model&quot;, chat_model_node)</span><br><span class="line">builder.add_edge(START, &quot;chat_model&quot;)</span><br><span class="line">builder.add_edge(&quot;chat_model&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œåªéœ€ä¼ é€’ä¸€ä¸ªè¿‡æ»¤åçš„åˆ—è¡¨ï¼š<code>llm.invoke(messages[-1:])</code> ç»™æ¨¡å‹ã€‚</p>
<p>çŠ¶æ€åŒ…å«äº†æ‰€æœ‰æ¶ˆæ¯ã€‚ä½†è¿™é‡Œæ¨¡å‹è°ƒç”¨ä»…ä½¿ç”¨æœ€åä¸€æ¡æ¶ˆæ¯</p>
<h5 id="è£å‰ªæ¶ˆæ¯ï¼ˆTrim-messagesï¼‰"><a href="#è£å‰ªæ¶ˆæ¯ï¼ˆTrim-messagesï¼‰" class="headerlink" title="è£å‰ªæ¶ˆæ¯ï¼ˆTrim messagesï¼‰"></a><strong>è£å‰ªæ¶ˆæ¯ï¼ˆTrim messagesï¼‰</strong></h5><p>å¦ä¸€ç§æ–¹æ³•æ˜¯æ ¹æ®è®¾å®šä¸€å®šæ•°é‡çš„tokensè¿›è¡Œ <a target="_blank" rel="noopener" href="https://python.langchain.com/v0.2/docs/how_to/trim_messages/#getting-the-last-max_tokens-tokens">trim messages</a>ã€‚åœ¨æŠŠå¯¹è¯å†å²å‘ç»™å¤§æ¨¡å‹ä¹‹å‰ï¼ŒæŒ‰ <strong>token é¢„ç®—</strong> æŠŠè¶…é•¿æ¶ˆæ¯åˆ—è¡¨â€œå‰ªâ€åˆ°åˆé€‚é•¿åº¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import trim_messages</span><br><span class="line"></span><br><span class="line"># Node</span><br><span class="line">def chat_model_node(state: MessagesState):</span><br><span class="line">    # ä½¿ç”¨ trim_messages å‡½æ•°ä¿®å‰ªæ¶ˆæ¯åˆ—è¡¨</span><br><span class="line">    # max_tokens: é™åˆ¶æ¶ˆæ¯çš„æœ€å¤§ä»¤ç‰Œæ•°</span><br><span class="line">    # strategy: ä¿®å‰ªç­–ç•¥ï¼Œè¿™é‡Œæ˜¯â€œlastâ€ï¼Œè¡¨ç¤ºä¿ç•™æœ€æ–°çš„æ¶ˆæ¯</span><br><span class="line">    # token_counter: ç”¨äºè®¡ç®—ä»¤ç‰Œæ•°çš„æ¨¡å‹å®ä¾‹</span><br><span class="line">    # allow_partial: æ˜¯å¦å…è®¸éƒ¨åˆ†ä¿®å‰ª</span><br><span class="line">    messages = trim_messages(</span><br><span class="line">            state[&quot;messages&quot;],</span><br><span class="line">            max_tokens=100,</span><br><span class="line">            strategy=&quot;last&quot;,</span><br><span class="line">            token_counter= ChatOpenAI(</span><br><span class="line">                model=&quot;qwen-plus-2025-04-28&quot;,</span><br><span class="line">                api_key=&quot;sk-&quot;,</span><br><span class="line">                base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;),</span><br><span class="line">            allow_partial=False,</span><br><span class="line">        )</span><br><span class="line">    # è°ƒç”¨è¯­è¨€æ¨¡å‹ï¼ˆllmï¼‰å¤„ç†ä¿®å‰ªåçš„æ¶ˆæ¯ï¼Œå¹¶è¿”å›ç»“æœ</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(messages)]&#125;</span><br><span class="line"></span><br><span class="line"># Build graph</span><br><span class="line">builder = StateGraph(MessagesState)</span><br><span class="line">builder.add_node(&quot;chat_model&quot;, chat_model_node)</span><br><span class="line">builder.add_edge(START, &quot;chat_model&quot;)</span><br><span class="line">builder.add_edge(&quot;chat_model&quot;, END)</span><br><span class="line">graph = builder.compile()</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<h4 id="Chatbot-with-message-summarizationå¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº"><a href="#Chatbot-with-message-summarizationå¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº" class="headerlink" title="Chatbot with message summarizationå¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº"></a><strong>Chatbot with message summarization</strong>å¸¦æœ‰æ¶ˆæ¯æ€»ç»“åŠŸèƒ½çš„èŠå¤©æœºå™¨äºº</h4><p>ä¸å…¶ä»…ä»…ä¿®å‰ªæˆ–è¿‡æ»¤æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰æ¥ç”Ÿæˆå¯¹è¯çš„å®æ—¶æ‘˜è¦ã€‚</p>
<p>è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¿ç•™æ•´ä¸ªå¯¹è¯çš„å‹ç¼©è¡¨ç¤ºï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡ä¿®å‰ªæˆ–è¿‡æ»¤å°†å…¶ç§»é™¤ã€‚</p>
<p>æˆ‘ä»¬å°†ä¸ºè¯¥èŠå¤©æœºå™¨äººé…å¤‡è®°å¿†åŠŸèƒ½ï¼Œæ”¯æŒé•¿æ—¶é—´å¯¹è¯ï¼ŒåŒæ—¶ä¸ä¼šäº§ç”Ÿé«˜æ˜‚çš„ token æˆæœ¬æˆ–å»¶è¿Ÿã€‚</p>
<h5 id="å®šä¹‰æ€»ç»“çŠ¶æ€"><a href="#å®šä¹‰æ€»ç»“çŠ¶æ€" class="headerlink" title="å®šä¹‰æ€»ç»“çŠ¶æ€"></a>å®šä¹‰æ€»ç»“çŠ¶æ€</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import MessagesState</span><br><span class="line">class State(MessagesState):</span><br><span class="line">    summary: str</span><br></pre></td></tr></table></figure>
<p>é™¤äº†å†…ç½®çš„ <code>messages</code> é”®ä¹‹å¤–ï¼Œæˆ‘ä»¬ç°åœ¨è¿˜å°†åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰é”®ï¼ˆ<code>summary</code>ï¼‰ã€‚</p>
<h5 id="å®šä¹‰LLMèŠ‚ç‚¹"><a href="#å®šä¹‰LLMèŠ‚ç‚¹" class="headerlink" title="å®šä¹‰LLMèŠ‚ç‚¹"></a>å®šä¹‰LLMèŠ‚ç‚¹</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.messages import SystemMessage, HumanMessage, RemoveMessage </span><br><span class="line"> </span><br><span class="line"> # å®šä¹‰è°ƒç”¨æ¨¡å‹çš„é€»è¾‘</span><br><span class="line">def call_model(state: State): </span><br><span class="line">     </span><br><span class="line">     # è·å–æ‘˜è¦ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ </span><br><span class="line">     summary = state.get(&quot;summary&quot;, &quot;&quot;) </span><br><span class="line"> </span><br><span class="line">     # å¦‚æœæœ‰æ‘˜è¦ï¼Œåˆ™æ·»åŠ å®ƒ</span><br><span class="line">     if summary: </span><br><span class="line">         </span><br><span class="line">         # å°†æ‘˜è¦æ·»åŠ åˆ°ç³»ç»Ÿæ¶ˆæ¯ä¸­</span><br><span class="line">         system_message = f&quot;å…ˆå‰å¯¹è¯çš„æ‘˜è¦ï¼š&#123;summary&#125;&quot; </span><br><span class="line"> </span><br><span class="line">         # å°†æ‘˜è¦é™„åŠ åˆ°ä»»ä½•è¾ƒæ–°çš„æ¶ˆæ¯ä¸­</span><br><span class="line">         messages = [SystemMessage(content=system_message)] + state[&quot;messages&quot;] </span><br><span class="line">     </span><br><span class="line">     else: </span><br><span class="line">         messages = state[&quot;messages&quot;] </span><br><span class="line">     </span><br><span class="line">     response = model.invoke(messages) </span><br><span class="line">     return &#123;&quot;messages&quot;: response&#125; </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹æ¥<strong>è°ƒç”¨æˆ‘ä»¬çš„LLM</strong>ï¼Œå¦‚æœå­˜åœ¨æ‘˜è¦ï¼Œåˆ™å°†å…¶çº³å…¥æç¤ºä¸­ã€‚</p>
<blockquote>
<p>å½“ call_model å‡½æ•°è¿”å› {â€œmessagesâ€: response} æ—¶ï¼Œå®ƒæ˜¯åœ¨å‘Šè¯‰ langgraph ï¼šâ€œè¯·ç”¨ response ï¼ˆå³æ¨¡å‹çš„æ–°è¾“å‡ºï¼‰æ¥æ›´æ–° State å¯¹è±¡ä¸­ messages é”®å¯¹åº”çš„å€¼ã€‚â€ langgraph ä¼šå°†è¿™ä¸ªæ–°æ¶ˆæ¯è¿½åŠ åˆ° messages åˆ—è¡¨ä¸­ï¼Œä»è€Œä¿æŒäº†å¯¹è¯å†å²çš„è¿ç»­æ€§</p>
</blockquote>
<h5 id="å®šä¹‰æ‘˜è¦èŠ‚ç‚¹"><a href="#å®šä¹‰æ‘˜è¦èŠ‚ç‚¹" class="headerlink" title="å®šä¹‰æ‘˜è¦èŠ‚ç‚¹"></a>å®šä¹‰æ‘˜è¦èŠ‚ç‚¹</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def summarize_conversation(state: State): </span><br><span class="line">     </span><br><span class="line">     # é¦–å…ˆï¼Œæˆ‘ä»¬è·å–ä»»ä½•ç°æœ‰çš„æ‘˜è¦</span><br><span class="line">     summary = state.get(&quot;summary&quot;, &quot;&quot;) </span><br><span class="line"> </span><br><span class="line">     # åˆ›å»ºæˆ‘ä»¬çš„æ‘˜è¦æç¤º</span><br><span class="line">     if summary: </span><br><span class="line">         </span><br><span class="line">         # æ‘˜è¦å·²å­˜åœ¨</span><br><span class="line">         summary_message = ( </span><br><span class="line">             f&quot;è¿™æ˜¯è¿„ä»Šä¸ºæ­¢å¯¹è¯çš„æ‘˜è¦ï¼š&#123;summary&#125;\n\n&quot; </span><br><span class="line">             &quot;è¯·ç»“åˆä»¥ä¸Šæ–°æ¶ˆæ¯æ‰©å±•æ‘˜è¦ï¼š&quot; </span><br><span class="line">         ) </span><br><span class="line">         </span><br><span class="line">     else: </span><br><span class="line">         summary_message = &quot;åˆ›å»ºä»¥ä¸Šå¯¹è¯çš„æ‘˜è¦ï¼š&quot; </span><br><span class="line"> </span><br><span class="line">     # å°†æç¤ºæ·»åŠ åˆ°æˆ‘ä»¬çš„å†å²è®°å½•ä¸­</span><br><span class="line">     messages = state[&quot;messages&quot;] + [HumanMessage(content=summary_message)] </span><br><span class="line">     response = model.invoke(messages) </span><br><span class="line">     </span><br><span class="line">     # åˆ é™¤é™¤æœ€è¿‘2æ¡æ¶ˆæ¯å¤–çš„æ‰€æœ‰æ¶ˆæ¯</span><br><span class="line">     delete_messages = [RemoveMessage(id=m.id) for m in state[&quot;messages&quot;][:-2]] </span><br><span class="line">     return &#123;&quot;summary&quot;: response.content, &quot;messages&quot;: delete_messages&#125; </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹æ¥<strong>ç”Ÿæˆæ‘˜è¦</strong>ã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>RemoveMessage</code> åœ¨ç”Ÿæˆæ‘˜è¦åè¿‡æ»¤æˆ‘ä»¬çš„çŠ¶æ€ã€‚</p>
<h5 id="å®šä¹‰è·¯ç”±å‡½æ•°"><a href="#å®šä¹‰è·¯ç”±å‡½æ•°" class="headerlink" title="å®šä¹‰è·¯ç”±å‡½æ•°"></a>å®šä¹‰è·¯ç”±å‡½æ•°</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.graph import END </span><br><span class="line"> # å†³å®šæ˜¯ç»“æŸå¯¹è¯è¿˜æ˜¯æ€»ç»“å¯¹è¯</span><br><span class="line">def should_continue(state: State): </span><br><span class="line">     </span><br><span class="line">     &quot;&quot;&quot;è¿”å›è¦æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚&quot;&quot;&quot; </span><br><span class="line">     </span><br><span class="line">     messages = state[&quot;messages&quot;] </span><br><span class="line">     </span><br><span class="line">     # å¦‚æœæ¶ˆæ¯è¶…è¿‡å…­æ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€»ç»“å¯¹è¯</span><br><span class="line">     if len(messages) &gt; 6: </span><br><span class="line">         return &quot;summarize_conversation&quot; </span><br><span class="line">     </span><br><span class="line">     # å¦åˆ™æˆ‘ä»¬å°±å¯ä»¥ç»“æŸäº†</span><br><span class="line">     return END </span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ¡ä»¶è¾¹ï¼Œä»¥æ ¹æ®å¯¹è¯é•¿åº¦ç¡®å®šæ˜¯å¦ç”Ÿæˆæ‘˜è¦ã€‚</p>
<blockquote>
<p>åœ¨ langgraph ä¸­ï¼Œ Command æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ï¼Œç”¨äºæŒ‡å¯¼å›¾å½¢ï¼ˆgraphï¼‰å†³å®šæ¥ä¸‹æ¥åº”è¯¥æ‰§è¡Œå“ªä¸ªèŠ‚ç‚¹ã€‚ æ‚¨å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ç»™å›¾å½¢ä¸‹è¾¾çš„ä¸€ä¸ªâ€œå‘½ä»¤â€ã€‚</p>
</blockquote>
<h5 id="æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾"><a href="#æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾" class="headerlink" title="æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾"></a>æ·»åŠ å†…å­˜å¹¶ç¼–è¯‘å›¾</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Image, display</span><br><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">from langgraph.graph import StateGraph, START</span><br><span class="line"></span><br><span class="line"># Define a new graph</span><br><span class="line">workflow = StateGraph(State)</span><br><span class="line">workflow.add_node(&quot;conversation&quot;, call_model)</span><br><span class="line">workflow.add_node(&quot;summarize_conversation&quot;,summarize_conversation)</span><br><span class="line"></span><br><span class="line"># Set the entrypoint as conversation</span><br><span class="line">workflow.add_edge(START, &quot;conversation&quot;)</span><br><span class="line">workflow.add_conditional_edges(&quot;conversation&quot;, should_continue)</span><br><span class="line">workflow.add_edge(&quot;summarize_conversation&quot;, END)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Compile</span><br><span class="line">memory = MemorySaver()</span><br><span class="line">graph = workflow.compile(checkpointer=memory)</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨çº¿ç¨‹è°ƒç”¨"><a href="#ä½¿ç”¨çº¿ç¨‹è°ƒç”¨" class="headerlink" title="ä½¿ç”¨çº¿ç¨‹è°ƒç”¨"></a>ä½¿ç”¨çº¿ç¨‹è°ƒç”¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;2&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">input_message = HumanMessage(content=&quot;æˆ‘å–œæ¬¢ç©lolï¼Œä½ çŸ¥é“è¿™ä¸ªæ¸¸æˆå—&quot;)</span><br><span class="line">output = graph.invoke(&#123;&quot;messages&quot;: [input_message]&#125;, config) </span><br><span class="line">for m in output[&#x27;messages&#x27;][-1:]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<p>å½“å¯¹è¯å¤§äº6ï¼Œå¯ç”Ÿæˆæ¦‚è¦</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.get_state(config).values.get(&quot;summary&quot;,&quot;&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="Chatbot-with-message-summarization-amp-external-DB-memoryå…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº"><a href="#Chatbot-with-message-summarization-amp-external-DB-memoryå…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº" class="headerlink" title="Chatbot with message summarization &amp; external DB memoryå…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº"></a><strong>Chatbot with message summarization &amp; external DB memory</strong>å…·æœ‰æ¶ˆæ¯æ€»ç»“å’Œå¤–éƒ¨æ•°æ®åº“è®°å¿†çš„èŠå¤©æœºå™¨äºº</h4><h5 id="ä½¿ç”¨æ•°æ®åº“"><a href="#ä½¿ç”¨æ•°æ®åº“" class="headerlink" title="ä½¿ç”¨æ•°æ®åº“"></a>ä½¿ç”¨æ•°æ®åº“</h5><p><code>SqliteSaver</code> æ˜¯ LangGraph æä¾›çš„ä¸€ä¸ª <strong>è½»é‡çº§çŠ¶æ€æŒä¹…åŒ–å·¥å…·</strong>ï¼Œå®ƒå°†å›¾çš„è¿è¡ŒçŠ¶æ€ï¼ˆå³ checkpointï¼‰ä¿å­˜åˆ°æœ¬åœ°çš„ SQLite æ•°æ®åº“ä¸­ï¼Œä½¿å¾—ä½ å¯ä»¥åœ¨ç¨‹åºä¸­æ–­æˆ–é‡å¯å<strong>æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼Œç‰¹åˆ«é€‚åˆæœ¬åœ°å¼€å‘ã€å®éªŒæ€§é¡¹ç›®æˆ–ä¸­å°è§„æ¨¡åº”ç”¨ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æä¾› â€œ:memory:â€ ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªå†…å­˜ä¸­çš„ SQLite æ•°æ®åº“ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import sqlite3</span><br><span class="line"># In memory</span><br><span class="line">conn = sqlite3.connect(&quot;:memory:&quot;, check_same_thread = False)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æä¾›ä¸€ä¸ª db è·¯å¾„ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªç›®å½• state_dbï¼Œå¹¶å°è¯•ä» GitHub ä¸‹è½½ä¸€ä¸ªåä¸º example.db çš„ SQLite æ•°æ®åº“æ–‡ä»¶</span><br><span class="line">!mkdir -p state_db &amp;&amp; [ ! -f state_db/example.db ] &amp;&amp; wget -P state_db https://github.com/langchain-ai/langchain-academy/raw/main/module-2/state_db/example.db</span><br><span class="line"></span><br><span class="line">db_path = &quot;state_db/example.db&quot;</span><br><span class="line">conn = sqlite3.connect(db_path, check_same_thread=False)</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰checkpoint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from langgraph.checkpoint.sqlite import SqliteSaver</span><br><span class="line">memory = SqliteSaver(conn)</span><br></pre></td></tr></table></figure>
<p>åƒä¸Šä¸€ä¸ªå½¢å¼ç¼–è¯‘å›¾</p>
<p>è®©æˆ‘ä»¬ç¡®è®¤ä¸€ä¸‹æˆ‘ä»¬çš„çŠ¶æ€æ˜¯å¦å·²ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line">graph_state = graph.get_state(config)</span><br><span class="line">graph_state</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨åƒ Sqlite è¿™æ ·çš„æ•°æ®åº“æ„å‘³ç€çŠ¶æ€ä¼šè¢«æŒä¹…åŒ–ï¼</p>
<h3 id="module-3"><a href="#module-3" class="headerlink" title="module-3"></a>module-3</h3><h4 id="Streaming-æµå¼ä¼ è¾“"><a href="#Streaming-æµå¼ä¼ è¾“" class="headerlink" title="Streaming æµå¼ä¼ è¾“"></a><strong>Streaming</strong> æµå¼ä¼ è¾“</h4><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè°ˆ <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/concepts/low_level/#streaming">æµå¼ä¼ è¾“æˆ‘ä»¬çš„å›¾çŠ¶æ€</a> çš„æ–¹æ³•ã€‚<code>.stream</code> å’Œ <code>.astream</code> æ˜¯ç”¨äºæµå¼è¿”å›ç»“æœçš„åŒæ­¥å’Œå¼‚æ­¥æ–¹æ³•ã€‚</p>
<p><code>values</code>ï¼šè¿™å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹è¢«è°ƒç”¨åæµå¼ä¼ è¾“å›¾çš„å®Œæ•´çŠ¶æ€ã€‚ <code>updates</code>ï¼šè¿™å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹è¢«è°ƒç”¨åæµå¼ä¼ è¾“å›¾çš„çŠ¶æ€æ›´æ–°ã€‚</p>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66dbaf892d24625a201744e5_streaming1.png" alt="values_vs_updates.png"></p>
<h5 id="stream-mode-â€updatesâ€"><a href="#stream-mode-â€updatesâ€" class="headerlink" title="stream_mode=â€updatesâ€"></a>stream_mode=â€updatesâ€</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Create a thread</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Start conversation</span><br><span class="line">for chunk in graph.stream(&#123;&quot;messages&quot;: [HumanMessage(content=&quot;ä½ å¥½æˆ‘æ˜¯zxj&quot;)]&#125;, config, stream_mode=&quot;updates&quot;):</span><br><span class="line">    print(chunk)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;conversation&#x27;: &#123;&#x27;messages&#x27;: AIMessage(content=&#x27;ä½ å¥½ï¼Œzxjï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼ŸğŸ˜Š&#x27;, additional_kwargs=&#123;&#x27;refusal&#x27;: None&#125;, response_metadata=&#123;&#x27;token_usage&#x27;: &#123;&#x27;completion_tokens&#x27;: 16, &#x27;prompt_tokens&#x27;: 576, &#x27;total_tokens&#x27;: 592, &#x27;completion_tokens_details&#x27;: None, &#x27;prompt_tokens_details&#x27;: None&#125;, &#x27;model_name&#x27;: &#x27;qwen-plus-2025-04-28&#x27;, &#x27;system_fingerprint&#x27;: None, &#x27;id&#x27;: &#x27;chatcmpl-891471ae-2fe8-9b3d-b5f7-f4fcd55a4e16&#x27;, &#x27;service_tier&#x27;: None, &#x27;finish_reason&#x27;: &#x27;stop&#x27;, &#x27;logprobs&#x27;: None&#125;, id=&#x27;run--f36409f3-af43-4e9b-8a46-39646ad7c106-0&#x27;, usage_metadata=&#123;&#x27;input_tokens&#x27;: 576, &#x27;output_tokens&#x27;: 16, &#x27;total_tokens&#x27;: 592, &#x27;input_token_details&#x27;: &#123;&#125;, &#x27;output_token_details&#x27;: &#123;&#125;&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>stream_mode=&quot;updates&quot;</code>ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ <code>updates</code> è¿›è¡Œæµå¼ä¼ è¾“ï¼Œæ‰€ä»¥åªæœ‰åœ¨å›¾ä¸­çš„èŠ‚ç‚¹è¿è¡Œåï¼Œæˆ‘ä»¬æ‰èƒ½çœ‹åˆ°çŠ¶æ€çš„æ›´æ–°ã€‚æ¯ä¸ª <code>chunk</code> æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä»¥ <code>node_name</code> ä¸ºé”®ï¼Œæ›´æ–°åçš„çŠ¶æ€ä¸ºå€¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Start conversation</span><br><span class="line">for chunk in graph.stream(&#123;&quot;messages&quot;: [HumanMessage(content=&quot;ä½ å¥½æˆ‘æ˜¯zxj&quot;)]&#125;, config, stream_mode=&quot;updates&quot;):</span><br><span class="line">    chunk[&#x27;conversation&#x27;][&quot;messages&quot;].pretty_print()</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬ç›´æ¥æ‰“å°çŠ¶æ€æ›´æ–°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½å‘€ï¼Œzxjï¼å†æ¬¡è§åˆ°ä½ çœŸé«˜å…´ï½ğŸ˜Š æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®å¿™çš„å—ï¼Ÿ</span><br></pre></td></tr></table></figure>
<h5 id="stream-mode-â€valuesâ€"><a href="#stream-mode-â€valuesâ€" class="headerlink" title="stream_mode=â€valuesâ€"></a>stream_mode=â€valuesâ€</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Start conversation, again</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;2&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Start conversation</span><br><span class="line">input_message = HumanMessage(content=&quot;ä½ å¥½æˆ‘æ˜¯zxj&quot;)</span><br><span class="line">for event in graph.stream(&#123;&quot;messages&quot;: [input_message]&#125;, config, stream_mode=&quot;values&quot;):</span><br><span class="line">    for m in event[&#x27;messages&#x27;]:</span><br><span class="line">        m.pretty_print()</span><br><span class="line">    print(&quot;---&quot;*25)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>stream_mode=&quot;values&quot;</code>.è¿™æ˜¯åœ¨ <code>conversation</code> èŠ‚ç‚¹è¢«è°ƒç”¨åï¼Œå›¾çš„æ•´ä¸ªçŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½æˆ‘æ˜¯zxj</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½æˆ‘æ˜¯zxj</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">ä½ å¥½ï¼Œzxjï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼ŸğŸ˜Š</span><br><span class="line">---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="Streaming-tokens-æµå¼ä¼ è¾“ä»¤ç‰Œ"><a href="#Streaming-tokens-æµå¼ä¼ è¾“ä»¤ç‰Œ" class="headerlink" title="Streaming tokens æµå¼ä¼ è¾“ä»¤ç‰Œ"></a><strong>Streaming tokens</strong> <strong>æµå¼ä¼ è¾“ä»¤ç‰Œ</strong></h5><p>åœ¨ LangGraph ä¸­ï¼Œâ€œæµå¼ä¼ è¾“ä»¤ç‰Œï¼ˆStreaming tokensï¼‰â€æŒ‡çš„æ˜¯<strong>åœ¨èŠ‚ç‚¹å†…éƒ¨çš„å¤§æ¨¡å‹ï¼ˆLLMï¼‰ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œé€ token åœ°å°†ä¸­é—´ç»“æœå®æ—¶æ¨é€åˆ°å®¢æˆ·ç«¯</strong>çš„èƒ½åŠ›ã€‚å®ç°è¿™ä¸€èƒ½åŠ›çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>astream_events</code>ï¼Œå®ƒä¼šä»¥äº‹ä»¶æµçš„å½¢å¼æš´éœ²æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ç»†èŠ‚ï¼ŒåŒ…æ‹¬æ¯ä¸€æ¬¡ LLM è°ƒç”¨äº§ç”Ÿçš„ tokenã€‚</p>
<p>æ¯ä¸ªäº‹ä»¶æ˜¯ä¸€ä¸ªåŒ…å«å‡ ä¸ªé”®çš„å­—å…¸ï¼š</p>
<p><code>event</code>ï¼šè¿™æ˜¯æ­£åœ¨å‘å‡ºçš„äº‹ä»¶çš„ç±»å‹ã€‚</p>
<p> <code>name</code>ï¼šè¿™æ˜¯äº‹ä»¶çš„åç§°ã€‚</p>
<p><code>data</code>ï¼šè¿™æ˜¯ä¸äº‹ä»¶ç›¸å…³è”çš„æ•°æ®ã€‚</p>
<p> <code>metadata</code>ï¼šåŒ…å« <code>langgraph_node</code>ï¼Œå³å‘å‡ºäº‹ä»¶çš„èŠ‚ç‚¹ã€‚</p>
<p>è¦ç‚¹æ˜¯ï¼Œå›¾è¡¨ä¸­èŠå¤©æ¨¡å‹çš„ä»¤ç‰Œå…·æœ‰ <code>on_chat_model_stream</code> ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>event[&#39;metadata&#39;][&#39;langgraph_node&#39;]</code> æ¥é€‰æ‹©è¦æµå¼çš„èŠ‚ç‚¹ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>event[&#39;data&#39;]</code> æ¥è·å–æ¯ä¸ªäº‹ä»¶çš„å®é™…æ•°æ®ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®æ˜¯ä¸€ä¸ª <code>AIMessageChunk</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node_to_stream = &#x27;conversation&#x27;#å®šä¹‰æµå¼ä¼ è¾“çš„èŠ‚ç‚¹</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;5&quot;&#125;&#125;</span><br><span class="line">input_message = HumanMessage(content=&quot;ä¸ºæˆ‘ä»‹ç»lol&quot;)</span><br><span class="line">async for event in graph.astream_events(&#123;&quot;messages&quot;: [input_message]&#125;, config, version=&quot;v2&quot;):</span><br><span class="line">    # ä»ç‰¹å®šèŠ‚ç‚¹è·å–èŠå¤©æ¨¡å‹ç”Ÿæˆçš„ Token</span><br><span class="line">    #äº‹ä»¶ç±»å‹å¿…é¡»æ˜¯ é€ token æµå¼è¾“å‡ºï¼ˆon_chat_model_streamï¼‰ã€‚</span><br><span class="line">    if event[&quot;event&quot;] == &quot;on_chat_model_stream&quot; and event[&#x27;metadata&#x27;].get(&#x27;langgraph_node&#x27;,&#x27;&#x27;) == node_to_stream:</span><br><span class="line">        data = event[&quot;data&quot;]</span><br><span class="line">        print(data[&quot;chunk&quot;].content, end=&quot;|&quot;)</span><br></pre></td></tr></table></figure>
<p>eventçš„å¸¸è§ç±»å‹</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>äº‹ä»¶ç±»å‹ (<code>event</code>)</th>
<th>è§¦å‘æ—¶æœºä¸è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>on_chain_start</code></td>
<td>ä»»æ„ Runnableï¼ˆèŠ‚ç‚¹ã€å­å›¾æˆ–æ•´ä¸ªå›¾ï¼‰å¼€å§‹æ‰§è¡Œ</td>
</tr>
<tr>
<td><code>on_chain_stream</code></td>
<td>èŠ‚ç‚¹/å›¾åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ <strong>å¢é‡è¾“å‡º</strong> chunk</td>
</tr>
<tr>
<td><code>on_chain_end</code></td>
<td>ä»»æ„ Runnable æ‰§è¡Œå®Œæˆ</td>
</tr>
<tr>
<td><code>on_chat_model_start</code></td>
<td><strong>ChatModel</strong> å¼€å§‹è°ƒç”¨</td>
</tr>
<tr>
<td><code>on_chat_model_stream</code></td>
<td><strong>ChatModel</strong> é€ token è¿”å›å†…å®¹ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰</td>
</tr>
<tr>
<td><code>on_chat_model_end</code></td>
<td><strong>ChatModel</strong> è°ƒç”¨ç»“æŸ</td>
</tr>
<tr>
<td><code>on_tool_start</code></td>
<td><strong>Tool</strong> å¼€å§‹è°ƒç”¨</td>
</tr>
<tr>
<td><code>on_tool_end</code></td>
<td><strong>Tool</strong> è°ƒç”¨ç»“æŸ</td>
</tr>
<tr>
<td><code>on_retriever_start</code></td>
<td><strong>Retriever</strong> å¼€å§‹æ£€ç´¢</td>
</tr>
<tr>
<td><code>on_retriever_end</code></td>
<td><strong>Retriever</strong> æ£€ç´¢ç»“æŸ</td>
</tr>
</tbody>
</table>
</div>
<h4 id="Breakpoints-æ–­ç‚¹"><a href="#Breakpoints-æ–­ç‚¹" class="headerlink" title="Breakpoints æ–­ç‚¹"></a><strong>Breakpoints æ–­ç‚¹</strong></h4><p><code>human-in-the-loop</code>ï¼ˆäººå·¥ä»‹å…¥/äººåœ¨å›è·¯ï¼‰çš„ä¸‰å¤§åŠ¨æœºï¼š</p>
<p>1ï¸âƒ£ Approvalï¼ˆå®¡æ‰¹ï¼‰æˆ‘ä»¬å¯ä»¥ä¸­æ–­æ™ºèƒ½ä½“ï¼Œå°†å½“å‰çŠ¶æ€å‘ˆç°ç»™ç”¨æˆ·ï¼Œå¹¶è®©ç”¨æˆ·å†³å®šæ˜¯å¦æ‰§è¡Œè¯¥æ“ä½œã€‚</p>
<p>2ï¸âƒ£ Debuggingï¼ˆè°ƒè¯•/å›æ”¾ï¼‰æˆ‘ä»¬å¯ä»¥å›é€€å›¾å½¢ä»¥é‡ç°æˆ–é¿å…é—®é¢˜</p>
<p>3ï¸âƒ£ Editingï¼ˆç¼–è¾‘ï¼‰AI äº§å‡ºçš„ä¸­é—´ç»“æœä¸ç¬¦åˆé¢„æœŸï¼Œä½†ä¸æƒ³é‡è·‘æ•´å›¾ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹çŠ¶æ€</p>
<p>æˆ‘ä»¬å°†ä»‹ç» <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/breakpoints/#simple-usage">breakpoints</a>ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨ç‰¹å®šæ­¥éª¤åœæ­¢å›¾çš„ç®€å•æ–¹æ³•ã€‚</p>
<h5 id="Breakpoints-for-human-approvalç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹"><a href="#Breakpoints-for-human-approvalç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹" class="headerlink" title="Breakpoints for human approvalç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹"></a><strong>Breakpoints for human approval</strong>ç”¨äºäººç±»å®¡æ‰¹çš„æ–­ç‚¹</h5><p>å‡è®¾æˆ‘ä»¬å…³æ³¨å·¥å…·çš„ä½¿ç”¨ï¼šæˆ‘ä»¬å¸Œæœ›æ‰¹å‡†ä»£ç†ä½¿ç”¨å…¶ä»»ä½•å·¥å…·ã€‚</p>
<p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç®€å•åœ°ç”¨ <code>interrupt_before=[&quot;tools&quot;]</code> ç¼–è¯‘å›¾å½¢ï¼Œå…¶ä¸­ <code>tools</code> æ˜¯æˆ‘ä»¬çš„å·¥å…·èŠ‚ç‚¹ã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨çš„èŠ‚ç‚¹ <code>tools</code> ä¹‹å‰ï¼Œæ‰§è¡Œå°†è¢«ä¸­æ–­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = builder.compile(interrupt_before=[&quot;tools&quot;], checkpointer=memory)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250720225640772.png" alt="image-20250720225640772"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Input</span><br><span class="line">initial_input = &#123;&quot;messages&quot;: HumanMessage(content=&quot;2ä¹˜3&quot;)&#125;</span><br><span class="line"></span><br><span class="line"># Thread</span><br><span class="line">thread = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Run the graph until the first interruption</span><br><span class="line">for event in graph.stream(initial_input, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_92a4bcf88d25476d925775)</span><br><span class="line"> Call ID: call_92a4bcf88d25476d925775</span><br><span class="line">  Args:</span><br><span class="line">    a: 2</span><br><span class="line">    b: 3</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥è·å–çŠ¶æ€å¹¶æŸ¥çœ‹è¦è°ƒç”¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ï¼Œå¯ä»¥å‘ç°å›¾å·²è¢«ä¸­æ–­ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ä¸ªå¾ˆå¥½çš„æŠ€å·§ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ <code>None</code> è°ƒç”¨å›¾æ—¶ï¼Œå®ƒå°†ç›´æ¥ä»æœ€åä¸€ä¸ªçŠ¶æ€æ£€æŸ¥ç‚¹ç»§ç»­ï¼</p>
<p><img src="https://cdn.prod.website-files.com/65b8cd72835ceeacd4449a53/66dbae7985b747dfed67775d_breakpoints1.png" alt="breakpoints.jpg"></p>
<p>çŠ¶æ€å¿«ç…§ï¼ˆStateSnapshotï¼‰</p>
<ul>
<li>ç±»å‹ï¼šä¸“é—¨ç”¨æ¥å­˜ <strong>ä¸€ä¸ªæ—¶åˆ»</strong> çš„å®Œæ•´çŠ¶æ€</li>
<li>è·å–æ–¹å¼ï¼š<ul>
<li><code>Graph.get_state()</code> â†’ <strong>æœ€æ–°çš„</strong> å¿«ç…§</li>
<li><code>Graph.get_state_history()</code> â†’ <strong>æ‰€æœ‰</strong> å¿«ç…§åˆ—è¡¨</li>
</ul>
</li>
</ul>
<p>ç»§ç»­/é‡è·‘å›¾</p>
<ul>
<li><code>Graph.stream(None, &#123;&quot;thread_id&quot;: &quot;xxx&quot;&#125;)</code><ul>
<li>ä¸ä¼ æ–°è¾“å…¥ <code>None</code> è¡¨ç¤º <strong>ä»å½“å‰æœ€æ–°çŠ¶æ€ç»§ç»­è·‘</strong></li>
<li>ä¹Ÿå¯å›é€€åˆ°å†å²å¿«ç…§ï¼Œå†é‡è·‘ï¼ˆè°ƒè¯•/å›æ”¾ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line">Tool Calls:</span><br><span class="line">  multiply (call_92a4bcf88d25476d925775)</span><br><span class="line"> Call ID: call_92a4bcf88d25476d925775</span><br><span class="line">  Args:</span><br><span class="line">    a: 2</span><br><span class="line">    b: 3</span><br><span class="line">=================================[1m Tool Message [0m=================================</span><br><span class="line">Name: multiply</span><br><span class="line"></span><br><span class="line">6</span><br><span class="line">==================================[1m Ai Message [0m==================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3çš„ç»“æœæ˜¯6ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="Editing-graph-state-ç¼–è¾‘å›¾çŠ¶æ€"><a href="#Editing-graph-state-ç¼–è¾‘å›¾çŠ¶æ€" class="headerlink" title="Editing graph state ç¼–è¾‘å›¾çŠ¶æ€"></a><strong>Editing graph state </strong>ç¼–è¾‘å›¾çŠ¶æ€</h4><p>æ–­ç‚¹ä¹Ÿæ˜¯<a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/edit-graph-state/">ä¿®æ”¹å›¾çŠ¶æ€çš„æœºä¼š</a>è®©æˆ‘ä»¬åœ¨ <code>assistant</code> èŠ‚ç‚¹ä¹‹å‰ä¸ºä»£ç†è®¾ç½®æ–­ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = builder.compile(interrupt_before=[&quot;assistant&quot;], checkpointer=memory)</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250720230924672.png" alt="image-20250720230924672"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Input</span><br><span class="line">initial_input = &#123;&quot;messages&quot;: &quot;2ä¹˜3&quot;&#125;</span><br><span class="line"></span><br><span class="line"># Thread</span><br><span class="line">thread = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Run the graph until the first interruption</span><br><span class="line">for event in graph.stream(initial_input, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3</span><br></pre></td></tr></table></figure>
<p>å½“çŠ¶æ€ä¸­æ–­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åº”ç”¨çŠ¶æ€æ›´æ–°</p>
<p>è®°ä½ï¼Œå¯¹ <code>messages</code> é”®çš„æ›´æ–°å°†ä½¿ç”¨ <code>add_messages</code> reducerï¼š</p>
<p><strong>å¦‚æœæˆ‘ä»¬æƒ³è¦†ç›–ç°æœ‰çš„æ¶ˆæ¯ï¼Œå¯ä»¥æä¾›å¸¦æœ‰<em> </em><code>id</code><em> </em>çš„æ¶ˆæ¯ã€‚</strong> å¦‚æœæˆ‘ä»¬åªæƒ³å°†æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ä¸­ï¼Œåˆ™å¯ä»¥ä¼ é€’æœªæŒ‡å®š <code>id</code> çš„æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.update_state(</span><br><span class="line">    thread,</span><br><span class="line">    &#123;&quot;messages&quot;: [HumanMessage(content=&quot;ä¸è¦ï¼Œå®é™…ä¸Šè¦3ä¹˜3!&quot;)]&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">new_state = graph.get_state(thread).values</span><br><span class="line">for m in new_state[&#x27;messages&#x27;]:</span><br><span class="line">    m.pretty_print()</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">2ä¹˜3</span><br><span class="line">================================[1m Human Message [0m=================================</span><br><span class="line"></span><br><span class="line">ä¸è¦ï¼Œå®é™…ä¸Šè¦3ä¹˜3!</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œæˆ‘ä»¬çš„ä»£ç†æ“ä½œï¼Œåªéœ€ä¼ é€’ <code>None</code> å¹¶å…è®¸å…¶ä»å½“å‰çŠ¶æ€ç»§ç»­æ‰§è¡Œã€‚æˆ‘ä»¬è¾“å‡ºå½“å‰å†…å®¹ï¼Œç„¶åç»§ç»­æ‰§è¡Œå‰©ä½™çš„èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, thread, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h4 id="Dynamic-breakpoints-åŠ¨æ€æ–­ç‚¹"><a href="#Dynamic-breakpoints-åŠ¨æ€æ–­ç‚¹" class="headerlink" title="Dynamic breakpoints åŠ¨æ€æ–­ç‚¹"></a><strong>Dynamic breakpoints </strong>åŠ¨æ€æ–­ç‚¹</h4><p>ä½ å¯ä»¥æ ¹æ®æ¡ä»¶æ¥å®ç°å®ƒï¼ˆä»èŠ‚ç‚¹å†…éƒ¨åŸºäºå¼€å‘äººå‘˜å®šä¹‰çš„é€»è¾‘ï¼‰ã€‚æ‚¨å¯ä»¥å‘ç”¨æˆ·è¯´æ˜å…¶ä¸­æ–­åŸå› ï¼ˆé€šè¿‡å°†æ‚¨æƒ³ä¼ é€’çš„å†…å®¹å‘é€åˆ° <code>NodeInterrupt</code>ï¼‰ã€‚</p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå›¾è¡¨ï¼Œå…¶ä¸­æ ¹æ®è¾“å…¥çš„é•¿åº¦ä¼šæŠ›å‡ºä¸€ä¸ª <code>NodeInterrupt</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Image, display</span><br><span class="line"></span><br><span class="line">from typing_extensions import TypedDict</span><br><span class="line">from langgraph.checkpoint.memory import MemorySaver</span><br><span class="line">from langgraph.errors import NodeInterrupt</span><br><span class="line">from langgraph.graph import START, END, StateGraph</span><br><span class="line"></span><br><span class="line">class State(TypedDict):</span><br><span class="line">    input: str</span><br><span class="line"></span><br><span class="line">def step_1(state: State) -&gt; State:</span><br><span class="line">    print(&quot;---Step 1---&quot;)</span><br><span class="line">    return state</span><br><span class="line"></span><br><span class="line">def step_2(state: State) -&gt; State:</span><br><span class="line">    # å¦‚æœè¾“å…¥å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡5ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æŠ›å‡ºNodeInterruptå¼‚å¸¸</span><br><span class="line">    if len(state[&#x27;input&#x27;]) &gt; 5:</span><br><span class="line">        raise NodeInterrupt(f&quot;æ”¶åˆ°é•¿åº¦è¶…è¿‡5ä¸ªå­—ç¬¦çš„è¾“å…¥: &#123;state[&#x27;input&#x27;]&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    print(&quot;---Step 2---&quot;)</span><br><span class="line">    return state</span><br><span class="line"></span><br><span class="line">def step_3(state: State) -&gt; State:</span><br><span class="line">    print(&quot;---Step 3---&quot;)</span><br><span class="line">    return state</span><br><span class="line"></span><br><span class="line">builder = StateGraph(State)</span><br><span class="line">builder.add_node(&quot;step_1&quot;, step_1)</span><br><span class="line">builder.add_node(&quot;step_2&quot;, step_2)</span><br><span class="line">builder.add_node(&quot;step_3&quot;, step_3)</span><br><span class="line">builder.add_edge(START, &quot;step_1&quot;)</span><br><span class="line">builder.add_edge(&quot;step_1&quot;, &quot;step_2&quot;)</span><br><span class="line">builder.add_edge(&quot;step_2&quot;, &quot;step_3&quot;)</span><br><span class="line">builder.add_edge(&quot;step_3&quot;, END)</span><br><span class="line"></span><br><span class="line"># Set up memory</span><br><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line"># Compile the graph with memory</span><br><span class="line">graph = builder.compile(checkpointer=memory)</span><br><span class="line"></span><br><span class="line"># View</span><br><span class="line">display(Image(graph.get_graph().draw_mermaid_png()))</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/image-20250721222709712.png" alt="image-20250721222709712"></p>
<p>è®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªè¾“å…¥è¶…è¿‡5ä¸ªå­—ç¬¦çš„å›¾ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">initial_input = &#123;&quot;input&quot;: &quot;hello world&quot;&#125;</span><br><span class="line">thread_config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"># Run the graph until the first interruption</span><br><span class="line">for event in graph.stream(initial_input, thread_config, stream_mode=&quot;values&quot;):</span><br><span class="line">    print(event)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;input&#x27;: &#x27;hello world&#x27;&#125;</span><br><span class="line">---Step 1---</span><br><span class="line">&#123;&#x27;input&#x27;: &#x27;hello world&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å°è¯•ä»æ–­ç‚¹æ¢å¤å›¾ã€‚ä½†æ˜¯ï¼Œè¿™åªä¼šé‡æ–°è¿è¡Œç›¸åŒçš„èŠ‚ç‚¹ï¼é™¤éçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™æˆ‘ä»¬å°†ä¸€ç›´å¡åœ¨è¿™é‡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph.update_state(</span><br><span class="line">    thread_config,</span><br><span class="line">    &#123;&quot;input&quot;: &quot;hi&quot;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨update_stateæ›´æ–°çŠ¶æ€</p>
<h4 id="Time-travel-æ—¶é—´æ—…è¡Œ"><a href="#Time-travel-æ—¶é—´æ—…è¡Œ" class="headerlink" title="Time travel æ—¶é—´æ—…è¡Œ"></a><strong>Time travel</strong> æ—¶é—´æ—…è¡Œ</h4><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ã€é‡æ’­ï¼Œç”šè‡³ä»è¿‡å»çš„çŠ¶æ€å‰å‡ºï¼Œæ¥å±•ç¤º LangGraph <a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/how-tos/human_in_the_loop/time-travel/">æ”¯æŒdebug</a> çš„åŠŸèƒ½ã€‚</p>
<h5 id="Browsing-History-æµè§ˆå†å²"><a href="#Browsing-History-æµè§ˆå†å²" class="headerlink" title="Browsing History æµè§ˆå†å²"></a><strong>Browsing History</strong> <strong>æµè§ˆå†å²</strong></h5><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>get_state</code> æ¥æŸ¥çœ‹ç»™å®š <code>thread_id</code> çš„å›¾çš„ å½“å‰ çŠ¶æ€ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph.get_state(&#123;&#x27;configurable&#x27;: &#123;&#x27;thread_id&#x27;: &#x27;1&#x27;&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥æµè§ˆä»£ç†çš„çŠ¶æ€å†å²ã€‚<code>get_state_history</code> è®©æˆ‘ä»¬èƒ½å¤Ÿè·å–æ‰€æœ‰å…ˆå‰æ­¥éª¤çš„çŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">all_states = [s for s in graph.get_state_history(thread)]</span><br><span class="line">len(all_states)</span><br><span class="line">print(all_states)</span><br></pre></td></tr></table></figure>
<h5 id="Replaying-å›æ”¾"><a href="#Replaying-å›æ”¾" class="headerlink" title="Replaying å›æ”¾"></a><strong>Replaying</strong> <strong>å›æ”¾</strong></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">to_replay = all_states[-2]</span><br><span class="line">to_replay.values</span><br><span class="line">&#123;&#x27;messages&#x27;: [HumanMessage(content=&#x27;2ä¹˜3&#x27;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;, id=&#x27;0676d9b5-cd59-4630-924d-b5c8d950e8d8&#x27;)]&#125;</span><br><span class="line">to_replay.next</span><br><span class="line">(&#x27;assistant&#x27;,)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜è·å–äº†é…ç½®ï¼Œå®ƒå‘Šè¯‰äº†æˆ‘ä»¬ <code>checkpoint_id</code> ä»¥åŠ <code>thread_id</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">to_replay.config</span><br><span class="line">&#123;&#x27;configurable&#x27;: &#123;&#x27;thread_id&#x27;: &#x27;1&#x27;,</span><br><span class="line">  &#x27;checkpoint_ns&#x27;: &#x27;&#x27;,</span><br><span class="line">  &#x27;checkpoint_id&#x27;: &#x27;1f066c0e-2ee2-66d5-8000-5dde78194aae&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ä»è¿™é‡Œé‡æ’­ï¼Œæˆ‘ä»¬åªéœ€å°†é…ç½®ä¼ å›ç»™ä»£ç†ï¼å›¾çŸ¥é“è¿™ä¸ªæ£€æŸ¥ç‚¹å·²ç»æ‰§è¡Œè¿‡äº†ã€‚å®ƒåªæ˜¯ä»è¿™ä¸ªæ£€æŸ¥ç‚¹é‡æ–°æ’­æ”¾ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, to_replay.config, stream_mode=&quot;values&quot;):</span><br><span class="line">    event[&#x27;messages&#x27;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h5 id="Forking-åˆ†å‰"><a href="#Forking-åˆ†å‰" class="headerlink" title="Forking åˆ†å‰"></a><strong>Forking</strong> åˆ†å‰</h5><p>å¦‚æœæˆ‘ä»¬æƒ³ä»ç›¸åŒçš„æ­¥éª¤è¿è¡Œï¼Œä½†ä½¿ç”¨ä¸åŒçš„è¾“å…¥ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ˜¯åˆ†å‰ã€‚</p>
<p><img src="/2025/07/18/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph-agent/66dbb038f89f2d847ee5c336_time-travel3.png" alt="fig3.jpg"></p>
<p>è®©æˆ‘ä»¬ä¿®æ”¹æ­¤æ£€æŸ¥ç‚¹çš„çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æä¾›çš„ <code>checkpoint_id</code> æ¥è¿è¡Œ <code>update_state</code>ã€‚</p>
<p>è¯·è®°ä½æˆ‘ä»¬å¯¹ <code>messages</code> çš„ reducer æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<ul>
<li>å®ƒä¼šè¿½åŠ æ¶ˆæ¯ï¼Œé™¤éæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¶ˆæ¯ IDã€‚</li>
<li>æˆ‘ä»¬æä¾›æ¶ˆæ¯ ID æ˜¯ä¸ºäº†è¦†ç›–æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯å°†æ¶ˆæ¯è¿½åŠ åˆ°çŠ¶æ€ä¸­ï¼</li>
</ul>
<p>å› æ­¤ï¼Œè¦è¦†ç›–æ¶ˆæ¯ï¼Œæˆ‘ä»¬åªéœ€æä¾›æ¶ˆæ¯ IDï¼Œè€Œæˆ‘ä»¬å·²æœ‰ <code>to_fork.values[&quot;messages&quot;].id</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fork_config = graph.update_state(</span><br><span class="line">    to_fork.config,</span><br><span class="line">    &#123;&quot;messages&quot;: [HumanMessage(content=&#x27;5ä¹˜3&#x27;, </span><br><span class="line">                               id=to_fork.values[&quot;messages&quot;][0].id)]&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><h4 id="message"><a href="#message" class="headerlink" title="message"></a>message</h4><p>LangChain ä¸­çš„ HumanMessage ã€ AIMessage ã€ SystemMessage å’Œ ToolMessage ã€‚è¿™äº›æ¶ˆæ¯ç±»å‹æ˜¯æ„å»ºä¸è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†ä¸€ä¸ªå®Œæ•´çš„å¯¹è¯å†å²ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£ä¸Šä¸‹æ–‡å¹¶åšå‡ºæ°å½“çš„å›åº”ã€‚</p>
<ol>
<li>SystemMessage</li>
</ol>
<p>SystemMessage çš„ç»“æ„æœ€ç®€å•ï¼Œå®ƒåªåŒ…å«å†…å®¹å’Œç±»å‹ã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): æ¶ˆæ¯çš„å…·ä½“å†…å®¹ï¼Œå³ç»™ AI çš„æŒ‡ä»¤ã€‚</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜systemâ€™ ã€‚</li>
</ul>
<ol>
<li>HumanMessage</li>
</ol>
<p>HumanMessage çš„ç»“æ„ä¹ŸåŒæ ·ç®€å•ï¼Œä»£è¡¨ç”¨æˆ·çš„è¾“å…¥ã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ã€‚</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜humanâ€™ ã€‚</li>
</ul>
<ol>
<li>AIMessage</li>
</ol>
<p>AIMessage çš„ç»“æ„ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒä¸ä»…å¯ä»¥åŒ…å«æ–‡æœ¬å“åº”ï¼Œè¿˜å¯ä»¥åŒ…å«å¯¹å·¥å…·çš„è°ƒç”¨è¯·æ±‚ã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): AI ç”Ÿæˆçš„æ–‡æœ¬å“åº”ã€‚å¦‚æœ AI çš„å›å¤æ˜¯å‘èµ·å·¥å…·è°ƒç”¨ï¼Œæ­¤å­—æ®µå¯ä»¥ä¸ºç©ºå­—ç¬¦ä¸²ã€‚</li>
<li>tool_calls (list[dict], å¯é€‰): ä¸€ä¸ªå­—å…¸åˆ—è¡¨ï¼Œæ¯ä¸ªå­—å…¸ä»£è¡¨ä¸€ä¸ªå·¥å…·è°ƒç”¨è¯·æ±‚ã€‚è¿™æ˜¯æ”¯æŒâ€œFunction Callingâ€æˆ–â€œTool Callingâ€åŠŸèƒ½çš„æ ¸å¿ƒã€‚å…¶ç»“æ„é€šå¸¸åŒ…å«ï¼š<ul>
<li>name (str): è¦è°ƒç”¨çš„å·¥å…·åç§°ã€‚</li>
<li>args (dict): è°ƒç”¨å·¥å…·æ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°ã€‚</li>
<li>id (str): æ­¤æ¬¡å·¥å…·è°ƒç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåç»­ ToolMessage çš„å…³è”ã€‚</li>
</ul>
</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜aiâ€™ ã€‚</li>
</ul>
<ol>
<li>ToolMessage</li>
</ol>
<p>ToolMessage ç”¨äºæ‰¿è½½å·¥å…·æ‰§è¡Œåçš„è¿”å›ç»“æœã€‚</p>
<p>æ•°æ®ç»“æ„ :</p>
<ul>
<li>content (str): å·¥å…·æ‰§è¡Œè¿”å›çš„ç»“æœã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</li>
<li>tool_call_id (str): æ­¤æ¬¡å·¥å…·è°ƒç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œ å¿…é¡» ä¸ä¹‹å‰ AIMessage ä¸­ tool_calls é‡Œçš„ id ç›¸å¯¹åº”ã€‚è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå‡†ç¡®åœ°å°†ç»“æœä¸è¯·æ±‚åŒ¹é…èµ·æ¥ã€‚</li>
<li>type (str): å›ºå®šä¸ºå­—ç¬¦ä¸² â€˜toolâ€™ ã€‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langchain%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langchain%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">LangChainå­¦ä¹ </a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-02 15:52:10" itemprop="dateModified" datetime="2025-08-02T15:52:10+08:00">2025-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langchain/" itemprop="url" rel="index"><span itemprop="name">langchain</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="å®æˆ˜demo"><a href="#å®æˆ˜demo" class="headerlink" title="å®æˆ˜demo"></a>å®æˆ˜demo</h3><h4 id="agentå®æˆ˜"><a href="#agentå®æˆ˜" class="headerlink" title="agentå®æˆ˜"></a>agentå®æˆ˜</h4><p>langchainçš„agentä¸langgraphçš„agentä¸»è¦å·®å¼‚ç‚¹åœ¨create_openai_functions_agent, AgentExecutorè¿™ä¸¤ä¸ªå‡½æ•°</p>
<p>å‰è€…çš„ä½œç”¨ç±»ä¼¼<strong>æ„å»º Runnable é“¾</strong>ï¼Œè¿”å›ä¸€ä¸ª<code>RunnablePassthrough.assign(...)|prompt|llm_with_tools|ToolsAgentOutputParser()</code>ï¼Œä½†å…¶invokeä»…èƒ½å®Œæˆå•æ­¥çš„è°ƒç”¨ï¼Œè€Œ<code>AgentExecutor</code> ä¼šè‡ªåŠ¨å®Œæˆ3 æ­¥å¾ªç¯ï¼ˆè°ƒç”¨å·¥å…·â†’æ‹¼å›ç»“æœâ†’å†æ¬¡è°ƒç”¨ LLMï¼‰ï¼Œç›´åˆ°ä»»åŠ¡ç»“æŸã€‚</p>
<blockquote>
<p>ä»¥ä¸‹ä¸ºaiçš„è§£é‡Š</p>
<p><strong>ç›´æ¥ä½¿ç”¨ <code>agent</code> (Runnable) çš„å±€é™æ€§:</strong></p>
<ol>
<li><strong>å•æ­¥æ‰§è¡Œ</strong>: ä½ ç›´æ¥è°ƒç”¨ <code>agent.invoke()</code> æˆ– <code>agent.ainvoke()</code> æ—¶ï¼Œå®ƒé€šå¸¸åªæ‰§è¡Œ<strong>ä¸€æ­¥</strong>ã€‚å¯¹äºåƒ <code>create_tool_calling_agent</code> ç”Ÿæˆçš„ <code>agent</code> æ¥è¯´ï¼Œè¿™ä¸€æ­¥å°±æ˜¯ï¼š<ul>
<li>æ¥æ”¶è¾“å…¥ï¼ˆåŒ…æ‹¬å†å²æ¶ˆæ¯å’Œ <code>agent_scratchpad</code>ï¼‰ã€‚</li>
<li>è®© LLM å†³å®šæ˜¯ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ (<code>AgentFinish</code>) è¿˜æ˜¯è°ƒç”¨å·¥å…· (<code>AgentAction</code>)ã€‚</li>
<li>è¿”å›è¿™ä¸ªå†³å®šã€‚</li>
</ul>
</li>
<li><strong>å·¥å…·è°ƒç”¨éœ€è¦æ‰‹åŠ¨å¤„ç†</strong>: å¦‚æœ LLM å†³å®šè°ƒç”¨å·¥å…·ï¼ˆè¿”å› <code>AgentAction</code>ï¼‰ï¼Œ<strong>ä½ </strong>éœ€è¦è´Ÿè´£ï¼š<ul>
<li>ä»è¿”å›çš„ <code>AgentAction</code> ä¸­æ‰¾å‡ºå·¥å…·åç§°å’Œè¾“å…¥å‚æ•°ã€‚</li>
<li>åœ¨ä½ çš„å·¥å…·åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„å·¥å…·ã€‚</li>
<li>æ‰§è¡Œè¿™ä¸ªå·¥å…·ã€‚</li>
<li>è·å–å·¥å…·çš„è¾“å‡ºï¼ˆObservationï¼‰ã€‚</li>
<li><strong>å†æ¬¡æ‰‹åŠ¨è°ƒç”¨ <code>agent.invoke(...)</code></strong>ï¼ŒæŠŠå·¥å…·çš„è¾“å‡ºï¼ˆé€šå¸¸éœ€è¦æ ¼å¼åŒ–æˆ <code>ToolMessage</code>ï¼‰æ”¾å› <code>agent_scratchpad</code> æˆ– <code>intermediate_steps</code> ä¸­ã€‚</li>
<li>é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ° <code>agent</code> æœ€ç»ˆè¿”å› <code>AgentFinish</code>ã€‚</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨ <code>AgentExecutor</code> çš„ä¼˜åŠ¿:</strong></p>
<p><code>AgentExecutor</code> å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜è€Œè®¾è®¡çš„ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>è‡ªåŠ¨åŒ–çš„æ‰§è¡Œå¼•æ“</strong>ï¼Œä¸ºä½ ç®¡ç†æ•´ä¸ª Agent çš„æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯ã€‚</p>
<ol>
<li><strong>è‡ªåŠ¨åŒ–å¾ªç¯</strong>: <code>AgentExecutor</code> å†…éƒ¨ä¼šè‡ªåŠ¨è¿è¡Œé‚£ä¸ªå¾ªç¯ï¼š<ul>
<li>è°ƒç”¨ <code>agent</code> (Runnable)ã€‚</li>
<li>æ£€æŸ¥è¿”å›çš„æ˜¯ <code>AgentAction</code> è¿˜æ˜¯ <code>AgentFinish</code>ã€‚</li>
<li>å¦‚æœæ˜¯ <code>AgentAction</code>ï¼Œå®ƒä¼šè‡ªåŠ¨æ ¹æ®ä½ æä¾›çš„ <code>tools</code> åˆ—è¡¨æ‰¾åˆ°å¹¶æ‰§è¡Œå¯¹åº”çš„å·¥å…·ã€‚</li>
<li>å®ƒä¼šè‡ªåŠ¨å°†å·¥å…·çš„è¾“å‡ºï¼ˆObservationï¼‰è®°å½•ä¸‹æ¥ï¼Œå¹¶ä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥ï¼ˆæ”¾å…¥ <code>agent_scratchpad</code>ï¼‰å†æ¬¡è°ƒç”¨ <code>agent</code>ã€‚</li>
<li>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸€ç›´é‡å¤ã€‚</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from langchain.agents import create_openai_functions_agent, AgentExecutor</span><br><span class="line">from langchain.tools import tool</span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">from pydantic import BaseModel, Field</span><br><span class="line"></span><br><span class="line"># 1. å®šä¹‰å·¥å…·</span><br><span class="line">class WeatherInput(BaseModel):</span><br><span class="line">    location: str = Field(description=&quot;åŸå¸‚åç§°&quot;)</span><br><span class="line"></span><br><span class="line">@tool(&quot;get_weather&quot;, args_schema=WeatherInput)</span><br><span class="line">def get_weather(location: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;æŸ¥è¯¢åŸå¸‚å¤©æ°”&quot;&quot;&quot;</span><br><span class="line">    return f&quot;&#123;location&#125; ä»Šå¤©æ˜¯æ™´å¤©ï¼Œ25Â°C&quot;</span><br><span class="line"></span><br><span class="line"># 2. åˆ›å»ºAgent</span><br><span class="line">llm = ChatOpenAI(model=&quot;gpt-4&quot;)</span><br><span class="line">tools = [get_weather]</span><br><span class="line">prompt = ChatPromptTemplate.from_messages([</span><br><span class="line">    (&quot;system&quot;, &quot;ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹ï¼Œå¯ä»¥è°ƒç”¨å·¥å…·&quot;),</span><br><span class="line">    (&quot;human&quot;, &quot;&#123;input&#125;&quot;)</span><br><span class="line">])</span><br><span class="line">agent = create_openai_functions_agent(llm, tools, prompt)</span><br><span class="line">agent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)</span><br><span class="line"></span><br><span class="line"># 3. æ‰§è¡Œ</span><br><span class="line">result = agent_executor.invoke(&#123;&quot;input&quot;: &quot;åŒ—äº¬å¤©æ°”å¦‚ä½•ï¼Ÿ&quot;&#125;)</span><br><span class="line">print(result[&quot;output&quot;])</span><br></pre></td></tr></table></figure>
<h4 id="å·¥å…·è°ƒç”¨"><a href="#å·¥å…·è°ƒç”¨" class="headerlink" title="å·¥å…·è°ƒç”¨"></a>å·¥å…·è°ƒç”¨</h4><p>åˆ©ç”¨bind_toolsç»‘å®šå·¥å…·ï¼Œå½“å¤§æ¨¡å‹éœ€è¦è°ƒç”¨å·¥å…·çš„æ—¶å€™ï¼Œä¼šè¿”å›å·¥å…·ä¿¡æ¯ï¼Œtool_callsï¼Œå¦‚ä¸‹</p>
<p>[{â€˜nameâ€™: â€˜add_numbersâ€™, â€˜argsâ€™: {â€˜aâ€™: 15, â€˜bâ€™: 27}, â€˜idâ€™: â€˜4e7b261cce6d4e3da09134086c704c3câ€™, â€˜typeâ€™: â€˜tool_callâ€™}]</p>
<blockquote>
<p><code>llm_with_tools.invoke(...)</code> åªæ˜¯ä¸€ä¸ª<strong>å•æ­¥è°ƒç”¨</strong>ï¼ŒLLM è¿”å›çš„æ˜¯<strong>â€œæˆ‘æƒ³è°ƒç”¨å“ªä¸ªå·¥å…·ã€ä¼ ä»€ä¹ˆå‚æ•°â€</strong>ï¼ˆå³ <code>tool_calls</code>ï¼‰ã€‚<br><strong>ä½† LLM å¹¶ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œå·¥å…·</strong>ï¼Œæ‰€ä»¥ä½ å¿…é¡»ï¼š</p>
<ol>
<li><strong>æ‰‹åŠ¨æ‰§è¡Œå·¥å…·</strong>ï¼ˆæˆ–è®© AgentExecutor å¸®ä½ æ‰§è¡Œï¼‰ã€‚</li>
<li><strong>æŠŠæ‰§è¡Œç»“æœæ‹¼å›å¯¹è¯</strong>ï¼ˆä½œä¸º <code>ToolMessage</code>ï¼‰ã€‚</li>
<li><strong>å†æ¬¡è°ƒç”¨ LLM</strong>ï¼Œè®©å®ƒåŸºäºå·¥å…·è¿”å›çš„ç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚</li>
</ol>
</blockquote>
<p>è¿™é‡Œå±•ç¤ºçš„æ˜¯æ‰‹åŠ¨æ‹¼æ¥ï¼Œå¹¶ä¼ ç»™å¤§æ¨¡å‹ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å°†å·¥å…·çš„è¾“å‡ºå‘é€å›LLMï¼Œè®©LLMåŸºäºç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”</span><br><span class="line">            # è¿™æ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œé€šå¸¸åœ¨Agentä¸­è‡ªåŠ¨å¤„ç†ã€‚è¿™é‡Œæ‰‹åŠ¨æ¼”ç¤ºã€‚</span><br><span class="line">            final_response = llm_with_tools.invoke([</span><br><span class="line">                HumanMessage(content=&quot;What is 15 + 27?&quot;),</span><br><span class="line">                AIMessage(content=&quot;&quot;, tool_calls=[tool_call]), # å‘ŠçŸ¥LLMå®ƒä¹‹å‰å»ºè®®çš„å·¥å…·è°ƒç”¨</span><br><span class="line">                ToolMessage(content=str(result), tool_call_id=tool_call[&#x27;id&#x27;]) # å‘ŠçŸ¥LLMå·¥å…·çš„æ‰§è¡Œç»“æœ</span><br><span class="line">            ])</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">from langchain_core.tools import tool</span><br><span class="line">from typing import Literal</span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">from langchain_core.messages import HumanMessage, AIMessage, ToolMessage</span><br><span class="line"></span><br><span class="line"># å®šä¹‰ä¸€ä¸ªåŠ æ³•å·¥å…·</span><br><span class="line">@tool</span><br><span class="line">def add_numbers(a: float, b: float) -&gt; float:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Adds two numbers together.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        a: The first number.</span><br><span class="line">        b: The second number.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return a + b</span><br><span class="line"></span><br><span class="line"># æˆ‘ä»¬å¯ä»¥å®šä¹‰æ›´å¤šçš„å·¥å…·ï¼Œä¾‹å¦‚ä¸€ä¸ªä¹˜æ³•å·¥å…·</span><br><span class="line">@tool</span><br><span class="line">def multiply_numbers(a: float, b: float) -&gt; float:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Multiplies two numbers together.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        a: The first number.</span><br><span class="line">        b: The second number.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    return a * b</span><br><span class="line"></span><br><span class="line"># å°†æˆ‘ä»¬å®šä¹‰çš„å·¥å…·æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</span><br><span class="line">tools = [add_numbers, multiply_numbers]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># åˆå§‹åŒ–LLM</span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    temperature=0.5,</span><br><span class="line">    model_name=&quot;deepseek-v3-0324&quot;, # èŠå¤©æ¨¡å‹é€šå¸¸ä½¿ç”¨&quot;gpt-3.5-turbo&quot;æˆ–&quot;gpt-4&quot;</span><br><span class="line">    openai_api_base=&quot;https://api.qnaigc.com/v1&quot;, # ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŒ‡å®šbase_url</span><br><span class="line">    openai_api_key=&quot;sk-&quot; # ç›´æ¥åœ¨æ­¤å¤„è®¾ç½®APIå¯†é’¥ï¼Œæˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®</span><br><span class="line">)</span><br><span class="line"># å°†å·¥å…·ç»‘å®šåˆ°LLM</span><br><span class="line"># LLMç°åœ¨çŸ¥é“äº†add_numberså’Œmultiply_numbersè¿™ä¸¤ä¸ªå·¥å…·åŠå…¶åŠŸèƒ½</span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># åœºæ™¯ä¸€ï¼šLLMç›´æ¥å›ç­”ï¼Œä¸éœ€è¦å·¥å…·</span><br><span class="line">print(&quot;--- åœºæ™¯ä¸€ï¼šLLMç›´æ¥å›ç­” ---&quot;)</span><br><span class="line">response1 = llm_with_tools.invoke([HumanMessage(content=&quot;Hello, what&#x27;s your name?&quot;)])</span><br><span class="line">print(response1.content) # LLMç›´æ¥ç”Ÿæˆæ–‡æœ¬å›å¤</span><br><span class="line"></span><br><span class="line">print(&quot;\n--- åœºæ™¯äºŒï¼šLLMå†³å®šè°ƒç”¨å·¥å…· ---&quot;)</span><br><span class="line"># åœºæ™¯äºŒï¼šLLMå†³å®šè°ƒç”¨å·¥å…·</span><br><span class="line"># å½“LLMçš„å“åº”ä¸­åŒ…å«tool_callsæ—¶ï¼Œæ„å‘³ç€å®ƒæƒ³è¦è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·</span><br><span class="line">response2 = llm_with_tools.invoke([HumanMessage(content=&quot;What is 15 + 27?&quot;)])</span><br><span class="line">print(response2.tool_calls) # æ‰“å°LLMå†³å®šè°ƒç”¨çš„å·¥å…·ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"># æ£€æŸ¥å¹¶æ‰§è¡ŒLLMå»ºè®®çš„å·¥å…·è°ƒç”¨</span><br><span class="line">if response2.tool_calls:</span><br><span class="line">    for tool_call in response2.tool_calls:</span><br><span class="line">        if tool_call[&#x27;name&#x27;] == &quot;add_numbers&quot;:</span><br><span class="line">            # æå–LLMä¸ºå·¥å…·è°ƒç”¨ç”Ÿæˆçš„å‚æ•°</span><br><span class="line">            args = tool_call[&#x27;args&#x27;]</span><br><span class="line">            result = add_numbers.invoke(args) # æ‰§è¡Œå·¥å…·</span><br><span class="line">            print(f&quot;Tool call: add_numbers(&#123;args[&#x27;a&#x27;]&#125;, &#123;args[&#x27;b&#x27;]&#125;) = &#123;result&#125;&quot;)</span><br><span class="line"></span><br><span class="line">            # å°†å·¥å…·çš„è¾“å‡ºå‘é€å›LLMï¼Œè®©LLMåŸºäºç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”</span><br><span class="line">            # è¿™æ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œé€šå¸¸åœ¨Agentä¸­è‡ªåŠ¨å¤„ç†ã€‚è¿™é‡Œæ‰‹åŠ¨æ¼”ç¤ºã€‚</span><br><span class="line">            final_response = llm_with_tools.invoke([</span><br><span class="line">                HumanMessage(content=&quot;What is 15 + 27?&quot;),</span><br><span class="line">                AIMessage(content=&quot;&quot;, tool_calls=[tool_call]), # å‘ŠçŸ¥LLMå®ƒä¹‹å‰å»ºè®®çš„å·¥å…·è°ƒç”¨</span><br><span class="line">                ToolMessage(content=str(result), tool_call_id=tool_call[&#x27;id&#x27;]) # å‘ŠçŸ¥LLMå·¥å…·çš„æ‰§è¡Œç»“æœ</span><br><span class="line">            ])</span><br><span class="line">            print(&quot;Final LLM response based on tool output:&quot;)</span><br><span class="line">            print(final_response.content)</span><br></pre></td></tr></table></figure>
<h3 id="æ¦‚å¿µæ‰«ç›²"><a href="#æ¦‚å¿µæ‰«ç›²" class="headerlink" title="æ¦‚å¿µæ‰«ç›²"></a>æ¦‚å¿µæ‰«ç›²</h3><h4 id="Document-å¯¹è±¡"><a href="#Document-å¯¹è±¡" class="headerlink" title="Document å¯¹è±¡"></a>Document å¯¹è±¡</h4><p>Document å¯¹è±¡æ˜¯ LangChain ç”¨æ¥å°è£…å’Œå¤„ç†æ–‡æœ¬æ•°æ®çš„åŸºæœ¬å•ä½ã€‚æ— è®ºæ‚¨æ˜¯ä» PDFã€Markdown æ–‡ä»¶ã€ç½‘ç«™è¿˜æ˜¯æ•°æ®åº“åŠ è½½æ•°æ®ï¼ŒLangChain éƒ½ä¼šå°†è¿™äº›æ•°æ®è½¬æ¢æˆä¸€ä¸ªæˆ–å¤šä¸ª Document å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨åç»­çš„æµç¨‹ä¸­ä½¿ç”¨ã€‚</p>
<p>ä¸€ä¸ª Document å¯¹è±¡ä¸»è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><p>page_content (å­—ç¬¦ä¸²)</p>
<ul>
<li>è¿™æ˜¯æ–‡æ¡£å¯¹è±¡çš„æ ¸å¿ƒï¼Œå­˜å‚¨äº†åŸå§‹çš„æ–‡æœ¬å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåŠ è½½ä¸€ä¸ª Markdown æ–‡ä»¶ï¼Œ page_content å°±ä¼šåŒ…å«è¯¥æ–‡ä»¶çš„æ‰€æœ‰æ–‡æœ¬ã€‚</li>
</ul>
</li>
<li><p>metadata (å­—å…¸)</p>
<ul>
<li>è¿™æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œç”¨äºå­˜å‚¨å…³äºæ–‡æ¡£çš„â€œå…ƒæ•°æ®â€æˆ–é™„åŠ ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯¹äºè¿‡æ»¤ã€è¿½è¸ªæˆ–å¢å¼ºæ–‡æ¡£å¤„ç†æµç¨‹éå¸¸æœ‰ç”¨ã€‚å¸¸è§çš„å…ƒæ•°æ®åŒ…æ‹¬ï¼š<ul>
<li>source ï¼šæ–‡æ¡£çš„æ¥æºï¼Œæ¯”å¦‚æ–‡ä»¶åã€URLç­‰ã€‚</li>
<li>page ï¼šå¦‚æœæ–‡æ¡£æ¥è‡ªå¤šé¡µæ–‡ä»¶ï¼ˆå¦‚PDFï¼‰ï¼Œè¿™é‡Œå¯ä»¥å­˜å‚¨é¡µç ã€‚</li>
<li>å…¶ä»–è‡ªå®šä¹‰ä¿¡æ¯ï¼šæ‚¨å¯ä»¥æ·»åŠ ä»»ä½•æœ‰åŠ©äºæ‚¨åº”ç”¨çš„ä¿¡æ¯ï¼Œå¦‚ä½œè€…ã€åˆ›å»ºæ—¥æœŸç­‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>é™¤äº†é€šè¿‡æ–‡æ¡£åŠ è½½å™¨ï¼ˆLoadersï¼‰è‡ªåŠ¨åˆ›å»ºï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª Document å¯¹è±¡ã€‚è¿™åœ¨æµ‹è¯•æˆ–å¤„ç†ç®€å•æ–‡æœ¬æ—¶éå¸¸æ–¹ä¾¿ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªç®€å•çš„ Document å¯¹è±¡</span><br><span class="line">doc = Document(</span><br><span class="line">    page_content=&quot;è¿™æ˜¯æ–‡æ¡£çš„ä¸»è¦å†…å®¹ã€‚LangChain çœŸé…·ï¼&quot;,</span><br><span class="line">    metadata=&#123;</span><br><span class="line">        &#x27;source&#x27;: &#x27;my_notebook.ipynb&#x27;,</span><br><span class="line">        &#x27;author&#x27;: &#x27;AI Assistant&#x27;,</span><br><span class="line">        &#x27;chapter&#x27;: 2</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="Runnableåè®®"><a href="#Runnableåè®®" class="headerlink" title="Runnableåè®®"></a>Runnableåè®®</h4><p><a target="_blank" rel="noopener" href="https://python.langchain.com/api_reference/core/runnables/langchain_core.runnables.base.Runnable.html#langchain_core.runnables.base.Runnable">â€œRunnableâ€</a>åè®®</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12TLAzuEni/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">2025æœ€æ–°ç‰ˆï¼langchainå…¥é—¨åˆ°ç²¾é€šå®æˆ˜æ•™ç¨‹ï¼ç»“åˆå®æˆ˜æ¡ˆä¾‹ï¼Œå¹²è´§æ‹‰æ»¡ï¼99%çš„äººä¸çŸ¥é“çš„æš´åˆ©ç©æ³•ï¼Œå­¦å®Œæ•¢è°·æ­Œå·¥ç¨‹å¸ˆå«æ¿ï¼_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://www.langchain.com.cn/docs/introduction/">introduction | LangChainä¸­æ–‡ç½‘</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1XudVYzEcW?spm_id_from=333.788.videopod.episodes&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">è·Ÿç€å®˜ç½‘å­¦langchain2025(version 0.3)_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.langchain.com/langgraph-platform">LangGraph Platform - Docs by LangChain</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">LangGraphå­¦ä¹ â€”â€”å¿«é€Ÿå…¥é—¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-28 09:43:40" itemprop="dateModified" datetime="2025-08-28T09:43:40+08:00">2025-08-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹"><a href="#æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹" class="headerlink" title="æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹"></a>æ„å»ºlanggraphèŠå¤©æœºå™¨äººçš„åŸºæœ¬æµç¨‹</h3><h4 id="åˆ›å»ºä¸€ä¸ª-StateGraph"><a href="#åˆ›å»ºä¸€ä¸ª-StateGraph" class="headerlink" title="åˆ›å»ºä¸€ä¸ª StateGraph"></a>åˆ›å»ºä¸€ä¸ª <code>StateGraph</code></h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>StateGraph</code>ã€‚ä¸€ä¸ª <code>StateGraph</code> å¯¹è±¡å°†æˆ‘ä»¬çš„èŠå¤©æœºå™¨äººç»“æ„å®šä¹‰ä¸ºâ€œçŠ¶æ€æœºâ€ã€‚æˆ‘ä»¬å°†æ·»åŠ  <code>èŠ‚ç‚¹</code> æ¥è¡¨ç¤º LLM å’ŒèŠå¤©æœºå™¨äººå¯ä»¥è°ƒç”¨çš„å‡½æ•°ï¼Œå¹¶æ·»åŠ  <code>è¾¹</code> æ¥æŒ‡å®šæœºå™¨äººåº”å¦‚ä½•åœ¨è¿™äº›å‡½æ•°ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰çŠ¶æ€</span></span><br><span class="line">graph_builder = StateGraph(State)</span><br></pre></td></tr></table></figure>
<p>åœ¨ langgraph ä¸­ï¼ŒçŠ¶æ€ä¼šåœ¨å›¾çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´ä¼ é€’ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹äº§ç”Ÿæ–°çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ›´æ–° State ä¸­çš„ messages å­—æ®µã€‚</p>
<p>æˆ‘ä»¬çš„å›¾ç°åœ¨å¯ä»¥å¤„ç†ä¸¤ä¸ªå…³é”®ä»»åŠ¡</p>
<ol>
<li>æ¯ä¸ª <code>èŠ‚ç‚¹</code> éƒ½å¯ä»¥æ¥æ”¶å½“å‰ <code>çŠ¶æ€</code> ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºçŠ¶æ€çš„æ›´æ–°ã€‚</li>
<li>å¯¹ <code>æ¶ˆæ¯</code> çš„æ›´æ–°å°†è¿½åŠ åˆ°ç°æœ‰åˆ—è¡¨è€Œä¸æ˜¯è¦†ç›–å®ƒï¼Œè¿™å¾—ç›Šäºä¸ <code>Annotated</code> è¯­æ³•ä¸€èµ·ä½¿ç”¨çš„é¢„æ„å»º <a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/reference/graphs/?h=add+messages#add_messages"><code>add_messages</code></a> å‡½æ•°ã€‚</li>
</ol>
<blockquote>
<p>langgraphä¸­æ¯ä¸ªæ¶ˆæ¯å¯¹è±¡é€šå¸¸åŒ…å«ä»¥ä¸‹å…³é”®å±æ€§ï¼š</p>
<ul>
<li>role : ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ‡è¯†æ¶ˆæ¯çš„å‘é€è€…ï¼ˆä¾‹å¦‚ â€˜humanâ€™ , â€˜aiâ€™ , â€˜systemâ€™ ï¼‰ã€‚</li>
<li>content : æ¶ˆæ¯çš„å…·ä½“å†…å®¹ï¼Œé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯æ›´å¤æ‚çš„ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œç”¨äºå¤šæ¨¡æ€è¾“å…¥ï¼‰ã€‚</li>
<li>id : ä¸€ä¸ªå¯é€‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li>
</ul>
<p>Annotated çš„ä½œç”¨ : é€šè¿‡ä½¿ç”¨ Annotated[list, add_messages] ï¼Œä½ æ”¹å˜äº†è¿™ä¸ªé»˜è®¤è¡Œä¸ºã€‚ add_messages å‡½æ•°ï¼ˆç”± langgraph æä¾›æˆ–ç”±ä½ è‡ªå®šä¹‰ï¼‰çš„é€»è¾‘æ˜¯ è¿½åŠ  è€Œä¸æ˜¯è¦†ç›–ã€‚æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªæ–°èŠ‚ç‚¹è¿”å›æ¶ˆæ¯æ—¶ï¼Œ langgraph ä¼šè°ƒç”¨ add_messages å‡½æ•°ï¼Œå°†æ–°æ¶ˆæ¯ è¿½åŠ  åˆ°ç°æœ‰ messages åˆ—è¡¨çš„æœ«å°¾ã€‚</p>
</blockquote>
<h4 id="å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹"><a href="#å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹" class="headerlink" title="å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹"></a>å®šä¹‰ä¸€ä¸ªèŠå¤©æ¨¡å‹</h4><p>ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>1.ä½¿ç”¨ <code>init_chat_model</code>(é€šç”¨é«˜å±‚å°è£…)<br>è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„è¾…åŠ©å‡½æ•°ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥åˆå§‹åŒ–æ¥è‡ª ä¸åŒæä¾›å•† çš„èŠå¤©æ¨¡å‹ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://python.langchain.com/api_reference/langchain/chat_models/langchain.chat_models.base.init_chat_model.html">init_chat_model â€” ğŸ¦œğŸ”— LangChain æ–‡æ¡£ â€”- init_chat_model â€” ğŸ¦œğŸ”— LangChain documentation</a></p>
<p>2.ä½¿ç”¨å¦‚ChatOpenAI (ç‰¹å®šäºæä¾›å•†çš„ç±»)<br>è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸º OpenAI API è®¾è®¡çš„ç±»ï¼Œæä¾›äº†å¯¹ OpenAI æ¨¡å‹æ‰€æœ‰åŠŸèƒ½çš„å®Œå…¨è®¿é—®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain.chat_models import init_chat_model</span><br><span class="line"></span><br><span class="line">os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;sk-&quot;</span><br><span class="line">#ä½¿ç”¨â€˜&#123;model_provider&#125;:&#123;model&#125;â€™æ ¼å¼åœ¨å•ä¸ªå‚æ•°ä¸­æŒ‡å®šæ¨¡å‹å’Œæ¨¡å‹æä¾›è€…ï¼Œä¾‹å¦‚â€œopenai:o1â€</span><br><span class="line">llm = init_chat_model(&quot;openai:qwen-plus-2025-04-28&quot;,</span><br><span class="line">                      base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">                      )</span><br></pre></td></tr></table></figure>
<h4 id="æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹"><a href="#æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹"></a>æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹</h4><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†èŠå¤©æ¨¡å‹é›†æˆåˆ°ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#å®šä¹‰èŠ‚ç‚¹chatbot</span><br><span class="line">def chatbot(state: State):</span><br><span class="line">    return &#123;&quot;messages&quot;: [llm.invoke(state[&quot;messages&quot;])]&#125;</span><br><span class="line"></span><br><span class="line">graph_builder.add_node(&quot;chatbot&quot;, chatbot)</span><br></pre></td></tr></table></figure>
<p> <code>chatbot</code> èŠ‚ç‚¹å‡½æ•°å¦‚ä½•å°†å½“å‰ <code>çŠ¶æ€</code> ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«æ›´æ–°çš„ <code>æ¶ˆæ¯</code> åˆ—è¡¨çš„å­—å…¸ï¼Œé”®ä¸ºâ€œmessagesâ€ã€‚è¿™æ˜¯æ‰€æœ‰ LangGraph èŠ‚ç‚¹å‡½æ•°çš„åŸºæœ¬æ¨¡å¼ã€‚</p>
<p>æˆ‘ä»¬ <code>çŠ¶æ€</code> ä¸­çš„ <code>add_messages</code> å‡½æ•°ä¼šå°† LLM çš„å“åº”æ¶ˆæ¯è¿½åŠ åˆ°çŠ¶æ€ä¸­å·²æœ‰çš„æ¶ˆæ¯ä¹‹åã€‚</p>
<h4 id="æ·»åŠ ä¸€ä¸ª-å…¥å£-ç‚¹"><a href="#æ·»åŠ ä¸€ä¸ª-å…¥å£-ç‚¹" class="headerlink" title="æ·»åŠ ä¸€ä¸ª å…¥å£ ç‚¹"></a>æ·»åŠ ä¸€ä¸ª <code>å…¥å£</code> ç‚¹</h4><p>æ·»åŠ ä¸€ä¸ª <code>å…¥å£</code> ç‚¹ï¼Œä»¥å‘Šè¯‰å›¾æ¯æ¬¡è¿è¡Œæ—¶<strong>ä»ä½•å¤„å¼€å§‹å·¥ä½œ</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph_builder.add_edge(START, &quot;chatbot&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="ç¼–è¯‘å›¾"><a href="#ç¼–è¯‘å›¾" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><p>åœ¨è¿è¡Œå›¾ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å›¾æ„å»ºå™¨ä¸Šè°ƒç”¨ <code>compile()</code> æ¥å®Œæˆã€‚è¿™å°†åˆ›å»ºä¸€ä¸ª <code>CompiledGraph</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„çŠ¶æ€ä¸Šè°ƒç”¨å®ƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.compile()</span><br></pre></td></tr></table></figure>
<h4 id="å¯è§†åŒ–å›¾"><a href="#å¯è§†åŒ–å›¾" class="headerlink" title="å¯è§†åŒ–å›¾"></a>å¯è§†åŒ–å›¾</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>get_graph</code> æ–¹æ³•å’Œå…¶ä¸­ä¸€ä¸ªâ€œç»˜å›¾â€æ–¹æ³•ï¼ˆä¾‹å¦‚ <code>draw_ascii</code> æˆ– <code>draw_png</code>ï¼‰æ¥å¯è§†åŒ–å›¾ã€‚è¿™äº› <code>draw</code> æ–¹æ³•éƒ½éœ€è¦é¢å¤–çš„ä¾èµ–é¡¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from IPython.display import Image, display</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    display(Image(graph.get_graph().draw_mermaid_png()))</span><br><span class="line">except Exception:</span><br><span class="line">    # This requires some extra dependencies and is optional</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<h4 id="è¿è¡ŒèŠå¤©æœºå™¨äºº"><a href="#è¿è¡ŒèŠå¤©æœºå™¨äºº" class="headerlink" title="è¿è¡ŒèŠå¤©æœºå™¨äºº"></a>è¿è¡ŒèŠå¤©æœºå™¨äºº</h4><p>è¿è¡ŒèŠå¤©æœºå™¨äºº</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">stream_graph_updates</span>(<span class="params">user_input: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">for</span> event <span class="keyword">in</span> graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_input&#125;]&#125;):</span><br><span class="line">        <span class="built_in">print</span>(event)</span><br><span class="line">        <span class="comment">#stream è¿”å›çš„æ¯ä¸ª event é€šå¸¸æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®æ˜¯å›¾ä¸­èŠ‚ç‚¹çš„åç§°ï¼Œå€¼æ˜¯è¯¥èŠ‚ç‚¹å®Œæˆåçš„çŠ¶æ€æ›´æ–°ã€‚</span></span><br><span class="line">        <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">            <span class="comment">#æ¶ˆæ¯åˆ—è¡¨ä¸­çš„æœ€åä¸€æ¡æ¶ˆæ¯çš„æ–‡æœ¬å†…å®¹</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Assistant:&quot;</span>, value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        user_input = <span class="built_in">input</span>(<span class="string">&quot;User: &quot;</span>)</span><br><span class="line">        <span class="comment">#é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> user_input.lower() <span class="keyword">in</span> [<span class="string">&quot;quit&quot;</span>, <span class="string">&quot;exit&quot;</span>, <span class="string">&quot;q&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#è°ƒç”¨</span></span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># fallback if input() is not available</span></span><br><span class="line">        user_input = <span class="string">&quot;What do you know about LangGraph?&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;User: &quot;</span> + user_input)</span><br><span class="line">        stream_graph_updates(user_input)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>graph.stream() æ˜¯ LangGraph çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒä¼šæ‰§è¡Œæ•´ä¸ªå›¾ï¼ˆGraphï¼‰ï¼Œä½†ä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›æœ€ç»ˆç»“æœï¼Œè€Œæ˜¯åƒè§†é¢‘æµä¸€æ ·ï¼Œä¸€æ­¥ä¸€æ­¥åœ°è¿”å›ä¸­é—´è¿‡ç¨‹çš„æ›´æ–°ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥å®æ—¶çœ‹åˆ°æ¨¡å‹ç”Ÿæˆå†…å®¹çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ã€‚</p>
</blockquote>
<h3 id="æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·"><a href="#æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·" class="headerlink" title="æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·"></a>æ·»åŠ ç½‘é¡µæœç´¢å·¥å…·</h3><h4 id="è·å–Tavily-api"><a href="#è·å–Tavily-api" class="headerlink" title="è·å–Tavily api"></a>è·å–Tavily api</h4><p><a target="_blank" rel="noopener" href="https://tavily.com/">Tavily çš„æœç´¢ API</a> æ˜¯ä¸€æ¬¾ä¸“ä¸º AI ä»£ç† (LLM) æ„å»ºçš„æœç´¢å¼•æ“ï¼Œèƒ½å¤Ÿå¿«é€Ÿæä¾›å®æ—¶ã€å‡†ç¡®å’ŒåŸºäºäº‹å®çš„ç»“æœã€‚</p>
<p>æ¯æœˆ 1,000 æ¬¡å…è´¹æœç´¢</p>
<p><a target="_blank" rel="noopener" href="https://python.langchain.ac.cn/docs/integrations/tools/tavily_search/">Tavily Search | ğŸ¦œï¸ğŸ”— LangChain æ¡†æ¶</a></p>
<p>è·å–api<a target="_blank" rel="noopener" href="https://app.tavily.com/home">Tavily AI â€”- Tavily AI</a></p>
<h4 id="æ·»åŠ å·¥å…·"><a href="#æ·»åŠ å·¥å…·" class="headerlink" title="æ·»åŠ å·¥å…·"></a>æ·»åŠ å·¥å…·</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from langchain_tavily import TavilySearch</span><br><span class="line"></span><br><span class="line">tool = TavilySearch(</span><br><span class="line">    tavily_api_key=&quot;tvly-dev-&quot;,</span><br><span class="line">    max_results=2)</span><br><span class="line">tools = [tool]</span><br><span class="line">tool.invoke(&quot;æè¶…æ˜¯è°?&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰å›¾"><a href="#å®šä¹‰å›¾" class="headerlink" title="å®šä¹‰å›¾"></a>å®šä¹‰å›¾</h4><p>åœ¨LLMä¸Šæ·»åŠ <code>bind_tools</code>ã€‚è¿™è®©LLMçŸ¥é“å¦‚æœå®ƒæƒ³ä½¿ç”¨æœç´¢å¼•æ“ï¼Œåº”ä½¿ç”¨æ­£ç¡®çš„JSONæ ¼å¼ã€‚</p>
<p>å®šä¹‰èŠå¤©æ¨¡å‹llmï¼ˆä»£ç åŒä¸Šï¼‰</p>
<p>å°†toolsæ•´åˆåˆ°<code>StateGraph</code>ä¸­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> TypedDict</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, START, END</span><br><span class="line"><span class="keyword">from</span> langgraph.graph.message <span class="keyword">import</span> add_messages</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line">graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†ä¸€ä¸ªæˆ–å¤šä¸ª**å·¥å…·ï¼ˆtoolsï¼‰ ç»‘å®šåˆ°ä¸€ä¸ª å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰**ä¸Šï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„ã€å…·å¤‡å·¥å…·è°ƒç”¨èƒ½åŠ›çš„ LLM å®ä¾‹</span></span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm_with_tools.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line">graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°"><a href="#åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°" class="headerlink" title="åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°"></a>åˆ›å»ºä¸€ä¸ªè¿è¡Œå·¥å…·çš„å‡½æ•°</h4><p>ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥è¿è¡Œè¢«è°ƒç”¨çš„å·¥å…·ã€‚é€šè¿‡å°†å·¥å…·æ·»åŠ åˆ°ä¸€ä¸ªåä¸º<code>BasicToolNode</code>çš„æ–°èŠ‚ç‚¹æ¥å®Œæˆï¼Œè¯¥èŠ‚ç‚¹æ£€æŸ¥çŠ¶æ€ä¸­çš„æœ€æ–°æ¶ˆæ¯ï¼Œå¦‚æœæ¶ˆæ¯åŒ…å«<code>tool_calls</code>ï¼Œåˆ™è°ƒç”¨å·¥å…·ã€‚å®ƒä¾èµ–äºLLMçš„<code>tool_calling</code>æ”¯æŒï¼Œè¯¥æ”¯æŒåœ¨Anthropicã€OpenAIã€Google Geminiä»¥åŠè®¸å¤šå…¶ä»–LLMæä¾›å•†ä¸­å¯ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ __call__ æ–¹æ³•ï¼Œè®©è¿™ä¸ªç±»çš„å®ä¾‹å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨</span></span><br><span class="line"><span class="comment"># inputs æ˜¯ langgraph ä¼ è¿›æ¥çš„å½“å‰çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªå­—å…¸</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, inputs: <span class="built_in">dict</span></span>):</span><br><span class="line">    <span class="comment"># 1. ä»çŠ¶æ€ä¸­è·å–æœ€æ–°çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨äº†â€œæµ·è±¡æ“ä½œç¬¦â€ :=ï¼Œå…ˆä» inputs ä¸­è·å– &#x27;messages&#x27; åˆ—è¡¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›ç©ºåˆ—è¡¨ []</span></span><br><span class="line">    <span class="comment"># ç„¶åæ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å–å‡ºæœ€åä¸€æ¡æ¶ˆæ¯ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> messages := inputs.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">        message = messages[-<span class="number">1</span>]  <span class="comment"># é€šå¸¸ï¼Œæœ€åä¸€æ¡æ¶ˆæ¯æ˜¯ AI å‘å‡ºçš„ï¼Œå…¶ä¸­åŒ…å«å·¥å…·è°ƒç”¨è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># å¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œå°±æŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸ªèŠ‚ç‚¹ä¸çŸ¥é“è¯¥åšä»€ä¹ˆ</span></span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;No message found in input&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. å‡†å¤‡ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨æ¥å­˜æ”¾æ‰€æœ‰å·¥å…·çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">    outputs = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. éå† AI æ¶ˆæ¯ä¸­è¯·æ±‚çš„æ‰€æœ‰å·¥å…·è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">for</span> tool_call <span class="keyword">in</span> message.tool_calls:</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. æ‰§è¡Œå·¥å…·</span></span><br><span class="line">        <span class="comment"># a. tool_call[&quot;name&quot;] è·å–å·¥å…·åç§° (ä¾‹å¦‚ &#x27;tavily_search_results_json&#x27;)</span></span><br><span class="line">        <span class="comment"># b. self.tools_by_name[...] ä»é¢„å­˜çš„å·¥å…·å­—å…¸ä¸­æ‰¾åˆ°å¯¹åº”çš„å·¥å…·å¯¹è±¡</span></span><br><span class="line">        <span class="comment"># c. .invoke(tool_call[&quot;args&quot;]) ä½¿ç”¨ LLM æä¾›çš„å‚æ•°æ¥è°ƒç”¨è¯¥å·¥å…·</span></span><br><span class="line">        tool_result = <span class="variable language_">self</span>.tools_by_name[tool_call[<span class="string">&quot;name&quot;</span>]].invoke(</span><br><span class="line">            tool_call[<span class="string">&quot;args&quot;</span>]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 5. å°†å·¥å…·æ‰§è¡Œç»“æœæ‰“åŒ…æˆ ToolMessage</span></span><br><span class="line">        <span class="comment"># è¿™æ˜¯ langgraph/langchain çš„æ ‡å‡†æ ¼å¼ï¼Œç”¨äºå‘Šè¯‰ LLM å·¥å…·æ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆ</span></span><br><span class="line">        outputs.append(</span><br><span class="line">            ToolMessage(</span><br><span class="line">                content=json.dumps(tool_result),  <span class="comment"># å·¥å…·ç»“æœå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ç”¨ json.dumps åºåˆ—åŒ–</span></span><br><span class="line">                name=tool_call[<span class="string">&quot;name&quot;</span>],  <span class="comment"># å‘Šè¯‰ LLM è¿™æ˜¯å“ªä¸ªå·¥å…·çš„ç»“æœ</span></span><br><span class="line">                tool_call_id=tool_call[<span class="string">&quot;id&quot;</span>],  <span class="comment"># å¿…é¡»æä¾›åŸå§‹è¯·æ±‚çš„ IDï¼Œä»¥ä¾¿ LLM çŸ¥é“è¿™ä¸ªç»“æœå¯¹åº”å“ªä¸ªè¯·æ±‚</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. è¿”å›ç»“æœï¼Œæ›´æ–°å›¾çš„çŠ¶æ€</span></span><br><span class="line">    <span class="comment"># è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­ &#x27;messages&#x27; é”®å¯¹åº”ç€åŒ…å«æ‰€æœ‰ ToolMessage çš„åˆ—è¡¨</span></span><br><span class="line">    <span class="comment"># langgraph ä¼šå°†è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ¶ˆæ¯è¿½åŠ åˆ°ä¸»çŠ¶æ€çš„ &#x27;messages&#x27; åˆ—è¡¨ä¸­</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: outputs&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>call</strong> æ˜¯ Python ä¸­ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„â€œé­”æœ¯æ–¹æ³•â€ï¼ˆmagic methodï¼‰ã€‚å®ƒçš„ä½œç”¨æ˜¯ è®©ä¸€ä¸ªç±»çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰èƒ½å¤Ÿåƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ ã€‚</p>
<p>è¿™åœ¨ langgraph ä¸­æ˜¯ä¸€ç§å¸¸è§ä¸”æ ¸å¿ƒçš„è®¾è®¡æ¨¡å¼ã€‚å®ƒçš„å«ä¹‰æ˜¯ï¼š</p>
<ol>
<li>èŠ‚ç‚¹å³å‡½æ•° ï¼š BasicToolNode çš„å®ä¾‹ï¼ˆæ¯”å¦‚ tool_node ï¼‰æœ¬èº«å°±ä»£è¡¨äº†å›¾ä¸­çš„ä¸€ä¸ªå¯æ‰§è¡ŒèŠ‚ç‚¹ã€‚</li>
<li>æ‰§è¡Œé€»è¾‘ ï¼šå½“ langgraph çš„çŠ¶æ€æœºè¿è¡Œåˆ°è¿™ä¸ª tool_node èŠ‚ç‚¹æ—¶ï¼Œå®ƒä¼šç›´æ¥â€œè°ƒç”¨â€è¿™ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œå¹¶æŠŠå½“å‰çš„çŠ¶æ€ï¼ˆ inputs å­—å…¸ï¼‰ä¼ é€’ç»™å®ƒ</li>
</ol>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨LangGraphé¢„æ„å»ºçš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/reference/agents/#langgraph.prebuilt.tool_node.ToolNode">ToolNode</a>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> ToolNode</span><br><span class="line"></span><br><span class="line">tool_node = ToolNode(tools=[tool])</span><br><span class="line">graph_builder.add_node(<span class="string">&quot;tools&quot;</span>, tool_node)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰conditional-edges"><a href="#å®šä¹‰conditional-edges" class="headerlink" title="å®šä¹‰conditional_edges"></a>å®šä¹‰<code>conditional_edges</code></h4><p>æ·»åŠ äº†å·¥å…·èŠ‚ç‚¹åï¼Œç°åœ¨æ‚¨å¯ä»¥å®šä¹‰<code>conditional_edges</code>ã€‚</p>
<p><strong>è¾¹ï¼ˆEdgesï¼‰</strong>å°†æ§åˆ¶æµä»ä¸€ä¸ªèŠ‚ç‚¹è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚<strong>æ¡ä»¶è¾¹ï¼ˆConditional edgesï¼‰</strong>ä»å•ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œé€šå¸¸åŒ…å«â€œifâ€è¯­å¥ï¼Œæ ¹æ®å½“å‰å›¾çŠ¶æ€è·¯ç”±åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚è¿™äº›å‡½æ•°æ¥æ”¶å½“å‰çš„å›¾<code>state</code>å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‡ç¤ºæ¥ä¸‹æ¥è¦è°ƒç”¨å“ªä¸ªï¼ˆæˆ–å“ªäº›ï¼‰èŠ‚ç‚¹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º<code>route_tools</code>çš„è·¯ç”±å‡½æ•°ï¼Œå®ƒæ£€æŸ¥èŠå¤©æœºå™¨äººè¾“å‡ºä¸­çš„<code>tool_calls</code>ã€‚é€šè¿‡è°ƒç”¨<code>add_conditional_edges</code>å°†æ­¤å‡½æ•°æä¾›ç»™å›¾ï¼Œè¿™ä¼šå‘Šè¯‰å›¾ï¼Œæ— è®ºä½•æ—¶<code>chatbot</code>èŠ‚ç‚¹å®Œæˆï¼Œéƒ½è¦æ£€æŸ¥æ­¤å‡½æ•°ä»¥ç¡®å®šä¸‹ä¸€æ­¥å»å“ªé‡Œã€‚</p>
<p>å¦‚æœå­˜åœ¨å·¥å…·è°ƒç”¨ï¼Œæ¡ä»¶å°†è·¯ç”±åˆ°<code>tools</code>ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è·¯ç”±åˆ°<code>END</code>ã€‚ç”±äºæ¡ä»¶å¯ä»¥è¿”å›<code>END</code>ï¼Œå› æ­¤è¿™æ¬¡æ‚¨ä¸éœ€è¦æ˜ç¡®è®¾ç½®<code>finish_point</code>ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">route_tools</span>(<span class="params"></span></span><br><span class="line"><span class="params">     state: State,</span></span><br><span class="line"><span class="params"> </span>):</span><br><span class="line">     <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">     ç”¨äº conditional_edge çš„è·¯ç”±å‡½æ•°ï¼š</span></span><br><span class="line"><span class="string">     - å¦‚æœæœ€åä¸€æ¡æ¶ˆæ¯åŒ…å«å·¥å…·è°ƒç”¨ï¼Œåˆ™è·¯ç”±åˆ° ToolNode</span></span><br><span class="line"><span class="string">     - å¦åˆ™è·¯ç”±åˆ°ç»“æŸèŠ‚ç‚¹</span></span><br><span class="line"><span class="string">     &quot;&quot;&quot;</span></span><br><span class="line">     <span class="comment"># å¤„ç† state ä¸ºåˆ—è¡¨çš„æƒ…å†µï¼ˆå¯èƒ½æ˜¯æ¶ˆæ¯åˆ—è¡¨ï¼‰</span></span><br><span class="line">     <span class="keyword">if</span> <span class="built_in">isinstance</span>(state, <span class="built_in">list</span>):</span><br><span class="line">         ai_message = state[-<span class="number">1</span>]  <span class="comment"># è·å–æœ€åä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">     <span class="comment"># å¤„ç† state ä¸ºå­—å…¸çš„æƒ…å†µï¼ˆåŒ…å« messages å­—æ®µï¼‰</span></span><br><span class="line">     <span class="keyword">elif</span> messages := state.get(<span class="string">&quot;messages&quot;</span>, []):</span><br><span class="line">         ai_message = messages[-<span class="number">1</span>]  <span class="comment"># è·å–æœ€åä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         <span class="keyword">raise</span> ValueError(<span class="string">f&quot;è¾“å…¥çŠ¶æ€ä¸­æ²¡æœ‰æ‰¾åˆ°æ¶ˆæ¯: <span class="subst">&#123;state&#125;</span>&quot;</span>)</span><br><span class="line">     </span><br><span class="line">     <span class="comment"># æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦æœ‰å·¥å…·è°ƒç”¨</span></span><br><span class="line">     <span class="keyword">if</span> <span class="built_in">hasattr</span>(ai_message, <span class="string">&quot;tool_calls&quot;</span>) <span class="keyword">and</span> <span class="built_in">len</span>(ai_message.tool_calls) &gt; <span class="number">0</span>:</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;tools&quot;</span>  <span class="comment"># æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å› &quot;tools&quot; è·¯ç”±åˆ°å·¥å…·èŠ‚ç‚¹</span></span><br><span class="line">     <span class="keyword">return</span> END  <span class="comment"># æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å› END ç»“æŸæµç¨‹</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨é¢„æ„å»ºçš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/reference/prebuilt/#tools_condition">tools_condition</a>ä»£æ›¿route_toolsä»¥ä½¿å…¶æ›´ç®€æ´ã€‚</p>
<blockquote>
<p><code>tools_condition</code> å‡½æ•°åœ¨èŠå¤©æœºå™¨äººéœ€è¦ä½¿ç”¨å·¥å…·æ—¶è¿”å› â€œtoolsâ€ï¼Œå¦‚æœå¯ä»¥ä¸ä½¿ç”¨å“åº”åˆ™è¿”å› â€œENDâ€ã€‚</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.prebuilt <span class="keyword">import</span> tools_condition</span><br><span class="line">graph_builder.add_conditional_edges(</span><br><span class="line">    <span class="string">&quot;chatbot&quot;</span>,</span><br><span class="line">    tools_condition,</span><br><span class="line">    &#123;<span class="string">&quot;tools&quot;</span>: <span class="string">&quot;tools&quot;</span>, END: END&#125;,</span><br><span class="line">)</span><br><span class="line">graph_builder.add_edge(<span class="string">&quot;tools&quot;</span>, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">graph = graph_builder.<span class="built_in">compile</span>()</span><br></pre></td></tr></table></figure>
<h4 id="å¯è§†åŒ–å›¾-1"><a href="#å¯è§†åŒ–å›¾-1" class="headerlink" title="å¯è§†åŒ–å›¾"></a>å¯è§†åŒ–å›¾</h4><p>å¦‚ä¸Š</p>
<h4 id="å‘æœºå™¨äººæé—®"><a href="#å‘æœºå™¨äººæé—®" class="headerlink" title="å‘æœºå™¨äººæé—®"></a>å‘æœºå™¨äººæé—®</h4><p>ç°åœ¨æ‚¨å¯ä»¥å‘èŠå¤©æœºå™¨äººæå‡ºè¶…å‡ºå…¶è®­ç»ƒæ•°æ®èŒƒå›´çš„é—®é¢˜ã€‚</p>
<p>å¦‚ä¸Š</p>
<h3 id="æ·»åŠ è®°å¿†åŠŸèƒ½"><a href="#æ·»åŠ è®°å¿†åŠŸèƒ½" class="headerlink" title="æ·»åŠ è®°å¿†åŠŸèƒ½"></a>æ·»åŠ è®°å¿†åŠŸèƒ½</h3><p>LangGraph é€šè¿‡<strong>æŒä¹…æ€§æ£€æŸ¥ç‚¹</strong>è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæ‚¨åœ¨ç¼–è¯‘å›¾æ—¶æä¾›ä¸€ä¸ª<code>checkpointer</code>ï¼Œå¹¶åœ¨è°ƒç”¨å›¾æ—¶æä¾›ä¸€ä¸ª<code>thread_id</code>ï¼ŒLangGraph ä¼šåœ¨æ¯ä¸€æ­¥ä¹‹åè‡ªåŠ¨ä¿å­˜çŠ¶æ€ã€‚å½“æ‚¨ä½¿ç”¨ç›¸åŒçš„<code>thread_id</code>å†æ¬¡è°ƒç”¨å›¾æ—¶ï¼Œå›¾ä¼šåŠ è½½å…¶ä¿å­˜çš„çŠ¶æ€ï¼Œå…è®¸èŠå¤©æœºå™¨äººä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­ã€‚</p>
<p>æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ï¼Œ<strong>æ£€æŸ¥ç‚¹</strong>æ¯”ç®€å•çš„èŠå¤©è®°å¿†åŠŸèƒ½<em>å¼ºå¤§å¾—å¤š</em>â€”â€”å®ƒå…è®¸æ‚¨éšæ—¶ä¿å­˜å’Œæ¢å¤å¤æ‚çŠ¶æ€ï¼Œç”¨äºé”™è¯¯æ¢å¤ã€äººå·¥å¹²é¢„å·¥ä½œæµã€æ—¶é—´æ—…è¡Œäº¤äº’ç­‰ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ æ£€æŸ¥ç‚¹ä»¥å®ç°å¤šè½®å¯¹è¯ã€‚</p>
<h4 id="åˆ›å»º-MemorySaver-æ£€æŸ¥ç‚¹"><a href="#åˆ›å»º-MemorySaver-æ£€æŸ¥ç‚¹" class="headerlink" title="åˆ›å»º MemorySaver æ£€æŸ¥ç‚¹"></a>åˆ›å»º <code>MemorySaver</code> æ£€æŸ¥ç‚¹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.checkpoint.memory <span class="keyword">import</span> MemorySaver</span><br><span class="line"></span><br><span class="line">memory = MemorySaver()</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªå†…å­˜ä¸­çš„æ£€æŸ¥ç‚¹ï¼Œæ–¹ä¾¿æœ¬æ•™ç¨‹ä½¿ç”¨ã€‚ç„¶è€Œï¼Œåœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯èƒ½ä¼šå°†å…¶æ›´æ”¹ä¸ºä½¿ç”¨ <code>SqliteSaver</code> æˆ– <code>PostgresSaver</code> å¹¶è¿æ¥æ•°æ®åº“ã€‚</p>
<h4 id="ç¼–è¯‘å›¾-1"><a href="#ç¼–è¯‘å›¾-1" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><p>ä½¿ç”¨æä¾›çš„æ£€æŸ¥ç‚¹ç¼–è¯‘å›¾ï¼Œå›¾åœ¨éå†æ¯ä¸ªèŠ‚ç‚¹æ—¶å°†å¯¹ <code>State</code> è¿›è¡Œæ£€æŸ¥ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">graph = graph_builder.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<h4 id="ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨"><a href="#ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨" class="headerlink" title="ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨"></a>ä¸æ‚¨çš„èŠå¤©æœºå™¨äººäº’åŠ¨</h4><ol>
<li><p>é€‰æ‹©ä¸€ä¸ªçº¿ç¨‹ä½œä¸ºæ­¤å¯¹è¯çš„é”®ã€‚</p>
<p>thread_idå†³å®šå¯¹è¯çª—å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨æ‚¨çš„èŠå¤©æœºå™¨äºº</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">user_input = &quot;æˆ‘æ˜¯è°&quot;</span><br><span class="line"></span><br><span class="line"># The config is the **second positional argument** to stream() or invoke()!</span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input&#125;]&#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=&quot;values&quot;,</span><br><span class="line">)</span><br><span class="line">for event in events:</span><br><span class="line">    event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="æ·»åŠ äººå·¥å¹²é¢„"><a href="#æ·»åŠ äººå·¥å¹²é¢„" class="headerlink" title="æ·»åŠ äººå·¥å¹²é¢„"></a>æ·»åŠ äººå·¥å¹²é¢„</h3><p>ä»£ç†å¯èƒ½ä¸å¯é ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦äººå·¥è¾“å…¥æ‰èƒ½æˆåŠŸå®Œæˆä»»åŠ¡ã€‚åŒæ ·ï¼Œå¯¹äºæŸäº›æ“ä½œï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨è¿è¡Œå‰è¦æ±‚äººå·¥æ‰¹å‡†ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡æŒ‰é¢„æœŸè¿è¡Œã€‚</p>
<p>LangGraph çš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/persistence/">æŒä¹…åŒ–</a>å±‚æ”¯æŒ<strong>äººå·¥å¹²é¢„</strong>å·¥ä½œæµï¼Œå…è®¸æ ¹æ®ç”¨æˆ·åé¦ˆæš‚åœå’Œæ¢å¤æ‰§è¡Œã€‚æ­¤åŠŸèƒ½çš„ä¸»è¦æ¥å£æ˜¯<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/how-tos/human_in_the_loop/add-human-in-the-loop/"><code>interrupt</code></a>å‡½æ•°ã€‚åœ¨èŠ‚ç‚¹å†…è°ƒç”¨<code>interrupt</code>å°†æš‚åœæ‰§è¡Œã€‚é€šè¿‡ä¼ å…¥<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/low_level/#command">Command</a>ï¼Œå¯ä»¥æ¢å¤æ‰§è¡Œå¹¶æ¥æ”¶æ¥è‡ªäººå·¥çš„æ–°è¾“å…¥ã€‚<code>interrupt</code>åœ¨åŠŸèƒ½ä¸Šç±»ä¼¼äº Python çš„å†…ç½®<code>input()</code>ï¼Œ<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/how-tos/human_in_the_loop/add-human-in-the-loop/">ä½†æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹</a>ã€‚</p>
<h4 id="æ·»åŠ human-assistanceå·¥å…·"><a href="#æ·»åŠ human-assistanceå·¥å…·" class="headerlink" title="æ·»åŠ human_assistanceå·¥å…·"></a>æ·»åŠ <code>human_assistance</code>å·¥å…·</h4><p>å°†<code>human_assistance</code>å·¥å…·æ·»åŠ åˆ°èŠå¤©æœºå™¨äººã€‚æ­¤å·¥å…·ä½¿ç”¨<code>interrupt</code>ä»äººå·¥æ¥æ”¶ä¿¡æ¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># æ·»åŠ äººå·¥å¹²é¢„åŠŸèƒ½</span><br><span class="line"># å¯¼å…¥LangGraphçš„ä¸­æ–­æœºåˆ¶å’Œå‘½ä»¤ç±»å‹</span><br><span class="line">from langgraph.types import Command, interrupt</span><br><span class="line"># å¯¼å…¥LangChainçš„å·¥å…·è£…é¥°å™¨</span><br><span class="line">from langchain_core.tools import tool</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨@toolè£…é¥°å™¨å°†å‡½æ•°æ ‡è®°ä¸ºå¯è¢«LLMè°ƒç”¨çš„å·¥å…·</span><br><span class="line">@tool</span><br><span class="line">def human_assistance(query: str) -&gt; str:</span><br><span class="line">    &quot;&quot;&quot;è¯·æ±‚äººå·¥ååŠ©çš„å·¥å…·å‡½æ•°ã€‚</span><br><span class="line">    å½“LLMé‡åˆ°éœ€è¦äººå·¥åˆ¤æ–­æˆ–å¸®åŠ©çš„æƒ…å†µæ—¶ï¼Œä¼šè°ƒç”¨æ­¤å·¥å…·ã€‚</span><br><span class="line">    è¯¥å‡½æ•°ä¼šæš‚åœå›¾çš„æ‰§è¡Œï¼Œç­‰å¾…äººå·¥æ“ä½œå‘˜æä¾›å“åº”ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # interrupt()å‡½æ•°ä¼šæš‚åœå›¾çš„æ‰§è¡Œï¼Œç­‰å¾…äººå·¥è¾“å…¥</span><br><span class="line">    # ä¼ å…¥çš„å­—å…¸åŒ…å«æŸ¥è¯¢ä¿¡æ¯ï¼Œäººå·¥æ“ä½œå‘˜ä¼šçœ‹åˆ°è¿™ä¸ªæŸ¥è¯¢</span><br><span class="line">    human_response = interrupt(&#123;&quot;query&quot;: query&#125;)</span><br><span class="line">    </span><br><span class="line">    # ä»äººå·¥å“åº”ä¸­æå–æ•°æ®å¹¶è¿”å›ç»™LLM</span><br><span class="line">    # human_responseæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œ&quot;data&quot;å­—æ®µåŒ…å«äººå·¥æä¾›çš„å®é™…å“åº”</span><br><span class="line">    return human_response[&quot;data&quot;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ <strong>è°ƒç”¨å“ªä¸ªå·¥å…·ï¼Œä»¥åŠä½•æ—¶è°ƒç”¨ï¼Œå®Œå…¨æ˜¯ç”±å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ ¹æ®ä½ ç»™å®ƒçš„æŒ‡ä»¤ï¼ˆPromptï¼‰æ¥å†³å®šçš„ã€‚</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tool = TavilySearch(max_results=2)</span><br><span class="line">tools = [tool, human_assistance]</span><br><span class="line">llm_with_tools = llm.bind_tools(tools)</span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰chatbot"><a href="#å®šä¹‰chatbot" class="headerlink" title="å®šä¹‰chatbot"></a>å®šä¹‰chatbot</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def chatbot(state: State):</span><br><span class="line">    # è°ƒç”¨ç»‘å®šäº†å·¥å…·çš„LLMï¼ˆllm_with_toolsï¼‰ï¼Œä¼ å…¥å½“å‰çš„æ¶ˆæ¯å†å²</span><br><span class="line">    # LLMä¼šæ ¹æ®æœ€æ–°çš„æ¶ˆæ¯å†³å®šæ˜¯ç”Ÿæˆæ–‡æœ¬å›å¤ï¼Œè¿˜æ˜¯è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·</span><br><span class="line">    message = llm_with_tools.invoke(state[&quot;messages&quot;])</span><br><span class="line">    </span><br><span class="line">    # --- å…³é”®æ–­è¨€é€»è¾‘ ---</span><br><span class="line">    assert len(message.tool_calls) &lt;= 1</span><br><span class="line">    </span><br><span class="line">    # å°†LLMç”Ÿæˆçš„æ–°æ¶ˆæ¯ï¼ˆå¯èƒ½æ˜¯æ–‡æœ¬å›å¤ï¼Œä¹Ÿå¯èƒ½æ˜¯å·¥å…·è°ƒç”¨è¯·æ±‚ï¼‰è¿”å›</span><br><span class="line">    # è¿™ä¸ªè¿”å›å€¼ä¼šä»¥å­—å…¸çš„å½¢å¼æ›´æ–°åˆ°çŠ¶æ€ï¼ˆStateï¼‰å¯¹è±¡ä¸­</span><br><span class="line">    return &#123;&quot;messages&quot;: [message]&#125;</span><br><span class="line"></span><br><span class="line"># å°† chatbot å‡½æ•°ä½œä¸ºåä¸º &quot;chatbot&quot; çš„èŠ‚ç‚¹æ·»åŠ åˆ°å›¾æ„å»ºå™¨ä¸­</span><br><span class="line">graph_builder.add_node(&quot;chatbot&quot;, chatbot)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸­æ–­å®‰å…¨æ€§çš„æ–­è¨€ ( assert ) : assert len(message.tool_calls) &lt;= 1 æ˜¯åœ¨å®ç°äººå·¥å¹²é¢„æ—¶ä¸€ä¸ªéå¸¸é‡è¦çš„ å®‰å…¨æªæ–½ ã€‚</p>
<ul>
<li>é—®é¢˜ : ç°ä»£ LLM æ”¯æŒå¹¶è¡Œå·¥å…·è°ƒç”¨ï¼ˆä¸€æ¬¡è¯·æ±‚æ‰§è¡Œå¤šä¸ªå·¥å…·ï¼‰ã€‚ä½†å¦‚æœå…¶ä¸­ä¸€ä¸ªå·¥å…·æ˜¯ human_assistance å¹¶è§¦å‘äº†ä¸­æ–­ï¼Œæ•´ä¸ªå›¾ä¼šæš‚åœã€‚å½“äººå·¥æ“ä½œå®Œæˆåï¼Œå›¾ä¼šä»ä¸­æ–­ç‚¹æ¢å¤ã€‚æ­¤æ—¶ï¼Œå¦‚æœä¸å¯¹å·¥å…·è°ƒç”¨æ•°é‡åšé™åˆ¶ï¼ŒLangGraph å¯èƒ½ä¼šé‡æ–°å°è¯•æ‰§è¡Œæ‰€æœ‰åœ¨ä¸­æ–­å‰è¯·æ±‚çš„å·¥å…·ï¼Œå¯¼è‡´å·²ç»æ‰§è¡Œè¿‡çš„å·¥å…·è¢«å†æ¬¡è°ƒç”¨ã€‚</li>
<li>è§£å†³æ–¹æ¡ˆ : è¿™ä¸ªæ–­è¨€å¼ºåˆ¶è¦æ±‚ LLM åœ¨æ¯ä¸€æ­¥æœ€å¤šåªèƒ½è¯·æ±‚è°ƒç”¨ä¸€ä¸ªå·¥å…·ã€‚è¿™æ ·å°±ä¿è¯äº†å½“ä¸­æ–­å‘ç”Ÿå¹¶æ¢å¤åï¼Œä¸ä¼šæœ‰é‡å¤æ‰§è¡Œå·¥å…·çš„é£é™©ï¼Œç¡®ä¿äº†æµç¨‹çš„ç¨³å®šæ€§å’Œå¯é¢„æµ‹æ€§ã€‚</li>
</ul>
</blockquote>
<h4 id="ç¼–è¯‘å›¾-2"><a href="#ç¼–è¯‘å›¾-2" class="headerlink" title="ç¼–è¯‘å›¾"></a>ç¼–è¯‘å›¾</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory = MemorySaver()</span><br><span class="line"></span><br><span class="line">graph = graph_builder.compile(checkpointer=memory)</span><br></pre></td></tr></table></figure>
<h4 id="è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­"><a href="#è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­" class="headerlink" title="è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­"></a>è°ƒç”¨èŠå¤©æœºå™¨äººå¹¶ä¸­æ–­</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user_input = &quot;æˆ‘éœ€è¦ä¸€äº›å…³äºæ„å»º AI ä»£ç†çš„ä¸“å®¶æŒ‡å¯¼ã€‚ä½ èƒ½å¸®æˆ‘è¯·æ±‚ååŠ©å—ï¼Ÿ&quot;</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input&#125;]&#125;,</span><br><span class="line">    config,</span><br><span class="line">    #å®ƒçš„ä½œç”¨æ˜¯æŒ‡å®šåœ¨è¿›è¡Œæµå¼å¤„ç†æ—¶ï¼Œä½ å¸Œæœ›æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯ä»¥ å®Œæ•´çš„ã€ç´¯ç§¯çš„å€¼ çš„å½¢å¼è¿”å›ï¼Œè€Œä¸æ˜¯ä»¥å¢é‡çš„ã€ç‰‡æ®µçš„å½¢å¼è¿”å›ã€‚</span><br><span class="line">    stream_mode=&quot;values&quot;,</span><br><span class="line">)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<p>èŠå¤©æœºå™¨äººç”Ÿæˆäº†ä¸€ä¸ªå·¥å…·è°ƒç”¨ï¼Œä½†éšåæ‰§è¡Œè¢«ä¸­æ–­ã€‚å¦‚æœæ‚¨æ£€æŸ¥å›¾çŠ¶æ€ï¼Œæ‚¨ä¼šçœ‹åˆ°å®ƒåœæ­¢åœ¨å·¥å…·èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line">snapshot.next</span><br></pre></td></tr></table></figure>
<h4 id="æ¢å¤æ‰§è¡Œ"><a href="#æ¢å¤æ‰§è¡Œ" class="headerlink" title="æ¢å¤æ‰§è¡Œ"></a>æ¢å¤æ‰§è¡Œ</h4><p>è¦æ¢å¤æ‰§è¡Œï¼Œè¯·ä¼ å…¥ä¸€ä¸ªåŒ…å«å·¥å…·æ‰€éœ€æ•°æ®çš„<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/low_level/#command"><code>Command</code></a>å¯¹è±¡ã€‚æ­¤æ•°æ®çš„æ ¼å¼å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ã€‚å¯¹äºæœ¬ç¤ºä¾‹ï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰é”®<code>&quot;data&quot;</code>çš„å­—å…¸ï¼ˆç”±human_assistanceå†³å®šï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">human_response = (</span><br><span class="line">&quot;æˆ‘ä»¬ä¸“å®¶åœ¨æ­¤ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼æˆ‘ä»¬å»ºè®®æ‚¨æŸ¥çœ‹ LangGraph æ¥æ„å»ºæ‚¨çš„ä»£ç†ã€‚å®ƒæ¯”ç®€å•çš„è‡ªä¸»ä»£ç†æ›´å¯é ã€æ›´å…·å¯æ‰©å±•æ€§ã€‚&quot;</span><br><span class="line">)   </span><br><span class="line">#ä»æš‚åœçŠ¶æ€æ¢å¤æ‰§è¡Œ</span><br><span class="line">human_command = Command(resume=&#123;&quot;data&quot;: human_response&#125;)</span><br><span class="line"></span><br><span class="line">events = graph.stream(human_command, config, stream_mode=&quot;values&quot;)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.å·¥å…·çš„å®šä¹‰ ( human_assistance function):</p>
<ul>
<li>å½“ LLM è°ƒç”¨ human_assistance å·¥å…·æ—¶ï¼Œè¿™ä¸ªå‡½æ•°è¢«æ‰§è¡Œã€‚</li>
<li>å‡½æ•°å†…éƒ¨ï¼Œ interrupt() è¢«è°ƒç”¨ï¼Œå¯¼è‡´å›¾æš‚åœï¼Œå¹¶ç­‰å¾…äººå·¥è¾“å…¥ã€‚</li>
<li>åœ¨å›¾æ¢å¤åï¼Œ interrupt() å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯æ‚¨é€šè¿‡ Command(resume=â€¦) æ³¨å…¥çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ {â€œdataâ€: human_response} ã€‚</li>
<li>å› æ­¤ï¼Œ human_assistance å‡½æ•°ä¸­çš„ human_response å˜é‡å®é™…ä¸Šå°±ç­‰äº {â€œdataâ€: human_response} ã€‚</li>
<li>æœ€åï¼Œ return human_response[â€œdataâ€] ä»è¿™ä¸ªå­—å…¸ä¸­æå–å‡º â€œdataâ€ é”®å¯¹åº”çš„å€¼ ï¼Œå¹¶å°†å…¶ä½œä¸º human_assistance å·¥å…·çš„æœ€ç»ˆè¿”å›ç»“æœã€‚</li>
</ul>
<p>2.æ¢å¤æŒ‡ä»¤ ( Command(resume=â€¦) ):</p>
<ul>
<li>å½“æ‚¨æ„å»º Command(resume={â€œdataâ€: human_response}) æ—¶ï¼Œæ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªç¬¦åˆ human_assistance å‡½æ•°æœŸæœ›çš„ç»“æ„ã€‚</li>
<li>æ‚¨å°†äººå·¥å›å¤åŒ…è£…åœ¨ä¸€ä¸ªå­—å…¸é‡Œï¼Œå¹¶ä½¿ç”¨ â€œdataâ€ ä½œä¸ºé”®ã€‚</li>
<li>è¿™ä¸ªç»“æ„è¢«ä¼ é€’å› interrupt() ï¼Œç„¶åè¢« human_assistance å‡½æ•°æ¥æ”¶å’Œè§£æã€‚</li>
</ul>
<p>å› ä¸º human_assistance å‡½æ•°çš„ return è¯­å¥æœŸæœ›ä»è¿”å›çš„å­—å…¸ä¸­è®¿é—® â€œdataâ€ é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ¢å¤æ‰§è¡Œæ—¶å¿…é¡»æä¾›ä¸€ä¸ªå…·æœ‰ç›¸åŒç»“æ„çš„å­—å…¸ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ•°æ®èƒ½å¤Ÿæ­£ç¡®åœ°åœ¨ä¸­æ–­å’Œæ¢å¤çš„è¿‡ç¨‹ä¸­ä¼ é€’ã€‚</p>
</blockquote>
<p>åœ¨ LangGraph ä¸­ï¼Œ<code>Command</code> æ˜¯ä¸€ä¸ªç”¨äº<strong>æ§åˆ¶å›¾æ‰§è¡Œæµç¨‹ã€æ›´æ–°çŠ¶æ€ã€å®ç°äººæœºäº¤äº’</strong>çš„æ ¸å¿ƒç±»ã€‚å®ƒæ”¯æŒä»¥ä¸‹å››ä¸ªå‚æ•°ï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">å‚æ•°å</th>
<th style="text-align:left">ç±»å‹</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>update</code></td>
<td style="text-align:left"><code>dict</code></td>
<td style="text-align:left">ç”¨äºæ›´æ–°å›¾çš„çŠ¶æ€ï¼ˆstateï¼‰ã€‚ä¾‹å¦‚ï¼š<code>Command(update=&#123;&quot;foo&quot;: &quot;bar&quot;&#125;)</code>ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>resume</code></td>
<td style="text-align:left"><code>Any</code></td>
<td style="text-align:left">ä¸ <code>interrupt()</code> é…åˆä½¿ç”¨ï¼Œç”¨äºæ¢å¤è¢«ä¸­æ–­çš„å›¾æ‰§è¡Œï¼Œå¹¶ä¼ é€’ç”¨æˆ·è¾“å…¥ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>goto</code></td>
<td style="text-align:left"><code>str</code> æˆ– <code>Send</code> æˆ– `List[str</td>
<td style="text-align:left">Send]`</td>
<td>æ§åˆ¶ä¸‹ä¸€æ­¥è¦æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œæ”¯æŒè·³è½¬åˆ°æŒ‡å®šèŠ‚ç‚¹ã€å¤šä¸ªèŠ‚ç‚¹åºåˆ—ï¼Œæˆ–ä½¿ç”¨ <code>Send</code> å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td style="text-align:left"><code>graph</code></td>
<td style="text-align:left"><code>str</code></td>
<td style="text-align:left">å¯é€‰ï¼ŒæŒ‡å®šå‘½ä»¤ä½œç”¨çš„å›¾ã€‚é»˜è®¤æ˜¯å½“å‰å›¾ï¼Œä¹Ÿå¯ä»¥è®¾ä¸º <code>Command.PARENT</code> è¡¨ç¤ºçˆ¶å›¾ã€‚</td>
</tr>
</tbody>
</table>
</div>
<h3 id="è‡ªå®šä¹‰çŠ¶æ€"><a href="#è‡ªå®šä¹‰çŠ¶æ€" class="headerlink" title="è‡ªå®šä¹‰çŠ¶æ€"></a>è‡ªå®šä¹‰çŠ¶æ€</h3><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å‘çŠ¶æ€æ·»åŠ é¢å¤–å­—æ®µï¼Œä»¥å®šä¹‰å¤æ‚è¡Œä¸ºï¼Œè€Œæ— éœ€ä¾èµ–æ¶ˆæ¯åˆ—è¡¨ã€‚èŠå¤©æœºå™¨äººå°†ä½¿ç”¨å…¶æœç´¢å·¥å…·æŸ¥æ‰¾ç‰¹å®šä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬å‘ç»™äººå·¥è¿›è¡Œå®¡æŸ¥ã€‚</p>
<h4 id="å‘çŠ¶æ€æ·»åŠ é”®"><a href="#å‘çŠ¶æ€æ·»åŠ é”®" class="headerlink" title="å‘çŠ¶æ€æ·»åŠ é”®"></a>å‘çŠ¶æ€æ·»åŠ é”®</h4><p>é€šè¿‡å‘çŠ¶æ€æ·»åŠ  <code>name</code> å’Œ <code>birthday</code> é”®ï¼Œæ›´æ–°èŠå¤©æœºå™¨äººä»¥ç ”ç©¶å®ä½“çš„ç”Ÿæ—¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class State(TypedDict):</span><br><span class="line">    messages: Annotated[list, add_messages]</span><br><span class="line">    name: str</span><br><span class="line">    birthday: str</span><br></pre></td></tr></table></figure>
<p>å°†æ­¤ä¿¡æ¯æ·»åŠ åˆ°çŠ¶æ€ä¸­ï¼Œå¯ä»¥ä½¿å…¶è½»æ¾è¢«å…¶ä»–å›¾èŠ‚ç‚¹ï¼ˆä¾‹å¦‚å­˜å‚¨æˆ–å¤„ç†ä¿¡æ¯çš„ä¸‹æ¸¸èŠ‚ç‚¹ï¼‰ä»¥åŠå›¾çš„æŒä¹…å±‚è®¿é—®ã€‚</p>
<h4 id="åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€"><a href="#åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€" class="headerlink" title="åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€"></a>åœ¨å·¥å…·å†…éƒ¨æ›´æ–°çŠ¶æ€</h4><p>ç°åœ¨ï¼Œåœ¨ <code>human_assistance</code> å·¥å…·å†…éƒ¨å¡«å……çŠ¶æ€é”®ã€‚è¿™å…è®¸äººå·¥åœ¨ä¿¡æ¯å­˜å‚¨åˆ°çŠ¶æ€ä¹‹å‰å¯¹å…¶è¿›è¡Œå®¡æŸ¥ã€‚ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/low_level/#using-inside-tools"><code>Command</code></a> ä»<strong>å·¥å…·å†…éƒ¨</strong>å‘å‡ºçŠ¶æ€æ›´æ–°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"># ä» langchain_core.messages å¯¼å…¥ ToolMessageï¼Œç”¨äºåˆ›å»ºå·¥å…·è°ƒç”¨çš„å“åº”æ¶ˆæ¯</span><br><span class="line">from langchain_core.messages import ToolMessage </span><br><span class="line"># ä» langchain_core.tools å¯¼å…¥ InjectedToolCallIdï¼ˆç”¨äºè‡ªåŠ¨æ³¨å…¥å·¥å…·è°ƒç”¨IDï¼‰å’Œ toolï¼ˆå·¥å…·è£…é¥°å™¨ï¼‰</span><br><span class="line">from langchain_core.tools import InjectedToolCallId, tool </span><br><span class="line"></span><br><span class="line"># ä» langgraph.types å¯¼å…¥ Commandï¼ˆç”¨äºå‘å›¾å‘é€æŒ‡ä»¤ï¼‰å’Œ interruptï¼ˆç”¨äºä¸­æ–­å›¾çš„æ‰§è¡Œï¼‰</span><br><span class="line">from langgraph.types import Command, interrupt </span><br><span class="line">from typing import Annotated</span><br><span class="line"># @tool è£…é¥°å™¨å°†è¿™ä¸ªå‡½æ•°å£°æ˜ä¸ºä¸€ä¸ªå¯ä¾› LLM è°ƒç”¨çš„å·¥å…·</span><br><span class="line">@tool </span><br><span class="line">def human_assistance(</span><br><span class="line">    name: str, </span><br><span class="line">    birthday: str, </span><br><span class="line">    # tool_call_id è¿™ä¸ªå‚æ•°éå¸¸ç‰¹æ®Šã€‚Annotated[...] å’Œ InjectedToolCallId å‘Šè¯‰ LangGraphï¼š</span><br><span class="line">    # 1. è¿™ä¸ªå‚æ•°ä¸åº”æš´éœ²ç»™ LLMï¼ŒLLM åœ¨è°ƒç”¨æ­¤å·¥å…·æ—¶ä¸éœ€è¦æä¾›å®ƒã€‚</span><br><span class="line">    # 2. LangGraph åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å°†è§¦å‘æ­¤å·¥å…·çš„é‚£ä¸ªå·¥å…·è°ƒç”¨çš„ ID æ³¨å…¥åˆ°è¿™ä¸ªå‚æ•°ä¸­ã€‚</span><br><span class="line">    # è¿™ä¸ª ID å¯¹äºåˆ›å»ºä¸åŸå§‹è¯·æ±‚ç›¸å…³è”çš„ ToolMessage è‡³å…³é‡è¦ã€‚</span><br><span class="line">    tool_call_id: Annotated[str, InjectedToolCallId]</span><br><span class="line">) -&gt; str: </span><br><span class="line">    &quot;&quot;&quot;å½“éœ€è¦äººå·¥ç¡®è®¤æˆ–æ›´æ­£ä¿¡æ¯æ—¶ï¼Œè¯·æ±‚äººç±»ååŠ©ã€‚&quot;&quot;&quot; </span><br><span class="line">    # è°ƒç”¨ interrupt() æ¥æš‚åœå›¾çš„æ‰§è¡Œï¼Œå¹¶å‘äººç±»å®¡æ ¸è€…å‘ˆç°ä¸€ä¸ªåŒ…å«é—®é¢˜å’Œå¾…ç¡®è®¤æ•°æ®çš„å­—å…¸ã€‚</span><br><span class="line">    # å›¾ä¼šåœ¨æ­¤å¤„æš‚åœï¼Œç›´åˆ°äººç±»é€šè¿‡ resume æŒ‡ä»¤æä¾›äº†å“åº”ã€‚</span><br><span class="line">    human_response = interrupt( </span><br><span class="line">        &#123; </span><br><span class="line">            &quot;question&quot;: &quot;Is this correct?&quot;, </span><br><span class="line">            &quot;name&quot;: name, </span><br><span class="line">            &quot;birthday&quot;: birthday, </span><br><span class="line">        &#125;,</span><br><span class="line">    ) </span><br><span class="line">    # æ£€æŸ¥äººç±»çš„å“åº”ã€‚å¦‚æœå“åº”ä¸­ &#x27;correct&#x27; é”®çš„å€¼æ˜¯ &#x27;yes&#x27; æˆ– &#x27;y&#x27; å¼€å¤´ï¼Œ</span><br><span class="line">    # åˆ™è®¤ä¸ºä¿¡æ¯æ˜¯æ­£ç¡®çš„ã€‚</span><br><span class="line">    if human_response.get(&quot;correct&quot;, &quot;&quot;).lower().startswith(&quot;y&quot;): </span><br><span class="line">        # å¦‚æœä¿¡æ¯æ­£ç¡®ï¼Œç›´æ¥ä½¿ç”¨ä» LLM è·å–çš„åŸå§‹ä¿¡æ¯ã€‚</span><br><span class="line">        verified_name = name </span><br><span class="line">        verified_birthday = birthday </span><br><span class="line">        response = &quot;Correct&quot; </span><br><span class="line">    # å¦åˆ™ï¼Œè®¤ä¸ºäººç±»å®¡æ ¸è€…æä¾›äº†æ›´æ­£åçš„ä¿¡æ¯ã€‚</span><br><span class="line">    else: </span><br><span class="line">        # ä»äººç±»çš„å“åº”ä¸­è·å–æ›´æ­£åçš„å§“åå’Œç”Ÿæ—¥ã€‚</span><br><span class="line">        # å¦‚æœäººç±»æ²¡æœ‰æä¾›æ–°çš„å€¼ï¼Œåˆ™ä½¿ç”¨ .get() çš„é»˜è®¤å€¼ï¼Œå³åŸå§‹å€¼ã€‚</span><br><span class="line">        verified_name = human_response.get(&quot;name&quot;, name) </span><br><span class="line">        verified_birthday = human_response.get(&quot;birthday&quot;, birthday) </span><br><span class="line">        response = f&quot;Made a correction: &#123;human_response&#125;&quot; </span><br><span class="line"></span><br><span class="line">    # åœ¨å·¥å…·å†…éƒ¨ç›´æ¥æ„é€ ä¸€ä¸ªç”¨äºæ›´æ–°å›¾çŠ¶æ€çš„å­—å…¸ã€‚</span><br><span class="line">    state_update = &#123; </span><br><span class="line">        &quot;name&quot;: verified_name, # æ›´æ–°çŠ¶æ€ä¸­çš„ &#x27;name&#x27; å­—æ®µ</span><br><span class="line">        &quot;birthday&quot;: verified_birthday, # æ›´æ–°çŠ¶æ€ä¸­çš„ &#x27;birthday&#x27; å­—æ®µ</span><br><span class="line">        # åˆ›å»ºä¸€ä¸ª ToolMessageï¼Œå°†å…¶æ·»åŠ åˆ°çŠ¶æ€çš„ &#x27;messages&#x27; åˆ—è¡¨ä¸­ã€‚</span><br><span class="line">        # è¿™ä¸ªæ¶ˆæ¯å°†ä½œä¸ºæ­¤å·¥å…·è°ƒç”¨çš„æ­£å¼â€œç­”å¤â€å‡ºç°åœ¨å¯¹è¯å†å²ä¸­ã€‚</span><br><span class="line">        # tool_call_id æ˜¯å¿…éœ€çš„ï¼Œç”¨äºå°†æ­¤ç­”å¤ä¸ LLM çš„åŸå§‹å·¥å…·è°ƒç”¨è¯·æ±‚å…³è”èµ·æ¥ã€‚</span><br><span class="line">        &quot;messages&quot;: [ToolMessage(response, tool_call_id=tool_call_id)], </span><br><span class="line">    &#125; </span><br><span class="line">    # è¿™ä¸ªå·¥å…·ä¸è¿”å›ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª Command å¯¹è±¡ã€‚</span><br><span class="line">    # Command(update=...) æ˜¯ä¸€ä¸ªæ˜ç¡®çš„æŒ‡ä»¤ï¼Œå‘Šè¯‰ LangGraph æ‰§è¡Œå™¨ï¼š</span><br><span class="line">    # â€œè¯·ä¸è¦å°†æˆ‘çš„è¿”å›å€¼å½“ä½œæ™®é€šå·¥å…·è¾“å‡ºï¼Œè€Œæ˜¯ç”¨ state_update å­—å…¸é‡Œçš„å†…å®¹æ¥ç›´æ¥æ›´æ–°å½“å‰çš„å›¾çŠ¶æ€ã€‚â€</span><br><span class="line">    return Command(update=state_update) </span><br></pre></td></tr></table></figure>
<p>å›¾çš„å…¶ä½™éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</p>
<h4 id="æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥"><a href="#æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥" class="headerlink" title="æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥"></a>æç¤ºèŠå¤©æœºå™¨äººè°ƒç”¨äººå·¥å®¡æŸ¥</h4><p>æç¤ºèŠå¤©æœºå™¨äººæŸ¥æ‰¾ LangGraph åº“çš„â€œç”Ÿæ—¥â€ï¼Œå¹¶åœ¨å…¶è·å–æ‰€éœ€ä¿¡æ¯åï¼ŒæŒ‡ç¤ºèŠå¤©æœºå™¨äººä½¿ç”¨ <code>human_assistance</code> å·¥å…·ã€‚é€šè¿‡åœ¨å·¥å…·å‚æ•°ä¸­è®¾ç½® <code>name</code> å’Œ <code>birthday</code>ï¼Œæ‚¨å°†å¼ºåˆ¶èŠå¤©æœºå™¨äººä¸ºè¿™äº›å­—æ®µç”Ÿæˆæè®®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">user_input = (</span><br><span class="line">    &quot;ä½ èƒ½æŸ¥ä¸€ä¸‹ LangGraph æ˜¯ä»€ä¹ˆæ—¶å€™å‘å¸ƒçš„å—ï¼Ÿ &quot;</span><br><span class="line">    &quot;å½“ä½ æœ‰äº†ç­”æ¡ˆåï¼Œä½¿ç”¨ human_assistance å·¥å…·è¿›è¡Œå®¡æŸ¥ã€‚&quot;</span><br><span class="line">)</span><br><span class="line">config = &#123;&quot;configurable&quot;: &#123;&quot;thread_id&quot;: &quot;1&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line">events = graph.stream(</span><br><span class="line">    &#123;&quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_input&#125;]&#125;,</span><br><span class="line">    config,</span><br><span class="line">    stream_mode=&quot;values&quot;,</span><br><span class="line">)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†æ¬¡åœ¨ <code>human_assistance</code> å·¥å…·ä¸­è§¦å‘äº† <code>interrupt</code>ã€‚</p>
<h4 id="æ·»åŠ äººå·¥ååŠ©"><a href="#æ·»åŠ äººå·¥ååŠ©" class="headerlink" title="æ·»åŠ äººå·¥ååŠ©"></a>æ·»åŠ äººå·¥ååŠ©</h4><p>èŠå¤©æœºå™¨äººæœªèƒ½è¯†åˆ«æ­£ç¡®çš„æ—¥æœŸï¼Œå› æ­¤ä¸ºå…¶æä¾›ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">human_command = Command(</span><br><span class="line">    resume=&#123;</span><br><span class="line">        &quot;name&quot;: &quot;LangGraph&quot;,</span><br><span class="line">        &quot;birthday&quot;: &quot;Jan 17, 2024&quot;,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">events = graph.stream(human_command, config, stream_mode=&quot;values&quot;)</span><br><span class="line">for event in events:</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œè¿™äº›å­—æ®µç°åœ¨å·²åæ˜ åœ¨çŠ¶æ€ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">snapshot = graph.get_state(config)</span><br><span class="line"></span><br><span class="line">&#123;k: v for k, v in snapshot.values.items() if k in (&quot;name&quot;, &quot;birthday&quot;)&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä½¿å¾—ä¸‹æ¸¸èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼Œè¿›ä¸€æ­¥å¤„ç†æˆ–å­˜å‚¨ä¿¡æ¯çš„èŠ‚ç‚¹ï¼‰å¯ä»¥è½»æ¾è®¿é—®å®ƒä»¬ã€‚</p>
<h3 id="æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰"><a href="#æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰" class="headerlink" title="æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰"></a>æ—¶é—´åŠŸèƒ½ï¼ˆä»ä¹‹å‰çš„æŸä¸ªçŠ¶æ€å¼€å§‹ï¼‰</h3><p>åœ¨å…¸å‹çš„èŠå¤©æœºå™¨äººå·¥ä½œæµç¨‹ä¸­ï¼Œç”¨æˆ·ä¸æœºå™¨äººè¿›è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡äº¤äº’ä»¥å®Œæˆä»»åŠ¡ã€‚<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/tutorials/get-started/3-add-memory/">è®°å¿†</a>å’Œ<a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/tutorials/get-started/4-human-in-the-loop/">äººå·¥å¹²é¢„</a>åŠŸèƒ½å¯ä»¥ä¸ºå›¾çŠ¶æ€å¯ç”¨æ£€æŸ¥ç‚¹å¹¶æ§åˆ¶æœªæ¥çš„å“åº”ã€‚</p>
<p>å¦‚æœæ‚¨å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿä»ä¹‹å‰çš„å“åº”å¼€å§‹å¹¶æ¢ç´¢ä¸åŒçš„ç»“æœï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿæˆ–è€…ï¼Œå¦‚æœæ‚¨å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿå›æº¯èŠå¤©æœºå™¨äººçš„å·¥ä½œä»¥çº æ­£é”™è¯¯æˆ–å°è¯•ä¸åŒçš„ç­–ç•¥ï¼Œè¿™åœ¨è‡ªä¸»è½¯ä»¶å·¥ç¨‹å¸ˆç­‰åº”ç”¨ç¨‹åºä¸­å¾ˆå¸¸è§ï¼Œé‚£åˆè¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ LangGraph å†…ç½®çš„<strong>æ—¶å…‰æ—…è¡Œ</strong>åŠŸèƒ½åˆ›å»ºè¿™äº›ç±»å‹çš„ä½“éªŒã€‚</p>
<h4 id="å›æº¯æ‚¨çš„å›¾"><a href="#å›æº¯æ‚¨çš„å›¾" class="headerlink" title="å›æº¯æ‚¨çš„å›¾"></a>å›æº¯æ‚¨çš„å›¾</h4><p>é€šè¿‡ä½¿ç”¨å›¾çš„<code>get_state_history</code>æ–¹æ³•è·å–æ£€æŸ¥ç‚¹æ¥å›æº¯æ‚¨çš„å›¾ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä»ä¹‹å‰çš„è¿™ä¸ªæ—¶é—´ç‚¹æ¢å¤æ‰§è¡Œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ to_replay ä¸º Noneï¼Œå®ƒå°†ç”¨äºå­˜å‚¨æˆ‘ä»¬æƒ³è¦â€œæ—¶é—´æ—…è¡Œâ€å›å»çš„ç‰¹å®šçŠ¶æ€ã€‚</span><br><span class="line"># to_replay å°†åœ¨å¾ªç¯ä¸­è¢«èµ‹å€¼ä¸ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„é‚£ä¸ªå†å²çŠ¶æ€å¿«ç…§ã€‚</span><br><span class="line">to_replay = None</span><br><span class="line"></span><br><span class="line"># éå† `graph` åœ¨ç»™å®š `config` ä¸‹çš„æ‰€æœ‰å†å²çŠ¶æ€ã€‚</span><br><span class="line"># `graph.get_state_history(config)` ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå…¶ä¸­åŒ…å«äº†ä»å¼€å§‹åˆ°å½“å‰çš„æ‰€æœ‰çŠ¶æ€å¿«ç…§ã€‚</span><br><span class="line">for state in graph.get_state_history(config):</span><br><span class="line">    # æ‰“å°å½“å‰çŠ¶æ€å¿«ç…§ä¸­çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘ä»¬è§‚å¯Ÿå’Œé€‰æ‹©ã€‚</span><br><span class="line">    # `len(state.values[&quot;messages&quot;])` æ˜¾ç¤ºäº†åˆ°è¯¥çŠ¶æ€ä¸ºæ­¢ï¼Œå¯¹è¯å†å²ä¸­çš„æ¶ˆæ¯æ€»æ•°ã€‚</span><br><span class="line">    # `state.next` æ˜¾ç¤ºäº†åœ¨è¯¥çŠ¶æ€ä¹‹åï¼Œå›¾å°†è¦æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æˆ–æ­¥éª¤çš„åç§°ã€‚</span><br><span class="line">    print(&quot;Num Messages: &quot;, len(state.values[&quot;messages&quot;]), &quot;Next: &quot;, state.next)</span><br><span class="line">    </span><br><span class="line">    # æ‰“å°ä¸€æ¡åˆ†éš”çº¿ï¼Œä½¿è¾“å‡ºæ›´æ˜“è¯»ã€‚</span><br><span class="line">    print(&quot;-&quot; * 80)</span><br><span class="line">    </span><br><span class="line">    # è¿™é‡Œæ˜¯é€‰æ‹©â€œæ—¶é—´æ—…è¡Œâ€ç›®æ ‡ç‚¹çš„å…³é”®é€»è¾‘ã€‚</span><br><span class="line">    # æˆ‘ä»¬è®¾å®šä¸€ä¸ªæ¡ä»¶ï¼šå½“å¯¹è¯å†å²ä¸­çš„æ¶ˆæ¯æ•°é‡æ­£å¥½ç­‰äº4æ—¶ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†æƒ³è¦å›åˆ°çš„é‚£ä¸ªç‚¹ã€‚</span><br><span class="line">    # è¿™æ˜¯ä¸€ä¸ªä¸ºäº†æ¼”ç¤ºè€Œè®¾å®šçš„ä»»æ„æ¡ä»¶ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®æ›´å¤æ‚çš„é€‰æ‹©é€»è¾‘ã€‚</span><br><span class="line">    if len(state.values[&quot;messages&quot;]) == 4:</span><br><span class="line">        # We are somewhat arbitrarily selecting a specific state based on the number of chat messages in the state.</span><br><span class="line">        # å°†å½“å‰è¿™ä¸ªç¬¦åˆæ¡ä»¶çš„çŠ¶æ€ï¼ˆstateï¼‰ä¿å­˜åˆ° to_replay å˜é‡ä¸­ã€‚</span><br><span class="line">        # å¾ªç¯ç»“æŸåï¼Œto_replay å˜é‡å°†æŒæœ‰æˆ‘ä»¬é€‰ä¸­çš„é‚£ä¸ªå†å²æ—¶åˆ»çš„å®Œæ•´çŠ¶æ€ï¼Œ</span><br><span class="line">        # ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥æ¢å¤æˆ–ä¿®æ”¹æ‰§è¡Œæµç¨‹ã€‚</span><br><span class="line">        to_replay = state</span><br></pre></td></tr></table></figure>
<p>å›¾çš„æ¯ä¸€æ­¥éƒ½ä¼šä¿å­˜æ£€æŸ¥ç‚¹ã€‚è¿™<strong>è·¨è¶Šäº†è°ƒç”¨</strong>ï¼Œå› æ­¤æ‚¨å¯ä»¥å›æº¯æ•´ä¸ªçº¿ç¨‹çš„å†å²ã€‚</p>
<h4 id="ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€"><a href="#ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€" class="headerlink" title="ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€"></a>ä»ç‰¹å®šæ—¶é—´ç‚¹åŠ è½½çŠ¶æ€</h4><p>ä»<code>to_replay</code>çŠ¶æ€æ¢å¤ã€‚ä»è¿™ä¸€ç‚¹æ¢å¤å°†æ¥ä¸‹æ¥è°ƒç”¨<strong>action</strong>èŠ‚ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(to_replay.next)</span><br><span class="line">print(to_replay.config)</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ç‚¹çš„<code>to_replay.config</code>åŒ…å«ä¸€ä¸ª<code>checkpoint_id</code>æ—¶é—´æˆ³ã€‚æä¾›æ­¤<code>checkpoint_id</code>å€¼ä¼šå‘Šè¯‰ LangGraph çš„æ£€æŸ¥ç‚¹å™¨ä»è¯¥æ—¶é—´ç‚¹<strong>åŠ è½½</strong>çŠ¶æ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for event in graph.stream(None, to_replay.config, stream_mode=&quot;values&quot;):</span><br><span class="line">    if &quot;messages&quot; in event:</span><br><span class="line">        event[&quot;messages&quot;][-1].pretty_print()</span><br></pre></td></tr></table></figure>
<h3 id="è¿è¡Œæœ¬åœ°æœåŠ¡å™¨"><a href="#è¿è¡Œæœ¬åœ°æœåŠ¡å™¨" class="headerlink" title="è¿è¡Œæœ¬åœ°æœåŠ¡å™¨"></a>è¿è¡Œæœ¬åœ°æœåŠ¡å™¨</h3><h4 id="å®‰è£…-LangGraph-CLI"><a href="#å®‰è£…-LangGraph-CLI" class="headerlink" title="å®‰è£… LangGraph CLI"></a>å®‰è£… LangGraph CLI</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Python &gt;= 3.11 is required.</span><br><span class="line"></span><br><span class="line">pip install --upgrade &quot;langgraph-cli[inmem]&quot;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»º-LangGraph-åº”ç”¨-ğŸŒ±"><a href="#åˆ›å»º-LangGraph-åº”ç”¨-ğŸŒ±" class="headerlink" title="åˆ›å»º LangGraph åº”ç”¨ ğŸŒ±"></a>åˆ›å»º LangGraph åº”ç”¨ ğŸŒ±</h4><p>ä» <a target="_blank" rel="noopener" href="https://github.com/langchain-ai/new-langgraph-project"><code>new-langgraph-project-python</code> æ¨¡æ¿</a> æˆ– <a target="_blank" rel="noopener" href="https://github.com/langchain-ai/new-langgraphjs-project"><code>new-langgraph-project-js</code> æ¨¡æ¿</a> åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚æ­¤æ¨¡æ¿å±•ç¤ºäº†ä¸€ä¸ªå•èŠ‚ç‚¹åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„é€»è¾‘è¿›è¡Œæ‰©å±•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">langgraph new . --template new-langgraph-project-python</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨ <code>langgraph new</code> è€Œä¸æŒ‡å®šæ¨¡æ¿ï¼Œç³»ç»Ÿå°†æ˜¾ç¤ºä¸€ä¸ªäº¤äº’å¼èœå•ï¼Œæ‚¨å¯ä»¥ä»ä¸­é€‰æ‹©å¯ç”¨çš„æ¨¡æ¿åˆ—è¡¨ã€‚</p>
</blockquote>
<h4 id="ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹"><a href="#ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹" class="headerlink" title="ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹"></a>ä½¿ç”¨uvå®‰è£…ä¾èµ–é¡¹</h4><p>uv æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„æé€Ÿ Python åŒ…å’Œé¡¹ç›®ç®¡ç†å™¨ ã€‚å®ƒæ—¨åœ¨è§£å†³ä¼ ç»Ÿ Python åŒ…ç®¡ç†å·¥å…·ï¼ˆå¦‚ pip ã€ poetry ç­‰ï¼‰åœ¨é€Ÿåº¦å’Œæ•ˆç‡æ–¹é¢çš„ç—›ç‚¹ï¼Œæä¾›æ›´å¿«çš„å®‰è£…ã€ä¾èµ–è§£æå’Œç¯å¢ƒç®¡ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install uv#å®‰è£…uv</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ<code>uv sync</code>ä¼šæ ¹æ® <code>pyproject.toml</code>çš„ä¾èµ–åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–</p>
<blockquote>
<p><code>pyproject.toml</code> æ–‡ä»¶æ˜¯ Python é¡¹ç›®ä¸­ç”¨äºç»Ÿä¸€é…ç½®é¡¹ç›®å…ƒæ•°æ®ã€æ„å»ºç³»ç»Ÿã€ä¾èµ–ç®¡ç†å’Œå„ç§å·¥å…·è®¾ç½®çš„æ ‡å‡†åŒ–æ–‡ä»¶ã€‚å®ƒé€šå¸¸ç”¨äºæ›¿ä»£æ—§çš„ requirements.txt æ–‡ä»¶ï¼Œæä¾›æ›´ç°ä»£å’Œé›†ä¸­çš„é¡¹ç›®é…ç½®æ–¹å¼ã€‚</p>
</blockquote>
<h4 id="åˆ›å»ºä¸€ä¸ª-env-æ–‡ä»¶"><a href="#åˆ›å»ºä¸€ä¸ª-env-æ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶"></a>åˆ›å»ºä¸€ä¸ª <code>.env</code> æ–‡ä»¶</h4><p>æ‚¨å°†åœ¨æ–° LangGraph åº”ç”¨çš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ª <code>.env.example</code> æ–‡ä»¶ã€‚åœ¨æ–° LangGraph åº”ç”¨çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>.env</code> æ–‡ä»¶ï¼Œå¹¶å°† <code>.env.example</code> æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å…¶ä¸­ï¼Œå¡«å…¥æ‰€éœ€çš„ API å¯†é’¥ã€‚</p>
<p>æ·»åŠ ç¯å¢ƒå˜é‡å¦‚LANGSMITH_API_KEYï¼ŒOPENAI_API_KEYç­‰</p>
<h4 id="å¯åŠ¨-LangGraph-æœåŠ¡å™¨"><a href="#å¯åŠ¨-LangGraph-æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨ LangGraph æœåŠ¡å™¨"></a>å¯åŠ¨ LangGraph æœåŠ¡å™¨</h4><p>åœ¨æœ¬åœ°å¯åŠ¨ LangGraph API æœåŠ¡å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">langgraph dev</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;    Ready!</span><br><span class="line">&gt;</span><br><span class="line">&gt;    - API: [https://:2024](https://:2024/)</span><br><span class="line">&gt;</span><br><span class="line">&gt;    - Docs: https://:2024/docs</span><br><span class="line">&gt;</span><br><span class="line">&gt;    - LangGraph Studio Web UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024</span><br></pre></td></tr></table></figure>
<p>LangGraph æœåŠ¡å™¨ï¼ˆå¦‚æ‚¨é€šè¿‡ langgraph dev å‘½ä»¤å¯åŠ¨çš„æœåŠ¡å™¨ï¼‰çš„ä¸»è¦ä½œç”¨æ˜¯æä¾›ä¸€ä¸ªè¿è¡Œç¯å¢ƒå’Œæ¥å£ï¼Œç”¨äºå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œç®¡ç†åŸºäº LangGraph æ„å»ºçš„ AI ä»£ç†å’Œåº”ç”¨ç¨‹åºã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç”¨é€”ï¼š</p>
<ol>
<li>API æ¥å£æš´éœ² ï¼šå®ƒå°†æ‚¨ç”¨ LangGraph å®šä¹‰çš„å¤æ‚ä»£ç†é€»è¾‘ï¼ˆå³å›¾ç»“æ„ï¼‰é€šè¿‡æ ‡å‡†çš„ RESTful API æ¥å£æš´éœ²å‡ºæ¥ã€‚è¿™æ„å‘³ç€å…¶ä»–åº”ç”¨ç¨‹åºã€å‰ç«¯ç•Œé¢æˆ–è€…å…¶ä»–æœåŠ¡å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚ä¸æ‚¨çš„ LangGraph ä»£ç†è¿›è¡Œäº¤äº’ï¼Œè€Œæ— éœ€ç›´æ¥é›†æˆ LangGraph çš„ Python ä»£ç ã€‚</li>
<li>ç®€åŒ–éƒ¨ç½² ï¼šé€šè¿‡å°† LangGraph åº”ç”¨ç¨‹åºæ‰“åŒ…æˆä¸€ä¸ªå¯è¿è¡Œçš„æœåŠ¡ï¼Œæ‚¨å¯ä»¥æ›´å®¹æ˜“åœ°å°†å…¶éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ã€å®¹å™¨ï¼ˆå¦‚ Dockerï¼‰æˆ–å…¶ä»–ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™ä½¿å¾— LangGraph ä»£ç†å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡è¿è¡Œï¼Œæ–¹ä¾¿æ‰©å±•å’Œç®¡ç†ã€‚</li>
<li><p>å¼€å‘å’Œè°ƒè¯•ä¾¿åˆ© ï¼š</p>
<ul>
<li>å®æ—¶é¢„è§ˆå’Œè°ƒè¯• ï¼šæœåŠ¡å™¨é€šå¸¸ä¼šæä¾›ä¸€ä¸ª Studio UIï¼ˆå¦‚æ‚¨åœ¨ <a target="_blank" rel="noopener" href="http://127.0.0.1:2024/studio">http://127.0.0.1:2024/studio</a> çœ‹åˆ°çš„ï¼‰ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå¯è§†åŒ–åœ°æŸ¥çœ‹ä»£ç†çš„å›¾ç»“æ„ã€æ‰§è¡Œæµç¨‹ã€çŠ¶æ€å˜åŒ–å’Œä¸­é—´æ­¥éª¤ï¼Œè¿™å¯¹äºç†è§£å’Œè°ƒè¯•å¤æ‚çš„ä»£ç†è¡Œä¸ºè‡³å…³é‡è¦ã€‚</li>
<li>API æ–‡æ¡£ ï¼šè‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£ï¼ˆå¦‚ <a target="_blank" rel="noopener" href="http://127.0.0.1:2024/docs">http://127.0.0.1:2024/docs</a> ï¼‰æä¾›äº†æ‰€æœ‰å¯ç”¨æ¥å£çš„è¯¦ç»†è¯´æ˜å’Œäº¤äº’å¼æµ‹è¯•åŠŸèƒ½ï¼Œæå¤§åœ°åŠ é€Ÿäº†å¼€å‘å’Œé›†æˆè¿‡ç¨‹ã€‚</li>
</ul>
</li>
<li>çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ– ï¼šLangGraph ä»£ç†é€šå¸¸æ¶‰åŠå¤æ‚çš„çŠ¶æ€ç®¡ç†ã€‚æœåŠ¡å™¨å¯ä»¥è´Ÿè´£å¤„ç†è¿™äº›çŠ¶æ€çš„æŒä¹…åŒ–ï¼Œç¡®ä¿ä»£ç†åœ¨å¤šæ¬¡äº¤äº’ä¹‹é—´èƒ½å¤Ÿè®°ä½ä¸Šä¸‹æ–‡å’Œå†å²ä¿¡æ¯ã€‚</li>
</ol>
<h4 id="åœ¨-LangGraph-Studio-ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº"><a href="#åœ¨-LangGraph-Studio-ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº" class="headerlink" title="åœ¨ LangGraph Studio ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº"></a>åœ¨ LangGraph Studio ä¸­æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åº</h4><p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/concepts/langgraph_studio/">LangGraph Studio</a> æ˜¯ä¸€ä¸ªä¸“é—¨çš„ UIï¼Œæ‚¨å¯ä»¥è¿æ¥åˆ° LangGraph API æœåŠ¡å™¨ï¼Œä»¥ä¾¿åœ¨æœ¬åœ°å¯è§†åŒ–ã€äº¤äº’å’Œè°ƒè¯•æ‚¨çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡è®¿é—® <code>langgraph dev</code> å‘½ä»¤è¾“å‡ºä¸­æä¾›çš„ URLï¼Œåœ¨ LangGraph Studio ä¸­æµ‹è¯•æ‚¨çš„å›¾ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;    - LangGraph Studio Web UI: https://smith.langchain.com/studio/?baseUrl=http://127.0.0.1:2024</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/tutorials/get-started/1-build-basic-chatbot/#1-install-packages">æ„å»ºä¸€ä¸ªåŸºæœ¬èŠå¤©æœºå™¨äºº - LangChain æ¡†æ¶</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.langchain.com/oss/python/overview">Overview - Docs by LangChain</a></p>
<p>å®˜æ–¹æ•™ç¨‹ï¼Œä½†æ˜¯è‹±æ–‡<a target="_blank" rel="noopener" href="https://academy.langchain.com/collections">https://academy.langchain.com/collections</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1AY4aeRETY/?spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">3.5 å°æ—¶å‡ºè¯ï¼LangGraph å®˜æ–¹è¯¾ç¨‹ ğŸ†“ é‡ç£…ä¸Šçº¿ğŸ”¥ğŸ”¥ğŸ”¥_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langgraph%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/" class="post-title-link" itemprop="url">langgraphæŸ¥æ¼è¡¥ç¼º</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-04 17:14:00" itemprop="dateModified" datetime="2025-08-04T17:14:00+08:00">2025-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="æ³¨å…¥ä¸Šä¸‹æ–‡"><a href="#æ³¨å…¥ä¸Šä¸‹æ–‡" class="headerlink" title="æ³¨å…¥ä¸Šä¸‹æ–‡"></a>æ³¨å…¥ä¸Šä¸‹æ–‡</h3><p>â€œæ³¨å…¥ä¸Šä¸‹æ–‡â€å°±æ˜¯<strong>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­èŠ‚ç‚¹/å¤§æ¨¡å‹</strong> å¯èƒ½éœ€è¦ã€ä½†<strong>ä¸ä¼š</strong>ï¼ˆä¹Ÿä¸åº”è¯¥ï¼‰å»æ”¹å˜çš„<strong>åªè¯»ä¿¡æ¯</strong>çš„é›†åˆã€‚</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ³¨å…¥ä¸Šä¸‹æ–‡é‡Œå¯èƒ½æ”¾ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æƒé™æ§åˆ¶</strong></td>
<td><code>user_id</code>, <code>tenant_id</code>ï¼ˆå†³å®šèƒ½è®¿é—®å“ªäº›æ•°æ®ï¼‰</td>
</tr>
<tr>
<td><strong>å¤–éƒ¨ä¾èµ–</strong></td>
<td><code>db_connection</code>, <code>api_key</code>, <code>s3_bucket</code>ï¼ˆèŠ‚ç‚¹é‡Œè¦ç”¨ï¼‰</td>
</tr>
<tr>
<td><strong>ä¸ªæ€§åŒ–å‚æ•°</strong></td>
<td><code>language</code>, <code>timezone</code>, <code>model_temperature</code></td>
</tr>
<tr>
<td><strong>ä¼šè¯å…ƒä¿¡æ¯</strong></td>
<td><code>session_id</code>, <code>channel</code>ï¼ˆSlack / å¾®ä¿¡ / Webï¼‰</td>
</tr>
</tbody>
</table>
</div>
<h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">from dataclasses import dataclass</span><br><span class="line"></span><br><span class="line">from langgraph.graph import StateGraph</span><br><span class="line">from langgraph.runtime import Runtime</span><br><span class="line"></span><br><span class="line">@dataclass</span><br><span class="line">class Context:</span><br><span class="line">    &quot;&quot;&quot;Context schema defined by the developer.&quot;&quot;&quot;    </span><br><span class="line">    user_id: str    </span><br><span class="line">    db_connection: str</span><br><span class="line">    </span><br><span class="line">def node(state: State, runtime: Runtime[Context]):</span><br><span class="line">    # type safe access to context attributes    </span><br><span class="line">    user_id = runtime.context.user_id</span><br><span class="line">    db_conn = runtime.context.db_connection</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">builder = StateGraph(state_schema=State, context_schema=Context)</span><br><span class="line"></span><br><span class="line"># add nodes, edges, compile the graph...</span><br><span class="line"></span><br><span class="line"># top level context arg is typed as Context for autocomplete and type checking</span><br><span class="line">result = graph.invoke(</span><br><span class="line">    &#123;&#x27;input&#x27;: &#x27;abc&#x27;&#125;,</span><br><span class="line">    context=Context(user_id=&#x27;123&#x27;, db_conn=&#x27;conn_mock&#x27;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://langchain-ai.github.io/langgraph/reference/runtime/#runtime"><code>Runtime</code></a> ç±»æä¾›äº†ä¸€ä¸ªå•ä¸€æ¥å£ï¼Œç”¨äºè®¿é—®ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ä¸Šä¸‹æ–‡ï¼šåœ¨è¿è¡Œå¼€å§‹æ—¶ä¼ é€’çš„é™æ€æ•°æ®</li>
<li>å­˜å‚¨ï¼šé•¿æœŸè®°å¿†çš„å­˜å‚¨æœºåˆ¶</li>
<li>æµå†™å…¥å™¨ï¼šç”¨äºå‘å›¾è¾“å‡ºæµå†™å…¥çš„è‡ªå®šä¹‰å‡½æ•°</li>
<li>å¯¹äºåŠŸèƒ½ API ç”¨æˆ·ï¼Œ<code>previous</code> ä¹Ÿå¯ç”¨ï¼šç»™å®šçº¿ç¨‹çš„å‰ä¸€ä¸ªè¿”å›å€¼</li>
</ul>
<p>ç°åœ¨ï¼Œå¼€å‘è€…ä¸å†éœ€è¦å°†ä¸Šè¿°æ‰€æœ‰å†…å®¹ä½œä¸ºå•ç‹¬çš„å‚æ•°æ³¨å…¥åˆ°èŠ‚ç‚¹å‡½æ•°ä¸­ï¼Œ<br>è€Œæ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ª <code>runtime</code> å‚æ•°æ¥è®¿é—®å®ƒä»¬ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langsmith/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/15/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/langsmith/" class="post-title-link" itemprop="url">Langsmith</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-15 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š17:55:02" itemprop="dateCreated datePublished" datetime="2025-07-15T00:00:00+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langsmith/" itemprop="url" rel="index"><span itemprop="name">langsmith</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="é…ç½®langsmith"><a href="#é…ç½®langsmith" class="headerlink" title="é…ç½®langsmith"></a>é…ç½®langsmith</h3><h4 id="å®‰è£…LangSmith-SDK"><a href="#å®‰è£…LangSmith-SDK" class="headerlink" title="å®‰è£…LangSmith SDK"></a>å®‰è£…LangSmith SDK</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install langsmith</span><br></pre></td></tr></table></figure>
<h4 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h4><p>è·å–api<a target="_blank" rel="noopener" href="https://smith.langchain.com/o/56031c2a-c402-41d4-83ed-ed15d0693548/settings/apikeys">LangSmith</a></p>
<p>è®¾ç½®ç›¸åº”çš„ç¯å¢ƒå˜é‡ã€‚è¿™å°†æŠŠè·Ÿè¸ªè®°å½•åˆ°<code>default</code>é¡¹ç›®ï¼ˆå°½ç®¡æ‚¨å¯ä»¥è½»æ¾æ›´æ”¹ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export LANGSMITH_TRACING=true</span><br><span class="line">export LANGSMITH_API_KEY=</span><br><span class="line">export LANGSMITH_PROJECT=default</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LANGSMITH_TRACING=true</span><br><span class="line">LANGSMITH_ENDPOINT=&quot;https://api.smith.langchain.com&quot;</span><br><span class="line">LANGSMITH_API_KEY=&quot;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&quot;</span><br><span class="line">LANGSMITH_PROJECT=&quot;langgraph&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h3><p>å®˜ç½‘<a target="_blank" rel="noopener" href="https://smith.langchain.com/o/56031c2a-c402-41d4-83ed-ed15d0693548/">ã€ŠLangSmithã€‹ â€”- LangSmith</a></p>
<p>å‚è€ƒæ–‡æ¡£<a target="_blank" rel="noopener" href="https://langsmith.langchain.ac.cn/">LangSmith å…¥é—¨ | ğŸ¦œï¸ğŸ› ï¸ LangSmith æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.smith.langchain.com/">Get started with LangSmith | ğŸ¦œï¸ğŸ› ï¸ LangSmith</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/LangGraphChatBot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/LangGraphChatBot/" class="post-title-link" itemprop="url">LangGraphChatBot</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-14 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-14T00:00:00+08:00">2025-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-07-15 17:54:50" itemprop="dateModified" datetime="2025-07-15T17:54:50+08:00">2025-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">aiæ¡†æ¶</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ai%E6%A1%86%E6%9E%B6/langgraph/" itemprop="url" rel="index"><span itemprop="name">langgraph</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h3><p>pythonè™šæ‹Ÿç¯å¢ƒæ„å»º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m venv .venv</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install langgraph==0.2.74                  </span><br><span class="line">pip install langchain-openai==0.3.6            </span><br><span class="line">pip install fastapi==0.115.8                         </span><br><span class="line">pip install uvicorn==0.34.0                          </span><br><span class="line">pip install gradio==5.18.0</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹åŒ…<code>pip list</code></p>
<h3 id="æ„å»ºä¸€ä¸ªåŸºæœ¬çš„fastapi-langgraphåº”ç”¨"><a href="#æ„å»ºä¸€ä¸ªåŸºæœ¬çš„fastapi-langgraphåº”ç”¨" class="headerlink" title="æ„å»ºä¸€ä¸ªåŸºæœ¬çš„fastapi+langgraphåº”ç”¨"></a>æ„å»ºä¸€ä¸ªåŸºæœ¬çš„fastapi+langgraphåº”ç”¨</h3><h4 id="llmç¤ºä¾‹çš„æ„å»ºï¼ˆåˆ©ç”¨ChatOpenAIï¼‰"><a href="#llmç¤ºä¾‹çš„æ„å»ºï¼ˆåˆ©ç”¨ChatOpenAIï¼‰" class="headerlink" title="llmç¤ºä¾‹çš„æ„å»ºï¼ˆåˆ©ç”¨ChatOpenAIï¼‰"></a>llmç¤ºä¾‹çš„æ„å»ºï¼ˆåˆ©ç”¨ChatOpenAIï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºLLMå®ä¾‹</span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    base_url=config[&quot;base_url&quot;],</span><br><span class="line">    api_key=config[&quot;api_key&quot;],</span><br><span class="line">    model=config[&quot;model&quot;],</span><br><span class="line">    temperature=DEFAULT_TEMPERATURE,</span><br><span class="line">    timeout=30,  # æ·»åŠ è¶…æ—¶é…ç½®ï¼ˆç§’ï¼‰</span><br><span class="line">    max_retries=2  # æ·»åŠ é‡è¯•æ¬¡æ•°</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="æ•°æ®ç±»å‹çš„æ„å»º"><a href="#æ•°æ®ç±»å‹çš„æ„å»º" class="headerlink" title="æ•°æ®ç±»å‹çš„æ„å»º"></a>æ•°æ®ç±»å‹çš„æ„å»º</h4><p>ç»§æ‰¿äºpydantic</p>
<p>è§„èŒƒåŒ– API è¯·æ±‚å’Œå“åº”çš„æ•°æ®ç»“æ„</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰æ¶ˆæ¯ç±»ï¼Œç”¨äºå°è£…APIæ¥å£è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment">#åŸºäº Pydantic çš„æ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="comment"># å®šä¹‰Messageç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    role (è§’è‰²): è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ¶ˆæ¯çš„å‘é€è€…ã€‚å¸¸è§çš„è§’è‰²åŒ…æ‹¬ï¼š</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- user (ç”¨æˆ·): è¡¨ç¤ºç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="string">- assistant (åŠ©æ‰‹): è¡¨ç¤ºèŠå¤©æœºå™¨äººæˆ–æ¨¡å‹ç”Ÿæˆçš„æ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="string">- system (ç³»ç»Ÿ): è¡¨ç¤ºä¸ºæ¨¡å‹æä¾›ä¸Šä¸‹æ–‡æˆ–æŒ‡ä»¤çš„ç³»ç»Ÿæ¶ˆæ¯ã€‚</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    role: <span class="built_in">str</span></span><br><span class="line">    content: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ChatCompletionRequestç±»</span></span><br><span class="line"><span class="comment">#èŠå¤© API è¯·æ±‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatCompletionRequest</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    messages: <span class="type">List</span>[Message]</span><br><span class="line">    stream: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">False</span><span class="comment">#æ˜¯å¦æµå¼æ–¹å¼å“åº”</span></span><br><span class="line">    userId: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span><span class="comment">#ç”¨äºæ ‡è¯†å‘èµ·è¯·æ±‚çš„ç”¨æˆ·</span></span><br><span class="line">    conversationId: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span><span class="comment">#ç”¨äºæ ‡è¯†ç‰¹å®šçš„å¯¹è¯ä¼šè¯ï¼Œè¿™å¯¹äºç®¡ç†å¯¹è¯ä¸Šä¸‹æ–‡æˆ–å†å²è®°å½•éå¸¸æœ‰ç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ChatCompletionResponseChoiceç±»</span></span><br><span class="line"><span class="comment">#èŠå¤©å®Œæˆå“åº”ä¸­çš„ä¸€ä¸ªâ€œé€‰æ‹©â€æˆ–ä¸€ä¸ªç”Ÿæˆçš„å›å¤</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatCompletionResponseChoice</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    index: <span class="built_in">int</span></span><br><span class="line">    message: Message</span><br><span class="line">    finish_reason: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ChatCompletionResponseç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatCompletionResponse</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">str</span> = Field(default_factory=<span class="keyword">lambda</span>: <span class="string">f&quot;chatcmpl-<span class="subst">&#123;uuid.uuid4().<span class="built_in">hex</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">object</span>: <span class="built_in">str</span> = <span class="string">&quot;chat.completion&quot;</span></span><br><span class="line">    created: <span class="built_in">int</span> = Field(default_factory=<span class="keyword">lambda</span>: <span class="built_in">int</span>(time.time()))</span><br><span class="line">    choices: <span class="type">List</span>[ChatCompletionResponseChoice]<span class="comment">#æ¨¡å‹ç”Ÿæˆçš„æ‰€æœ‰å¯èƒ½çš„å›å¤é€‰é¡¹</span></span><br><span class="line">    system_fingerprint: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h4 id="å®šä¹‰fastapiåº”ç”¨å¹¶ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#å®šä¹‰fastapiåº”ç”¨å¹¶ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å®šä¹‰fastapiåº”ç”¨å¹¶ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ"></a>å®šä¹‰fastapiåº”ç”¨å¹¶ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°lifespanï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªFastAPIåº”ç”¨å®ä¾‹appä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå‡½æ•°å°†ç®¡ç†åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å¯åŠ¨å’Œå…³é—­æ—¶çš„æ“ä½œ</span></span><br><span class="line"><span class="comment"># å‡½æ•°åœ¨åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¦‚åŠ è½½ä¸Šä¸‹æ–‡æ•°æ®ã€ä»¥åŠåˆå§‹åŒ–é—®é¢˜ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="comment"># å‡½æ•°åœ¨åº”ç”¨å…³é—­æ—¶æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œ</span></span><br><span class="line"><span class="comment"># @asynccontextmanager è£…é¥°å™¨ç”¨äºåˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ƒå…è®¸ä½ åœ¨ yield ä¹‹å‰å’Œä¹‹åæ‰§è¡Œç‰¹å®šçš„ä»£ç å—ï¼Œåˆ†åˆ«è¡¨ç¤ºå¯åŠ¨å’Œå…³é—­æ—¶çš„æ“ä½œ</span></span><br><span class="line"><span class="meta">@asynccontextmanager</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">lifespan</span>(<span class="params">app: FastAPI</span>):</span><br><span class="line">    <span class="comment"># å¯åŠ¨æ—¶æ‰§è¡Œ</span></span><br><span class="line">    <span class="comment"># ç”³æ˜å¼•ç”¨å…¨å±€å˜é‡ï¼Œåœ¨å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ä¸­ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">global</span> graph</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        logger.info(<span class="string">&quot;æ­£åœ¨åˆå§‹åŒ–æ¨¡å‹ã€å®šä¹‰Graph...&quot;</span>)</span><br><span class="line">        <span class="comment">#ï¼ˆ1ï¼‰åˆå§‹åŒ–LLM</span></span><br><span class="line">        llm = get_llm(llm_type)</span><br><span class="line">        <span class="comment">#ï¼ˆ2ï¼‰å®šä¹‰Graph</span></span><br><span class="line">        graph = create_graph(llm)</span><br><span class="line">        <span class="comment">#ï¼ˆ3ï¼‰å°†Graphå¯è§†åŒ–å›¾ä¿å­˜</span></span><br><span class="line">        save_graph_visualization(graph)</span><br><span class="line">        logger.info(<span class="string">&quot;åˆå§‹åŒ–å®Œæˆ&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºé”™: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># raise å…³é”®å­—é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œä»¥ç¡®ä¿ç¨‹åºä¸ä¼šåœ¨é”™è¯¯çŠ¶æ€ä¸‹ç»§ç»­è¿è¡Œ</span></span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># yield å…³é”®å­—å°†æ§åˆ¶æƒäº¤è¿˜ç»™FastAPIæ¡†æ¶ï¼Œä½¿åº”ç”¨å¼€å§‹è¿è¡Œ</span></span><br><span class="line">    <span class="comment"># åˆ†éš”äº†å¯åŠ¨å’Œå…³é—­çš„é€»è¾‘ã€‚åœ¨yield ä¹‹å‰çš„ä»£ç åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿è¡Œï¼Œyield ä¹‹åçš„ä»£ç åœ¨åº”ç”¨å…³é—­æ—¶è¿è¡Œ</span></span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="comment"># å…³é—­æ—¶æ‰§è¡Œ</span></span><br><span class="line">    logger.info(<span class="string">&quot;æ­£åœ¨å…³é—­...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># lifespanå‚æ•°ç”¨äºåœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„å¼€å§‹å’Œç»“æŸæ—¶æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æˆ–æ¸…ç†å·¥ä½œ</span></span><br><span class="line">app = FastAPI(lifespan=lifespan)</span><br></pre></td></tr></table></figure>
<h4 id="langgraphæ ¸å¿ƒé€»è¾‘"><a href="#langgraphæ ¸å¿ƒé€»è¾‘" class="headerlink" title="langgraphæ ¸å¿ƒé€»è¾‘"></a>langgraphæ ¸å¿ƒé€»è¾‘</h4><p>åˆ›å»ºlanggraph</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰chatbotçš„çŠ¶æ€</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    messages: Annotated[<span class="built_in">list</span>, add_messages]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå’Œé…ç½®chatbotçš„çŠ¶æ€å›¾</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_graph</span>(<span class="params">llm</span>) -&gt; StateGraph:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># æ„å»ºgraph</span></span><br><span class="line">        <span class="comment">#åˆ›å»ºä¸€ä¸ª StateGraph çš„å®ä¾‹ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºä½¿ç”¨ State ç±»ä½œä¸ºå…¶çŠ¶æ€ç®¡ç†çš„æ•°æ®æ¨¡å‹</span></span><br><span class="line">        graph_builder = StateGraph(State)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å®šä¹‰chatbotçš„node</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">chatbot</span>(<span class="params">state: State</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">            <span class="comment"># å¤„ç†å½“å‰çŠ¶æ€å¹¶è¿”å› LLM å“åº”</span></span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;messages&quot;</span>: [llm.invoke(state[<span class="string">&quot;messages&quot;</span>])]&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é…ç½®graph</span></span><br><span class="line">        <span class="comment">#ç¬¬äºŒä¸ªå‚æ•° chatbot ï¼šè¿™æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ï¼‰ï¼Œå®ƒå®šä¹‰äº†å½“æ‰§è¡Œæµç¨‹åˆ°è¾¾è¿™ä¸ªåä¸º &quot;chatbot&quot; çš„èŠ‚ç‚¹æ—¶ï¼Œåº”è¯¥æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚</span></span><br><span class="line">        graph_builder.add_node(<span class="string">&quot;chatbot&quot;</span>, chatbot)</span><br><span class="line">        graph_builder.add_edge(START, <span class="string">&quot;chatbot&quot;</span>)</span><br><span class="line">        graph_builder.add_edge(<span class="string">&quot;chatbot&quot;</span>, END)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿™é‡Œä½¿ç”¨å†…å­˜å­˜å‚¨ ä¹Ÿå¯ä»¥æŒä¹…åŒ–åˆ°æ•°æ®åº“</span></span><br><span class="line">        memory = MemorySaver()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¼–è¯‘ç”Ÿæˆgraphå¹¶è¿”å›</span></span><br><span class="line">        <span class="comment">#checkpointer å‚æ•°å°† memory å®ä¾‹ä¼ é€’ç»™ç¼–è¯‘è¿‡ç¨‹ï¼Œä½¿å¾—å›¾èƒ½å¤Ÿç®¡ç†å…¶çŠ¶æ€çš„ä¿å­˜å’ŒåŠ è½½ã€‚ç¼–è¯‘åçš„å›¾å¯¹è±¡è¢«è¿”å›ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥è¢«è°ƒç”¨æ¥è¿è¡ŒèŠå¤©æœºå™¨äººã€‚</span></span><br><span class="line">        <span class="keyword">return</span> graph_builder.<span class="built_in">compile</span>(checkpointer=memory)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Failed to create graph: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¯è§†åŒ–langgraphèŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å°†æ„å»ºçš„graphå¯è§†åŒ–ä¿å­˜ä¸º PNG æ–‡ä»¶</span><br><span class="line">def save_graph_visualization(graph: StateGraph, filename: str = &quot;graph.png&quot;) -&gt; None:</span><br><span class="line">    try:</span><br><span class="line">        with open(filename, &quot;wb&quot;) as f:</span><br><span class="line">            f.write(graph.get_graph().draw_mermaid_png())</span><br><span class="line">        logger.info(f&quot;Graph visualization saved as &#123;filename&#125;&quot;)</span><br><span class="line">    except IOError as e:</span><br><span class="line">        logger.info(f&quot;Warning: Failed to save graph visualization: &#123;str(e)&#125;&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="å°è£…æ¥å£"><a href="#å°è£…æ¥å£" class="headerlink" title="å°è£…æ¥å£"></a>å°è£…æ¥å£</h4><p>åŒ…å«æµå¼è¾“å‡ºä¸éæµå¼è¾“å‡ºçš„å¤„ç†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°è£…POSTè¯·æ±‚æ¥å£ï¼Œä¸å¤§æ¨¡å‹è¿›è¡Œé—®ç­”</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/v1/chat/completions&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">chat_completions</span>(<span class="params">request: ChatCompletionRequest</span>):</span><br><span class="line">    <span class="comment"># åˆ¤æ–­åˆå§‹åŒ–æ˜¯å¦å®Œæˆ</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> graph:</span><br><span class="line">        logger.error(<span class="string">&quot;æœåŠ¡æœªåˆå§‹åŒ–&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="string">&quot;æœåŠ¡æœªåˆå§‹åŒ–&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        logger.info(<span class="string">f&quot;æ”¶åˆ°èŠå¤©å®Œæˆè¯·æ±‚: <span class="subst">&#123;request&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        query_prompt = request.messages[-<span class="number">1</span>].content</span><br><span class="line">        logger.info(<span class="string">f&quot;ç”¨æˆ·é—®é¢˜æ˜¯: <span class="subst">&#123;query_prompt&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        config = &#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;thread_id&quot;</span>: request.userId+<span class="string">&quot;@@&quot;</span>+request.conversationId&#125;&#125;</span><br><span class="line">        logger.info(<span class="string">f&quot;ç”¨æˆ·å½“å‰ä¼šè¯ä¿¡æ¯: <span class="subst">&#123;config&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        prompt_template_system = PromptTemplate.from_file(PROMPT_TEMPLATE_TXT_SYS)</span><br><span class="line">        prompt_template_user = PromptTemplate.from_file(PROMPT_TEMPLATE_TXT_USER)</span><br><span class="line">        prompt = [</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt_template_system.template&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: prompt_template_user.template.<span class="built_in">format</span>(query=query_prompt)&#125;</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¤„ç†æµå¼å“åº”</span></span><br><span class="line">        <span class="keyword">if</span> request.stream:</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">generate_stream</span>():</span><br><span class="line">                chunk_id = <span class="string">f&quot;chatcmpl-<span class="subst">&#123;uuid.uuid4().<span class="built_in">hex</span>&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">for</span> message_chunk, metadata <span class="keyword">in</span> graph.astream(&#123;<span class="string">&quot;messages&quot;</span>: prompt&#125;, config, stream_mode=<span class="string">&quot;messages&quot;</span>):</span><br><span class="line">                    chunk = message_chunk.content</span><br><span class="line">                    logger.info(<span class="string">f&quot;chunk: <span class="subst">&#123;chunk&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="comment"># åœ¨å¤„ç†è¿‡ç¨‹ä¸­äº§ç”Ÿæ¯ä¸ªå—</span></span><br><span class="line">                    <span class="keyword">yield</span> <span class="string">f&quot;data: <span class="subst">&#123;json.dumps(&#123;<span class="string">&#x27;id&#x27;</span>: chunk_id,<span class="string">&#x27;object&#x27;</span>: <span class="string">&#x27;chat.completion.chunk&#x27;</span>,<span class="string">&#x27;created&#x27;</span>: <span class="built_in">int</span>(time.time()),<span class="string">&#x27;choices&#x27;</span>: [&#123;<span class="string">&#x27;index&#x27;</span>: <span class="number">0</span>,<span class="string">&#x27;delta&#x27;</span>: &#123;<span class="string">&#x27;content&#x27;</span>: chunk&#125;</span>,&#x27;finish_reason&#x27;: None&#125;]&#125;)&#125;\n\n&quot;</span></span><br><span class="line">                <span class="comment"># æµç»“æŸçš„æœ€åä¸€å—</span></span><br><span class="line">                <span class="keyword">yield</span> <span class="string">f&quot;data: <span class="subst">&#123;json.dumps(&#123;<span class="string">&#x27;id&#x27;</span>: chunk_id,<span class="string">&#x27;object&#x27;</span>: <span class="string">&#x27;chat.completion.chunk&#x27;</span>,<span class="string">&#x27;created&#x27;</span>: <span class="built_in">int</span>(time.time()),<span class="string">&#x27;choices&#x27;</span>: [&#123;<span class="string">&#x27;index&#x27;</span>: <span class="number">0</span>,<span class="string">&#x27;delta&#x27;</span>: &#123;&#125;</span>,&#x27;finish_reason&#x27;: &#x27;stop&#x27;&#125;]&#125;)&#125;\n\n&quot;</span></span><br><span class="line">            <span class="comment"># è¿”å›fastapi.responsesä¸­StreamingResponseå¯¹è±¡</span></span><br><span class="line">            <span class="keyword">return</span> StreamingResponse(generate_stream(), media_type=<span class="string">&quot;text/event-stream&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¤„ç†éæµå¼å“åº”å¤„ç†</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                events = graph.stream(&#123;<span class="string">&quot;messages&quot;</span>: prompt&#125;, config)</span><br><span class="line">                <span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">                    <span class="keyword">for</span> value <span class="keyword">in</span> event.values():</span><br><span class="line">                        result = value[<span class="string">&quot;messages&quot;</span>][-<span class="number">1</span>].content</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logger.info(<span class="string">f&quot;Error processing response: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            formatted_response = <span class="built_in">str</span>(format_response(result))</span><br><span class="line">            logger.info(<span class="string">f&quot;æ ¼å¼åŒ–çš„æœç´¢ç»“æœ: <span class="subst">&#123;formatted_response&#125;</span>&quot;</span>)</span><br><span class="line">			<span class="comment">#å°è£…å“åº”</span></span><br><span class="line">            response = ChatCompletionResponse(</span><br><span class="line">                choices=[</span><br><span class="line">                    ChatCompletionResponseChoice(</span><br><span class="line">                        index=<span class="number">0</span>,</span><br><span class="line">                        message=Message(role=<span class="string">&quot;assistant&quot;</span>, content=formatted_response),</span><br><span class="line">                        finish_reason=<span class="string">&quot;stop&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            logger.info(<span class="string">f&quot;å‘é€å“åº”å†…å®¹: \n<span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># è¿”å›fastapi.responsesä¸­JSONResponseå¯¹è±¡</span></span><br><span class="line">            <span class="comment"># model_dump()æ–¹æ³•é€šå¸¸ç”¨äºå°†Pydanticæ¨¡å‹å®ä¾‹çš„å†…å®¹è½¬æ¢ä¸ºä¸€ä¸ªæ ‡å‡†çš„Pythonå­—å…¸ï¼Œä»¥ä¾¿è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line">            <span class="keyword">return</span> JSONResponse(content=response.model_dump())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;å¤„ç†èŠå¤©å®Œæˆæ—¶å‡ºé”™:\n\n <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">500</span>, detail=<span class="built_in">str</span>(e))</span><br></pre></td></tr></table></figure>
<h3 id="langgraphçš„çŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†"><a href="#langgraphçš„çŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†" class="headerlink" title="langgraphçš„çŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†"></a>langgraphçš„çŸ­æœŸè®°å¿†ä¸é•¿æœŸè®°å¿†</h3><p>LangGraphæ”¯æŒä¸¤ç§å¯¹äºæ„å»ºå¯¹è¯ä»£ç†è‡³å…³é‡è¦çš„å†…å­˜ç±»å‹ï¼š</p>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/agents/memory/#short-term-memory">çŸ­æœŸå†…å­˜</a></strong>ï¼šé€šè¿‡åœ¨ä¼šè¯ä¸­ç»´æŠ¤æ¶ˆæ¯å†å²æ¥è·Ÿè¸ªæ­£åœ¨è¿›è¡Œçš„å¯¹è¯ã€‚</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.langchain.ac.cn/langgraph/agents/memory/#long-term-memory">é•¿æœŸå†…å­˜</a></strong>ï¼šåœ¨ä¸åŒä¼šè¯ä¹‹é—´å­˜å‚¨ç”¨æˆ·ç‰¹å®šæˆ–åº”ç”¨ç¨‹åºçº§åˆ«çš„æ•°æ®ã€‚</li>
</ul>
<p><img src="/2025/07/14/%E5%AD%A6%E4%B9%A0/ai%E6%A1%86%E6%9E%B6/LangGraphChatBot/image-20250715094855646.png" alt="image-20250715094855646"></p>
<p>åœ¨LangGraphä¸­</p>
<ul>
<li><em>çŸ­æœŸå†…å­˜</em>ä¹Ÿç§°ä¸º<strong>çº¿ç¨‹çº§å†…å­˜</strong>ã€‚</li>
<li><em>é•¿æœŸå†…å­˜</em>ä¹Ÿç§°ä¸º<strong>è·¨çº¿ç¨‹å†…å­˜</strong>ã€‚</li>
</ul>
<h3 id="æ•™ç¨‹åœ°å€"><a href="#æ•™ç¨‹åœ°å€" class="headerlink" title="æ•™ç¨‹åœ°å€"></a>æ•™ç¨‹åœ°å€</h3><p><a target="_blank" rel="noopener" href="https://github.com/NanGePlus/LangGraphChatBot">NanGePlus/LangGraphChatBot: ä½¿ç”¨LangGraph+DeepSeek-R1+FastAPI+Gradioå®ç°ä¸€ä¸ªå¸¦æœ‰è®°å¿†åŠŸèƒ½çš„æµé‡åŒ…æ¨èæ™ºèƒ½å®¢æœwebç«¯ç”¨ä¾‹,åŒæ—¶ä¹Ÿæ”¯æŒgptå¤§æ¨¡å‹ã€å›½äº§å¤§æ¨¡å‹(OneApiæ–¹å¼)ã€Ollamaæœ¬åœ°å¼€æºå¤§æ¨¡å‹ã€é˜¿é‡Œé€šä¹‰åƒé—®å¤§æ¨¡å‹</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1m89NYKE2J/?vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">LangGraph+deepseek-r1+FastAPI+Gradioå®ç°æ‹¥æœ‰è®°å¿†çš„æµé‡åŒ…æ¨èæ™ºèƒ½å®¢æœwebç«¯ç”¨ä¾‹,åŒæ—¶ä¹Ÿæ”¯æŒgptã€å›½äº§å¤§æ¨¡å‹ã€Ollama_å“”å“©å“”å“©_bilibili</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/13/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/prompt%20Engineering%E4%B8%8Econtext%20Engineering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/13/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/prompt%20Engineering%E4%B8%8Econtext%20Engineering/" class="post-title-link" itemprop="url">prompt Engineeringä¸context Engineering</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-13 00:00:00 / ä¿®æ”¹æ—¶é—´ï¼š13:36:34" itemprop="dateCreated datePublished" datetime="2025-07-13T00:00:00+08:00">2025-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="prompt-Engineering"><a href="#prompt-Engineering" class="headerlink" title="prompt Engineering"></a>prompt Engineering</h3><p>Prompt Engineeringæ˜¯ä¸å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’çš„åŸºç¡€ï¼Œå…¶æ ¸å¿ƒåœ¨äºç²¾å¿ƒè®¾è®¡è¾“å…¥å†…å®¹ï¼Œä»¥å¼•å¯¼æ¨¡å‹ç”ŸæˆæœŸæœ›çš„è¾“å‡ºã€‚</p>
<p>å°½ç®¡ Prompt Engineering è‡³å…³é‡è¦ï¼Œä½†å¯¹äºæ„å»ºç¨³å¥ã€å¯ç”¨äºç”Ÿäº§ç¯å¢ƒçš„ç³»ç»Ÿè€Œè¨€ï¼Œå®ƒå­˜åœ¨å›ºæœ‰çš„å±€é™æ€§ï¼š</p>
<ul>
<li><p><strong>è„†å¼±æ€§&amp;ä¸å¯å¤ç°æ€§ï¼š</strong> æç¤ºä¸­å¾®å°çš„æªè¾å˜åŒ–å¯èƒ½å¯¼è‡´è¾“å‡ºç»“æœçš„å·¨å¤§å·®å¼‚ï¼Œä½¿å¾—è¿™ä¸€è¿‡ç¨‹æ›´åƒæ˜¯ä¸€ç§ä¾èµ–åå¤è¯•é”™çš„â€œè‰ºæœ¯â€ï¼Œè€Œéå¯å¤ç°çš„â€œç§‘å­¦â€ ã€‚</p>
</li>
<li><p><strong>æ‰©å±•æ€§å·®ï¼š</strong> æ‰‹åŠ¨ã€è¿­ä»£åœ°ä¼˜åŒ–æç¤ºçš„è¿‡ç¨‹ï¼Œåœ¨é¢å¯¹å¤§é‡ç”¨æˆ·ã€å¤šæ ·åŒ–ç”¨ä¾‹å’Œä¸æ–­å‡ºç°çš„è¾¹ç¼˜æƒ…å†µæ—¶ï¼Œéš¾ä»¥æœ‰æ•ˆæ‰©å±• ã€‚</p>
</li>
<li><p><strong>ç”¨æˆ·è´Ÿæ‹…ï¼š</strong> è¿™ç§æ–¹æ³•å°†ç²¾å¿ƒæ„å»ºä¸€å¥—è¯¦å°½æŒ‡ä»¤çš„è´Ÿæ‹…å®Œå…¨å‹åœ¨äº†ç”¨æˆ·èº«ä¸Šï¼Œå¯¹äºéœ€è¦è‡ªä¸»è¿è¡Œã€æˆ–å¤„ç†é«˜å¹¶å‘è¯·æ±‚çš„ç³»ç»Ÿè€Œè¨€æ˜¯ä¸åˆ‡å®é™…çš„ ã€‚</p>
</li>
<li><p><strong>æ— çŠ¶æ€æ€§ï¼š</strong> Prompt Engineering æœ¬è´¨ä¸Šæ˜¯ä¸ºå•è½®ã€â€œä¸€æ¬¡æ€§â€çš„äº¤äº’è€Œè®¾è®¡çš„ï¼Œéš¾ä»¥å¤„ç†éœ€è¦è®°å¿†å’ŒçŠ¶æ€ç®¡ç†çš„é•¿å¯¹è¯æˆ–å¤šæ­¥éª¤ä»»åŠ¡ ã€‚</p>
</li>
</ul>
<h3 id="Context-Engineering"><a href="#Context-Engineering" class="headerlink" title="Context Engineering"></a>Context Engineering</h3><p><strong>Context Engineeringæ˜¯ä¸€é—¨è®¾è®¡ã€æ„å»ºå¹¶ä¼˜åŒ–åŠ¨æ€è‡ªåŠ¨åŒ–ç³»ç»Ÿçš„å­¦ç§‘ï¼Œæ—¨åœ¨ä¸ºå¤§å‹è¯­è¨€æ¨¡å‹åœ¨æ­£ç¡®çš„æ—¶é—´ã€ä»¥æ­£ç¡®çš„æ ¼å¼ï¼Œæä¾›æ­£ç¡®çš„ä¿¡æ¯å’Œå·¥å…·ï¼Œä»è€Œå¯é ã€å¯æ‰©å±•åœ°å®Œæˆå¤æ‚ä»»åŠ¡</strong> ã€‚</p>
<p><strong>prompt å‘Šè¯‰æ¨¡å‹å¦‚ä½•æ€è€ƒï¼Œè€Œ Context åˆ™èµ‹äºˆæ¨¡å‹å®Œæˆå·¥ä½œæ‰€éœ€çš„çŸ¥è¯†å’Œå·¥å…·ã€‚</strong></p>
<ul>
<li><p>Context Engineering å†³å®š<strong>ç”¨ä»€ä¹ˆå†…å®¹å¡«å…… Context Window</strong> ï¼Œ</p>
</li>
<li><p>Prompt Engineering åˆ™è´Ÿè´£ä¼˜åŒ–<strong>çª—å£å†…çš„å…·ä½“æŒ‡ä»¤</strong> ã€‚</p>
</li>
</ul>
<h3 id="Context-Engineering-çš„åŸºçŸ³ï¼šRAGï¼ˆRetrieval-Augmented-Generationï¼‰"><a href="#Context-Engineering-çš„åŸºçŸ³ï¼šRAGï¼ˆRetrieval-Augmented-Generationï¼‰" class="headerlink" title="Context Engineering çš„åŸºçŸ³ï¼šRAGï¼ˆRetrieval-Augmented Generationï¼‰"></a>Context Engineering çš„åŸºçŸ³ï¼šRAGï¼ˆRetrieval-Augmented Generationï¼‰</h3><p>æœ¬éƒ¨åˆ†å°†é˜è¿°æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ä½œä¸ºå®ç° Context Engineering çš„ä¸»è¦æ¶æ„æ¨¡å¼ã€‚</p>
<h4 id="è§£å†³LLMçš„æ ¸å¿ƒå¼±ç‚¹"><a href="#è§£å†³LLMçš„æ ¸å¿ƒå¼±ç‚¹" class="headerlink" title="è§£å†³LLMçš„æ ¸å¿ƒå¼±ç‚¹"></a>è§£å†³LLMçš„æ ¸å¿ƒå¼±ç‚¹</h4><p>RAGç›´æ¥è§£å†³äº†æ ‡å‡†LLMåœ¨ä¼ä¸šåº”ç”¨ä¸­å­˜åœ¨çš„å›ºæœ‰å±€é™æ€§ï¼š</p>
<ul>
<li><p><strong>çŸ¥è¯†å†»ç»“ï¼š</strong> LLMçš„çŸ¥è¯†è¢«å†»ç»“åœ¨<strong>å…¶è®­ç»ƒæ•°æ®çš„æ—¶é—´ç‚¹</strong>ã€‚RAGé€šè¿‡åœ¨æ¨ç†æ—¶æ³¨å…¥å®æ—¶çš„ã€æœ€æ–°çš„ä¿¡æ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ ã€‚</p>
</li>
<li><p><strong>ç¼ºä¹é¢†åŸŸä¸“æœ‰çŸ¥è¯†ï¼š</strong> æ ‡å‡†LLMæ— æ³•è®¿é—®ç»„ç»‡çš„å†…éƒ¨ç§æœ‰æ•°æ®ã€‚RAGåˆ™èƒ½å¤Ÿå°†LLMè¿æ¥åˆ°è¿™äº›å†…éƒ¨çŸ¥è¯†åº“ï¼Œå¦‚æŠ€æœ¯æ‰‹å†Œã€æ”¿ç­–æ–‡ä»¶ç­‰ ã€‚</p>
</li>
<li><p><strong>å¹»è§‰ï¼ˆHallucinationï¼‰ï¼š</strong> LLM ä¼šä¸åŒç¨‹åº¦ä¸Šåœ°ç¼–é€ äº‹å®ã€‚RAGé€šè¿‡å°†æ¨¡å‹çš„å›ç­”â€œé”šå®šâ€åœ¨å¯éªŒè¯çš„ã€æ£€ç´¢åˆ°çš„è¯æ®ä¸Šï¼Œæé«˜äº‹å®çš„å‡†ç¡®æ€§å’Œå¯ä¿¡åº¦ ã€‚</p>
</li>
</ul>
<h4 id="RAGå·¥ä½œæµ"><a href="#RAGå·¥ä½œæµ" class="headerlink" title="RAGå·¥ä½œæµ"></a>RAGå·¥ä½œæµ</h4><ol>
<li><p><strong>ç´¢å¼•ï¼ˆç¦»çº¿é˜¶æ®µï¼‰ï¼š</strong> åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç³»ç»Ÿä¼šå¤„ç†å¤–éƒ¨çŸ¥è¯†æºã€‚æ–‡æ¡£è¢«åŠ è½½ã€åˆ†å‰²æˆæ›´å°çš„ chunksï¼Œç„¶åé€šè¿‡Embedding Model è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œå¹¶æœ€ç»ˆå­˜å‚¨åœ¨ä¸“é—¨çš„å‘é‡æ•°æ®åº“ä¸­ä»¥å¤‡æ£€ç´¢ ã€‚</p>
</li>
<li><p><strong>æ¨ç†ï¼ˆåœ¨çº¿é˜¶æ®µï¼‰ï¼š</strong> å½“ç”¨æˆ·æå‡ºè¯·æ±‚æ—¶ï¼Œç³»ç»Ÿæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ£€ç´¢ï¼ˆRetrieveï¼‰ï¼š</strong> å°†ç”¨æˆ·çš„æŸ¥è¯¢åŒæ ·è½¬æ¢ä¸ºå‘é‡ï¼Œç„¶ååœ¨å‘é‡æ•°æ®åº“ä¸­è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œæ‰¾å‡ºä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£å—ã€‚</li>
<li><strong>å¢å¼ºï¼ˆAugmentï¼‰ï¼š</strong> å°†æ£€ç´¢åˆ°çš„è¿™äº›æ–‡æ¡£å—ä¸åŸå§‹çš„ç”¨æˆ·æŸ¥è¯¢ã€ç³»ç»ŸæŒ‡ä»¤ç­‰ç»“åˆèµ·æ¥ï¼Œæ„å»ºä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„ã€å¢å¼ºçš„æœ€ç»ˆæç¤ºã€‚</li>
<li><strong>ç”Ÿæˆï¼ˆGenerateï¼‰ï¼š</strong> å°†è¿™ä¸ªå¢å¼ºåçš„æç¤ºè¾“å…¥ç»™LLMï¼ŒLLMä¼šåŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ç”Ÿæˆä¸€ä¸ªæœ‰ç†æœ‰æ®çš„å›ç­” ã€‚</li>
</ol>
</li>
</ol>
<h3 id="Context-å·¥ç¨‹åŒ–ï¼šå¦‚ä½•åˆ¤æ–­å’Œæå–å“ªäº›å†…å®¹åº”è¯¥è¿›å…¥ä¸Šä¸‹æ–‡ï¼Ÿ"><a href="#Context-å·¥ç¨‹åŒ–ï¼šå¦‚ä½•åˆ¤æ–­å’Œæå–å“ªäº›å†…å®¹åº”è¯¥è¿›å…¥ä¸Šä¸‹æ–‡ï¼Ÿ" class="headerlink" title="Context å·¥ç¨‹åŒ–ï¼šå¦‚ä½•åˆ¤æ–­å’Œæå–å“ªäº›å†…å®¹åº”è¯¥è¿›å…¥ä¸Šä¸‹æ–‡ï¼Ÿ"></a>Context å·¥ç¨‹åŒ–ï¼šå¦‚ä½•åˆ¤æ–­å’Œæå–å“ªäº›å†…å®¹åº”è¯¥è¿›å…¥ä¸Šä¸‹æ–‡ï¼Ÿ</h3><h4 id="1-chunking"><a href="#1-chunking" class="headerlink" title="1.chunking"></a>1.chunking</h4><p>æ–‡æœ¬åˆ†å—ï¼ˆChunkingï¼‰æ˜¯RAGæµç¨‹ä¸­æœ€å…³é”®ä¹Ÿæœ€å®¹æ˜“è¢«å¿½è§†çš„ä¸€æ­¥ã€‚å…¶ç›®æ ‡æ˜¯åˆ›å»ºåœ¨è¯­ä¹‰ä¸Šè‡ªæˆä¸€ä½“çš„æ–‡æœ¬å—ã€‚</p>
<h4 id="2-Reranking"><a href="#2-Reranking" class="headerlink" title="2.Reranking"></a>2.Reranking</h4><p>ä¸ºäº†å¹³è¡¡æ£€ç´¢çš„é€Ÿåº¦å’Œå‡†ç¡®æ€§ï¼Œä¸šç•Œæ™®éé‡‡ç”¨ä¸¤é˜¶æ®µæ£€ç´¢æµç¨‹ã€‚</p>
<ul>
<li><p><strong>ä¸¤é˜¶æ®µæµç¨‹ï¼š</strong></p>
<ul>
<li><strong>ç¬¬ä¸€é˜¶æ®µï¼ˆå¬å›ï¼‰ï¼š</strong> ä½¿ç”¨ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆçš„æ£€ç´¢å™¨ï¼ˆå¦‚åŸºäº bi-encoder çš„å‘é‡æœç´¢æˆ–BM25ç­‰è¯æ³•æœç´¢ï¼‰è¿›è¡Œå¹¿æ³›æ’’ç½‘ï¼Œå¬å›ä¸€ä¸ªè¾ƒå¤§çš„å€™é€‰æ–‡æ¡£é›†ï¼ˆä¾‹å¦‚ï¼Œå‰100ä¸ªï¼‰ ã€‚</li>
<li><strong>ç¬¬äºŒé˜¶æ®µï¼ˆç²¾æ’/é‡æ’åºï¼‰ï¼š</strong> ä½¿ç”¨ä¸€ä¸ªæ›´å¼ºå¤§ä½†è®¡ç®—æˆæœ¬æ›´é«˜çš„æ¨¡å‹ï¼Œå¯¹è¿™ä¸ªè¾ƒå°çš„å€™é€‰é›†è¿›è¡Œé‡æ–°è¯„ä¼°ï¼Œä»¥è¯†åˆ«å‡ºæœ€ç›¸å…³çš„å°‘æ•°å‡ ä¸ªæ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼Œå‰5ä¸ªï¼‰ ã€‚</li>
</ul>
</li>
<li><p><strong>Cross-Encoderï¼š</strong> äº¤å‰ç¼–ç å™¨ä¹‹æ‰€ä»¥åœ¨é‡æ’åºé˜¶æ®µè¡¨ç°ä¼˜è¶Šï¼Œæ˜¯å› ä¸ºå®ƒä¸åŒç¼–ç å™¨çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚åŒç¼–ç å™¨ç‹¬ç«‹åœ°ä¸ºæŸ¥è¯¢å’Œæ–‡æ¡£ç”ŸæˆåµŒå…¥å‘é‡ï¼Œç„¶åè®¡ç®—å®ƒä»¬çš„ç›¸ä¼¼åº¦ã€‚è€Œäº¤å‰ç¼–ç å™¨åˆ™æ˜¯å°†æŸ¥è¯¢å’Œæ–‡æ¡£<strong>åŒæ—¶</strong>ä½œä¸ºè¾“å…¥ï¼Œè®©æ¨¡å‹åœ¨å†…éƒ¨é€šè¿‡ Attention Mechanism å¯¹äºŒè€…è¿›è¡Œæ·±åº¦äº¤äº’ã€‚è¿™ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ•æ‰åˆ°æ›´ç»†å¾®çš„è¯­ä¹‰å…³ç³»ï¼Œä»è€Œç»™å‡ºæ›´å‡†ç¡®çš„ç›¸å…³æ€§è¯„åˆ† ã€‚</p>
</li>
<li><p><strong>å®é™…å½±å“ï¼š</strong> é‡æ’åºæ˜¾è‘—æé«˜äº†æœ€ç»ˆé€å…¥LLMçš„ä¸Šä¸‹æ–‡è´¨é‡ï¼Œä»è€Œäº§å‡ºæ›´å‡†ç¡®ã€å¹»è§‰æ›´å°‘çš„ç­”æ¡ˆã€‚åœ¨é‡‘èã€æ³•å¾‹ç­‰é«˜é£é™©é¢†åŸŸï¼Œé‡æ’åºè¢«è®¤ä¸ºæ˜¯å¿…ä¸å¯å°‘è€Œéå¯é€‰çš„æ­¥éª¤ ã€‚</p>
</li>
</ul>
<h4 id="3-ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ï¼šå‹ç¼©ä¸æ‘˜è¦"><a href="#3-ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ï¼šå‹ç¼©ä¸æ‘˜è¦" class="headerlink" title="3.ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ï¼šå‹ç¼©ä¸æ‘˜è¦"></a>3.ä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ï¼šå‹ç¼©ä¸æ‘˜è¦</h4><p>æœ¬èŠ‚è¯¦ç»†ä»‹ç»ç”¨äºä¸»åŠ¨ç®¡ç†ä¸Šä¸‹æ–‡çš„æŠ€æœ¯ï¼Œç¡®ä¿æœ€æœ‰ä»·å€¼çš„ä¿¡æ¯è¢«ä¼˜å…ˆå‘ˆç°ã€‚</p>
<ul>
<li><p><strong>ä¸Šä¸‹æ–‡å‹ç¼©çš„ç›®æ ‡ï¼š</strong> ç¼©çŸ­æ£€ç´¢åˆ°çš„æ–‡æ¡£åˆ—è¡¨å’Œ/æˆ–ç²¾ç®€å•ä¸ªæ–‡æ¡£çš„å†…å®¹ï¼Œåªå°†<strong>æœ€ç›¸å…³çš„ä¿¡æ¯ä¼ é€’ç»™LLM</strong>ã€‚è¿™èƒ½æœ‰æ•ˆé™ä½APIè°ƒç”¨æˆæœ¬ã€å‡å°‘å»¶è¿Ÿï¼Œå¹¶ç¼“è§£ Lost in the Middle çš„é—®é¢˜ ã€‚</p>
</li>
<li><p><strong>å‹ç¼©æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>è¿‡æ»¤å¼å‹ç¼©ï¼š</strong> è¿™ç±»æ–¹æ³•å†³å®šæ˜¯ä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒæ•´ä¸ªæ£€ç´¢åˆ°çš„æ–‡æ¡£ã€‚<ul>
<li><strong>LLMChainFilterï¼š</strong> åˆ©ç”¨ä¸€ä¸ªLLMå¯¹æ¯ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§åšå‡ºç®€å•çš„â€œæ˜¯/å¦â€åˆ¤æ–­ ã€‚</li>
<li><strong>EmbeddingsFilterï¼š</strong> æ›´ç»æµå¿«é€Ÿçš„æ–¹æ³•ï¼Œæ ¹æ®æ–‡æ¡£åµŒå…¥ä¸æŸ¥è¯¢åµŒå…¥çš„ä½™å¼¦ç›¸ä¼¼åº¦æ¥è¿‡æ»¤æ–‡æ¡£ ã€‚</li>
</ul>
</li>
<li><strong>å†…å®¹æå–å¼å‹ç¼©ï¼š</strong> è¿™ç±»æ–¹æ³•ä¼šç›´æ¥ä¿®æ”¹æ–‡æ¡£å†…å®¹ã€‚<ul>
<li><strong>LLMChainExtractorï¼š</strong> éå†æ¯ä¸ªæ–‡æ¡£ï¼Œå¹¶ä½¿ç”¨LLMä»ä¸­æå–ä»…ä¸æŸ¥è¯¢ç›¸å…³çš„å¥å­æˆ–é™ˆè¿° ã€‚</li>
</ul>
</li>
<li><strong>ç”¨ top N ä»£æ›¿å‹ç¼©ï¼š</strong> åƒLLMListwiseRerankè¿™æ ·çš„æŠ€æœ¯ï¼Œä½¿ç”¨LLMå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œé‡æ’åºï¼Œå¹¶åªè¿”å›æ’åæœ€é«˜çš„Nä¸ªï¼Œä»è€Œèµ·åˆ°é«˜è´¨é‡è¿‡æ»¤å™¨çš„ä½œç”¨ ã€‚</li>
</ul>
</li>
<li><p><strong>ä½œä¸ºå‹ç¼©ç­–ç•¥çš„æ‘˜è¦ï¼š</strong> å¯¹äºéå¸¸é•¿çš„æ–‡æ¡£æˆ–å†—é•¿çš„å¯¹è¯å†å²ï¼Œå¯ä»¥åˆ©ç”¨LLMç”Ÿæˆæ‘˜è¦ã€‚è¿™äº›æ‘˜è¦éšåè¢«æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œæ—¢ä¿ç•™äº†å…³é”®ä¿¡æ¯ï¼Œåˆå¤§å¹…å‡å°‘äº† Token æ•°é‡ã€‚è¿™æ˜¯åœ¨é•¿æ—¶ç¨‹è¿è¡Œçš„æ™ºèƒ½ä½“ä¸­ç®¡ç†ä¸Šä¸‹æ–‡çš„å…³é”®æŠ€æœ¯ ã€‚</p>
</li>
</ul>
<h3 id="æ™ºèƒ½ä½“æ¶æ„ä¸­çš„æ•°æ®æµä¸å·¥ä½œæµç¼–æ’"><a href="#æ™ºèƒ½ä½“æ¶æ„ä¸­çš„æ•°æ®æµä¸å·¥ä½œæµç¼–æ’" class="headerlink" title="æ™ºèƒ½ä½“æ¶æ„ä¸­çš„æ•°æ®æµä¸å·¥ä½œæµç¼–æ’"></a>æ™ºèƒ½ä½“æ¶æ„ä¸­çš„æ•°æ®æµä¸å·¥ä½œæµç¼–æ’</h3><h4 id="å·¥ä½œæµï¼ˆWorkflowï¼‰-vs-æ™ºèƒ½ä½“ï¼ˆAgentï¼‰"><a href="#å·¥ä½œæµï¼ˆWorkflowï¼‰-vs-æ™ºèƒ½ä½“ï¼ˆAgentï¼‰" class="headerlink" title="å·¥ä½œæµï¼ˆWorkflowï¼‰ vs. æ™ºèƒ½ä½“ï¼ˆAgentï¼‰"></a>å·¥ä½œæµï¼ˆWorkflowï¼‰ vs. æ™ºèƒ½ä½“ï¼ˆAgentï¼‰</h4><ul>
<li><p><strong>å·¥ä½œæµï¼ˆWorkflowsï¼‰</strong></p>
<ul>
<li>æŒ‡çš„æ˜¯LLMå’Œå·¥å…·é€šè¿‡<strong>é¢„å®šä¹‰çš„ä»£ç è·¯å¾„</strong>è¿›è¡Œç¼–æ’çš„ç³»ç»Ÿã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®æµåŠ¨çš„è·¯å¾„æ˜¯å›ºå®šçš„ã€ç”±å¼€å‘è€…æ˜ç¡®è®¾è®¡çš„ï¼Œç±»ä¼¼äºä¸Šä¸–çºªæµè¡Œçš„â€œä¸“å®¶ç³»ç»Ÿâ€ã€‚ä¾‹å¦‚ï¼Œâ€œç¬¬ä¸€æ­¥ï¼šåˆ†æç”¨æˆ·é‚®ä»¶ï¼›ç¬¬äºŒæ­¥ï¼šæ ¹æ®åˆ†æç»“æœåœ¨æ—¥å†ä¸­æŸ¥æ‰¾ç©ºé—²æ—¶æ®µï¼›ç¬¬ä¸‰æ­¥ï¼šèµ·è‰ä¼šè®®é‚€è¯·é‚®ä»¶â€ã€‚è¿™ç§æ¨¡å¼ç¡®å®šæ€§é«˜ï¼Œæ˜“äºè°ƒè¯•å’Œæ§åˆ¶ï¼Œéå¸¸é€‚åˆæœ‰æ˜ç¡®ä¸šåŠ¡æµç¨‹çš„åœºæ™¯ï¼ˆå¦‚é£æ§éœ€æ±‚é«˜ã€æ•°æ®æ•æ„Ÿã€å®‰å…¨ç­‰çº§è¦æ±‚ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>æ™ºèƒ½ä½“ï¼ˆAgentsï¼‰</strong></p>
<ul>
<li>æŒ‡çš„æ˜¯LLM<strong>åŠ¨æ€åœ°æŒ‡å¯¼</strong>è‡ªå·±çš„æµç¨‹å’Œå·¥å…·ä½¿ç”¨ï¼Œè‡ªä¸»æ§åˆ¶å¦‚ä½•å®Œæˆä»»åŠ¡çš„ç³»ç»Ÿã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ•°æ®æµåŠ¨çš„è·¯å¾„ä¸æ˜¯é¢„å…ˆå›ºå®šçš„ï¼Œè€Œæ˜¯ç”±LLMåœ¨æ¯ä¸€æ­¥æ ¹æ®å½“å‰æƒ…å†µå’Œç›®æ ‡åŠ¨æ€å†³å®šçš„ã€‚è¿™ç§æ¨¡å¼çµæ´»æ€§é«˜ï¼Œèƒ½å¤„ç†å¼€æ”¾å¼é—®é¢˜ï¼Œä½†å¯æ§æ€§å’Œå¯é¢„æµ‹æ€§è¾ƒä½ ã€‚</li>
</ul>
</li>
</ul>
<p>å¤æ‚çš„æ™ºèƒ½ä½“é€šå¸¸æ˜¯è¿™ä¸¤ç§æ¨¡å¼çš„æ··åˆä½“ï¼Œåœ¨å®è§‚å±‚é¢éµå¾ªä¸€ä¸ªé¢„å®šä¹‰çš„å·¥ä½œæµï¼Œä½†åœ¨æŸäº›èŠ‚ç‚¹å†…éƒ¨ï¼Œåˆèµ‹äºˆLLMä¸€å®šçš„è‡ªä¸»å†³ç­–æƒã€‚ç®¡ç†è¿™ä¸€åˆ‡çš„æ ¸å¿ƒï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>ç¼–æ’å±‚ï¼ˆOrchestration Layerï¼‰</strong> ã€‚</p>
<h4 id="æ ¸å¿ƒæ¶æ„ï¼šé¢„å®šä¹‰æ•°æ®æµçš„å®ç°"><a href="#æ ¸å¿ƒæ¶æ„ï¼šé¢„å®šä¹‰æ•°æ®æµçš„å®ç°" class="headerlink" title="æ ¸å¿ƒæ¶æ„ï¼šé¢„å®šä¹‰æ•°æ®æµçš„å®ç°"></a><strong>æ ¸å¿ƒæ¶æ„ï¼šé¢„å®šä¹‰æ•°æ®æµçš„å®ç°</strong></h4><ol>
<li><p><strong>é“¾å¼å·¥ä½œæµï¼ˆPrompt Chainingï¼‰</strong></p>
</li>
<li><p><strong>è·¯ç”±å·¥ä½œæµï¼ˆRouting)</strong></p>
</li>
<li><p><strong>ç¼–æ’å™¨-å·¥ä½œè€…æ¨¡å¼ï¼ˆOrchestrator-Workersï¼‰</strong></p>
</li>
</ol>
<h4 id="æ¡†æ¶ä¸å·¥å…·"><a href="#æ¡†æ¶ä¸å·¥å…·" class="headerlink" title="æ¡†æ¶ä¸å·¥å…·"></a>æ¡†æ¶ä¸å·¥å…·</h4><p>ä¸Šè¿°çš„æ¶æ„å’Œæœºåˆ¶å¹¶éå‡­ç©ºå­˜åœ¨ï¼Œè€Œæ˜¯é€šè¿‡å…·ä½“çš„å¼€å‘æ¡†æ¶å®ç°çš„ã€‚å…¶ä¸­ï¼ŒLangGraphä½œä¸ºLangChainçš„æ‰©å±•ï¼Œä¸ºæ„å»ºå…·æœ‰æ˜¾å¼æ•°æ®æµçš„æ™ºèƒ½ä½“ç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„å·¥å…·é›†ã€‚</p>
<p><strong>LangGraphï¼šç”¨å›¾ï¼ˆGraphï¼‰å®šä¹‰å·¥ä½œæµï¼ˆWorkflowï¼‰</strong></p>
<p>LangGraphçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ™ºèƒ½ä½“åº”ç”¨æ„å»ºæˆä¸€ä¸ª<strong>çŠ¶æ€å›¾ï¼ˆState Graphï¼‰</strong> ã€‚è¿™ä¸ªå›¾ç”±èŠ‚ç‚¹å’Œè¾¹ç»„æˆï¼Œæ¸…æ™°åœ°å®šä¹‰äº†æ•°æ®å¦‚ä½•åœ¨ä¸åŒæ¨¡å—é—´æµåŠ¨</p>
<ul>
<li><p><strong>çŠ¶æ€ï¼ˆStateï¼‰ï¼š</strong> è¿™æ˜¯æ•´ä¸ªå›¾çš„æ ¸å¿ƒï¼Œä¸€ä¸ªæ‰€æœ‰èŠ‚ç‚¹å…±äº«çš„ä¸­å¤®æ•°æ®å¯¹è±¡ã€‚</p>
<ul>
<li>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªâ€œæ•°æ®æ€»çº¿â€æˆ–å…±äº«å†…å­˜ã€‚å¼€å‘è€…éœ€è¦é¢„å…ˆå®šä¹‰Stateçš„ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨æ‰§è¡Œæ—¶éƒ½å¯ä»¥è¯»å–å’Œæ›´æ–°è¿™ä¸ªStateå¯¹è±¡ ã€‚</li>
</ul>
</li>
<li><p><strong>èŠ‚ç‚¹ï¼ˆNodesï¼‰ï¼š</strong> ä»£è¡¨å·¥ä½œæµä¸­çš„ä¸€ä¸ªè®¡ç®—å•å…ƒæˆ–ä¸€ä¸ªæ­¥éª¤ã€‚</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹é€šå¸¸æ˜¯ä¸€ä¸ªPythonå‡½æ•°ï¼Œå®ƒæ¥æ”¶å½“å‰çš„Stateä½œä¸ºè¾“å…¥ï¼Œæ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼ˆå¦‚è°ƒç”¨LLMã€æ‰§è¡Œå·¥å…·ã€å¤„ç†æ•°æ®ï¼‰ï¼Œç„¶åè¿”å›å¯¹Stateçš„æ›´æ–° ã€‚</li>
</ul>
</li>
<li><p><strong>è¾¹ï¼ˆEdgesï¼‰</strong>ï¼š è¿æ¥èŠ‚ç‚¹ï¼Œå®šä¹‰äº†å·¥ä½œæµçš„è·¯å¾„ï¼Œå³æ•°æ®åœ¨Stateæ›´æ–°ååº”è¯¥æµå‘å“ªä¸ªèŠ‚ç‚¹ã€‚</p>
<ul>
<li><strong>ç®€å•è¾¹ï¼ˆSimple Edgesï¼‰ï¼š</strong> å®šä¹‰äº†å›ºå®šçš„ã€æ— æ¡ä»¶çš„æµå‘ï¼Œç”¨äºå®ç°é“¾å¼å·¥ä½œæµ ã€‚</li>
<li><strong>æ¡ä»¶è¾¹ï¼ˆConditional Edgesï¼‰ï¼š</strong> ç”¨äºå®ç°è·¯ç”±é€»è¾‘ã€‚å®ƒä¼šæ ¹æ®ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ¥å†³å®šæ¥ä¸‹æ¥åº”è¯¥èµ°å‘å“ªä¸ªèŠ‚ç‚¹ï¼Œä»è€Œå®ç°æµç¨‹çš„åˆ†æ”¯ ã€‚</li>
</ul>
</li>
<li><p><strong>æ£€æŸ¥ç‚¹ï¼ˆCheckpointerï¼‰ï¼š</strong> LangGraphæä¾›äº†æŒä¹…åŒ–æœºåˆ¶ï¼Œå¯ä»¥åœ¨æ¯ä¸€æ­¥æ‰§è¡Œåè‡ªåŠ¨ä¿å­˜Stateçš„çŠ¶æ€ã€‚è¿™å¯¹äºæ„å»ºéœ€è¦é•¿æœŸè®°å¿†ã€å¯ä¸­æ–­å’Œæ¢å¤ã€æˆ–éœ€è¦ Human-in-the-Loop çš„å¤æ‚ä¸šåŠ¡æµç¨‹è‡³å…³é‡è¦ ã€‚</p>
</li>
</ul>
<p>å¤æ‚ä¸šåŠ¡æµç¨‹çš„AIæ™ºèƒ½ä½“ï¼Œå…¶æ ¸å¿ƒæŒ‘æˆ˜å·²ä»å•çº¯ä¼˜åŒ–ä¿¡æ¯æ£€ç´¢ï¼ˆå¦‚RAGï¼‰æˆ–æç¤ºè¯ï¼Œè½¬å‘äº†å¯¹å†…éƒ¨<strong>å·¥ä½œæµå’Œæ•°æ®æµçš„ç²¾å¿ƒè®¾è®¡ä¸ç¼–æ’</strong>ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/" class="post-title-link" itemprop="url">ragä¸æ£€ç´¢è¯„ä¼°</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-11 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-11T00:00:00+08:00">2025-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-18 09:54:44" itemprop="dateModified" datetime="2025-08-18T09:54:44+08:00">2025-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="ragè¯„ä¼°çš„æŒ‡æ ‡"><a href="#ragè¯„ä¼°çš„æŒ‡æ ‡" class="headerlink" title="ragè¯„ä¼°çš„æŒ‡æ ‡"></a>ragè¯„ä¼°çš„æŒ‡æ ‡</h3><h4 id="å¿ è¯šåº¦Faithfulness"><a href="#å¿ è¯šåº¦Faithfulness" class="headerlink" title="å¿ è¯šåº¦Faithfulness"></a>å¿ è¯šåº¦Faithfulness</h4><p>Faithfulnessï¼šè¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸ç»™å®šä¸Šä¸‹æ–‡ä¹‹é—´çš„äº‹å®ä¸€è‡´æ€§ã€‚å¿ å®åº¦å¾—åˆ†æ˜¯åŸºäºç­”æ¡ˆå’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡<br>è®¡ç®—å‡ºæ¥çš„ï¼Œç­”æ¡ˆçš„è¯„åˆ†èŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œåˆ†æ•°è¶Šé«˜è¶Šå¥½ã€‚</p>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711154457878.png" alt="image-20250711154457878"></p>
<p>è®¡ç®—æ–¹å¼ï¼šå°†å¤§æ¨¡å‹ç»™å‡ºçš„ç­”æ¡ˆè¿›è¡Œåˆ‡ç‰‡ï¼Œæ£€ç´¢ç»™å‡ºçš„ä¸Šä¸‹æ–‡ï¼Œè®¡ç®—è¿™äº›åˆ‡ç‰‡æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­</p>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711155257239.png" alt="image-20250711155257239"></p>
<h4 id="ç­”æ¡ˆç›¸å…³æ€§Answerrelevance"><a href="#ç­”æ¡ˆç›¸å…³æ€§Answerrelevance" class="headerlink" title="ç­”æ¡ˆç›¸å…³æ€§Answerrelevance"></a>ç­”æ¡ˆç›¸å…³æ€§Answerrelevance</h4><p>Answerrelevanceï¼šç­”æ¡ˆç›¸å…³æ€§çš„è¯„ä¼°æŒ‡æ ‡æ—¨åœ¨è¯„ä¼°ç”Ÿæˆçš„ç­”æ¡ˆä¸ç»™å®šæç¤ºçš„ç›¸å…³ç¨‹åº¦ã€‚å¦‚æœç­”æ¡ˆä¸å®Œ<br>æ•´æˆ–åŒ…å«å†—ä½™ä¿¡æ¯ï¼Œåˆ™ä¼šè¢«èµ‹äºˆè¾ƒä½çš„åˆ†æ•°ã€‚è¿™ä¸ªæŒ‡æ ‡ä½¿ç”¨é—®é¢˜å’Œç­”æ¡ˆæ¥è®¡ç®—ï¼Œå…¶å€¼ä»‹äº0åˆ°1ä¹‹é—´ï¼Œå¾—<br>åˆ†è¶Šé«˜è¡¨æ˜ç­”æ¡ˆçš„ç›¸å…³æ€§è¶Šå¥½</p>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711155128553.png" alt="image-20250711155128553"></p>
<p>è®¡ç®—æ–¹å¼ï¼šæ ¹æ®ç­”æ¡ˆç”Ÿæˆå¤šä¸ªé—®é¢˜ï¼Œç„¶åè®¡ç®—ç”Ÿæˆçš„ç­”æ¡ˆä¸åŸç­”æ¡ˆçš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå†å–å¹³å‡</p>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250711155407518.png" alt="image-20250711155407518"></p>
<h4 id="ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ContextPrecision"><a href="#ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ContextPrecision" class="headerlink" title="ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ContextPrecision"></a>ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦ContextPrecision</h4><p>ContextPrecisionï¼šä¸Šä¸‹æ–‡ç²¾ç¡®åº¦è¡¡é‡ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰ç›¸å…³çš„çœŸå®ä¿¡æ¯æ˜¯å¦è¢«æ’åœ¨äº†è¾ƒé«˜çš„ä½ç½®ã€‚ç†æƒ³æƒ…<br>å†µä¸‹ï¼Œæ‰€æœ‰ç›¸å…³çš„ä¿¡æ¯å—éƒ½åº”è¯¥å‡ºç°åœ¨æ’åçš„æœ€å‰é¢ã€‚è¿™ä¸ªæŒ‡æ ‡æ˜¯æ ¹æ®é—®é¢˜å’Œä¸Šä¸‹æ–‡æ¥è®¡ç®—çš„ï¼Œæ•°å€¼èŒƒ<br>å›´åœ¨0åˆ°1ä¹‹é—´ï¼Œåˆ†æ•°è¶Šé«˜è¡¨ç¤ºç²¾ç¡®åº¦è¶Šå¥½ã€‚</p>
<script type="math/tex; mode=display">
\text{Context Precision} = \frac{\sum_{k=1}^{K} (\text{rel}(k) \times \frac{\text{Precision@k}}{\text{Ideal Precision@k}})}{\text{Total Relevant Documents}}</script><ul>
<li><code>K</code>ï¼šæ£€ç´¢è¿”å›çš„æ–‡æ¡£æ€»æ•°ï¼ˆå¦‚ top-5ï¼‰</li>
<li><code>rel(k)</code>ï¼šç¬¬ <code>k</code> ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸å…³ï¼ˆç›¸å…³=1ï¼Œæ— å…³=0ï¼‰</li>
<li><code>Precision@k</code>ï¼šå‰ <code>k</code> ä¸ªæ–‡æ¡£çš„ç²¾ç¡®ç‡ï¼ˆç›¸å…³æ–‡æ¡£æ•° / kï¼‰</li>
<li><code>Ideal Precision@k</code>ï¼šç†æƒ³æƒ…å†µä¸‹å‰ <code>k</code> ä¸ªæ–‡æ¡£çš„ç²¾ç¡®ç‡ï¼ˆå‡è®¾æ‰€æœ‰ç›¸å…³æ–‡æ¡£éƒ½æ’åœ¨æœ€å‰é¢ï¼‰</li>
</ul>
<h4 id="ä¸Šä¸‹æ–‡å¬å›ç‡ContextRecall"><a href="#ä¸Šä¸‹æ–‡å¬å›ç‡ContextRecall" class="headerlink" title="ä¸Šä¸‹æ–‡å¬å›ç‡ContextRecall"></a>ä¸Šä¸‹æ–‡å¬å›ç‡ContextRecall</h4><p>ContextRecallï¼šç”¨æ¥è¡¡é‡æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸è¢«è§†ä¸ºäº‹å®çœŸç›¸çš„æ ‡æ³¨ç­”æ¡ˆçš„ä¸€è‡´æ€§ç¨‹åº¦ã€‚å®ƒæ ¹æ®äº‹å®çœŸç›¸<br>å’Œæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ¥è®¡ç®—ï¼Œæ•°å€¼èŒƒå›´åœ¨0åˆ°1ä¹‹é—´ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºæ€§èƒ½è¶Šå¥½ã€‚<br>ä¸ºäº†ä»äº‹å®çœŸç›¸çš„ç­”æ¡ˆä¸­ä¼°è®¡ä¸Šä¸‹æ–‡å¬å›ç‡ï¼Œéœ€è¦åˆ†æç­”æ¡ˆä¸­çš„æ¯ä¸ªå¥å­æ˜¯å¦å¯ä»¥å½’å› äºæ£€ç´¢åˆ°çš„<br>ä¸Šä¸‹æ–‡ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œäº‹å®çœŸç›¸ç­”æ¡ˆä¸­çš„æ‰€æœ‰å¥å­éƒ½åº”è¯¥èƒ½å¤Ÿå¯¹åº”åˆ°æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸­ã€‚</p>
<script type="math/tex; mode=display">
\text{Context Recall} = \frac{|\{\text{è¿”å›çš„ç›¸å…³æ–‡æ¡£}\} \cap \{\text{æ ‡å‡†ç›¸å…³æ–‡æ¡£}\}|}{|\{\text{æ ‡å‡†ç›¸å…³æ–‡æ¡£}\}|}</script><p>è®¡ç®—æ–¹å¼ï¼šä¸Šä¸‹æ–‡æ˜¯å¦åŒ…æ‹¬äº†æ ‡å‡†ç­”æ¡ˆçš„å†…å®¹</p>
<h3 id="æ£€ç´¢æ€§èƒ½çš„è¯„ä¼°"><a href="#æ£€ç´¢æ€§èƒ½çš„è¯„ä¼°" class="headerlink" title="æ£€ç´¢æ€§èƒ½çš„è¯„ä¼°"></a>æ£€ç´¢æ€§èƒ½çš„è¯„ä¼°</h3><h4 id="å¹³å‡å€’æ•°æ’åï¼ˆMean-Reciprocal-Rank-MRRï¼‰"><a href="#å¹³å‡å€’æ•°æ’åï¼ˆMean-Reciprocal-Rank-MRRï¼‰" class="headerlink" title="å¹³å‡å€’æ•°æ’åï¼ˆMean Reciprocal Rank, MRRï¼‰"></a>å¹³å‡å€’æ•°æ’åï¼ˆMean Reciprocal Rank, MRRï¼‰</h4><p><strong>å¹³å‡å€’æ•°æ’åï¼ˆMean Reciprocal Rank, MRRï¼‰</strong> æ˜¯ä¸€ç§å¸¸ç”¨äºè¯„ä¼°ä¿¡æ¯æ£€ç´¢ç³»ç»Ÿã€æ¨èç³»ç»Ÿæˆ–é—®ç­”ç³»ç»Ÿæ€§èƒ½çš„è¯„ä»·æŒ‡æ ‡ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºâ€œæ¯ä¸ªæŸ¥è¯¢åªæœ‰ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆâ€æˆ–â€œæˆ‘ä»¬åªå…³å¿ƒç¬¬ä¸€ä¸ªæ­£ç¡®ç»“æœâ€çš„åœºæ™¯ã€‚</p>
<ul>
<li><p><strong>å€’æ•°æ’åï¼ˆReciprocal Rank, RRï¼‰</strong>ï¼šå¯¹äºä¸€ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆå‡ºç°åœ¨æ’åºç»“æœçš„ç¬¬ $ k $ ä½ï¼Œé‚£ä¹ˆå®ƒçš„å€’æ•°æ’åä¸ºï¼š</p>
<script type="math/tex; mode=display">
RR = \frac{1}{k}</script><p>å¦‚æœæ²¡æœ‰æ­£ç¡®ç­”æ¡ˆï¼Œåˆ™ $ RR = 0 $ã€‚</p>
</li>
<li><p><strong>å¹³å‡å€’æ•°æ’åï¼ˆMRRï¼‰</strong>ï¼šå¯¹å¤šä¸ªæŸ¥è¯¢çš„å€’æ•°æ’åå–å¹³å‡å€¼ï¼š</p>
<script type="math/tex; mode=display">
MRR = \frac{1}{|Q|} \sum_{i=1}^{|Q|} \frac{1}{\text{rank}_i}</script><p>å…¶ä¸­ï¼š</p>
<ul>
<li>$ |Q| $ æ˜¯æŸ¥è¯¢çš„æ€»æ•°ï¼Œ</li>
<li>$ \text{rank}_i $ æ˜¯ç¬¬ $ i $ ä¸ªæŸ¥è¯¢ä¸­ç¬¬ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆçš„æ’åï¼ˆä½ç½®ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250818093714324.png" alt="image-20250818093714324"></p>
<h4 id="å¹³å‡ç²¾ç¡®ç‡å‡å€¼ï¼ˆMean-Average-Precision-MAPï¼‰"><a href="#å¹³å‡ç²¾ç¡®ç‡å‡å€¼ï¼ˆMean-Average-Precision-MAPï¼‰" class="headerlink" title="å¹³å‡ç²¾ç¡®ç‡å‡å€¼ï¼ˆMean Average Precision, MAPï¼‰"></a>å¹³å‡ç²¾ç¡®ç‡å‡å€¼ï¼ˆMean Average Precision, MAPï¼‰</h4><p><strong>MAPï¼ˆMean Average Precisionï¼‰</strong> æ˜¯å¯¹å¤šä¸ªæŸ¥è¯¢æˆ–æ ·æœ¬çš„ <strong>å¹³å‡ç²¾ç¡®ç‡ï¼ˆAverage Precision, APï¼‰</strong> å–å¹³å‡ï¼Œç”¨æ¥è¡¡é‡æ’åºç»“æœçš„ç›¸å…³æ€§è´¨é‡ã€‚å®ƒç»¼åˆè€ƒè™‘äº†ï¼š</p>
<ul>
<li>æ’åºä¸­ç›¸å…³ç»“æœçš„æ•°é‡ï¼ˆå¬å›ï¼‰</li>
<li>ç›¸å…³ç»“æœåœ¨æ’åºä¸­çš„ä½ç½®ï¼ˆè¶Šé å‰è¶Šå¥½ï¼‰</li>
</ul>
<p><strong>å¹³å‡ç²¾ç¡®ç‡ï¼ˆAverage Precision, APï¼‰</strong></p>
<p>AP æ˜¯å¯¹ä¸€ä¸ªæŸ¥è¯¢è€Œè¨€çš„ï¼Œè¡¡é‡è¯¥æŸ¥è¯¢ä¸‹æ‰€æœ‰ç›¸å…³æ–‡æ¡£åœ¨æ’åºä¸­çš„æ•´ä½“è¡¨ç°ã€‚</p>
<blockquote>
<p><strong>ç›´è§‚ç†è§£</strong>ï¼šAP æ˜¯â€œåœ¨æ¯ä¸ªç›¸å…³æ–‡æ¡£è¢«æ£€ç´¢åˆ°æ—¶â€çš„ç²¾ç¡®ç‡çš„å¹³å‡å€¼ã€‚</p>
</blockquote>
<p>å…¬å¼å®šä¹‰ï¼š</p>
<script type="math/tex; mode=display">
AP = \frac{\sum_{k=1}^{n} (P(k) \times \text{rel}(k))}{\text{æ€»ç›¸å…³æ–‡æ¡£æ•°}}</script><p>å…¶ä¸­ï¼š</p>
<ul>
<li>$ P(k) $ï¼šåœ¨ç¬¬ $ k $ ä¸ªä½ç½®çš„ç²¾ç¡®ç‡ï¼ˆå³å‰ k ä¸ªç»“æœä¸­æœ‰å¤šå°‘æ˜¯ç›¸å…³çš„ï¼‰</li>
<li>$ \text{rel}(k) $ï¼šç¬¬ $ k $ ä¸ªæ–‡æ¡£æ˜¯å¦ç›¸å…³ï¼ˆ1 è¡¨ç¤ºç›¸å…³ï¼Œ0 è¡¨ç¤ºä¸ç›¸å…³ï¼‰</li>
</ul>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªåœ¨ç›¸å…³æ–‡æ¡£å‡ºç°çš„ä½ç½®è®¡ç®—å¹¶ç´¯åŠ ç²¾ç¡®ç‡ï¼Œæœ€åé™¤ä»¥æ€»ç›¸å…³æ–‡æ¡£æ•°ã€‚</p>
</blockquote>
<p><strong>å¹³å‡ç²¾ç¡®ç‡å‡å€¼ï¼ˆMAPï¼‰</strong></p>
<p>å°†æ‰€æœ‰æŸ¥è¯¢çš„ AP æ±‚å¹³å‡ï¼š</p>
<script type="math/tex; mode=display">
MAP = \frac{1}{|Q|} \sum_{i=1}^{|Q|} AP_i</script><p>å…¶ä¸­ï¼š</p>
<ul>
<li>$ |Q| $ï¼šæŸ¥è¯¢æ€»æ•°</li>
<li>$ AP_i $ï¼šç¬¬ $ i $ ä¸ªæŸ¥è¯¢çš„å¹³å‡ç²¾ç¡®ç‡</li>
</ul>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250818094149682.png" alt="image-20250818094149682"></p>
<h4 id="å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆNormalized-Discounted-Cumulative-Gain-nDCGï¼‰"><a href="#å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆNormalized-Discounted-Cumulative-Gain-nDCGï¼‰" class="headerlink" title="å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆNormalized Discounted Cumulative Gain, nDCGï¼‰"></a>å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆNormalized Discounted Cumulative Gain, nDCGï¼‰</h4><p>nDCG çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<ol>
<li><strong>é«˜ç›¸å…³æ€§çš„æ–‡æ¡£æ›´æœ‰ä»·å€¼</strong></li>
<li><strong>æ’åœ¨å‰é¢çš„ç»“æœæ¯”æ’åœ¨åé¢çš„ä»·å€¼æ›´é«˜</strong>ï¼ˆä½ç½®è¶Šé å‰ï¼Œæƒé‡è¶Šå¤§ï¼‰</li>
<li>å°†ç³»ç»Ÿçš„å¾—åˆ†ä¸â€œç†æƒ³æ’åºâ€å¯¹æ¯”ï¼Œè¿›è¡Œå½’ä¸€åŒ–ï¼Œä¾¿äºè·¨æŸ¥è¯¢æ¯”è¾ƒ</li>
</ol>
<p>1.<strong>ç´¯ç§¯å¢ç›Šï¼ˆCumulative Gain, CGï¼‰</strong></p>
<p>CG æ˜¯å‰ $ k $ ä¸ªç»“æœçš„ç›¸å…³æ€§è¯„åˆ†ä¹‹å’Œï¼Œ<strong>ä¸è€ƒè™‘ä½ç½®</strong>ã€‚</p>
<script type="math/tex; mode=display">
CG@k = \sum_{i=1}^{k} rel_i</script><p>å…¶ä¸­ $ rel_i $ æ˜¯ç¬¬ $ i $ ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§è¯„åˆ†ã€‚</p>
<blockquote>
<p>âŒ ç¼ºç‚¹ï¼šCG ä¸å…³å¿ƒæ’åºé¡ºåºã€‚æ— è®ºç›¸å…³æ–‡æ¡£æ’ç¬¬1è¿˜æ˜¯ç¬¬10ï¼ŒCG éƒ½ä¸€æ ·ã€‚</p>
</blockquote>
<ol>
<li><strong>æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆDiscounted Cumulative Gain, DCGï¼‰</strong></li>
</ol>
<p>DCG å¼•å…¥â€œä½ç½®æŠ˜æŸâ€ï¼šè¶Šé åçš„ç»“æœï¼Œå…¶è´¡çŒ®è¢«â€œæ‰“æŠ˜â€ã€‚</p>
<p>å¸¸ç”¨å…¬å¼ï¼ˆä¸¤ç§å½¢å¼ï¼Œç¬¬äºŒç§æ›´å¸¸è§ï¼‰ï¼š</p>
<script type="math/tex; mode=display">
DCG@k = \sum_{i=1}^{k} \frac{rel_i}{\log_2(i+1)} \quad \text{æˆ–}</script><script type="math/tex; mode=display">
DCG@k = rel_1 + \sum_{i=2}^{k} \frac{rel_i}{\log_2(i)} \quad \text{(æ›´å¸¸ç”¨)}</script><blockquote>
<p>ğŸ’¡ è§£é‡Šï¼šç¬¬1ä¸ªä½ç½®ä¸æ‰“æŠ˜ï¼Œç¬¬2ä¸ªä½ç½®é™¤ä»¥ $ \log_2(2) = 1 $ï¼Œç¬¬3ä¸ªä½ç½®é™¤ä»¥ $ \log_2(3) \approx 1.58 $ï¼Œç›¸å½“äºæ‰“äº†çº¦ 63% çš„æŠ˜æ‰£ã€‚</p>
</blockquote>
<p>è¿™æ ·ï¼Œ<strong>ç›¸å…³æ–‡æ¡£è¶Šæ—©å‡ºç°ï¼ŒDCG è¶Šé«˜</strong>ã€‚</p>
<ol>
<li><strong>ç†æƒ³æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆIdeal DCG, IDCGï¼‰</strong></li>
</ol>
<p>IDCG æ˜¯åœ¨<strong>ç†æƒ³æ’åºä¸‹</strong>ï¼ˆæ‰€æœ‰ç›¸å…³æ–‡æ¡£æŒ‰ç›¸å…³æ€§ä»é«˜åˆ°ä½æ’åˆ—ï¼‰çš„ DCG å€¼ã€‚</p>
<script type="math/tex; mode=display">
IDCG@k = \text{å°†å‰ } k \text{ ä¸ªæœ€ç›¸å…³æ–‡æ¡£æŒ‰æœ€ä¼˜é¡ºåºæ’åˆ—æ—¶çš„ } DCG</script><p>IDCG æ˜¯å½“å‰æŸ¥è¯¢ä¸‹ DCG çš„ç†è®ºæœ€å¤§å€¼ã€‚</p>
<ol>
<li><strong>å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Šï¼ˆnDCG@kï¼‰</strong></li>
</ol>
<script type="math/tex; mode=display">
nDCG@k = \frac{DCG@k}{IDCG@k}</script><blockquote>
<p>âœ… nDCG çš„å–å€¼èŒƒå›´æ˜¯ $[0, 1]$ï¼š</p>
<ul>
<li>1.0ï¼šæ’åºå®Œå…¨ç†æƒ³</li>
<li>æ¥è¿‘ 1ï¼šæ’åºè´¨é‡é«˜</li>
<li>æ¥è¿‘ 0ï¼šæ’åºå¾ˆå·®</li>
</ul>
</blockquote>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250818095351579.png" alt="image-20250818095351579"></p>
<h3 id="åˆ©ç”¨RAGASè¯„ä¼°ragæ€§èƒ½"><a href="#åˆ©ç”¨RAGASè¯„ä¼°ragæ€§èƒ½" class="headerlink" title="åˆ©ç”¨RAGASè¯„ä¼°ragæ€§èƒ½"></a>åˆ©ç”¨RAGASè¯„ä¼°ragæ€§èƒ½</h3><p><a target="_blank" rel="noopener" href="https://github.com/zxj-2023/learn-rag-langchain/blob/main/RAGAS-langchian.ipynb">learn-rag-langchain/RAGAS-langchian.ipynb at main Â· zxj-2023/learn-rag-langchain</a></p>
<p>æ£€ç´¢å™¨<br>1.Contextprecision(ä¸Šä¸‹æ–‡ç²¾ç¡®åº¦)ï¼šè¯„ä¼°æ£€ç´¢è´¨é‡ã€‚<br>2.Context Recall(ä¸Šä¸‹æ–‡å¬å›ç‡)ï¼šè¡¡é‡æ£€ç´¢çš„å®Œæ•´æ€§ã€‚<br>ç”Ÿæˆå™¨<br>1.Faithfulness(å¿ å®åº¦)ï¼šè¡¡é‡ç”Ÿæˆç­”æ¡ˆä¸­çš„å¹»è§‰æƒ…å†µã€‚<br>2.AnswerRelevance(ç­”æ¡ˆç›¸å…³æ€§):è¡¡é‡ç­”æ¡ˆå¯¹é—®é¢˜çš„ç›´æ¥æ€§(ç´§æ‰£é—®é¢˜çš„æ ¸å¿ƒ)ã€‚</p>
<p>æœ€ç»ˆçš„RAGASå¾—åˆ†æ˜¯ä»¥ä¸Šå„ä¸ªæŒ‡æ ‡å¾—åˆ†çš„è°ƒå’Œå¹³å‡å€¼ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™äº›æŒ‡æ ‡ç”¨æ¥ç»¼åˆè¯„ä¼°<br>-ä¸ªç³»ç»Ÿæ•´ä½“çš„æ€§èƒ½ã€‚</p>
<h4 id="RAGçš„æ„å»º"><a href="#RAGçš„æ„å»º" class="headerlink" title="RAGçš„æ„å»º"></a>RAGçš„æ„å»º</h4><p>åˆ›å»ºRAGæ–‡æœ¬åˆ†å‰²ã€Embedding model ã€ å‘é‡åº“å­˜å‚¨Chroma</p>
<p>æˆ‘ä»¬ä¸»è¦ä½¿ç”¨ <code>RecursiveCharacterTextSplitter</code> åˆ‡å‰²æ–‡æœ¬ï¼Œé€šè¿‡<code>OpenAIEmbeddings()</code>è¿›è¡Œæ–‡æœ¬ç¼–ç ï¼Œå­˜å‚¨åˆ° <code>VectorStore</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from langchain.vectorstores import Chroma</span><br><span class="line">from langchain.embeddings import OpenAIEmbeddings</span><br><span class="line">from langchain.text_splitter import RecursiveCharacterTextSplitter</span><br><span class="line">from langchain_community.embeddings import DashScopeEmbeddings</span><br><span class="line">embeddings_model = DashScopeEmbeddings(</span><br><span class="line">        model=&quot;text-embedding-v2&quot;,</span><br><span class="line">        dashscope_api_key=openai.api_key,</span><br><span class="line">    )</span><br><span class="line">text_splitter = RecursiveCharacterTextSplitter(chunk_size=500)</span><br><span class="line">#è¿›è¡Œæ–‡æœ¬åˆ†å‰²ï¼Œç”Ÿæˆæ›´å°ã€æ›´æ˜“äºå¤„ç†çš„æ–‡æ¡£å—</span><br><span class="line">docs = text_splitter.split_documents(paper_docs)</span><br><span class="line"></span><br><span class="line">vectorstore = Chroma.from_documents(docs, embeddings_model)</span><br></pre></td></tr></table></figure>
<p>Chroma å‘é‡æ•°æ®åº“é»˜è®¤æƒ…å†µä¸‹æ˜¯å†…å­˜å­˜å‚¨ï¼Œè¿™æ„å‘³ç€æ•°æ®åœ¨ç¨‹åºè¿è¡Œç»“æŸåä¸ä¼šä¿ç•™ã€‚<br>ä½†æ˜¯ï¼ŒChroma ä¹Ÿæ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä¸€ä¸ªè·¯å¾„å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚è¿™æ ·ï¼Œå³ä½¿ç¨‹åºå…³é—­ï¼Œæ•°æ®ä¹Ÿä¼šè¢«ä¿ç•™ï¼Œå¹¶åœ¨ä¸‹æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ã€‚</p>
<h4 id="æ£€ç´¢å™¨çš„æ„å»º"><a href="#æ£€ç´¢å™¨çš„æ„å»º" class="headerlink" title="æ£€ç´¢å™¨çš„æ„å»º"></a>æ£€ç´¢å™¨çš„æ„å»º</h4><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>Chroma</code> å‘é‡åº“çš„ <code>.as_retriever()</code> æ–¹å¼è¿›è¡Œæ£€ç´¢ï¼Œéœ€è¦æ§åˆ¶çš„ä¸»è¦å‚æ•°ä¸º <code>k</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base_retriever = vectorstore.as_retriever(search_kwargs=&#123;&quot;k&quot; : 3&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ectorstore.as_retriever() : è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªå‘é‡æ•°æ®åº“å®ä¾‹ï¼ˆ vectorstore ï¼‰è½¬æ¢ä¸º LangChain ä¸­çš„ä¸€ä¸ªæ£€ç´¢å™¨ï¼ˆ Retriever ï¼‰å¯¹è±¡ã€‚æ£€ç´¢å™¨æ˜¯ LangChain ä¸­è´Ÿè´£æ ¹æ®ç”¨æˆ·æŸ¥è¯¢ä»æ•°æ®æºä¸­è·å–ç›¸å…³æ–‡æ¡£çš„æ ¸å¿ƒç»„ä»¶ã€‚</li>
<li>â€œkâ€ : è¿™ä¸ªé”®è¡¨ç¤ºè¦æ£€ç´¢çš„â€œæœ€ç›¸ä¼¼â€æ–‡æ¡£çš„æ•°é‡ã€‚åœ¨è¿™é‡Œï¼Œ â€œkâ€ : 3 æ„å‘³ç€å½“æ£€ç´¢å™¨æ¥æ”¶åˆ°ä¸€ä¸ªæŸ¥è¯¢æ—¶ï¼Œå®ƒå°†ä»å‘é‡å­˜å‚¨ä¸­è¿”å›ä¸è¯¥æŸ¥è¯¢æœ€ç›¸ä¼¼çš„ 3 ä¸ªæ–‡æ¡£ã€‚è¿™åœ¨ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿä¸­éå¸¸å¸¸è§ï¼Œç”¨äºé™åˆ¶ä¼ é€’ç»™å¤§å‹è¯­è¨€æ¨¡å‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯é‡ï¼Œä»¥æé«˜æ•ˆç‡å’Œç›¸å…³æ€§ã€‚</li>
</ul>
<p>æ£€ç´¢å™¨çš„ä½œç”¨<br>æ£€ç´¢å™¨ï¼ˆRetrieverï¼‰æ˜¯ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯ä»ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚å‘é‡æ•°æ®åº“ã€æ–‡æ¡£åŠ è½½å™¨ç­‰ï¼‰ä¸­æ ¹æ®ç»™å®šçš„æŸ¥è¯¢ï¼ˆqueryï¼‰æ£€ç´¢å‡ºç›¸å…³çš„æ–‡æ¡£æˆ–ä¿¡æ¯ã€‚</p>
<h4 id="promptçš„æ„å»º"><a href="#promptçš„æ„å»º" class="headerlink" title="promptçš„æ„å»º"></a>promptçš„æ„å»º</h4><p>æˆ‘ä»¬éœ€è¦åˆ©ç”¨<code>LLM</code>å¯¹<code>Context</code> ç”Ÿæˆä¸€ç³»åˆ—çš„é—®é¢˜çš„<code>answer</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from langchain import PromptTemplate</span><br><span class="line"></span><br><span class="line">template = &quot;&quot;&quot;You are an assistant for question-answering tasks. </span><br><span class="line">Use the following pieces of retrieved context to answer the question. </span><br><span class="line">If you don&#x27;t know the answer, just say that you don&#x27;t know. </span><br><span class="line"></span><br><span class="line">Question: &#123;question&#125; </span><br><span class="line"></span><br><span class="line">Context: &#123;context&#125; </span><br><span class="line"></span><br><span class="line">Answer:</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">prompt = PromptTemplate(</span><br><span class="line">    template=template, </span><br><span class="line">    input_variables=[&quot;context&quot;,&quot;question&quot;]</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">print(prompt)</span><br></pre></td></tr></table></figure>
<h4 id="ç”Ÿæˆanswer-åˆ©ç”¨LLM"><a href="#ç”Ÿæˆanswer-åˆ©ç”¨LLM" class="headerlink" title="ç”Ÿæˆanswer,åˆ©ç”¨LLM"></a>ç”Ÿæˆ<code>answer</code>,åˆ©ç”¨LLM</h4><p>åˆ©ç”¨ <code>Runnable</code> å®šä¹‰ä¸€ä¸ª <code>chain</code> å®ç°ragå…¨æµç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from langchain.schema.runnable import RunnablePassthrough</span><br><span class="line">from langchain.schema.output_parser import StrOutputParser</span><br><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">llm = ChatOpenAI(</span><br><span class="line">    model_name=&quot;qwen-plus-2025-04-28&quot;, </span><br><span class="line">    temperature=0,</span><br><span class="line">    api_key=&quot;&quot;,</span><br><span class="line">    base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;</span><br><span class="line">    )</span><br><span class="line">#RunnablePassthroughå°†è¾“å…¥æ•°æ®åŸå°ä¸åŠ¨åœ°ä¼ é€’åˆ°è¾“å‡º</span><br><span class="line">#StrOutputParser() å®ƒè¢«ç”¨ä½œ RAG é“¾çš„æœ€åä¸€æ­¥ï¼Œç¡®ä¿æœ€ç»ˆçš„ç­”æ¡ˆä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºã€‚</span><br><span class="line">rag_chain = (</span><br><span class="line">    &#123;&quot;context&quot;: base_retriever,  &quot;question&quot;: RunnablePassthrough()&#125; </span><br><span class="line">    | prompt </span><br><span class="line">    | llm</span><br><span class="line">    | StrOutputParser() </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»º-RAGAs-æ‰€éœ€çš„æ•°æ®"><a href="#åˆ›å»º-RAGAs-æ‰€éœ€çš„æ•°æ®" class="headerlink" title="åˆ›å»º RAGAs æ‰€éœ€çš„æ•°æ®"></a>åˆ›å»º RAGAs æ‰€éœ€çš„æ•°æ®</h4><p>question  Answer   contexts  ground_truths</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># Ragas æ•°æ®é›†æ ¼å¼è¦æ±‚  [&#x27;question&#x27;, &#x27;answer&#x27;, &#x27;contexts&#x27;, &#x27;ground_truths&#x27;]</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;question&quot;: [], &lt;-- é—®é¢˜åŸºäºContextçš„</span><br><span class="line">    &quot;answer&quot;: [], &lt;-- ç­”æ¡ˆåŸºäºLLMç”Ÿæˆçš„</span><br><span class="line">    &quot;contexts&quot;: [], &lt;-- context</span><br><span class="line">    &quot;ground_truths&quot;: [] &lt;-- æ ‡å‡†ç­”æ¡ˆ</span><br><span class="line">&#125;</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">from datasets import Dataset</span><br><span class="line">#æ„å»ºé—®é¢˜ä¸æ ‡å‡†ç­”æ¡ˆï¼ˆé»„é‡‘æ•°æ®é›†ï¼‰</span><br><span class="line">questions = [&quot;What is faithfulness ?&quot;, </span><br><span class="line">             &quot;How many pages are included in the WikiEval dataset, and which years do they cover information from?&quot;,</span><br><span class="line">             &quot;Why is evaluating Retrieval Augmented Generation (RAG) systems challenging?&quot;,</span><br><span class="line">            ]</span><br><span class="line">ground_truths = [&quot;Faithfulness refers to the idea that the answer should be grounded in the given context.&quot;,</span><br><span class="line">                  &quot; To construct the dataset, we first selected 50 Wikipedia pages covering events that have happened since the start of 2022.&quot;,</span><br><span class="line">                &quot;Evaluating RAG architectures is, however, challenging because there are several dimensions to consider: the ability of the retrieval system to identify relevant and focused context passages, the ability of the LLM to exploit such passages in a faithful way, or the quality of the generation itself.&quot;]              </span><br><span class="line">answers = []</span><br><span class="line">contexts = []</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆç­”æ¡ˆ</span><br><span class="line">for query in questions:</span><br><span class="line">    answers.append(rag_chain.invoke(query))</span><br><span class="line">    contexts.append([docs.page_content for docs in base_retriever.get_relevant_documents(query)])</span><br><span class="line"></span><br><span class="line"># æ„å»ºæ•°æ®</span><br><span class="line">data = &#123;</span><br><span class="line">    &quot;user_input&quot;: questions,</span><br><span class="line">    &quot;response&quot;: answers,</span><br><span class="line">    &quot;retrieved_contexts&quot;: contexts,</span><br><span class="line">    &quot;reference&quot;: ground_truths</span><br><span class="line">&#125;</span><br><span class="line">dataset = Dataset.from_dict(data)</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨RAGAs-è¿›è¡Œè¯„ä¼°"><a href="#ä½¿ç”¨RAGAs-è¿›è¡Œè¯„ä¼°" class="headerlink" title="ä½¿ç”¨RAGAs è¿›è¡Œè¯„ä¼°"></a>ä½¿ç”¨RAGAs è¿›è¡Œè¯„ä¼°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#å°†è¯„ä¼°æ•°æ®è½¬æ¢æˆ Ragas æ¡†æ¶ä¸“ç”¨çš„æ ¼å¼ ã€‚</span><br><span class="line">from ragas import EvaluationDataset</span><br><span class="line">evaluation_dataset = EvaluationDataset.from_list(dataset)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç»„å¸¸ç”¨çš„RAGè¯„ä¼°æŒ‡æ ‡ï¼Œåœ¨æ”¶é›†çš„æ•°æ®é›†ä¸Šè¯„ä¼°æˆ‘ä»¬çš„RAGç³»ç»Ÿã€‚æ‚¨å¯ä»¥é€‰æ‹©ä»»ä½•æ¨¡å‹ä½œä¸ºè¯„ä¼°ç”¨LLMæ¥è¿›è¡Œè¯„ä¼°ã€‚<br>ragasé»˜è®¤ä½¿ç”¨openaiçš„api</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from ragas.llms import LangchainLLMWrapper</span><br><span class="line">evaluator_llm = LangchainLLMWrapper(llm)</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from ragas.metrics import LLMContextRecall, Faithfulness, FactualCorrectness</span><br><span class="line">from ragas import evaluate</span><br><span class="line">result = evaluate(dataset=evaluation_dataset,metrics=[LLMContextRecall(), Faithfulness(), FactualCorrectness()],llm=evaluator_llm)</span><br><span class="line">result</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/11/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/rag%E8%AF%84%E4%BC%B0/image-20250713164037571.png" alt="image-20250713164037571"></p>
<h4 id="æŸ¥çœ‹ç»“æœ"><a href="#æŸ¥çœ‹ç»“æœ" class="headerlink" title="æŸ¥çœ‹ç»“æœ"></a>æŸ¥çœ‹ç»“æœ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">pd.set_option(&quot;display.max_colwidth&quot;, None)</span><br><span class="line"></span><br><span class="line">df = result.to_pandas()</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1892529470419736435">RAGç³»ç»Ÿæ•ˆæœéš¾è¯„ï¼Ÿ2025å¹´å¿…å¤‡çš„RAGè¯„ä¼°æ¡†æ¶ä¸å·¥å…·è¯¦è§£ - çŸ¥ä¹</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Jz421Q7Lw?spm_id_from=333.788.videopod.sections&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">å¦‚ä½•åˆ©ç”¨RAGAsè¯„ä¼°RAGç³»ç»Ÿçš„å¥½å_å“”å“©å“”å“©_bilibili</a></p>
<p>ragasä¸­æ–‡æ–‡æ¡£<a target="_blank" rel="noopener" href="https://www.aidoczh.com/ragas/getstarted/rag_eval/index.html#want-help-in-improving-your-ai-application-using-evals">Evaluate a simple RAG - Ragas</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000045262257#item-4-5">äººå·¥æ™ºèƒ½ - RAGç³»ç»Ÿçš„7ä¸ªæ£€ç´¢æŒ‡æ ‡ï¼šä¿¡æ¯æ£€ç´¢ä»»åŠ¡å‡†ç¡®æ€§è¯„ä¼°æŒ‡å— - deephub - SegmentFault æ€å¦</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/zxjavatar.gif">
      <meta itemprop="name" content="å¼ ç†™æµš">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhang XiJun">
      <meta itemprop="description" content="zxj Blogs">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhang XiJun">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/" class="post-title-link" itemprop="url">chunkåˆ†å—ç­–ç•¥</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-07-09 00:00:00" itemprop="dateCreated datePublished" datetime="2025-07-09T00:00:00+08:00">2025-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-08-04 15:13:06" itemprop="dateModified" datetime="2025-08-04T15:13:06+08:00">2025-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">å®ä¹ </span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">æ™¨æ™Ÿæ™ºæ§</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="åˆ†å—ç­–ç•¥"><a href="#åˆ†å—ç­–ç•¥" class="headerlink" title="åˆ†å—ç­–ç•¥"></a>åˆ†å—ç­–ç•¥</h3><p>ä»¥ä¸‹æ˜¯ RAG åº”ç”¨ç¨‹åºçš„å…¸å‹å·¥ä½œæµç¨‹ï¼š</p>
<p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/6878b8fa-5e74-45a1-9a89-5aab92889126_2366x990.gif" alt="6878b8fa-5e74-45a1-9a89-5aab92889126_2366x990"></p>
<p>ä¸»æµä¸»è¦æœ‰äº”ç§åˆ†å—ç­–ç•¥ï¼š</p>
<p><img src="https___substack-post-media.s3.amazonaws.com_public_images_92c70184-ba0f-4877-9a55-e4add0e311ad_870x1116.gif" alt="https___substack-post-media.s3.amazonaws.com_public_images_92c70184-ba0f-4877-9a55-e4add0e311ad_870x1116"></p>
<h4 id="Fixed-size-chunking-å›ºå®šå¤§å°çš„åˆ†å—"><a href="#Fixed-size-chunking-å›ºå®šå¤§å°çš„åˆ†å—" class="headerlink" title="Fixed-size chunking å›ºå®šå¤§å°çš„åˆ†å—"></a>Fixed-size chunking å›ºå®šå¤§å°çš„åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/98c422a0-f0e2-457c-a256-4476a56a601f_943x232.png" alt="98c422a0-f0e2-457c-a256-4476a56a601f_943x232"></p>
<p>å°†æ–‡æœ¬ä»¥å›ºå®šé•¿åº¦åˆ†å—ï¼Œoverlapä¸ºæ¯ä¸ªå—çš„é‡åˆç¨‹åº¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æœç²’å¥¶ä¼˜æœ‰æœç²’ï¼Œæ¬¢è¿å…³æ³¨æˆ‘ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢AIã€‚&quot;</span></span><br><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> CharacterTextSplitter</span><br><span class="line"></span><br><span class="line">text_splitter = CharacterTextSplitter(</span><br><span class="line">    separator=<span class="string">&quot;&quot;</span>,<span class="comment">#æŒ‰å­—åˆ‡åˆ†</span></span><br><span class="line">    chunk_size=<span class="number">5</span>,</span><br><span class="line">    chunk_overlap=<span class="number">1</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span>,<span class="comment">#ä»¥é•¿åº¦è®¡ç®—</span></span><br><span class="line">    is_separator_regex=<span class="literal">False</span>,<span class="comment">#ä¸è§†ä¸ºæ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">)</span><br><span class="line">text_splitter.split_text(text)</span><br></pre></td></tr></table></figure>
<h4 id="Semantic-chunking-è¯­ä¹‰åˆ†å—"><a href="#Semantic-chunking-è¯­ä¹‰åˆ†å—" class="headerlink" title="Semantic chunking è¯­ä¹‰åˆ†å—"></a>Semantic chunking è¯­ä¹‰åˆ†å—</h4><p><img src="https___substack-post-media.s3.amazonaws.com_public_images_a6ad83a6-2879-4c77-9e49-393f16577aef_1066x288.gif" alt="https___substack-post-media.s3.amazonaws.com_public_images_a6ad83a6-2879-4c77-9e49-393f16577aef_1066x288"></p>
<p>å…ˆå°†æ–‡æœ¬åˆ†æ®µï¼Œç„¶åä¸ºæ¯ä¸ªæ®µè¿›è¡ŒåµŒå…¥ï¼Œè‹¥ä¸¤ä¸ªæ®µæœ‰è¾ƒé«˜çš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œåˆ™åˆå¹¶æˆä¸€ä¸ªå—ï¼Œä¸€ç›´åˆå¹¶åˆ°ä½™å¼¦ç›¸ä¼¼åº¦æ˜¾è‘—ä¸‹é™ï¼Œå†ä»æ–°çš„å—å¼€å§‹</p>
<p>éœ€è¦è®¾å®šé˜ˆå€¼æ¥ç¡®å®šä½™å¼¦ç›¸ä¼¼åº¦æ˜¯å¦æ˜¾è‘—ä¸‹é™ï¼Œè¿™å› æ–‡æ¡£è€Œå¼‚ã€‚</p>
<p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/image-20250710150106274.png" alt="image-20250710150106274"></p>
<p>å…·ä½“å®ç°æ€è·¯ï¼šåˆ©ç”¨æ»‘åŠ¨çª—å£ï¼Œä»ç¬¬ä¸€å¥å¾€åç§»åŠ¨æ»‘åŠ¨çª—å£ï¼Œå¦‚å›¾ï¼Œemed1ä¸emed2ç›¸å·®sen3ï¼Œè®¡ç®—å‡ºæ¥çš„distanceå†³å®šsen3æ˜¯å¦åŠ å…¥chunk1ï¼Œä»¥æ­¤ç±»æ¨</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ©ç”¨langchainè°ƒç”¨</span></span><br><span class="line"><span class="keyword">from</span> langchain_experimental.text_splitter <span class="keyword">import</span> SemanticChunker</span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line">embeddings_model = DashScopeEmbeddings(</span><br><span class="line">        model=<span class="string">&quot;text-embedding-v2&quot;</span>,</span><br><span class="line">        dashscope_api_key=<span class="string">&quot;&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">semantic_chunk=SemanticChunker(</span><br><span class="line">    embeddings=embeddings_model,<span class="comment">#åµŒå…¥æ¨¡å‹</span></span><br><span class="line">    breakpoint_threshold_type=<span class="string">&quot;percentile&quot;</span>,<span class="comment">#å®šä¹‰å¦‚ä½•è®¡ç®—è¯­ä¹‰æ–­ç‚¹é˜ˆå€¼</span></span><br><span class="line">    breakpoint_threshold_amount=<span class="number">95</span>,<span class="comment">#è®¾å®šé˜ˆå€¼</span></span><br><span class="line">    <span class="comment">#min_chunk_size=500#é™åˆ¶ç”Ÿæˆå—æœ€å°çš„å­—ç¬¦æ•°ï¼Œé¿å…ç”Ÿæˆæ— æ„ä¹‰çš„å—</span></span><br><span class="line">    sentence_split_regex=<span class="string">r&#x27;[ã€‚ï¼ï¼Ÿ.\n]&#x27;</span>,<span class="comment">#è¯­å¥åˆ‡åˆ†</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/1664186">LangChain æ­é… QWen è¸©å‘-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº</a></p>
<p>ä½¿ç”¨OpenAIEmbeddingsé…ç½®embeddingæ¨¡å‹ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªå…³é”®å‚æ•°</p>
<p><code>check_embedding_ctx_length = False</code> çš„ä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>å…³é—­ langchain_openai åœ¨è°ƒç”¨åµŒå…¥æ¨¡å‹å‰å¯¹è¾“å…¥æ–‡æœ¬é•¿åº¦çš„æ£€æŸ¥ä¸è‡ªåŠ¨æˆªæ–­/åˆ†æ®µé€»è¾‘ã€‚</strong></p>
</blockquote>
<p>ä½† DashScope çš„ <code>text-embedding-v4</code> æ¥å£ï¼š</p>
<ul>
<li>å¯¹è¾“å…¥æ ¼å¼è¦æ±‚æ›´ä¸¥æ ¼ï¼ˆå¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œä¸èƒ½æ˜¯åˆ†æ®µåçš„å¤æ‚ç»“æ„ï¼‰ã€‚</li>
<li>ä¸æ¥å— <code>langchain_openai</code> é»˜è®¤ç”Ÿæˆçš„<strong>åˆ†æ®µåçš„åˆ—è¡¨åµŒå¥—ç»“æ„</strong>ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from langchain_openai import OpenAIEmbeddings,  OpenAI</span><br><span class="line">embeddings = OpenAIEmbeddings(</span><br><span class="line">api_key=&quot;sk-&quot;, </span><br><span class="line">base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,</span><br><span class="line">model=&quot;text-embedding-v4&quot;,</span><br><span class="line">check_embedding_ctx_length = False,</span><br><span class="line">dimensions=1536</span><br><span class="line">)</span><br><span class="line">result=embeddings.embed_query(&quot;Hello, world!&quot;)</span><br><span class="line">print(len(result))</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æºä»£ç ç†è§£è§æœ€å</p>
<h4 id="Recursive-chunking-é€’å½’åˆ†å—"><a href="#Recursive-chunking-é€’å½’åˆ†å—" class="headerlink" title="Recursive chunking é€’å½’åˆ†å—"></a>Recursive chunking é€’å½’åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/f4009caa-34fc-48d6-8102-3d0f6f2c1386_1066x316.gif" alt="f4009caa-34fc-48d6-8102-3d0f6f2c1386_1066x316"></p>
<p>å…ˆä¾æ®å¤§çš„æ®µè½è¿›è¡Œåˆ†å—ï¼Œå†å¯¹æ¯ä¸ªå—è¿›è¡Œå¤„ç†ï¼Œè‹¥ç¬¦åˆchunk-sizeçš„é™åˆ¶ï¼Œåˆ™ä¸ä¼šå†åˆ†</p>
<p>ç»“æœå¯èƒ½å¦‚ä¸‹</p>
<p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/b0e40cc1-996f-48f4-9306-781b112536e4_984x428.png" alt="b0e40cc1-996f-48f4-9306-781b112536e4_984x428"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå—ï¼ˆç´«è‰²çš„ä¸¤ä¸ªæ®µè½ã€‚æ¥ä¸‹æ¥ï¼Œç¬¬1æ®µè¿›ä¸€æ­¥æ‹†åˆ†ä¸ºæ›´å°çš„å—ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_text_splitters <span class="keyword">import</span> RecursiveCharacterTextSplitter</span><br><span class="line"></span><br><span class="line">recursive_splitter_chinese = RecursiveCharacterTextSplitter(</span><br><span class="line">    chunk_size=<span class="number">50</span>,</span><br><span class="line">    chunk_overlap=<span class="number">10</span>,</span><br><span class="line">    length_function=<span class="built_in">len</span>,</span><br><span class="line">    separators=[<span class="string">&quot;\n\n&quot;</span>, <span class="string">&quot;ã€‚&quot;</span>, <span class="string">&quot;ï¼Œ&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>]<span class="comment">#ä¸­æ–‡çš„åˆ†éš”ç¬¦ï¼Œå¯ä»¥ç”¨é€—å·å¥å·</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="Document-structure-based-chunking-åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—"><a href="#Document-structure-based-chunking-åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—" class="headerlink" title="Document structure-based chunking åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—"></a>Document structure-based chunking åŸºäºæ–‡æ¡£ç»“æ„çš„åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/e8febecd-ee68-42ff-ab06-41a0a3a43cd3_1102x306.gif" alt="e8febecd-ee68-42ff-ab06-41a0a3a43cd3_1102x306"></p>
<p>æ ¹æ®æ–‡æ¡£çš„å›ºæœ‰ç»“æ„è¿›è¡Œåˆ†å—ï¼Œå¦‚markdownçš„ä¸€çº§æ ‡é¢˜äºŒçº§æ ‡é¢˜ç­‰</p>
<p><code>langchain.text_splitter</code>ä¸­æœ‰ä¸¤ä¸ªç”¨äºmdæ–‡æ¡£åˆ†å—çš„ç±»ï¼Œ<code>MarkdownTextSplitter</code>ä¸<code>MarkdownHeaderTextSplitter</code></p>
<p>äºŒè€…åŒºåˆ«ä¸»è¦åœ¨ï¼šå‰è€…ç»§æ‰¿äº<code>RecursiveCharacterTextSplitter</code>é€’å½’åˆ†å—ï¼Œå®ƒä¼šå°è¯•æ²¿ç€ Markdown æ ¼å¼çš„æ ‡é¢˜è¿›è¡Œåˆ†å‰²ï¼Œä½†å…¶æ ¸å¿ƒä»ç„¶æ˜¯åŸºäºå­—ç¬¦çš„é€’å½’åˆ†å‰²ï¼›åè€…ä¸“æ³¨äº åŸºäº Markdown æ ‡é¢˜çš„ç»“æ„åŒ–åˆ†å‰² ï¼Œå¹¶èƒ½å°†æ ‡é¢˜ä¿¡æ¯ä½œä¸ºå…ƒæ•°æ®ä¿ç•™ï¼Œæ›´é€‚åˆéœ€è¦ä¿æŒ Markdown æ–‡æ¡£å±‚çº§ç»“æ„çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>MarkdownHeaderTextSplitter</code> æœ¬èº«ä¸ç›´æ¥æä¾›é™åˆ¶å—å†…å®¹é•¿åº¦çš„å‚æ•°ï¼Œä½†å¯ä»¥é€šè¿‡ä¸ <code>RecursiveCharacterTextSplitter</code> ç­‰å…¶ä»–æ–‡æœ¬åˆ†å‰²å™¨ç»“åˆä½¿ç”¨æ¥æœ‰æ•ˆæ§åˆ¶å—çš„å¤§å°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> MarkdownHeaderTextSplitter</span><br><span class="line">headers_to_split_on = [</span><br><span class="line">    (<span class="string">&quot;#&quot;</span>, <span class="string">&quot;Header 1&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;##&quot;</span>, <span class="string">&quot;Header 2&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;###&quot;</span>, <span class="string">&quot;Header 3&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">markdown_splitter = MarkdownHeaderTextSplitter(headers_to_split_on)</span><br><span class="line">md_header_splits = markdown_splitter.split_text(markdown_document)</span><br></pre></td></tr></table></figure>
<p>å­˜å‚¨ç»“æ„ç±»ä¼¼å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Document(metadata=&#123;&#x27;Header 1&#x27;: &#x27;Foo&#x27;, &#x27;Header 2&#x27;: &#x27;Bar&#x27;&#125;, page_content=&#x27;Hi this is Jim  \nHi this is Joe&#x27;),</span><br><span class="line"> Document(metadata=&#123;&#x27;Header 1&#x27;: &#x27;Foo&#x27;, &#x27;Header 2&#x27;: &#x27;Bar&#x27;, &#x27;Header 3&#x27;: &#x27;Boo&#x27;&#125;, page_content=&#x27;Hi this is Lance&#x27;),</span><br><span class="line"> Document(metadata=&#123;&#x27;Header 1&#x27;: &#x27;Foo&#x27;, &#x27;Header 2&#x27;: &#x27;Baz&#x27;&#125;, page_content=&#x27;Hi this is Molly&#x27;)]</span><br></pre></td></tr></table></figure>
<h4 id="LLM-based-chunking-åŸºäº-LLM-çš„åˆ†å—"><a href="#LLM-based-chunking-åŸºäº-LLM-çš„åˆ†å—" class="headerlink" title="LLM-based chunking åŸºäº LLM çš„åˆ†å—"></a>LLM-based chunking åŸºäº LLM çš„åˆ†å—</h4><p><img src="/2025/07/09/%E5%AE%9E%E4%B9%A0/%E6%99%A8%E6%99%9F%E6%99%BA%E6%8E%A7/chunk%E5%88%86%E5%9D%97%E7%AD%96%E7%95%A5/4d1b6d60-8956-4030-8525-d899ee61a9d5_1140x198.gif" alt="4d1b6d60-8956-4030-8525-d899ee61a9d5_1140x198"></p>
<p>åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œåˆ†å—</p>
<p>langchainæ²¡æœ‰æä¾›å®˜æ–¹çš„ç±»å®ç°LLM-based chunking</p>
<p>ä½†æ˜¯æˆ‘åœ¨æ‰¾åˆ°äº†åˆ«äººå®ç°çš„agentic_chunker<a target="_blank" rel="noopener" href="https://github.com/FullStackRetrieval-com/RetrievalTutorials/blob/main/tutorials/LevelsOfTextSplitting/agentic_chunker.py">RetrievalTutorials/tutorials/LevelsOfTextSplitting/agentic_chunker.py at main Â· FullStackRetrieval-com/RetrievalTutorials</a>ï¼Œå¯ä¾›å‚è€ƒ</p>
<p>åè®°ï¼šagentic chunkå¤§æ¦‚çš„æ€è·¯ä¸ºå…ˆè¿›è¡Œåˆæ­¥åˆ†æ®µï¼ŒæŒ‰ç…§é•¿åº¦æˆ–é€’å½’ï¼Œç„¶åè®©å¤§æ¨¡å‹ç”Ÿæˆè¿™ä¸€æ®µçš„æ¦‚è¦ï¼Œå°†æ®µä¸æ®µåˆå¹¶ç”Ÿæˆå—ï¼Œä½†æ˜¯æµ‹è¯•ä¸‹æ¥ï¼Œä¸€ä¸ªæ–‡æ¡£çš„å†…å®¹åŒè´¨åŒ–å¾ˆä¸¥é‡ï¼ŒåŸºæœ¬ä¸Šéƒ½åˆ†åˆ°ä¸€å—é‡Œäº†ï¼Œè€Œä¸”è¿™ä¸ªä¸»è¦è¿˜æ˜¯æç¤ºè¯å·¥ç¨‹ï¼Œåˆ†å—å¹¶ä¸ç³»ç»Ÿï¼Œçœ‹ä¸ªä¹å§</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zxj-2023/chunks-strategy-/blob/main/agentic_chunker.py">chunks-strategy-/agentic_chunker.py at main Â· zxj-2023/chunks-strategy-</a>ä»£ç ç¨ä½œæ›´æ–°ï¼Œå¼ƒç”¨äº†éƒ¨åˆ†åº“</p>
<h3 id="embedding"><a href="#embedding" class="headerlink" title="embedding"></a>embedding</h3><p>ä¹‹å‰å¯¹chunkingå’Œembeddingçš„ç†è§£ä¸å¤Ÿæ¸…æ™°ï¼Œchunkingæ˜¯å¯¹æ–‡æœ¬è¿›è¡Œåˆ†å—ï¼Œç”±äºå¤§å¤šæ•°æ–‡æœ¬åµŒå…¥æ¨¡å‹å¯¹è¾“å…¥æ–‡æœ¬é•¿åº¦æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œå¦‚æœä¸åˆ†å—åˆ™æ— æ³•embeddingï¼Œä»è€Œæ— æ³•æ›´å¥½çš„è¿›è¡Œå‘é‡åŒ–æˆ–è€…æ›´å¥½åœ°å‚¨å­˜åœ¨çŸ¥è¯†åº“ä¸­ï¼Œæå‡retrieveræ€§èƒ½ï¼›embeddingåˆ™æ˜¯å°†æ–‡æœ¬æ˜ å°„åˆ°å‘é‡ç©ºé—´ï¼Œä¸ºäº†æ›´å¥½çš„ç›¸ä¼¼åº¦è®¡ç®—</p>
<h3 id="è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜"><a href="#è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜" class="headerlink" title="è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜"></a>è¯­ä¹‰åˆ†å—çš„æºä»£ç å®æˆ˜</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">å°†æ–‡æœ¬åˆ’åˆ†æˆå•å¥ï¼Œå¯ä»¥æŒ‰ç…§æ ‡ç‚¹ç¬¦å·åˆ’åˆ†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">single_sentences_list = re.split(<span class="string">r&#x27;(?&lt;=[ã€‚ï¼ï¼Ÿ])&#x27;</span>, essay)</span><br><span class="line"><span class="comment"># ç§»é™¤å¯èƒ½å­˜åœ¨çš„ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">single_sentences_list = [s.strip() <span class="keyword">for</span> s <span class="keyword">in</span> single_sentences_list <span class="keyword">if</span> s.strip()]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æˆ‘ä»¬éœ€è¦ä¸ºå•ä¸ªå¥å­æ‹¼æ¥æ›´å¤šçš„å¥å­ï¼Œä½†æ˜¯ `list` æ·»åŠ æ¯”è¾ƒå›°éš¾ã€‚å› æ­¤å°†å…¶è½¬æ¢ä¸ºå­—å…¸åˆ—ï¼ˆ`List[dict]`ï¼‰</span></span><br><span class="line"><span class="string">&#123; &#x27;sentence&#x27; : XXX  , &#x27;index&#x27; : 0&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">sentences = [&#123;<span class="string">&#x27;sentence&#x27;</span>: x, <span class="string">&#x27;index&#x27;</span> : i&#125; <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(single_sentences_list)]</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ©ç”¨æ»‘åŠ¨çª—å£åˆ†æ®µ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">combine_sentences</span>(<span class="params">sentences, buffer_size=<span class="number">1</span></span>):</span><br><span class="line">    combined_sentences = [</span><br><span class="line">        <span class="string">&#x27; &#x27;</span>.join(sentences[j][<span class="string">&#x27;sentence&#x27;</span>] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(i - buffer_size, <span class="number">0</span>), <span class="built_in">min</span>(i + buffer_size + <span class="number">1</span>, <span class="built_in">len</span>(sentences))))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sentences))</span><br><span class="line">    ]   </span><br><span class="line">    <span class="comment"># æ›´æ–°åŸå§‹å­—å…¸åˆ—è¡¨ï¼Œæ·»åŠ ç»„åˆåçš„å¥å­</span></span><br><span class="line">    <span class="keyword">for</span> i, combined_sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(combined_sentences):</span><br><span class="line">        sentences[i][<span class="string">&#x27;combined_sentence&#x27;</span>] = combined_sentence</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sentences</span><br><span class="line"></span><br><span class="line">sentences = combine_sentences(sentences)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¥ä¸‹æ¥ä½¿ç”¨**embedding model**å¯¹**sentences** è¿›è¡Œç¼–ç </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> DashScopeEmbeddings</span><br><span class="line">embeddings_model = DashScopeEmbeddings(</span><br><span class="line">        model=<span class="string">&quot;text-embedding-v2&quot;</span>,</span><br><span class="line">        dashscope_api_key=<span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line"><span class="comment"># æå–æ‰€æœ‰ç»„åˆåçš„å¥å­ç”¨äº embedding</span></span><br><span class="line">combined_sentences_to_embed = [x[<span class="string">&#x27;combined_sentence&#x27;</span>] <span class="keyword">for</span> x <span class="keyword">in</span> sentences]</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹å¥å­è¿›è¡Œ embedding</span></span><br><span class="line">embeddings = embeddings_model.embed_documents(combined_sentences_to_embed)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;æˆåŠŸå¯¹ <span class="subst">&#123;<span class="built_in">len</span>(embeddings)&#125;</span> ä¸ªå¥å­è¿›è¡Œäº† embeddingã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†embeddingæ·»åŠ åˆ°sentenceä¸­</span></span><br><span class="line"><span class="keyword">for</span> i, sentence <span class="keyword">in</span> <span class="built_in">enumerate</span>(sentences):</span><br><span class="line">    sentence[<span class="string">&#x27;combined_sentence_embedding&#x27;</span>] = embeddings[i]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">æ¥ä¸‹æ¥éœ€è¦æ ¹æ®ä½™å¼¦ç›¸ä¼¼åº¦è¿›è¡Œåˆ‡åˆ†</span></span><br><span class="line"><span class="string">é€šè¿‡è®¡ç®—ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ä½™å¼¦å€¼æ¥è¡¡é‡ç›¸ä¼¼æ€§</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cosine_similarity</span>(<span class="params">vec1, vec2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Calculate the cosine similarity between two vectors.&quot;&quot;&quot;</span></span><br><span class="line">    dot_product = np.dot(vec1, vec2)</span><br><span class="line">    norm_vec1 = np.linalg.norm(vec1)</span><br><span class="line">    norm_vec2 = np.linalg.norm(vec2)</span><br><span class="line">    <span class="keyword">return</span> dot_product / (norm_vec1 * norm_vec2)</span><br><span class="line"><span class="comment">#éå†ï¼Œè®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_cosine_distances</span>(<span class="params">sentences</span>):</span><br><span class="line">    distances = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sentences) - <span class="number">1</span>):</span><br><span class="line">        embedding_current = sentences[i][<span class="string">&#x27;combined_sentence_embedding&#x27;</span>]</span><br><span class="line">        embedding_next = sentences[i + <span class="number">1</span>][<span class="string">&#x27;combined_sentence_embedding&#x27;</span>]</span><br><span class="line">        <span class="comment"># Calculate cosine similarity</span></span><br><span class="line">        similarity = cosine_similarity(embedding_current, embedding_next)</span><br><span class="line">        <span class="comment"># Convert to cosine distance</span></span><br><span class="line">        distance = <span class="number">1</span> - similarity</span><br><span class="line">        distances.append(distance)</span><br><span class="line">        <span class="comment"># Store distance in the dictionary</span></span><br><span class="line">        sentences[i][<span class="string">&#x27;distance_to_next&#x27;</span>] = distance</span><br><span class="line">    <span class="keyword">return</span> distances, sentences</span><br><span class="line"></span><br><span class="line">distances, sentences = calculate_cosine_distances(sentences)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®é˜ˆå€¼åˆ’åˆ†</span></span><br><span class="line">breakpoint_percentile_threshold = <span class="number">95</span></span><br><span class="line">breakpoint_distance_threshold = np.percentile(distances, breakpoint_percentile_threshold)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è·ç¦»çš„ç¬¬95ä¸ªç™¾åˆ†ä½é˜ˆå€¼æ˜¯:&quot;</span>, breakpoint_distance_threshold)</span><br><span class="line"><span class="comment"># æ‰¾åˆ°æ‰€æœ‰è·ç¦»å¤§äºé˜ˆå€¼çš„ç‚¹çš„ç´¢å¼•ï¼Œè¿™äº›ç´¢å¼•å°±æ˜¯æˆ‘ä»¬çš„åˆ‡åˆ†ç‚¹</span></span><br><span class="line">indices_above_thresh = [i <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(distances) <span class="keyword">if</span> x &gt; breakpoint_distance_threshold]</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆå§‹åŒ–å—çš„èµ·å§‹å¥å­ç´¢å¼•ã€‚æˆ‘ä»¬å°†æ ¹æ®ä¹‹å‰è®¡ç®—å‡ºçš„è¯­ä¹‰åˆ†å‰²ç‚¹ï¼ˆ`indices_above_thresh`ï¼‰æ¥åˆ‡åˆ†å¥å­åˆ—è¡¨ã€‚</span></span><br><span class="line">start_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æœ€ç»ˆç»„åˆæˆçš„ã€å…·æœ‰è¯­ä¹‰è¿è´¯æ€§çš„æ–‡æœ¬å—ã€‚</span></span><br><span class="line">chunks = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†æ‰€æœ‰è¯†åˆ«å‡ºçš„è¯­ä¹‰åˆ†å‰²ç‚¹ï¼ˆè¿™äº›æ˜¯å¥å­åˆ—è¡¨ `sentences` ä¸­çš„ç´¢å¼•ï¼‰ã€‚</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> indices_above_thresh:</span><br><span class="line">    <span class="comment"># ç¡®å®šå½“å‰æ–‡æœ¬å—çš„ç»“æŸç‚¹ï¼Œå³å½“å‰çš„åˆ†å‰²ç‚¹ç´¢å¼•ã€‚</span></span><br><span class="line">    end_index = index</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä»åŸå§‹å¥å­åˆ—è¡¨ï¼ˆ`sentences`ï¼‰ä¸­åˆ‡ç‰‡ï¼Œæå–ä»ä¸Šä¸€ä¸ªåˆ†å‰²ç‚¹åˆ°å½“å‰åˆ†å‰²ç‚¹ä¹‹é—´çš„æ‰€æœ‰å¥å­ã€‚</span></span><br><span class="line">    <span class="comment"># `end_index + 1` æ˜¯ä¸ºäº†åœ¨åˆ‡ç‰‡æ—¶åŒ…å«ç»“æŸç´¢å¼•æŒ‡å‘çš„é‚£ä¸ªå¥å­ã€‚</span></span><br><span class="line">    group = sentences[start_index:end_index + <span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†åˆ‡åˆ†å‡ºçš„å¥å­ç»„ï¼ˆ`group`ï¼‰ä¸­çš„æ‰€æœ‰ &#x27;sentence&#x27; å­—æ®µçš„å€¼åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä¸²ï¼Œå¥å­ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚</span></span><br><span class="line">    combined_text = <span class="string">&#x27; &#x27;</span>.join([d[<span class="string">&#x27;sentence&#x27;</span>] <span class="keyword">for</span> d <span class="keyword">in</span> group])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å°†åˆå¹¶åçš„æ–‡æœ¬å—æ·»åŠ åˆ° `chunks` åˆ—è¡¨ä¸­ã€‚</span></span><br><span class="line">    chunks.append(combined_text)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ›´æ–°ä¸‹ä¸€ä¸ªæ–‡æœ¬å—çš„èµ·å§‹ç´¢å¼•ï¼Œè®¾ç½®ä¸ºå½“å‰åˆ†å‰²ç‚¹çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œä¸ºå¤„ç†ä¸‹ä¸€ä¸ªå—åšå‡†å¤‡ã€‚</span></span><br><span class="line">    start_index = index + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤„ç†æœ€åä¸€ä¸ªæ–‡æœ¬å—ã€‚</span></span><br><span class="line"><span class="comment"># å¾ªç¯ç»“æŸåï¼Œå¦‚æœ `start_index` ä»ç„¶å°äºå¥å­æ€»æ•°ï¼Œè¯´æ˜ä»æœ€åä¸€ä¸ªåˆ†å‰²ç‚¹åˆ°æ–‡æœ¬æœ«å°¾è¿˜æœ‰å‰©ä½™çš„å¥å­ã€‚</span></span><br><span class="line"><span class="keyword">if</span> start_index &lt; <span class="built_in">len</span>(sentences):</span><br><span class="line">    <span class="comment"># å°†è¿™äº›å‰©ä½™çš„å¥å­åˆå¹¶æˆæœ€åä¸€ä¸ªæ–‡æœ¬å—ã€‚</span></span><br><span class="line">    combined_text = <span class="string">&#x27; &#x27;</span>.join([d[<span class="string">&#x27;sentence&#x27;</span>] <span class="keyword">for</span> d <span class="keyword">in</span> sentences[start_index:]])</span><br><span class="line">    chunks.append(combined_text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶ï¼Œ`chunks` åˆ—è¡¨åŒ…å«äº†æ‰€æœ‰æ ¹æ®è¯­ä¹‰è·ç¦»åˆ‡åˆ†å’Œé‡ç»„åçš„æ–‡æœ¬å—ã€‚</span></span><br><span class="line"><span class="keyword">for</span> i, chunk <span class="keyword">in</span> <span class="built_in">enumerate</span>(chunks):</span><br><span class="line">    buffer = <span class="number">200</span></span><br><span class="line">    <span class="built_in">print</span> (<span class="string">f&quot;Chunk #<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (chunk[:buffer].strip())</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> (chunk[-buffer:].strip())</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a target="_blank" rel="noopener" href="https://www.dailydoseofds.com/p/5-chunking-strategies-for-rag/">RAG çš„ 5 ç§åˆ†å—ç­–ç•¥ â€”- 5 Chunking Strategies For RAG</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wjinjie/article/details/148660229">ä¸€æ–‡è¯»æ‡‚ Qwen3 æœ€æ–°å¼€æºçš„ Embedding å’Œ Rerank æ¨¡å‹ä¼˜åŠ¿ï¼_qwen-rerank-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1dr421x7Su/?spm_id_from=333.337.search-card.all.click&amp;vd_source=bacf29bd4bb51f2ecf08a1ac7c7d8f11">ä¸€ç«™å¸®ä½ é€‰æ‹©RAGä¸­çš„æ–‡æœ¬åˆ‡åˆ†ç­–ç•¥_å“”å“©å“”å“©_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/The_Thieves/article/details/148747334">LangChain è¯­ä¹‰æ–‡æœ¬æ‹†åˆ†æŒ‡å—ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„æ™ºèƒ½åˆ†å—æŠ€æœ¯å®æˆ˜_langchain è¯­ä¹‰åˆ†å‰²-CSDNåšå®¢</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å¼ ç†™æµš</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™è®¿é—®æ•° fa fa-user æ¬¡"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="æœ¬ç«™æ€»è®¿é—®é‡ fa fa-eye æ¬¡"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="400" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
